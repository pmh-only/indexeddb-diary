{"ast":null,"code":"/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport dialog from '../modules/dialog';\nimport anchor from '../modules/_anchor';\nexport default {\n  name: 'link',\n  display: 'dialog',\n  add: function add(core) {\n    core.addModule([dialog, anchor]);\n    var context = core.context;\n    var contextLink = context.link = {\n      focusElement: null,\n      // @Override dialog // This element has focus when the dialog is opened.\n      _linkAnchor: null,\n      anchorCtx: null\n    };\n    /** link dialog */\n\n    var link_dialog = this.setDialog(core);\n    contextLink.modal = link_dialog;\n    /** link controller */\n\n    var link_controller = this.setController_LinkButton(core);\n    contextLink.linkController = link_controller;\n    link_dialog.querySelector('form').addEventListener('submit', this.submit.bind(core));\n    link_controller.addEventListener('click', this.onClick_linkController.bind(core));\n    /** append html */\n\n    context.dialog.modal.appendChild(link_dialog);\n    /** append controller */\n\n    context.element.relative.appendChild(link_controller);\n    /** link event */\n\n    core.plugins.anchor.initEvent.call(core, 'link', link_dialog);\n    contextLink.focusElement = context.anchor.caller.link.urlInput;\n    /** empty memory */\n\n    link_dialog = null, link_controller = null;\n  },\n\n  /** dialog */\n  setDialog: function setDialog(core) {\n    var lang = core.lang;\n    var dialog = core.util.createElement('DIV');\n    var icons = core.icons;\n    dialog.className = 'se-dialog-content';\n    dialog.style.display = 'none';\n    var html = '' + '<form>' + '<div class=\"se-dialog-header\">' + '<button type=\"button\" data-command=\"close\" class=\"se-btn se-dialog-close\" aria-label=\"Close\" title=\"' + lang.dialogBox.close + '\">' + icons.cancel + '</button>' + '<span class=\"se-modal-title\">' + lang.dialogBox.linkBox.title + '</span>' + '</div>' + core.context.anchor.forms.innerHTML + '<div class=\"se-dialog-footer\">' + '<button type=\"submit\" class=\"se-btn-primary\" title=\"' + lang.dialogBox.submitButton + '\"><span>' + lang.dialogBox.submitButton + '</span></button>' + '</div>' + '</form>';\n    dialog.innerHTML = html;\n    return dialog;\n  },\n\n  /** modify controller button */\n  setController_LinkButton: function setController_LinkButton(core) {\n    var lang = core.lang;\n    var icons = core.icons;\n    var link_btn = core.util.createElement('DIV');\n    link_btn.className = 'se-controller se-controller-link';\n    link_btn.innerHTML = '' + '<div class=\"se-arrow se-arrow-up\"></div>' + '<div class=\"link-content\"><span><a target=\"_blank\" href=\"\"></a>&nbsp;</span>' + '<div class=\"se-btn-group\">' + '<button type=\"button\" data-command=\"update\" tabindex=\"-1\" class=\"se-btn se-tooltip\">' + icons.edit + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.edit + '</span></span>' + '</button>' + '<button type=\"button\" data-command=\"unlink\" tabindex=\"-1\" class=\"se-btn se-tooltip\">' + icons.unlink + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.unlink + '</span></span>' + '</button>' + '<button type=\"button\" data-command=\"delete\" tabindex=\"-1\" class=\"se-btn se-tooltip\">' + icons.delete + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.remove + '</span></span>' + '</button>' + '</div>' + '</div>';\n    return link_btn;\n  },\n\n  /**\n   * @Override dialog\n   */\n  open: function open() {\n    this.plugins.dialog.open.call(this, 'link', 'link' === this.currentControllerName);\n  },\n  submit: function submit(e) {\n    this.showLoading();\n    e.preventDefault();\n    e.stopPropagation();\n\n    try {\n      var oA = this.plugins.anchor.createAnchor.call(this, this.context.anchor.caller.link, false);\n\n      if (!this.context.dialog.updateModal) {\n        var selectedFormats = this.getSelectedElements();\n\n        if (selectedFormats.length > 1) {\n          var oFormat = this.util.createElement(selectedFormats[0].nodeName);\n          oFormat.appendChild(oA);\n          if (!this.insertNode(oFormat, null, true)) return;\n        } else {\n          if (!this.insertNode(oA, null, true)) return;\n        }\n\n        this.setRange(oA.childNodes[0], 0, oA.childNodes[0], oA.textContent.length);\n      } else {\n        // set range\n        var textNode = this.context.link._linkAnchor.childNodes[0];\n        this.setRange(textNode, 0, textNode, textNode.textContent.length);\n      }\n    } finally {\n      this.plugins.dialog.close.call(this);\n      this.closeLoading(); // history stack\n\n      this.history.push(false);\n    }\n\n    return false;\n  },\n\n  /**\n   * @Override core\n   */\n  active: function active(element) {\n    if (!element) {\n      if (this.controllerArray.indexOf(this.context.link.linkController) > -1) {\n        this.controllersOff();\n      }\n    } else if (this.util.isAnchor(element) && element.getAttribute('data-image-link') === null) {\n      if (this.controllerArray.indexOf(this.context.link.linkController) < 0) {\n        this.plugins.link.call_controller.call(this, element);\n      }\n\n      return true;\n    }\n\n    return false;\n  },\n\n  /**\n   * @Override dialog\n   */\n  on: function on(update) {\n    this.plugins.anchor.on.call(this, this.context.anchor.caller.link, update);\n  },\n  call_controller: function call_controller(selectionATag) {\n    this.editLink = this.context.link._linkAnchor = this.context.anchor.caller.link.linkAnchor = selectionATag;\n    var linkBtn = this.context.link.linkController;\n    var link = linkBtn.querySelector('a');\n    link.href = selectionATag.href;\n    link.title = selectionATag.textContent;\n    link.textContent = selectionATag.textContent;\n    this.util.addClass(selectionATag, 'on');\n    this.setControllerPosition(linkBtn, selectionATag, 'bottom', {\n      left: 0,\n      top: 0\n    });\n    this.controllersOn(linkBtn, selectionATag, 'link', this.util.removeClass.bind(this.util, this.context.link._linkAnchor, 'on'));\n  },\n  onClick_linkController: function onClick_linkController(e) {\n    e.stopPropagation();\n    var command = e.target.getAttribute('data-command') || e.target.parentNode.getAttribute('data-command');\n    if (!command) return;\n    e.preventDefault();\n\n    if (/update/.test(command)) {\n      this.plugins.dialog.open.call(this, 'link', true);\n    } else if (/unlink/.test(command)) {\n      var sc = this.util.getChildElement(this.context.link._linkAnchor, function (current) {\n        return current.childNodes.length === 0 || current.nodeType === 3;\n      }, false);\n      var ec = this.util.getChildElement(this.context.link._linkAnchor, function (current) {\n        return current.childNodes.length === 0 || current.nodeType === 3;\n      }, true);\n      this.setRange(sc, 0, ec, ec.textContent.length);\n      this.nodeChange(null, null, ['A'], false);\n    } else {\n      /** delete */\n      this.util.removeItem(this.context.link._linkAnchor);\n      this.context.anchor.caller.link.linkAnchor = null;\n      this.focus(); // history stack\n\n      this.history.push(false);\n    }\n\n    this.controllersOff();\n  },\n\n  /**\n   * @Override dialog\n   */\n  init: function init() {\n    this.context.link.linkController.style.display = 'none';\n    this.plugins.anchor.init.call(this, this.context.anchor.caller.link);\n  }\n};","map":{"version":3,"sources":["/github/workspace/node_modules/suneditor/src/plugins/dialog/link.js"],"names":["dialog","anchor","name","display","add","core","addModule","context","contextLink","link","focusElement","_linkAnchor","anchorCtx","link_dialog","setDialog","modal","link_controller","setController_LinkButton","linkController","querySelector","addEventListener","submit","bind","onClick_linkController","appendChild","element","relative","plugins","initEvent","call","caller","urlInput","lang","util","createElement","icons","className","style","html","dialogBox","close","cancel","linkBox","title","forms","innerHTML","submitButton","link_btn","edit","controller","unlink","delete","remove","open","currentControllerName","e","showLoading","preventDefault","stopPropagation","oA","createAnchor","updateModal","selectedFormats","getSelectedElements","length","oFormat","nodeName","insertNode","setRange","childNodes","textContent","textNode","closeLoading","history","push","active","controllerArray","indexOf","controllersOff","isAnchor","getAttribute","call_controller","on","update","selectionATag","editLink","linkAnchor","linkBtn","href","addClass","setControllerPosition","left","top","controllersOn","removeClass","command","target","parentNode","test","sc","getChildElement","current","nodeType","ec","nodeChange","removeItem","focus","init"],"mappings":"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","sourcesContent":["/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport dialog from '../modules/dialog';\nimport anchor from '../modules/_anchor';\n\nexport default {\n    name: 'link',\n    display: 'dialog',\n    add: function (core) {\n        core.addModule([dialog, anchor]);\n\n        const context = core.context;\n        const contextLink = context.link = {\n            focusElement: null, // @Override dialog // This element has focus when the dialog is opened.\n            _linkAnchor: null,\n            anchorCtx: null\n        };\n\n        /** link dialog */\n        let link_dialog = this.setDialog(core);\n        contextLink.modal = link_dialog;\n        \n        /** link controller */\n        let link_controller = this.setController_LinkButton(core);\n        contextLink.linkController = link_controller;\n\n        link_dialog.querySelector('form').addEventListener('submit', this.submit.bind(core));\n        link_controller.addEventListener('click', this.onClick_linkController.bind(core));\n\n        /** append html */\n        context.dialog.modal.appendChild(link_dialog);\n\n        /** append controller */\n        context.element.relative.appendChild(link_controller);\n\n        /** link event */\n        core.plugins.anchor.initEvent.call(core, 'link', link_dialog);\n        contextLink.focusElement = context.anchor.caller.link.urlInput;\n\n        /** empty memory */\n        link_dialog = null, link_controller = null;\n    },\n\n    /** dialog */\n    setDialog: function (core) {\n        const lang = core.lang;\n        const dialog = core.util.createElement('DIV');\n        const icons = core.icons;\n\n        dialog.className = 'se-dialog-content';\n        dialog.style.display = 'none';\n        let html = '' +\n            '<form>' +\n                '<div class=\"se-dialog-header\">' +\n                    '<button type=\"button\" data-command=\"close\" class=\"se-btn se-dialog-close\" aria-label=\"Close\" title=\"' + lang.dialogBox.close + '\">' +\n                        icons.cancel +\n                    '</button>' +\n                    '<span class=\"se-modal-title\">' + lang.dialogBox.linkBox.title + '</span>' +\n                '</div>' +\n                core.context.anchor.forms.innerHTML +\n                '<div class=\"se-dialog-footer\">' +\n                    '<button type=\"submit\" class=\"se-btn-primary\" title=\"' + lang.dialogBox.submitButton + '\"><span>' + lang.dialogBox.submitButton + '</span></button>' +\n                '</div>' +\n            '</form>';\n\n        dialog.innerHTML = html;\n        return dialog;\n    },\n\n    /** modify controller button */\n    setController_LinkButton: function (core) {\n        const lang = core.lang;\n        const icons = core.icons;\n        const link_btn = core.util.createElement('DIV');\n\n        link_btn.className = 'se-controller se-controller-link';\n        link_btn.innerHTML = '' +\n            '<div class=\"se-arrow se-arrow-up\"></div>' +\n            '<div class=\"link-content\"><span><a target=\"_blank\" href=\"\"></a>&nbsp;</span>' +\n                '<div class=\"se-btn-group\">' +\n                    '<button type=\"button\" data-command=\"update\" tabindex=\"-1\" class=\"se-btn se-tooltip\">' +\n                        icons.edit +\n                        '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.edit + '</span></span>' +\n                    '</button>' +\n                    '<button type=\"button\" data-command=\"unlink\" tabindex=\"-1\" class=\"se-btn se-tooltip\">' +\n                        icons.unlink +\n                        '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.unlink + '</span></span>' +\n                    '</button>' +\n                    '<button type=\"button\" data-command=\"delete\" tabindex=\"-1\" class=\"se-btn se-tooltip\">' +\n                        icons.delete +\n                        '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.remove + '</span></span>' +\n                    '</button>' +\n                '</div>' +\n            '</div>';\n\n        return link_btn;\n    },\n\n    /**\n     * @Override dialog\n     */\n    open: function () {\n        this.plugins.dialog.open.call(this, 'link', 'link' === this.currentControllerName);\n    },\n\n    submit: function (e) {\n        this.showLoading();\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        try {\n            const oA = this.plugins.anchor.createAnchor.call(this, this.context.anchor.caller.link, false);\n    \n            if (!this.context.dialog.updateModal) {\n                const selectedFormats = this.getSelectedElements();\n                if (selectedFormats.length > 1) {\n                    const oFormat = this.util.createElement(selectedFormats[0].nodeName);\n                    oFormat.appendChild(oA);\n                    if (!this.insertNode(oFormat, null, true)) return;\n                } else {\n                    if (!this.insertNode(oA, null, true)) return;\n                }\n    \n                this.setRange(oA.childNodes[0], 0, oA.childNodes[0], oA.textContent.length);\n            } else {\n                // set range\n                const textNode = this.context.link._linkAnchor.childNodes[0];\n                this.setRange(textNode, 0, textNode, textNode.textContent.length);\n            }\n        } finally {\n            this.plugins.dialog.close.call(this);\n            this.closeLoading();\n            // history stack\n            this.history.push(false);\n        }\n\n        return false;\n    },\n\n    /**\n     * @Override core\n     */\n    active: function (element) {\n        if (!element) {\n            if (this.controllerArray.indexOf(this.context.link.linkController) > -1) {\n                this.controllersOff();\n            }\n        } else if (this.util.isAnchor(element) && element.getAttribute('data-image-link') === null) {\n            if (this.controllerArray.indexOf(this.context.link.linkController) < 0) {\n                this.plugins.link.call_controller.call(this, element);\n            }\n            return true;\n        }\n\n        return false;\n    },\n\n    /**\n     * @Override dialog\n     */\n    on: function (update) {\n        this.plugins.anchor.on.call(this, this.context.anchor.caller.link, update);\n    },\n\n    call_controller: function (selectionATag) {\n        this.editLink = this.context.link._linkAnchor = this.context.anchor.caller.link.linkAnchor = selectionATag;\n        const linkBtn = this.context.link.linkController;\n        const link = linkBtn.querySelector('a');\n\n        link.href = selectionATag.href;\n        link.title = selectionATag.textContent;\n        link.textContent = selectionATag.textContent;\n\n        this.util.addClass(selectionATag, 'on');\n        this.setControllerPosition(linkBtn, selectionATag, 'bottom', {left: 0, top: 0});\n        this.controllersOn(linkBtn, selectionATag, 'link', this.util.removeClass.bind(this.util, this.context.link._linkAnchor, 'on'));\n    },\n\n    onClick_linkController: function (e) {\n        e.stopPropagation();\n\n        const command = e.target.getAttribute('data-command') || e.target.parentNode.getAttribute('data-command');\n        if (!command) return;\n\n        e.preventDefault();\n\n        if (/update/.test(command)) {\n            this.plugins.dialog.open.call(this, 'link', true);\n        } else if (/unlink/.test(command)) {\n            const sc = this.util.getChildElement(this.context.link._linkAnchor, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, false);\n            const ec = this.util.getChildElement(this.context.link._linkAnchor, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, true);\n            this.setRange(sc, 0, ec, ec.textContent.length);\n            this.nodeChange(null, null, ['A'], false);\n        } else {\n            /** delete */\n            this.util.removeItem(this.context.link._linkAnchor);\n            this.context.anchor.caller.link.linkAnchor = null;\n            this.focus();\n\n            // history stack\n            this.history.push(false);\n        }\n\n        this.controllersOff();\n    },\n\n    /**\n     * @Override dialog\n     */\n    init: function () {\n        this.context.link.linkController.style.display = 'none';\n        this.plugins.anchor.init.call(this, this.context.anchor.caller.link);\n    }\n};\n"]},"metadata":{},"sourceType":"module"}