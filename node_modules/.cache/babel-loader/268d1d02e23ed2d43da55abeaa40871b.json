{"ast":null,"code":"/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport dialog from '../modules/dialog';\nimport component from '../modules/component';\nimport fileManager from '../modules/fileManager';\nexport default {\n  name: 'audio',\n  display: 'dialog',\n  add: function add(core) {\n    core.addModule([dialog, component, fileManager]);\n    var context = core.context;\n    var contextAudio = context.audio = {\n      _infoList: [],\n      // @Override fileManager\n      _infoIndex: 0,\n      // @Override fileManager\n      _uploadFileLength: 0,\n      // @Override fileManager\n      focusElement: null,\n      // @Override dialog // This element has focus when the dialog is opened.\n      targetSelect: null,\n      _origin_w: core.options.audioWidth,\n      _origin_h: core.options.audioHeight,\n      _linkValue: '',\n      // @require @Override component\n      _element: null,\n      _cover: null,\n      _container: null\n    };\n    /** dialog */\n\n    var audio_dialog = this.setDialog(core);\n    contextAudio.modal = audio_dialog;\n    contextAudio.audioInputFile = audio_dialog.querySelector('._se_audio_files');\n    contextAudio.audioUrlFile = audio_dialog.querySelector('.se-input-url');\n    contextAudio.focusElement = contextAudio.audioInputFile || contextAudio.audioUrlFile;\n    contextAudio.preview = audio_dialog.querySelector('.se-link-preview');\n    /** controller */\n\n    var audio_controller = this.setController(core);\n    contextAudio.controller = audio_controller;\n    /** add event listeners */\n\n    audio_dialog.querySelector('form').addEventListener('submit', this.submit.bind(core));\n    if (contextAudio.audioInputFile) audio_dialog.querySelector('.se-dialog-files-edge-button').addEventListener('click', this._removeSelectedFiles.bind(contextAudio.audioInputFile, contextAudio.audioUrlFile, contextAudio.preview));\n    if (contextAudio.audioInputFile && contextAudio.audioUrlFile) contextAudio.audioInputFile.addEventListener('change', this._fileInputChange.bind(contextAudio));\n    audio_controller.addEventListener('click', this.onClick_controller.bind(core));\n    if (contextAudio.audioUrlFile) contextAudio.audioUrlFile.addEventListener('input', this._onLinkPreview.bind(contextAudio.preview, contextAudio, core.options.linkProtocol));\n    /** append html */\n\n    context.dialog.modal.appendChild(audio_dialog);\n    /** append controller */\n\n    context.element.relative.appendChild(audio_controller);\n    /** empty memory */\n\n    audio_dialog = null, audio_controller = null;\n  },\n\n  /** HTML - dialog */\n  setDialog: function setDialog(core) {\n    var option = core.options;\n    var lang = core.lang;\n    var dialog = core.util.createElement('DIV');\n    dialog.className = 'se-dialog-content';\n    dialog.style.display = 'none';\n    var html = '' + '<form method=\"post\" enctype=\"multipart/form-data\">' + '<div class=\"se-dialog-header\">' + '<button type=\"button\" data-command=\"close\" class=\"se-btn se-dialog-close\" aria-label=\"Close\" title=\"' + lang.dialogBox.close + '\">' + core.icons.cancel + '</button>' + '<span class=\"se-modal-title\">' + lang.dialogBox.audioBox.title + '</span>' + '</div>' + '<div class=\"se-dialog-body\">';\n\n    if (option.audioFileInput) {\n      html += '' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.audioBox.file + '</label>' + '<div class=\"se-dialog-form-files\">' + '<input class=\"se-input-form _se_audio_files\" type=\"file\" accept=\"' + option.audioAccept + '\"' + (option.audioMultipleFile ? ' multiple=\"multiple\"' : '') + '/>' + '<button type=\"button\" data-command=\"filesRemove\" class=\"se-btn se-dialog-files-edge-button se-file-remove\" title=\"' + lang.controller.remove + '\">' + core.icons.cancel + '</button>' + '</div>' + '</div>';\n    }\n\n    if (option.audioUrlInput) {\n      html += '' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.audioBox.url + '</label>' + '<input class=\"se-input-form se-input-url\" type=\"text\" />' + '<pre class=\"se-link-preview\"></pre>' + '</div>';\n    }\n\n    html += '' + '</div>' + '<div class=\"se-dialog-footer\">' + '<button type=\"submit\" class=\"se-btn-primary\" title=\"' + lang.dialogBox.submitButton + '\"><span>' + lang.dialogBox.submitButton + '</span></button>' + '</div>' + '</form>';\n    dialog.innerHTML = html;\n    return dialog;\n  },\n\n  /** HTML - controller */\n  setController: function setController(core) {\n    var lang = core.lang;\n    var icons = core.icons;\n    var link_btn = core.util.createElement('DIV');\n    link_btn.className = 'se-controller se-controller-link';\n    link_btn.innerHTML = '' + '<div class=\"se-arrow se-arrow-up\"></div>' + '<div class=\"link-content\">' + '<div class=\"se-btn-group\">' + '<button type=\"button\" data-command=\"update\" tabindex=\"-1\" class=\"se-tooltip\">' + icons.edit + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.edit + '</span></span>' + '</button>' + '<button type=\"button\" data-command=\"delete\" tabindex=\"-1\" class=\"se-tooltip\">' + icons.delete + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.remove + '</span></span>' + '</button>' + '</div>' + '</div>';\n    return link_btn;\n  },\n  // Disable url input when uploading files\n  _fileInputChange: function _fileInputChange() {\n    if (!this.audioInputFile.value) {\n      this.audioUrlFile.removeAttribute('disabled');\n      this.preview.style.textDecoration = '';\n    } else {\n      this.audioUrlFile.setAttribute('disabled', true);\n      this.preview.style.textDecoration = 'line-through';\n    }\n  },\n  // Disable url input when uploading files\n  _removeSelectedFiles: function _removeSelectedFiles(urlInput, preview) {\n    this.value = '';\n\n    if (urlInput) {\n      urlInput.removeAttribute('disabled');\n      preview.style.textDecoration = '';\n    }\n  },\n  // create new audio tag\n  _createAudioTag: function _createAudioTag() {\n    var oAudio = this.util.createElement('AUDIO');\n\n    this.plugins.audio._setTagAttrs.call(this, oAudio);\n\n    var w = this.context.audio._origin_w;\n    var h = this.context.audio._origin_h;\n    oAudio.setAttribute('origin-size', w + ',' + h);\n    oAudio.style.cssText = (w ? 'width:' + w + '; ' : '') + (h ? 'height:' + h + ';' : '');\n    return oAudio;\n  },\n  _setTagAttrs: function _setTagAttrs(element) {\n    element.setAttribute('controls', true);\n    var attrs = this.options.audioTagAttrs;\n    if (!attrs) return;\n\n    for (var key in attrs) {\n      if (!this.util.hasOwn(attrs, key)) continue;\n      element.setAttribute(key, attrs[key]);\n    }\n  },\n  _onLinkPreview: function _onLinkPreview(context, protocol, e) {\n    var value = e.target.value.trim();\n    context._linkValue = this.textContent = !value ? '' : protocol && value.indexOf('://') === -1 && value.indexOf('#') !== 0 ? protocol + value : value.indexOf('://') === -1 ? '/' + value : value;\n  },\n\n  /**\n   * @Required @Override fileManager\n   */\n  fileTags: ['audio'],\n\n  /**\n   * @Override core, fileManager, resizing\n   * @description It is called from core.selectComponent.\n   * @param {Element} element Target element\n   */\n  select: function select(element) {\n    this.plugins.audio.onModifyMode.call(this, element);\n  },\n\n  /**\n   * @Override fileManager, resizing \n   */\n  destroy: function destroy(element) {\n    element = element || this.context.audio._element;\n    var container = this.util.getParentElement(element, this.util.isComponent) || element;\n    var dataIndex = element.getAttribute('data-index') * 1;\n    var focusEl = container.previousElementSibling || container.nextElementSibling;\n    var emptyDiv = container.parentNode;\n    this.util.removeItem(container);\n    this.plugins.audio.init.call(this);\n    this.controllersOff();\n    if (emptyDiv !== this.context.element.wysiwyg) this.util.removeItemAllParents(emptyDiv, function (current) {\n      return current.childNodes.length === 0;\n    }, null); // focus\n\n    this.focusEdge(focusEl); // fileManager event\n\n    this.plugins.fileManager.deleteInfo.call(this, 'audio', dataIndex, this.functions.onAudioUpload); // history stack\n\n    this.history.push(false);\n  },\n\n  /**\n   * @Override fileManager\n   */\n  checkFileInfo: function checkFileInfo() {\n    this.plugins.fileManager.checkInfo.call(this, 'audio', ['audio'], this.functions.onAudioUpload, this.plugins.audio.updateCover.bind(this), false);\n  },\n\n  /**\n   * @Override fileManager\n   */\n  resetFileInfo: function resetFileInfo() {\n    this.plugins.fileManager.resetInfo.call(this, 'audio', this.functions.onAudioUpload);\n  },\n\n  /**\n   * @Required @Override dialog\n   */\n  on: function on(update) {\n    var contextAudio = this.context.audio;\n\n    if (!update) {\n      this.plugins.audio.init.call(this);\n      if (contextAudio.audioInputFile && this.options.audioMultipleFile) contextAudio.audioInputFile.setAttribute('multiple', 'multiple');\n    } else if (contextAudio._element) {\n      this.context.dialog.updateModal = true;\n      contextAudio._linkValue = contextAudio.preview.textContent = contextAudio.audioUrlFile.value = contextAudio._element.src;\n      if (contextAudio.audioInputFile && this.options.audioMultipleFile) contextAudio.audioInputFile.removeAttribute('multiple');\n    } else {\n      if (contextAudio.audioInputFile && this.options.audioMultipleFile) contextAudio.audioInputFile.removeAttribute('multiple');\n    }\n  },\n\n  /**\n   * @Required @Override dialog\n   */\n  open: function open() {\n    this.plugins.dialog.open.call(this, 'audio', 'audio' === this.currentControllerName);\n  },\n  submit: function submit(e) {\n    var contextAudio = this.context.audio;\n    e.preventDefault();\n    e.stopPropagation();\n\n    try {\n      if (contextAudio.audioInputFile && contextAudio.audioInputFile.files.length > 0) {\n        this.showLoading();\n        this.plugins.audio.submitAction.call(this, contextAudio.audioInputFile.files);\n      } else if (contextAudio.audioUrlFile && contextAudio._linkValue.length > 0) {\n        this.showLoading();\n        this.plugins.audio.setupUrl.call(this, contextAudio._linkValue);\n      }\n    } catch (error) {\n      this.closeLoading();\n      throw Error('[SUNEDITOR.audio.submit.fail] cause : \"' + error.message + '\"');\n    } finally {\n      this.plugins.dialog.close.call(this);\n    }\n\n    return false;\n  },\n  submitAction: function submitAction(fileList) {\n    if (fileList.length === 0) return;\n    var fileSize = 0;\n    var files = [];\n\n    for (var i = 0, len = fileList.length; i < len; i++) {\n      if (/audio/i.test(fileList[i].type)) {\n        files.push(fileList[i]);\n        fileSize += fileList[i].size;\n      }\n    }\n\n    var limitSize = this.options.audioUploadSizeLimit;\n\n    if (limitSize > 0) {\n      var infoSize = 0;\n      var audiosInfo = this.context.audio._infoList;\n\n      for (var _i = 0, _len = audiosInfo.length; _i < _len; _i++) {\n        infoSize += audiosInfo[_i].size * 1;\n      }\n\n      if (fileSize + infoSize > limitSize) {\n        this.closeLoading();\n        var err = '[SUNEDITOR.audioUpload.fail] Size of uploadable total audios: ' + limitSize / 1000 + 'KB';\n\n        if (typeof this.functions.onAudioUploadError !== 'function' || this.functions.onAudioUploadError(err, {\n          'limitSize': limitSize,\n          'currentSize': infoSize,\n          'uploadSize': fileSize\n        }, this)) {\n          this.functions.noticeOpen(err);\n        }\n\n        return;\n      }\n    }\n\n    var contextAudio = this.context.audio;\n    contextAudio._uploadFileLength = files.length;\n    var info = {\n      isUpdate: this.context.dialog.updateModal,\n      element: contextAudio._element\n    };\n\n    if (typeof this.functions.onAudioUploadBefore === 'function') {\n      var result = this.functions.onAudioUploadBefore(files, info, this, function (data) {\n        if (data && this._w.Array.isArray(data.result)) {\n          this.plugins.audio.register.call(this, info, data);\n        } else {\n          this.plugins.audio.upload.call(this, info, data);\n        }\n      }.bind(this));\n      if (typeof result === 'undefined') return;\n\n      if (!result) {\n        this.closeLoading();\n        return;\n      }\n\n      if (typeof result === 'object' && result.length > 0) files = result;\n    }\n\n    this.plugins.audio.upload.call(this, info, files);\n  },\n  error: function error(message, response) {\n    this.closeLoading();\n\n    if (typeof this.functions.onAudioUploadError !== 'function' || this.functions.onAudioUploadError(message, response, this)) {\n      this.functions.noticeOpen(message);\n      throw Error('[SUNEDITOR.plugin.audio.exception] response: ' + message);\n    }\n  },\n  upload: function upload(info, files) {\n    if (!files) {\n      this.closeLoading();\n      return;\n    }\n\n    if (typeof files === 'string') {\n      this.plugins.audio.error.call(this, files, null);\n      return;\n    }\n\n    var audioUploadUrl = this.options.audioUploadUrl;\n    var filesLen = this.context.dialog.updateModal ? 1 : files.length; // create formData\n\n    var formData = new FormData();\n\n    for (var i = 0; i < filesLen; i++) {\n      formData.append('file-' + i, files[i]);\n    } // server upload\n\n\n    this.plugins.fileManager.upload.call(this, audioUploadUrl, this.options.audioUploadHeader, formData, this.plugins.audio.callBack_upload.bind(this, info), this.functions.onAudioUploadError);\n  },\n  callBack_upload: function callBack_upload(info, xmlHttp) {\n    if (typeof this.functions.audioUploadHandler === 'function') {\n      this.functions.audioUploadHandler(xmlHttp, info, this);\n    } else {\n      var response = JSON.parse(xmlHttp.responseText);\n\n      if (response.errorMessage) {\n        this.plugins.audio.error.call(this, response.errorMessage, response);\n      } else {\n        this.plugins.audio.register.call(this, info, response);\n      }\n    }\n  },\n  register: function register(info, response) {\n    var fileList = response.result;\n\n    for (var i = 0, len = fileList.length, file, oAudio; i < len; i++) {\n      if (info.isUpdate) oAudio = info.element;else oAudio = this.plugins.audio._createAudioTag.call(this);\n      file = {\n        name: fileList[i].name,\n        size: fileList[i].size\n      };\n      this.plugins.audio.create_audio.call(this, oAudio, fileList[i].url, file, info.isUpdate);\n    }\n\n    this.closeLoading();\n  },\n  setupUrl: function setupUrl(src) {\n    try {\n      if (src.length === 0) return false;\n      this.plugins.audio.create_audio.call(this, this.plugins.audio._createAudioTag.call(this), src, null, this.context.dialog.updateModal);\n    } catch (error) {\n      throw Error('[SUNEDITOR.audio.audio.fail] cause : \"' + error.message + '\"');\n    } finally {\n      this.closeLoading();\n    }\n  },\n  create_audio: function create_audio(element, src, file, isUpdate) {\n    var contextAudio = this.context.audio; // create new tag\n\n    if (!isUpdate) {\n      element.src = src;\n      var cover = this.plugins.component.set_cover.call(this, element);\n      var container = this.plugins.component.set_container.call(this, cover, '');\n\n      if (!this.insertComponent(container, false, true, !this.options.mediaAutoSelect)) {\n        this.focus();\n        return;\n      }\n\n      if (!this.options.mediaAutoSelect) {\n        var line = this.appendFormatTag(container, null);\n        if (line) this.setRange(line, 0, line, 0);\n      }\n    } // update\n    else {\n        if (contextAudio._element) element = contextAudio._element;\n\n        if (element && element.src !== src) {\n          element.src = src;\n          this.selectComponent(element, 'audio');\n        } else {\n          this.selectComponent(element, 'audio');\n          return;\n        }\n      }\n\n    this.plugins.fileManager.setInfo.call(this, 'audio', element, this.functions.onAudioUpload, file, false);\n    if (isUpdate) this.history.push(false);\n  },\n  updateCover: function updateCover(element) {\n    var contextAudio = this.context.audio;\n\n    this.plugins.audio._setTagAttrs.call(this, element); // find component element\n\n\n    var existElement = this.util.getParentElement(element, this.util.isMediaComponent) || this.util.getParentElement(element, function (current) {\n      return this.isWysiwygDiv(current.parentNode);\n    }.bind(this.util)); // clone element\n\n    var prevElement = element;\n    contextAudio._element = element = element.cloneNode(false);\n    var cover = this.plugins.component.set_cover.call(this, element);\n    var container = this.plugins.component.set_container.call(this, cover, 'se-audio-container');\n\n    try {\n      if (this.util.isFormatElement(existElement) && existElement.childNodes.length > 0) {\n        existElement.parentNode.insertBefore(container, existElement);\n        this.util.removeItem(prevElement); // clean format tag\n\n        this.util.removeEmptyNode(existElement, null);\n        if (existElement.children.length === 0) existElement.innerHTML = this.util.htmlRemoveWhiteSpace(existElement.innerHTML);\n      } else {\n        existElement.parentNode.replaceChild(container, existElement);\n      }\n    } catch (error) {\n      console.warn('[SUNEDITOR.audio.error] Maybe the audio tag is nested.', error);\n    }\n\n    this.plugins.fileManager.setInfo.call(this, 'audio', element, this.functions.onAudioUpload, null, false);\n    this.plugins.audio.init.call(this);\n  },\n\n  /**\n   * @Required @Override fileManager, resizing\n   */\n  onModifyMode: function onModifyMode(selectionTag) {\n    var contextAudio = this.context.audio;\n    this.setControllerPosition(contextAudio.controller, selectionTag, 'bottom', {\n      left: 0,\n      top: 0\n    });\n    this.controllersOn(contextAudio.controller, selectionTag, this.plugins.audio.onControllerOff.bind(this, selectionTag), 'audio');\n    this.util.addClass(selectionTag, 'active');\n    contextAudio._element = selectionTag;\n    contextAudio._cover = this.util.getParentElement(selectionTag, 'FIGURE');\n    contextAudio._container = this.util.getParentElement(selectionTag, this.util.isComponent);\n  },\n\n  /**\n   * @Required @Override fileManager, resizing\n   */\n  openModify: function openModify(notOpen) {\n    if (this.context.audio.audioUrlFile) {\n      var contextAudio = this.context.audio;\n      contextAudio._linkValue = contextAudio.preview.textContent = contextAudio.audioUrlFile.value = contextAudio._element.src;\n    }\n\n    if (!notOpen) this.plugins.dialog.open.call(this, 'audio', true);\n  },\n  onClick_controller: function onClick_controller(e) {\n    e.stopPropagation();\n    var command = e.target.getAttribute('data-command');\n    if (!command) return;\n    e.preventDefault();\n\n    if (/update/.test(command)) {\n      this.plugins.audio.openModify.call(this, false);\n    } else {\n      /** delete */\n      this.plugins.audio.destroy.call(this, this.context.audio._element);\n    }\n\n    this.controllersOff();\n  },\n  onControllerOff: function onControllerOff(selectionTag) {\n    this.util.removeClass(selectionTag, 'active');\n    this.context.audio.controller.style.display = 'none';\n  },\n\n  /**\n   * @Required @Override dialog\n   */\n  init: function init() {\n    if (this.context.dialog.updateModal) return;\n    var contextAudio = this.context.audio;\n    if (contextAudio.audioInputFile) contextAudio.audioInputFile.value = '';\n    if (contextAudio.audioUrlFile) contextAudio._linkValue = contextAudio.preview.textContent = contextAudio.audioUrlFile.value = '';\n\n    if (contextAudio.audioInputFile && contextAudio.audioUrlFile) {\n      contextAudio.audioUrlFile.removeAttribute('disabled');\n      contextAudio.preview.style.textDecoration = '';\n    }\n\n    contextAudio._element = null;\n  }\n};","map":{"version":3,"sources":["/github/workspace/node_modules/suneditor/src/plugins/dialog/audio.js"],"names":["dialog","component","fileManager","name","display","add","core","addModule","context","contextAudio","audio","_infoList","_infoIndex","_uploadFileLength","focusElement","targetSelect","_origin_w","options","audioWidth","_origin_h","audioHeight","_linkValue","_element","_cover","_container","audio_dialog","setDialog","modal","audioInputFile","querySelector","audioUrlFile","preview","audio_controller","setController","controller","addEventListener","submit","bind","_removeSelectedFiles","_fileInputChange","onClick_controller","_onLinkPreview","linkProtocol","appendChild","element","relative","option","lang","util","createElement","className","style","html","dialogBox","close","icons","cancel","audioBox","title","audioFileInput","file","audioAccept","audioMultipleFile","remove","audioUrlInput","url","submitButton","innerHTML","link_btn","edit","delete","value","removeAttribute","textDecoration","setAttribute","urlInput","_createAudioTag","oAudio","plugins","_setTagAttrs","call","w","h","cssText","attrs","audioTagAttrs","key","hasOwn","protocol","e","target","trim","textContent","indexOf","fileTags","select","onModifyMode","destroy","container","getParentElement","isComponent","dataIndex","getAttribute","focusEl","previousElementSibling","nextElementSibling","emptyDiv","parentNode","removeItem","init","controllersOff","wysiwyg","removeItemAllParents","current","childNodes","length","focusEdge","deleteInfo","functions","onAudioUpload","history","push","checkFileInfo","checkInfo","updateCover","resetFileInfo","resetInfo","on","update","updateModal","src","open","currentControllerName","preventDefault","stopPropagation","files","showLoading","submitAction","setupUrl","error","closeLoading","Error","message","fileList","fileSize","i","len","test","type","size","limitSize","audioUploadSizeLimit","infoSize","audiosInfo","err","onAudioUploadError","noticeOpen","info","isUpdate","onAudioUploadBefore","result","data","_w","Array","isArray","register","upload","response","audioUploadUrl","filesLen","formData","FormData","append","audioUploadHeader","callBack_upload","xmlHttp","audioUploadHandler","JSON","parse","responseText","errorMessage","create_audio","cover","set_cover","set_container","insertComponent","mediaAutoSelect","focus","line","appendFormatTag","setRange","selectComponent","setInfo","existElement","isMediaComponent","isWysiwygDiv","prevElement","cloneNode","isFormatElement","insertBefore","removeEmptyNode","children","htmlRemoveWhiteSpace","replaceChild","console","warn","selectionTag","setControllerPosition","left","top","controllersOn","onControllerOff","addClass","openModify","notOpen","command","removeClass"],"mappings":"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","sourcesContent":["/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport dialog from '../modules/dialog';\nimport component from '../modules/component';\nimport fileManager from '../modules/fileManager';\n\nexport default {\n    name: 'audio',\n    display: 'dialog',\n    add: function (core) {\n        core.addModule([dialog, component, fileManager]);\n\n        const context = core.context;\n        const contextAudio = context.audio = {\n            _infoList: [], // @Override fileManager\n            _infoIndex: 0, // @Override fileManager\n            _uploadFileLength: 0, // @Override fileManager\n            focusElement: null, // @Override dialog // This element has focus when the dialog is opened.\n            targetSelect: null,\n            _origin_w: core.options.audioWidth,\n            _origin_h: core.options.audioHeight,\n            _linkValue: '',\n            // @require @Override component\n            _element: null,\n            _cover: null,\n            _container: null,\n        };\n\n        /** dialog */\n        let audio_dialog = this.setDialog(core);\n        contextAudio.modal = audio_dialog;\n        contextAudio.audioInputFile = audio_dialog.querySelector('._se_audio_files');\n        contextAudio.audioUrlFile = audio_dialog.querySelector('.se-input-url');\n        contextAudio.focusElement = contextAudio.audioInputFile || contextAudio.audioUrlFile;\n        contextAudio.preview = audio_dialog.querySelector('.se-link-preview');\n\n        /** controller */\n        let audio_controller = this.setController(core);\n        contextAudio.controller = audio_controller;\n\n        /** add event listeners */\n        audio_dialog.querySelector('form').addEventListener('submit', this.submit.bind(core));\n        if (contextAudio.audioInputFile) audio_dialog.querySelector('.se-dialog-files-edge-button').addEventListener('click', this._removeSelectedFiles.bind(contextAudio.audioInputFile, contextAudio.audioUrlFile, contextAudio.preview));\n        if (contextAudio.audioInputFile && contextAudio.audioUrlFile) contextAudio.audioInputFile.addEventListener('change', this._fileInputChange.bind(contextAudio));\n        audio_controller.addEventListener('click', this.onClick_controller.bind(core));\n        if (contextAudio.audioUrlFile) contextAudio.audioUrlFile.addEventListener('input', this._onLinkPreview.bind(contextAudio.preview, contextAudio, core.options.linkProtocol));\n\n        /** append html */\n        context.dialog.modal.appendChild(audio_dialog);\n\n        /** append controller */\n        context.element.relative.appendChild(audio_controller);\n\n        /** empty memory */\n        audio_dialog = null, audio_controller = null;\n    },\n\n    /** HTML - dialog */\n    setDialog: function (core) {\n        const option = core.options;\n        const lang = core.lang;\n        const dialog = core.util.createElement('DIV');\n\n        dialog.className = 'se-dialog-content';\n        dialog.style.display = 'none';\n        let html = '' +\n            '<form method=\"post\" enctype=\"multipart/form-data\">' +\n                '<div class=\"se-dialog-header\">' +\n                    '<button type=\"button\" data-command=\"close\" class=\"se-btn se-dialog-close\" aria-label=\"Close\" title=\"' + lang.dialogBox.close + '\">' +\n                        core.icons.cancel +\n                    '</button>' +\n                    '<span class=\"se-modal-title\">' + lang.dialogBox.audioBox.title + '</span>' +\n                '</div>' +\n                '<div class=\"se-dialog-body\">';\n\n                if (option.audioFileInput) {\n                    html += '' +\n                        '<div class=\"se-dialog-form\">' +\n                            '<label>' + lang.dialogBox.audioBox.file + '</label>' +\n                            '<div class=\"se-dialog-form-files\">' +\n                                '<input class=\"se-input-form _se_audio_files\" type=\"file\" accept=\"' + option.audioAccept + '\"' + (option.audioMultipleFile ? ' multiple=\"multiple\"' : '') + '/>' +\n                                '<button type=\"button\" data-command=\"filesRemove\" class=\"se-btn se-dialog-files-edge-button se-file-remove\" title=\"' + lang.controller.remove + '\">' + core.icons.cancel + '</button>' +\n                            '</div>' +\n                        '</div>';\n                }\n                 \n                if (option.audioUrlInput) {\n                    html += '' +\n                        '<div class=\"se-dialog-form\">' +\n                            '<label>' + lang.dialogBox.audioBox.url + '</label>' +\n                            '<input class=\"se-input-form se-input-url\" type=\"text\" />' +\n                            '<pre class=\"se-link-preview\"></pre>' +\n                        '</div>';\n                }\n                    \n                html += '' +\n                '</div>' +\n                '<div class=\"se-dialog-footer\">' +\n                    '<button type=\"submit\" class=\"se-btn-primary\" title=\"' + lang.dialogBox.submitButton + '\"><span>' + lang.dialogBox.submitButton + '</span></button>' +\n                '</div>' +\n            '</form>';\n\n        dialog.innerHTML = html;\n\n        return dialog;\n    },\n\n    /** HTML - controller */\n    setController: function (core) {\n        const lang = core.lang;\n        const icons = core.icons;\n        const link_btn = core.util.createElement('DIV');\n\n        link_btn.className = 'se-controller se-controller-link';\n        link_btn.innerHTML = '' +\n            '<div class=\"se-arrow se-arrow-up\"></div>' +\n            '<div class=\"link-content\">' +\n                '<div class=\"se-btn-group\">' +\n                    '<button type=\"button\" data-command=\"update\" tabindex=\"-1\" class=\"se-tooltip\">' +\n                        icons.edit +\n                        '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.edit + '</span></span>' +\n                    '</button>' +\n                    '<button type=\"button\" data-command=\"delete\" tabindex=\"-1\" class=\"se-tooltip\">' +\n                        icons.delete +\n                        '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.remove + '</span></span>' +\n                    '</button>' +\n                '</div>' +\n            '</div>';\n\n        return link_btn;\n    },\n\n    // Disable url input when uploading files\n    _fileInputChange: function () {\n        if (!this.audioInputFile.value) {\n            this.audioUrlFile.removeAttribute('disabled');\n            this.preview.style.textDecoration = '';\n        } else {\n            this.audioUrlFile.setAttribute('disabled', true);\n            this.preview.style.textDecoration = 'line-through';\n        }\n    },\n\n    // Disable url input when uploading files\n    _removeSelectedFiles: function (urlInput, preview) {\n        this.value = '';\n        if (urlInput) {\n            urlInput.removeAttribute('disabled');\n            preview.style.textDecoration = '';\n        }\n    },\n\n    // create new audio tag\n    _createAudioTag: function () {\n        const oAudio = this.util.createElement('AUDIO');\n        this.plugins.audio._setTagAttrs.call(this, oAudio);\n\n        const w = this.context.audio._origin_w;\n        const h = this.context.audio._origin_h;\n        oAudio.setAttribute('origin-size', w + ',' + h);\n        oAudio.style.cssText = (w ? ('width:' + w + '; ') : '') + (h ? ('height:' + h + ';') : '');\n\n        return oAudio;\n    },\n\n    _setTagAttrs: function (element) {\n        element.setAttribute('controls', true);\n\n        const attrs = this.options.audioTagAttrs;\n        if (!attrs) return;\n\n        for (let key in attrs) {\n            if (!this.util.hasOwn(attrs, key)) continue;\n            element.setAttribute(key, attrs[key]);\n        }\n    },\n\n    _onLinkPreview: function (context, protocol, e) {\n        const value = e.target.value.trim();\n        context._linkValue = this.textContent = !value ? '' : (protocol && value.indexOf('://') === -1 && value.indexOf('#') !== 0) ? protocol + value : value.indexOf('://') === -1 ? '/' + value : value;\n    },\n\n    /**\n     * @Required @Override fileManager\n     */\n    fileTags: ['audio'],\n\n    /**\n     * @Override core, fileManager, resizing\n     * @description It is called from core.selectComponent.\n     * @param {Element} element Target element\n     */\n    select: function (element) {\n        this.plugins.audio.onModifyMode.call(this, element);\n    },\n\n    /**\n     * @Override fileManager, resizing \n     */\n    destroy: function (element) {\n        element = element || this.context.audio._element;\n        const container = this.util.getParentElement(element, this.util.isComponent) || element;\n        const dataIndex = element.getAttribute('data-index') * 1;\n        const focusEl = (container.previousElementSibling || container.nextElementSibling);\n\n        const emptyDiv = container.parentNode;\n        this.util.removeItem(container);\n        this.plugins.audio.init.call(this);\n        this.controllersOff();\n\n        if (emptyDiv !== this.context.element.wysiwyg) this.util.removeItemAllParents(emptyDiv, function (current) { return current.childNodes.length === 0; }, null);\n\n        // focus\n        this.focusEdge(focusEl);\n\n        // fileManager event\n        this.plugins.fileManager.deleteInfo.call(this, 'audio', dataIndex, this.functions.onAudioUpload);\n\n        // history stack\n        this.history.push(false);\n    },\n\n    /**\n     * @Override fileManager\n     */\n    checkFileInfo: function () {\n        this.plugins.fileManager.checkInfo.call(this, 'audio', ['audio'], this.functions.onAudioUpload, this.plugins.audio.updateCover.bind(this), false);\n    },\n\n    /**\n     * @Override fileManager\n     */\n    resetFileInfo: function () {\n        this.plugins.fileManager.resetInfo.call(this, 'audio', this.functions.onAudioUpload);\n    },\n\n    /**\n     * @Required @Override dialog\n     */\n    on: function (update) {\n        const contextAudio = this.context.audio;\n\n        if (!update) {\n            this.plugins.audio.init.call(this);\n            if (contextAudio.audioInputFile && this.options.audioMultipleFile) contextAudio.audioInputFile.setAttribute('multiple', 'multiple');\n        } else if (contextAudio._element) {\n            this.context.dialog.updateModal = true;\n            contextAudio._linkValue = contextAudio.preview.textContent = contextAudio.audioUrlFile.value = contextAudio._element.src;\n            if (contextAudio.audioInputFile && this.options.audioMultipleFile) contextAudio.audioInputFile.removeAttribute('multiple');\n        } else {\n            if (contextAudio.audioInputFile && this.options.audioMultipleFile) contextAudio.audioInputFile.removeAttribute('multiple');\n        }\n    },\n\n    /**\n     * @Required @Override dialog\n     */\n    open: function () {\n        this.plugins.dialog.open.call(this, 'audio', 'audio' === this.currentControllerName);\n    },\n\n    submit: function (e) {\n        const contextAudio = this.context.audio;\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        try {\n            if (contextAudio.audioInputFile && contextAudio.audioInputFile.files.length > 0) {\n                this.showLoading();\n                this.plugins.audio.submitAction.call(this, contextAudio.audioInputFile.files);\n            } else if (contextAudio.audioUrlFile && contextAudio._linkValue.length > 0) {\n                this.showLoading();\n                this.plugins.audio.setupUrl.call(this, contextAudio._linkValue);\n            }\n        } catch (error) {\n            this.closeLoading();\n            throw Error('[SUNEDITOR.audio.submit.fail] cause : \"' + error.message + '\"');\n        } finally {\n            this.plugins.dialog.close.call(this);\n        }\n\n        return false;\n    },\n\n    submitAction: function (fileList) {\n        if (fileList.length === 0) return;\n\n        let fileSize = 0;\n        let files = [];\n        for (let i = 0, len = fileList.length; i < len; i++) {\n            if (/audio/i.test(fileList[i].type)) {\n                files.push(fileList[i]);\n                fileSize += fileList[i].size;\n            }\n        }\n\n        const limitSize = this.options.audioUploadSizeLimit;\n        if (limitSize > 0) {\n            let infoSize = 0;\n            const audiosInfo = this.context.audio._infoList;\n            for (let i = 0, len = audiosInfo.length; i < len; i++) {\n                infoSize += audiosInfo[i].size * 1;\n            }\n\n            if ((fileSize + infoSize) > limitSize) {\n                this.closeLoading();\n                const err = '[SUNEDITOR.audioUpload.fail] Size of uploadable total audios: ' + (limitSize/1000) + 'KB';\n                if (typeof this.functions.onAudioUploadError !== 'function' || this.functions.onAudioUploadError(err, { 'limitSize': limitSize, 'currentSize': infoSize, 'uploadSize': fileSize }, this)) {\n                    this.functions.noticeOpen(err);\n                }\n                return;\n            }\n        }\n\n        const contextAudio = this.context.audio;\n        contextAudio._uploadFileLength = files.length;\n\n        const info = {\n            isUpdate: this.context.dialog.updateModal,\n            element: contextAudio._element\n        };\n\n        if (typeof this.functions.onAudioUploadBefore === 'function') {\n            const result = this.functions.onAudioUploadBefore(files, info, this, function (data) {\n                if (data && this._w.Array.isArray(data.result)) {\n                    this.plugins.audio.register.call(this, info, data);\n                } else {\n                    this.plugins.audio.upload.call(this, info, data);\n                }\n            }.bind(this));\n\n            if (typeof result === 'undefined') return;\n            if (!result) {\n                this.closeLoading();\n                return;\n            }\n            if (typeof result === 'object' && result.length > 0) files = result;\n        }\n\n        this.plugins.audio.upload.call(this, info, files);\n    },\n\n    error: function (message, response) {\n        this.closeLoading();\n        if (typeof this.functions.onAudioUploadError !== 'function' || this.functions.onAudioUploadError(message, response, this)) {\n            this.functions.noticeOpen(message);\n            throw Error('[SUNEDITOR.plugin.audio.exception] response: ' + message);\n        }\n    },\n\n    upload: function (info, files) {\n        if (!files) {\n            this.closeLoading();\n            return;\n        }\n        if (typeof files === 'string') {\n            this.plugins.audio.error.call(this, files, null);\n            return;\n        }\n\n        const audioUploadUrl = this.options.audioUploadUrl;\n        const filesLen = this.context.dialog.updateModal ? 1 : files.length;\n\n        // create formData\n        const formData = new FormData();\n        for (let i = 0; i < filesLen; i++) {\n            formData.append('file-' + i, files[i]);\n        }\n\n        // server upload\n        this.plugins.fileManager.upload.call(this, audioUploadUrl, this.options.audioUploadHeader, formData, this.plugins.audio.callBack_upload.bind(this, info), this.functions.onAudioUploadError);\n    },\n\n    callBack_upload: function (info, xmlHttp) {\n        if (typeof this.functions.audioUploadHandler === 'function') {\n            this.functions.audioUploadHandler(xmlHttp, info, this);\n        } else {\n            const response = JSON.parse(xmlHttp.responseText);\n            if (response.errorMessage) {\n                this.plugins.audio.error.call(this, response.errorMessage, response);\n            } else {\n                this.plugins.audio.register.call(this, info, response);\n            }\n        }\n    },\n\n    register: function (info, response) {\n        const fileList = response.result;\n\n        for (let i = 0, len = fileList.length, file, oAudio; i < len; i++) {\n            if (info.isUpdate) oAudio = info.element;\n            else oAudio = this.plugins.audio._createAudioTag.call(this);\n\n            file = { name: fileList[i].name, size: fileList[i].size };\n            this.plugins.audio.create_audio.call(this, oAudio, fileList[i].url, file, info.isUpdate);\n        }\n\n        this.closeLoading();\n    },\n\n    setupUrl: function (src) {\n        try {\n            if (src.length === 0) return false;\n            this.plugins.audio.create_audio.call(this, this.plugins.audio._createAudioTag.call(this), src, null, this.context.dialog.updateModal);\n        } catch (error) {\n            throw Error('[SUNEDITOR.audio.audio.fail] cause : \"' + error.message + '\"');\n        } finally {\n            this.closeLoading();\n        }\n    },\n\n    create_audio: function (element, src, file, isUpdate) {\n        const contextAudio = this.context.audio;\n        \n        // create new tag\n        if (!isUpdate) {\n            element.src = src;\n            const cover = this.plugins.component.set_cover.call(this, element);\n            const container = this.plugins.component.set_container.call(this, cover, '');\n            if (!this.insertComponent(container, false, true, !this.options.mediaAutoSelect)) {\n                this.focus();\n                return;\n            }\n            if (!this.options.mediaAutoSelect) {\n                const line = this.appendFormatTag(container, null);\n                if (line) this.setRange(line, 0, line, 0);\n            }\n        } // update\n        else {\n            if (contextAudio._element) element = contextAudio._element;\n            if (element && element.src !== src) {\n                element.src = src;\n                this.selectComponent(element, 'audio');\n            } else {\n                this.selectComponent(element, 'audio');\n                return;\n            }\n        }\n\n        this.plugins.fileManager.setInfo.call(this, 'audio', element, this.functions.onAudioUpload, file, false);\n        if (isUpdate) this.history.push(false);\n    },\n\n    updateCover: function (element) {\n        const contextAudio = this.context.audio;\n        this.plugins.audio._setTagAttrs.call(this, element);\n        \n        // find component element\n        const existElement = this.util.getParentElement(element, this.util.isMediaComponent) || \n            this.util.getParentElement(element, function (current) {\n                return this.isWysiwygDiv(current.parentNode);\n            }.bind(this.util));\n\n        // clone element\n        const prevElement = element;\n        contextAudio._element = element = element.cloneNode(false);\n        const cover = this.plugins.component.set_cover.call(this, element);\n        const container = this.plugins.component.set_container.call(this, cover, 'se-audio-container');\n\n        try {\n            if (this.util.isFormatElement(existElement) && existElement.childNodes.length > 0) {\n                existElement.parentNode.insertBefore(container, existElement);\n                this.util.removeItem(prevElement);\n                // clean format tag\n                this.util.removeEmptyNode(existElement, null);\n                if (existElement.children.length === 0) existElement.innerHTML = this.util.htmlRemoveWhiteSpace(existElement.innerHTML);\n            } else {\n                existElement.parentNode.replaceChild(container, existElement);\n            }\n        } catch (error) {\n            console.warn('[SUNEDITOR.audio.error] Maybe the audio tag is nested.', error);\n        }\n\n        this.plugins.fileManager.setInfo.call(this, 'audio', element, this.functions.onAudioUpload, null, false);\n        this.plugins.audio.init.call(this);\n    },\n\n    /**\n     * @Required @Override fileManager, resizing\n     */\n    onModifyMode: function (selectionTag) {\n        const contextAudio = this.context.audio;\n        \n        this.setControllerPosition(contextAudio.controller, selectionTag, 'bottom', {left: 0, top: 0});\n        this.controllersOn(contextAudio.controller, selectionTag, this.plugins.audio.onControllerOff.bind(this, selectionTag), 'audio');\n\n        this.util.addClass(selectionTag, 'active');\n        contextAudio._element = selectionTag;\n        contextAudio._cover = this.util.getParentElement(selectionTag, 'FIGURE');\n        contextAudio._container = this.util.getParentElement(selectionTag, this.util.isComponent);\n    },\n\n    /**\n     * @Required @Override fileManager, resizing\n     */\n    openModify: function (notOpen) {\n        if (this.context.audio.audioUrlFile) {\n            const contextAudio = this.context.audio;\n            contextAudio._linkValue = contextAudio.preview.textContent = contextAudio.audioUrlFile.value = contextAudio._element.src;\n        }\n        if (!notOpen) this.plugins.dialog.open.call(this, 'audio', true);\n    },\n\n    onClick_controller: function (e) {\n        e.stopPropagation();\n\n        const command = e.target.getAttribute('data-command');\n        if (!command) return;\n\n        e.preventDefault();\n\n        if (/update/.test(command)) {\n            this.plugins.audio.openModify.call(this, false);\n        }\n        else { /** delete */\n            this.plugins.audio.destroy.call(this, this.context.audio._element);\n        }\n\n        this.controllersOff();\n    },\n\n    onControllerOff: function (selectionTag) {\n        this.util.removeClass(selectionTag, 'active');\n        this.context.audio.controller.style.display = 'none';\n    },\n\n    /**\n     * @Required @Override dialog\n     */\n    init: function () {\n        if (this.context.dialog.updateModal) return;\n        const contextAudio = this.context.audio;\n\n        if (contextAudio.audioInputFile) contextAudio.audioInputFile.value = '';\n        if (contextAudio.audioUrlFile) contextAudio._linkValue = contextAudio.preview.textContent = contextAudio.audioUrlFile.value = '';\n        if (contextAudio.audioInputFile && contextAudio.audioUrlFile) {\n            contextAudio.audioUrlFile.removeAttribute('disabled');\n            contextAudio.preview.style.textDecoration = '';\n        }\n\n        contextAudio._element = null;\n    }\n};"]},"metadata":{},"sourceType":"module"}