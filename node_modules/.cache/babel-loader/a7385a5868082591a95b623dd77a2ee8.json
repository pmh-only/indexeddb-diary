{"ast":null,"code":"/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\n(function (global, factory) {\n  if (typeof module === 'object' && typeof module.exports === 'object') {\n    module.exports = global.document ? factory(global, true) : function (w) {\n      if (!w.document) {\n        throw new Error('SUNEDITOR_MODULES a window with a document');\n      }\n\n      return factory(w);\n    };\n  } else {\n    factory(global);\n  }\n})(typeof window !== 'undefined' ? window : this, function (window, noGlobal) {\n  var fileBrowser = {\n    name: 'fileBrowser',\n    _xmlHttp: null,\n    _loading: null,\n\n    /**\n     * @description Constructor\n     * @param {Object} core Core object \n     */\n    add: function add(core) {\n      var context = core.context;\n      context.fileBrowser = {\n        _closeSignal: false,\n        area: null,\n        header: null,\n        tagArea: null,\n        body: null,\n        list: null,\n        tagElements: null,\n        items: [],\n        selectedTags: [],\n        selectorHandler: null,\n        contextPlugin: '',\n        columnSize: 4\n      };\n      /** fileBrowser */\n\n      var browser_div = core.util.createElement('DIV');\n      browser_div.className = 'se-file-browser sun-editor-common';\n      var back = core.util.createElement('DIV');\n      back.className = 'se-file-browser-back';\n      var content = core.util.createElement('DIV');\n      content.className = 'se-file-browser-inner';\n      content.innerHTML = this.set_browser(core);\n      browser_div.appendChild(back);\n      browser_div.appendChild(content);\n      this._loading = browser_div.querySelector('.se-loading-box');\n      context.fileBrowser.area = browser_div;\n      context.fileBrowser.header = content.querySelector('.se-file-browser-header');\n      context.fileBrowser.titleArea = content.querySelector('.se-file-browser-title');\n      context.fileBrowser.tagArea = content.querySelector('.se-file-browser-tags');\n      context.fileBrowser.body = content.querySelector('.se-file-browser-body');\n      context.fileBrowser.list = content.querySelector('.se-file-browser-list');\n      /** add event listeners */\n\n      context.fileBrowser.tagArea.addEventListener('click', this.onClickTag.bind(core));\n      context.fileBrowser.list.addEventListener('click', this.onClickFile.bind(core));\n      content.addEventListener('mousedown', this._onMouseDown_browser.bind(core));\n      content.addEventListener('click', this._onClick_browser.bind(core));\n      /** append html */\n\n      context.element.relative.appendChild(browser_div);\n      /** empty memory */\n\n      browser_div = null, back = null, content = null;\n    },\n    set_browser: function set_browser(core) {\n      var lang = core.lang;\n      return '<div class=\"se-file-browser-content\">' + '<div class=\"se-file-browser-header\">' + '<button type=\"button\" data-command=\"close\" class=\"se-btn se-file-browser-close\" class=\"close\" aria-label=\"Close\" title=\"' + lang.dialogBox.close + '\">' + core.icons.cancel + '</button>' + '<span class=\"se-file-browser-title\"></span>' + '<div class=\"se-file-browser-tags\"></div>' + '</div>' + '<div class=\"se-file-browser-body\">' + '<div class=\"se-loading-box sun-editor-common\"><div class=\"se-loading-effect\"></div></div>' + '<div class=\"se-file-browser-list\"></div>' + '</div>' + '</div>';\n    },\n\n    /**\n     * @description Event to control the behavior of closing the browser\n     * @param {MouseEvent} e Event object\n     * @private\n     */\n    _onMouseDown_browser: function _onMouseDown_browser(e) {\n      if (/se-file-browser-inner/.test(e.target.className)) {\n        this.context.fileBrowser._closeSignal = true;\n      } else {\n        this.context.fileBrowser._closeSignal = false;\n      }\n    },\n\n    /**\n     * @description Event to close the window when the outside area of the browser or close button is click\n     * @param {MouseEvent} e Event object\n     * @private\n     */\n    _onClick_browser: function _onClick_browser(e) {\n      e.stopPropagation();\n\n      if (/close/.test(e.target.getAttribute('data-command')) || this.context.fileBrowser._closeSignal) {\n        this.plugins.fileBrowser.close.call(this);\n      }\n    },\n\n    /**\n     * @description Open a file browser plugin\n     * @param {String} pluginName Plugin name using the file browser\n     * @param {Function|null} selectorHandler When the function comes as an argument value, it substitutes \"context.selectorHandler\".\n     */\n    open: function open(pluginName, selectorHandler) {\n      if (this.plugins.fileBrowser._bindClose) {\n        this._d.removeEventListener('keydown', this.plugins.fileBrowser._bindClose);\n\n        this.plugins.fileBrowser._bindClose = null;\n      }\n\n      this.plugins.fileBrowser._bindClose = function (e) {\n        if (!/27/.test(e.keyCode)) return;\n        this.plugins.fileBrowser.close.call(this);\n      }.bind(this);\n\n      this._d.addEventListener('keydown', this.plugins.fileBrowser._bindClose);\n\n      var fileBrowserContext = this.context.fileBrowser;\n      fileBrowserContext.contextPlugin = pluginName;\n      fileBrowserContext.selectorHandler = selectorHandler;\n      var pluginContext = this.context[pluginName];\n      var listClassName = pluginContext.listClass;\n\n      if (!this.util.hasClass(fileBrowserContext.list, listClassName)) {\n        fileBrowserContext.list.className = 'se-file-browser-list ' + listClassName;\n      }\n\n      if (this.options.popupDisplay === 'full') {\n        fileBrowserContext.area.style.position = 'fixed';\n      } else {\n        fileBrowserContext.area.style.position = 'absolute';\n      }\n\n      fileBrowserContext.titleArea.textContent = pluginContext.title;\n      fileBrowserContext.area.style.display = 'block';\n\n      this.plugins.fileBrowser._drawFileList.call(this, this.context[pluginName].url, this.context[pluginName].header);\n    },\n    _bindClose: null,\n\n    /**\n     * @description Close a fileBrowser plugin\n     * The plugin's \"init\" method is called.\n     */\n    close: function close() {\n      var fileBrowserPlugin = this.plugins.fileBrowser;\n\n      if (fileBrowserPlugin._xmlHttp) {\n        fileBrowserPlugin._xmlHttp.abort();\n      }\n\n      if (fileBrowserPlugin._bindClose) {\n        this._d.removeEventListener('keydown', fileBrowserPlugin._bindClose);\n\n        fileBrowserPlugin._bindClose = null;\n      }\n\n      var fileBrowserContext = this.context.fileBrowser;\n      fileBrowserContext.area.style.display = 'none';\n      fileBrowserContext.selectorHandler = null;\n      fileBrowserContext.selectedTags = [];\n      fileBrowserContext.items = [];\n      fileBrowserContext.list.innerHTML = fileBrowserContext.tagArea.innerHTML = fileBrowserContext.titleArea.textContent = '';\n      if (typeof this.plugins[fileBrowserContext.contextPlugin].init === 'function') this.plugins[fileBrowserContext.contextPlugin].init.call(this);\n      fileBrowserContext.contextPlugin = '';\n    },\n\n    /**\n     * @description Show file browser loading box\n     */\n    showBrowserLoading: function showBrowserLoading() {\n      this._loading.style.display = 'block';\n    },\n\n    /**\n     * @description Close file browser loading box\n     */\n    closeBrowserLoading: function closeBrowserLoading() {\n      this._loading.style.display = 'none';\n    },\n    _drawFileList: function _drawFileList(url, browserHeader) {\n      var fileBrowserPlugin = this.plugins.fileBrowser;\n      var xmlHttp = fileBrowserPlugin._xmlHttp = this.util.getXMLHttpRequest();\n      xmlHttp.onreadystatechange = fileBrowserPlugin._callBackGet.bind(this, xmlHttp);\n      xmlHttp.open('get', url, true);\n\n      if (browserHeader !== null && typeof browserHeader === 'object' && this._w.Object.keys(browserHeader).length > 0) {\n        for (var key in browserHeader) {\n          xmlHttp.setRequestHeader(key, browserHeader[key]);\n        }\n      }\n\n      xmlHttp.send(null);\n      this.plugins.fileBrowser.showBrowserLoading();\n    },\n    _callBackGet: function _callBackGet(xmlHttp) {\n      if (xmlHttp.readyState === 4) {\n        this.plugins.fileBrowser._xmlHttp = null;\n\n        if (xmlHttp.status === 200) {\n          try {\n            this.plugins.fileBrowser._drawListItem.call(this, JSON.parse(xmlHttp.responseText).result, true);\n          } catch (e) {\n            throw Error('[SUNEDITOR.fileBrowser.drawList.fail] cause : \"' + e.message + '\"');\n          } finally {\n            this.plugins.fileBrowser.closeBrowserLoading();\n            this.context.fileBrowser.body.style.maxHeight = this._w.innerHeight - this.context.fileBrowser.header.offsetHeight - 50 + 'px';\n          }\n        } else {\n          // exception\n          this.plugins.fileBrowser.closeBrowserLoading();\n\n          if (xmlHttp.status !== 0) {\n            var res = !xmlHttp.responseText ? xmlHttp : JSON.parse(xmlHttp.responseText);\n            var err = '[SUNEDITOR.fileBrowser.get.serverException] status: ' + xmlHttp.status + ', response: ' + (res.errorMessage || xmlHttp.responseText);\n            throw Error(err);\n          }\n        }\n      }\n    },\n    _drawListItem: function _drawListItem(items, update) {\n      var fileBrowserContext = this.context.fileBrowser;\n      var pluginContext = this.context[fileBrowserContext.contextPlugin];\n      var _tags = [];\n      var len = items.length;\n      var columnSize = pluginContext.columnSize || fileBrowserContext.columnSize;\n      var splitSize = columnSize <= 1 ? 1 : Math.round(len / columnSize) || 1;\n      var drawItemHandler = pluginContext.itemTemplateHandler;\n      var tagsHTML = '';\n      var listHTML = '<div class=\"se-file-item-column\">';\n      var columns = 1;\n\n      for (var i = 0, item, tags; i < len; i++) {\n        item = items[i];\n        tags = !item.tag ? [] : typeof item.tag === 'string' ? item.tag.split(',') : item.tag;\n        tags = item.tag = tags.map(function (v) {\n          return v.trim();\n        });\n        listHTML += drawItemHandler(item);\n\n        if ((i + 1) % splitSize === 0 && columns < columnSize && i + 1 < len) {\n          columns++;\n          listHTML += '</div><div class=\"se-file-item-column\">';\n        }\n\n        if (update && tags.length > 0) {\n          for (var t = 0, tLen = tags.length, tag; t < tLen; t++) {\n            tag = tags[t];\n\n            if (tag && _tags.indexOf(tag) === -1) {\n              _tags.push(tag);\n\n              tagsHTML += '<a title=\"' + tag + '\">' + tag + '</a>';\n            }\n          }\n        }\n      }\n\n      listHTML += '</div>';\n      fileBrowserContext.list.innerHTML = listHTML;\n\n      if (update) {\n        fileBrowserContext.items = items;\n        fileBrowserContext.tagArea.innerHTML = tagsHTML;\n        fileBrowserContext.tagElements = fileBrowserContext.tagArea.querySelectorAll('A');\n      }\n    },\n    onClickTag: function onClickTag(e) {\n      var target = e.target;\n      if (!this.util.isAnchor(target)) return;\n      var tagName = target.textContent;\n      var fileBrowserPlugin = this.plugins.fileBrowser;\n      var fileBrowserContext = this.context.fileBrowser;\n      var selectTag = fileBrowserContext.tagArea.querySelector('a[title=\"' + tagName + '\"]');\n      var selectedTags = fileBrowserContext.selectedTags;\n      var sTagIndex = selectedTags.indexOf(tagName);\n\n      if (sTagIndex > -1) {\n        selectedTags.splice(sTagIndex, 1);\n        this.util.removeClass(selectTag, 'on');\n      } else {\n        selectedTags.push(tagName);\n        this.util.addClass(selectTag, 'on');\n      }\n\n      fileBrowserPlugin._drawListItem.call(this, selectedTags.length === 0 ? fileBrowserContext.items : fileBrowserContext.items.filter(function (item) {\n        return item.tag.some(function (tag) {\n          return selectedTags.indexOf(tag) > -1;\n        });\n      }), false);\n    },\n    onClickFile: function onClickFile(e) {\n      e.preventDefault();\n      e.stopPropagation();\n      var fileBrowserContext = this.context.fileBrowser;\n      var listEl = fileBrowserContext.list;\n      var target = e.target;\n      var command = null;\n      if (target === listEl) return;\n\n      while (listEl !== target.parentNode) {\n        command = target.getAttribute('data-command');\n        if (command) break;\n        target = target.parentNode;\n      }\n\n      if (!command) return;\n      var handler = fileBrowserContext.selectorHandler || this.context[fileBrowserContext.contextPlugin].selectorHandler;\n      this.plugins.fileBrowser.close.call(this);\n      handler(target);\n    }\n  };\n\n  if (typeof noGlobal === typeof undefined) {\n    if (!window.SUNEDITOR_MODULES) {\n      Object.defineProperty(window, 'SUNEDITOR_MODULES', {\n        enumerable: true,\n        writable: false,\n        configurable: false,\n        value: {}\n      });\n    }\n\n    Object.defineProperty(window.SUNEDITOR_MODULES, 'fileBrowser', {\n      enumerable: true,\n      writable: false,\n      configurable: false,\n      value: fileBrowser\n    });\n  }\n\n  return fileBrowser;\n});","map":{"version":3,"sources":["/github/workspace/node_modules/suneditor/src/plugins/modules/fileBrowser.js"],"names":["global","factory","module","exports","document","w","Error","window","noGlobal","fileBrowser","name","_xmlHttp","_loading","add","core","context","_closeSignal","area","header","tagArea","body","list","tagElements","items","selectedTags","selectorHandler","contextPlugin","columnSize","browser_div","util","createElement","className","back","content","innerHTML","set_browser","appendChild","querySelector","titleArea","addEventListener","onClickTag","bind","onClickFile","_onMouseDown_browser","_onClick_browser","element","relative","lang","dialogBox","close","icons","cancel","e","test","target","stopPropagation","getAttribute","plugins","call","open","pluginName","_bindClose","_d","removeEventListener","keyCode","fileBrowserContext","pluginContext","listClassName","listClass","hasClass","options","popupDisplay","style","position","textContent","title","display","_drawFileList","url","fileBrowserPlugin","abort","init","showBrowserLoading","closeBrowserLoading","browserHeader","xmlHttp","getXMLHttpRequest","onreadystatechange","_callBackGet","_w","Object","keys","length","key","setRequestHeader","send","readyState","status","_drawListItem","JSON","parse","responseText","result","message","maxHeight","innerHeight","offsetHeight","res","err","errorMessage","update","_tags","len","splitSize","Math","round","drawItemHandler","itemTemplateHandler","tagsHTML","listHTML","columns","i","item","tags","tag","split","map","v","trim","t","tLen","indexOf","push","querySelectorAll","isAnchor","tagName","selectTag","sTagIndex","splice","removeClass","addClass","filter","some","preventDefault","listEl","command","parentNode","handler","undefined","SUNEDITOR_MODULES","defineProperty","enumerable","writable","configurable","value"],"mappings":"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","sourcesContent":["/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\n(function (global, factory) {\n    if (typeof module === 'object' && typeof module.exports === 'object') {\n        module.exports = global.document ?\n            factory(global, true) :\n            function (w) {\n                if (!w.document) {\n                    throw new Error('SUNEDITOR_MODULES a window with a document');\n                }\n                return factory(w);\n            };\n    } else {\n        factory(global);\n    }\n}(typeof window !== 'undefined' ? window : this, function (window, noGlobal) {\n    const fileBrowser = {\n        name: 'fileBrowser',\n        _xmlHttp: null,\n        _loading: null,\n\n        /**\n         * @description Constructor\n         * @param {Object} core Core object \n         */\n        add: function (core) {\n            const context = core.context;\n            context.fileBrowser = {\n                _closeSignal: false,\n                area: null,\n                header: null,\n                tagArea: null,\n                body: null,\n                list: null,\n                tagElements: null,\n                items: [],\n                selectedTags: [],\n                selectorHandler: null,\n                contextPlugin: '',\n                columnSize: 4\n            };\n\n            /** fileBrowser */\n            let browser_div = core.util.createElement('DIV');\n            browser_div.className = 'se-file-browser sun-editor-common';\n\n            let back = core.util.createElement('DIV');\n            back.className = 'se-file-browser-back';\n\n            let content = core.util.createElement('DIV');\n            content.className = 'se-file-browser-inner';\n            content.innerHTML = this.set_browser(core);\n\n            browser_div.appendChild(back);\n            browser_div.appendChild(content);\n            this._loading = browser_div.querySelector('.se-loading-box');\n\n            context.fileBrowser.area = browser_div;\n            context.fileBrowser.header = content.querySelector('.se-file-browser-header');\n            context.fileBrowser.titleArea = content.querySelector('.se-file-browser-title');\n            context.fileBrowser.tagArea = content.querySelector('.se-file-browser-tags');\n            context.fileBrowser.body = content.querySelector('.se-file-browser-body');\n            context.fileBrowser.list = content.querySelector('.se-file-browser-list');\n\n            /** add event listeners */\n            context.fileBrowser.tagArea.addEventListener('click', this.onClickTag.bind(core));\n            context.fileBrowser.list.addEventListener('click', this.onClickFile.bind(core));\n            content.addEventListener('mousedown', this._onMouseDown_browser.bind(core));\n            content.addEventListener('click', this._onClick_browser.bind(core));\n            \n            /** append html */\n            context.element.relative.appendChild(browser_div);\n            \n            /** empty memory */\n            browser_div = null, back = null, content = null;\n        },\n\n        set_browser: function (core) {\n            const lang = core.lang;\n\n            return '<div class=\"se-file-browser-content\">' +\n                    '<div class=\"se-file-browser-header\">' +\n                        '<button type=\"button\" data-command=\"close\" class=\"se-btn se-file-browser-close\" class=\"close\" aria-label=\"Close\" title=\"' + lang.dialogBox.close + '\">' +\n                        core.icons.cancel +\n                        '</button>' +\n                        '<span class=\"se-file-browser-title\"></span>' +\n                        '<div class=\"se-file-browser-tags\"></div>' +\n                    '</div>' +\n                    '<div class=\"se-file-browser-body\">' +\n                        '<div class=\"se-loading-box sun-editor-common\"><div class=\"se-loading-effect\"></div></div>' +\n                        '<div class=\"se-file-browser-list\"></div>' +\n                    '</div>' +\n                '</div>';\n        },\n\n        /**\n         * @description Event to control the behavior of closing the browser\n         * @param {MouseEvent} e Event object\n         * @private\n         */\n        _onMouseDown_browser: function (e) {\n            if (/se-file-browser-inner/.test(e.target.className)) {\n                this.context.fileBrowser._closeSignal = true;\n            } else {\n                this.context.fileBrowser._closeSignal = false;\n            }\n        },\n\n        /**\n         * @description Event to close the window when the outside area of the browser or close button is click\n         * @param {MouseEvent} e Event object\n         * @private\n         */\n        _onClick_browser: function (e) {\n            e.stopPropagation();\n\n            if (/close/.test(e.target.getAttribute('data-command')) || this.context.fileBrowser._closeSignal) {\n                this.plugins.fileBrowser.close.call(this);\n            }\n        },\n\n        /**\n         * @description Open a file browser plugin\n         * @param {String} pluginName Plugin name using the file browser\n         * @param {Function|null} selectorHandler When the function comes as an argument value, it substitutes \"context.selectorHandler\".\n         */\n        open: function (pluginName, selectorHandler)  {\n            if (this.plugins.fileBrowser._bindClose) {\n                this._d.removeEventListener('keydown', this.plugins.fileBrowser._bindClose);\n                this.plugins.fileBrowser._bindClose = null;\n            }\n\n            this.plugins.fileBrowser._bindClose = function (e) {\n                if (!/27/.test(e.keyCode)) return;\n                this.plugins.fileBrowser.close.call(this);\n            }.bind(this);\n            this._d.addEventListener('keydown', this.plugins.fileBrowser._bindClose);\n\n            const fileBrowserContext = this.context.fileBrowser;\n            fileBrowserContext.contextPlugin = pluginName;\n            fileBrowserContext.selectorHandler = selectorHandler;\n            \n            const pluginContext = this.context[pluginName];\n            const listClassName = pluginContext.listClass;\n            if (!this.util.hasClass(fileBrowserContext.list, listClassName)) {\n                fileBrowserContext.list.className = 'se-file-browser-list ' + listClassName;\n            }\n\n            if (this.options.popupDisplay === 'full') {\n                fileBrowserContext.area.style.position = 'fixed';\n            } else {\n                fileBrowserContext.area.style.position = 'absolute';\n            }\n            \n            fileBrowserContext.titleArea.textContent = pluginContext.title;\n            fileBrowserContext.area.style.display = 'block';\n\n            this.plugins.fileBrowser._drawFileList.call(this, this.context[pluginName].url, this.context[pluginName].header);\n        },\n\n        _bindClose: null,\n        \n        /**\n         * @description Close a fileBrowser plugin\n         * The plugin's \"init\" method is called.\n         */\n        close: function () {\n            const fileBrowserPlugin = this.plugins.fileBrowser;\n\n            if (fileBrowserPlugin._xmlHttp) {\n                fileBrowserPlugin._xmlHttp.abort();\n            }\n\n            if (fileBrowserPlugin._bindClose) {\n                this._d.removeEventListener('keydown', fileBrowserPlugin._bindClose);\n                fileBrowserPlugin._bindClose = null;\n            }\n\n            const fileBrowserContext = this.context.fileBrowser;\n            fileBrowserContext.area.style.display = 'none';\n            fileBrowserContext.selectorHandler = null;\n            fileBrowserContext.selectedTags = [];\n            fileBrowserContext.items = [];\n            fileBrowserContext.list.innerHTML = fileBrowserContext.tagArea.innerHTML = fileBrowserContext.titleArea.textContent = '';\n\n            if (typeof this.plugins[fileBrowserContext.contextPlugin].init === 'function') this.plugins[fileBrowserContext.contextPlugin].init.call(this);\n            fileBrowserContext.contextPlugin = '';\n        },\n\n        /**\n         * @description Show file browser loading box\n         */\n        showBrowserLoading: function () {\n            this._loading.style.display = 'block';\n        },\n\n        /**\n         * @description Close file browser loading box\n         */\n        closeBrowserLoading: function () {\n            this._loading.style.display = 'none';\n        },\n\n        _drawFileList: function (url, browserHeader) {\n            const fileBrowserPlugin = this.plugins.fileBrowser;\n\n            const xmlHttp = fileBrowserPlugin._xmlHttp = this.util.getXMLHttpRequest();\n            xmlHttp.onreadystatechange = fileBrowserPlugin._callBackGet.bind(this, xmlHttp);\n            xmlHttp.open('get', url, true);\n            if(browserHeader !== null && typeof browserHeader === 'object' && this._w.Object.keys(browserHeader).length > 0){\n                for(let key in browserHeader){\n                    xmlHttp.setRequestHeader(key, browserHeader[key]);\n                }\n            }\n            xmlHttp.send(null);\n\n            this.plugins.fileBrowser.showBrowserLoading();\n        },\n\n        _callBackGet: function (xmlHttp) {\n            if (xmlHttp.readyState === 4) {\n                this.plugins.fileBrowser._xmlHttp = null;\n                if (xmlHttp.status === 200) {\n                    try {\n                        this.plugins.fileBrowser._drawListItem.call(this, JSON.parse(xmlHttp.responseText).result, true);\n                    } catch (e) {\n                        throw Error('[SUNEDITOR.fileBrowser.drawList.fail] cause : \"' + e.message + '\"');\n                    } finally {\n                        this.plugins.fileBrowser.closeBrowserLoading();\n                        this.context.fileBrowser.body.style.maxHeight = (this._w.innerHeight - this.context.fileBrowser.header.offsetHeight - 50) + 'px';\n                    }\n                } else { // exception\n                    this.plugins.fileBrowser.closeBrowserLoading();\n                    if (xmlHttp.status !== 0) {\n                        const res = !xmlHttp.responseText ? xmlHttp : JSON.parse(xmlHttp.responseText);\n                        const err = '[SUNEDITOR.fileBrowser.get.serverException] status: ' + xmlHttp.status + ', response: ' + (res.errorMessage || xmlHttp.responseText);\n                        throw Error(err);\n                    }\n                }\n            }\n        },\n\n        _drawListItem: function (items, update) {\n            const fileBrowserContext = this.context.fileBrowser;\n            const pluginContext = this.context[fileBrowserContext.contextPlugin];\n\n            const _tags = [];\n            const len = items.length;\n            const columnSize = pluginContext.columnSize || fileBrowserContext.columnSize;\n            const splitSize = columnSize <= 1 ? 1 : (Math.round(len/columnSize) || 1);\n            const drawItemHandler = pluginContext.itemTemplateHandler;\n            \n            let tagsHTML = '';\n            let listHTML = '<div class=\"se-file-item-column\">';\n            let columns = 1;\n            for (let i = 0, item, tags; i < len; i++) {\n                item = items[i];\n                tags = !item.tag ? [] : typeof item.tag === 'string' ? item.tag.split(',') : item.tag;\n                tags = item.tag = tags.map(function (v) { return v.trim(); });\n                listHTML += drawItemHandler(item);\n\n                if ((i + 1) % splitSize === 0 && columns < columnSize && (i + 1) < len) {\n                    columns++;\n                    listHTML += '</div><div class=\"se-file-item-column\">';\n                }\n                \n                if (update && tags.length > 0) {\n                    for (let t = 0, tLen = tags.length, tag; t < tLen; t++) {\n                        tag = tags[t];\n                        if (tag && _tags.indexOf(tag) === -1) {\n                            _tags.push(tag);\n                            tagsHTML += '<a title=\"' + tag + '\">' + tag + '</a>';\n                        }\n                    }\n                }\n            }\n            listHTML += '</div>';\n\n            fileBrowserContext.list.innerHTML = listHTML;\n\n            if (update) {\n                fileBrowserContext.items = items;\n                fileBrowserContext.tagArea.innerHTML = tagsHTML;\n                fileBrowserContext.tagElements = fileBrowserContext.tagArea.querySelectorAll('A');\n            }\n        },\n\n        onClickTag: function (e) {\n            const target = e.target;\n            if (!this.util.isAnchor(target)) return;\n\n            const tagName = target.textContent;\n            const fileBrowserPlugin = this.plugins.fileBrowser;\n            const fileBrowserContext = this.context.fileBrowser;\n\n            const selectTag = fileBrowserContext.tagArea.querySelector('a[title=\"' + tagName + '\"]');\n            const selectedTags = fileBrowserContext.selectedTags;\n            const sTagIndex = selectedTags.indexOf(tagName);\n\n            if (sTagIndex > -1){\n                selectedTags.splice(sTagIndex, 1);\n                this.util.removeClass(selectTag, 'on');\n            } else {\n                selectedTags.push(tagName);\n                this.util.addClass(selectTag, 'on');\n            }\n\n            fileBrowserPlugin._drawListItem.call(this,\n                selectedTags.length === 0 ?\n                fileBrowserContext.items :\n                fileBrowserContext.items.filter(function (item) {\n                    return item.tag.some(function (tag) {\n                        return selectedTags.indexOf(tag) > -1;\n                    });\n                }), false);\n        },\n\n        onClickFile: function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n\n            const fileBrowserContext = this.context.fileBrowser;\n            const listEl = fileBrowserContext.list;\n            let target = e.target;\n            let command = null;\n\n            if (target === listEl) return;\n\n            while (listEl !== target.parentNode) {\n                command = target.getAttribute('data-command');\n                if (command) break;\n                target = target.parentNode;\n            }\n\n            if (!command) return;\n\n            const handler = (fileBrowserContext.selectorHandler || this.context[fileBrowserContext.contextPlugin].selectorHandler);\n            this.plugins.fileBrowser.close.call(this);\n            handler(target);\n        }\n    };\n\n    if (typeof noGlobal === typeof undefined) {\n        if (!window.SUNEDITOR_MODULES) {\n            Object.defineProperty(window, 'SUNEDITOR_MODULES', {\n                enumerable: true,\n                writable: false,\n                configurable: false,\n                value: {}\n            });\n        }\n\n        Object.defineProperty(window.SUNEDITOR_MODULES, 'fileBrowser', {\n            enumerable: true,\n            writable: false,\n            configurable: false,\n            value: fileBrowser\n        });\n    }\n\n    return fileBrowser;\n}));"]},"metadata":{},"sourceType":"script"}