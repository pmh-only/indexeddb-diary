{"ast":null,"code":"/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport dialog from '../modules/dialog';\nimport anchor from '../modules/_anchor';\nimport component from '../modules/component';\nimport resizing from '../modules/resizing';\nimport fileManager from '../modules/fileManager';\nexport default {\n  name: 'image',\n  display: 'dialog',\n  add: function add(core) {\n    core.addModule([dialog, anchor, component, resizing, fileManager]);\n    var options = core.options;\n    var context = core.context;\n    var contextImage = context.image = {\n      _infoList: [],\n      // @Override fileManager\n      _infoIndex: 0,\n      // @Override fileManager\n      _uploadFileLength: 0,\n      // @Override fileManager\n      focusElement: null,\n      // @Override dialog // This element has focus when the dialog is opened.\n      sizeUnit: options._imageSizeUnit,\n      _linkElement: '',\n      _altText: '',\n      _align: 'none',\n      _floatClassRegExp: '__se__float\\\\-[a-z]+',\n      _v_src: {\n        _linkValue: ''\n      },\n      svgDefaultSize: '30%',\n      base64RenderIndex: 0,\n      // @require @Override component\n      _element: null,\n      _cover: null,\n      _container: null,\n      // @Override resizing properties\n      inputX: null,\n      inputY: null,\n      _element_w: 1,\n      _element_h: 1,\n      _element_l: 0,\n      _element_t: 0,\n      _defaultSizeX: 'auto',\n      _defaultSizeY: 'auto',\n      _origin_w: options.imageWidth === 'auto' ? '' : options.imageWidth,\n      _origin_h: options.imageHeight === 'auto' ? '' : options.imageHeight,\n      _proportionChecked: true,\n      _resizing: options.imageResizing,\n      _resizeDotHide: !options.imageHeightShow,\n      _rotation: options.imageRotation,\n      _onlyPercentage: options.imageSizeOnlyPercentage,\n      _ratio: false,\n      _ratioX: 1,\n      _ratioY: 1,\n      _captionShow: true,\n      _captionChecked: false,\n      _caption: null,\n      captionCheckEl: null\n    };\n    /** image dialog */\n\n    var image_dialog = this.setDialog(core);\n    contextImage.modal = image_dialog;\n    contextImage.imgInputFile = image_dialog.querySelector('._se_image_file');\n    contextImage.imgUrlFile = image_dialog.querySelector('._se_image_url');\n    contextImage.focusElement = contextImage.imgInputFile || contextImage.imgUrlFile;\n    contextImage.altText = image_dialog.querySelector('._se_image_alt');\n    contextImage.captionCheckEl = image_dialog.querySelector('._se_image_check_caption');\n    contextImage.previewSrc = image_dialog.querySelector('._se_tab_content_image .se-link-preview');\n    /** add event listeners */\n\n    image_dialog.querySelector('.se-dialog-tabs').addEventListener('click', this.openTab.bind(core));\n    image_dialog.querySelector('form').addEventListener('submit', this.submit.bind(core));\n    if (contextImage.imgInputFile) image_dialog.querySelector('.se-file-remove').addEventListener('click', this._removeSelectedFiles.bind(contextImage.imgInputFile, contextImage.imgUrlFile, contextImage.previewSrc));\n    if (contextImage.imgUrlFile) contextImage.imgUrlFile.addEventListener('input', this._onLinkPreview.bind(contextImage.previewSrc, contextImage._v_src, options.linkProtocol));\n    if (contextImage.imgInputFile && contextImage.imgUrlFile) contextImage.imgInputFile.addEventListener('change', this._fileInputChange.bind(contextImage));\n    var imageGalleryButton = image_dialog.querySelector('.__se__gallery');\n    if (imageGalleryButton) imageGalleryButton.addEventListener('click', this._openGallery.bind(core));\n    contextImage.proportion = {};\n    contextImage.inputX = {};\n    contextImage.inputY = {};\n\n    if (options.imageResizing) {\n      contextImage.proportion = image_dialog.querySelector('._se_image_check_proportion');\n      contextImage.inputX = image_dialog.querySelector('._se_image_size_x');\n      contextImage.inputY = image_dialog.querySelector('._se_image_size_y');\n      contextImage.inputX.value = options.imageWidth;\n      contextImage.inputY.value = options.imageHeight;\n      contextImage.inputX.addEventListener('keyup', this.setInputSize.bind(core, 'x'));\n      contextImage.inputY.addEventListener('keyup', this.setInputSize.bind(core, 'y'));\n      contextImage.inputX.addEventListener('change', this.setRatio.bind(core));\n      contextImage.inputY.addEventListener('change', this.setRatio.bind(core));\n      contextImage.proportion.addEventListener('change', this.setRatio.bind(core));\n      image_dialog.querySelector('.se-dialog-btn-revert').addEventListener('click', this.sizeRevert.bind(core));\n    }\n    /** append html */\n\n\n    context.dialog.modal.appendChild(image_dialog);\n    /** link event */\n\n    core.plugins.anchor.initEvent.call(core, 'image', image_dialog.querySelector('._se_tab_content_url'));\n    contextImage.anchorCtx = core.context.anchor.caller.image;\n    /** empty memory */\n\n    image_dialog = null;\n  },\n\n  /** dialog */\n  setDialog: function setDialog(core) {\n    var option = core.options;\n    var lang = core.lang;\n    var dialog = core.util.createElement('DIV');\n    dialog.className = 'se-dialog-content se-dialog-image';\n    dialog.style.display = 'none';\n    var html = '' + '<div class=\"se-dialog-header\">' + '<button type=\"button\" data-command=\"close\" class=\"se-btn se-dialog-close\" class=\"close\" aria-label=\"Close\" title=\"' + lang.dialogBox.close + '\">' + core.icons.cancel + '</button>' + '<span class=\"se-modal-title\">' + lang.dialogBox.imageBox.title + '</span>' + '</div>' + '<div class=\"se-dialog-tabs\">' + '<button type=\"button\" class=\"_se_tab_link active\" data-tab-link=\"image\">' + lang.toolbar.image + '</button>' + '<button type=\"button\" class=\"_se_tab_link\" data-tab-link=\"url\">' + lang.toolbar.link + '</button>' + '</div>' + '<form method=\"post\" enctype=\"multipart/form-data\">' + '<div class=\"_se_tab_content _se_tab_content_image\">' + '<div class=\"se-dialog-body\"><div style=\"border-bottom: 1px dashed #ccc;\">';\n\n    if (option.imageFileInput) {\n      html += '' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.imageBox.file + '</label>' + '<div class=\"se-dialog-form-files\">' + '<input class=\"se-input-form _se_image_file\" type=\"file\" accept=\"' + option.imageAccept + '\"' + (option.imageMultipleFile ? ' multiple=\"multiple\"' : '') + '/>' + '<button type=\"button\" class=\"se-btn se-dialog-files-edge-button se-file-remove\" title=\"' + lang.controller.remove + '\">' + core.icons.cancel + '</button>' + '</div>' + '</div>';\n    }\n\n    if (option.imageUrlInput) {\n      html += '' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.imageBox.url + '</label>' + '<div class=\"se-dialog-form-files\">' + '<input class=\"se-input-form se-input-url _se_image_url\" type=\"text\" />' + (option.imageGalleryUrl && core.plugins.imageGallery ? '<button type=\"button\" class=\"se-btn se-dialog-files-edge-button __se__gallery\" title=\"' + lang.toolbar.imageGallery + '\">' + core.icons.image_gallery + '</button>' : '') + '</div>' + '<pre class=\"se-link-preview\"></pre>' + '</div>';\n    }\n\n    html += '</div>' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.imageBox.altText + '</label><input class=\"se-input-form _se_image_alt\" type=\"text\" />' + '</div>';\n\n    if (option.imageResizing) {\n      var onlyPercentage = option.imageSizeOnlyPercentage;\n      var onlyPercentDisplay = onlyPercentage ? ' style=\"display: none !important;\"' : '';\n      var heightDisplay = !option.imageHeightShow ? ' style=\"display: none !important;\"' : '';\n      html += '<div class=\"se-dialog-form\">';\n\n      if (onlyPercentage || !option.imageHeightShow) {\n        html += '' + '<div class=\"se-dialog-size-text\">' + '<label class=\"size-w\">' + lang.dialogBox.size + '</label>' + '</div>';\n      } else {\n        html += '' + '<div class=\"se-dialog-size-text\">' + '<label class=\"size-w\">' + lang.dialogBox.width + '</label>' + '<label class=\"se-dialog-size-x\">&nbsp;</label>' + '<label class=\"size-h\">' + lang.dialogBox.height + '</label>' + '</div>';\n      }\n\n      html += '' + '<input class=\"se-input-control _se_image_size_x\" placeholder=\"auto\"' + (onlyPercentage ? ' type=\"number\" min=\"1\"' : 'type=\"text\"') + (onlyPercentage ? ' max=\"100\"' : '') + ' />' + '<label class=\"se-dialog-size-x\"' + heightDisplay + '>' + (onlyPercentage ? '%' : 'x') + '</label>' + '<input type=\"text\" class=\"se-input-control _se_image_size_y\" placeholder=\"auto\"' + onlyPercentDisplay + (onlyPercentage ? ' max=\"100\"' : '') + heightDisplay + '/>' + '<label' + onlyPercentDisplay + heightDisplay + '><input type=\"checkbox\" class=\"se-dialog-btn-check _se_image_check_proportion\" checked/>&nbsp;' + lang.dialogBox.proportion + '</label>' + '<button type=\"button\" title=\"' + lang.dialogBox.revertButton + '\" class=\"se-btn se-dialog-btn-revert\" style=\"float: right;\">' + core.icons.revert + '</button>' + '</div>';\n    }\n\n    html += '' + '<div class=\"se-dialog-form se-dialog-form-footer\">' + '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_image_check_caption\" />&nbsp;' + lang.dialogBox.caption + '</label>' + '</div>' + '</div>' + '</div>' + '<div class=\"_se_tab_content _se_tab_content_url\" style=\"display: none\">' + core.context.anchor.forms.innerHTML + '</div>' + '<div class=\"se-dialog-footer\">' + '<div>' + '<label><input type=\"radio\" name=\"suneditor_image_radio\" class=\"se-dialog-btn-radio\" value=\"none\" checked>' + lang.dialogBox.basic + '</label>' + '<label><input type=\"radio\" name=\"suneditor_image_radio\" class=\"se-dialog-btn-radio\" value=\"left\">' + lang.dialogBox.left + '</label>' + '<label><input type=\"radio\" name=\"suneditor_image_radio\" class=\"se-dialog-btn-radio\" value=\"center\">' + lang.dialogBox.center + '</label>' + '<label><input type=\"radio\" name=\"suneditor_image_radio\" class=\"se-dialog-btn-radio\" value=\"right\">' + lang.dialogBox.right + '</label>' + '</div>' + '<button type=\"submit\" class=\"se-btn-primary\" title=\"' + lang.dialogBox.submitButton + '\"><span>' + lang.dialogBox.submitButton + '</span></button>' + '</div>' + '</form>';\n    dialog.innerHTML = html;\n    return dialog;\n  },\n  _fileInputChange: function _fileInputChange() {\n    if (!this.imgInputFile.value) {\n      this.imgUrlFile.removeAttribute('disabled');\n      this.previewSrc.style.textDecoration = '';\n    } else {\n      this.imgUrlFile.setAttribute('disabled', true);\n      this.previewSrc.style.textDecoration = 'line-through';\n    }\n  },\n  _removeSelectedFiles: function _removeSelectedFiles(urlInput, previewSrc) {\n    this.value = '';\n\n    if (urlInput) {\n      urlInput.removeAttribute('disabled');\n      previewSrc.style.textDecoration = '';\n    }\n  },\n  _openGallery: function _openGallery() {\n    this.callPlugin('imageGallery', this.plugins.imageGallery.open.bind(this, this.plugins.image._setUrlInput.bind(this.context.image)), null);\n  },\n  _setUrlInput: function _setUrlInput(target) {\n    this.altText.value = target.alt;\n    this._v_src._linkValue = this.previewSrc.textContent = this.imgUrlFile.value = target.src;\n    this.imgUrlFile.focus();\n  },\n  _onLinkPreview: function _onLinkPreview(context, protocol, e) {\n    var value = e.target.value.trim();\n    context._linkValue = this.textContent = !value ? '' : protocol && value.indexOf('://') === -1 && value.indexOf('#') !== 0 ? protocol + value : value.indexOf('://') === -1 ? '/' + value : value;\n  },\n\n  /**\n   * @Override @Required fileManager\n   */\n  fileTags: ['img'],\n\n  /**\n   * @Override core, fileManager, resizing\n   * @description It is called from core.selectComponent.\n   * @param {Element} element Target element\n   */\n  select: function select(element) {\n    this.plugins.image.onModifyMode.call(this, element, this.plugins.resizing.call_controller_resize.call(this, element, 'image'));\n  },\n\n  /**\n   * @Override fileManager, resizing\n   */\n  destroy: function destroy(element) {\n    var imageEl = element || this.context.image._element;\n    var imageContainer = this.util.getParentElement(imageEl, this.util.isMediaComponent) || imageEl;\n    var dataIndex = imageEl.getAttribute('data-index') * 1;\n    var focusEl = imageContainer.previousElementSibling || imageContainer.nextElementSibling;\n    var emptyDiv = imageContainer.parentNode;\n    this.util.removeItem(imageContainer);\n    this.plugins.image.init.call(this);\n    this.controllersOff();\n    if (emptyDiv !== this.context.element.wysiwyg) this.util.removeItemAllParents(emptyDiv, function (current) {\n      return current.childNodes.length === 0;\n    }, null); // focus\n\n    this.focusEdge(focusEl); // event\n\n    this.plugins.fileManager.deleteInfo.call(this, 'image', dataIndex, this.functions.onImageUpload); // history stack\n\n    this.history.push(false);\n  },\n\n  /**\n   * @Required @Override dialog\n   */\n  on: function on(update) {\n    var contextImage = this.context.image;\n\n    if (!update) {\n      contextImage.inputX.value = contextImage._origin_w = this.options.imageWidth === contextImage._defaultSizeX ? '' : this.options.imageWidth;\n      contextImage.inputY.value = contextImage._origin_h = this.options.imageHeight === contextImage._defaultSizeY ? '' : this.options.imageHeight;\n      if (contextImage.imgInputFile && this.options.imageMultipleFile) contextImage.imgInputFile.setAttribute('multiple', 'multiple');\n    } else {\n      if (contextImage.imgInputFile && this.options.imageMultipleFile) contextImage.imgInputFile.removeAttribute('multiple');\n    }\n\n    this.plugins.anchor.on.call(this, contextImage.anchorCtx, update);\n  },\n\n  /**\n   * @Required @Override dialog\n   */\n  open: function open() {\n    this.plugins.dialog.open.call(this, 'image', 'image' === this.currentControllerName);\n  },\n  openTab: function openTab(e) {\n    var modal = this.context.image.modal;\n    var targetElement = e === 'init' ? modal.querySelector('._se_tab_link') : e.target;\n\n    if (!/^BUTTON$/i.test(targetElement.tagName)) {\n      return false;\n    } // Declare all variables\n\n\n    var tabName = targetElement.getAttribute('data-tab-link');\n    var contentClassName = '_se_tab_content';\n    var i, tabContent, tabLinks; // Get all elements with class=\"tabcontent\" and hide them\n\n    tabContent = modal.getElementsByClassName(contentClassName);\n\n    for (i = 0; i < tabContent.length; i++) {\n      tabContent[i].style.display = 'none';\n    } // Get all elements with class=\"tablinks\" and remove the class \"active\"\n\n\n    tabLinks = modal.getElementsByClassName('_se_tab_link');\n\n    for (i = 0; i < tabLinks.length; i++) {\n      this.util.removeClass(tabLinks[i], 'active');\n    } // Show the current tab, and add an \"active\" class to the button that opened the tab\n\n\n    modal.querySelector('.' + contentClassName + '_' + tabName).style.display = 'block';\n    this.util.addClass(targetElement, 'active'); // focus\n\n    if (tabName === 'image' && this.context.image.focusElement) {\n      this.context.image.focusElement.focus();\n    } else if (tabName === 'url') {\n      this.context.anchor.caller.image.urlInput.focus();\n    }\n\n    return false;\n  },\n  submit: function submit(e) {\n    var contextImage = this.context.image;\n    var imagePlugin = this.plugins.image;\n    e.preventDefault();\n    e.stopPropagation();\n    contextImage._altText = contextImage.altText.value;\n    contextImage._align = contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"]:checked').value;\n    contextImage._captionChecked = contextImage.captionCheckEl.checked;\n    if (contextImage._resizing) contextImage._proportionChecked = contextImage.proportion.checked;\n\n    try {\n      if (this.context.dialog.updateModal) {\n        imagePlugin.update_image.call(this, false, true, false);\n      }\n\n      if (contextImage.imgInputFile && contextImage.imgInputFile.files.length > 0) {\n        this.showLoading();\n        imagePlugin.submitAction.call(this, this.context.image.imgInputFile.files);\n      } else if (contextImage.imgUrlFile && contextImage._v_src._linkValue.length > 0) {\n        this.showLoading();\n        imagePlugin.onRender_imgUrl.call(this);\n      }\n    } catch (error) {\n      this.closeLoading();\n      throw Error('[SUNEDITOR.image.submit.fail] cause : \"' + error.message + '\"');\n    } finally {\n      this.plugins.dialog.close.call(this);\n    }\n\n    return false;\n  },\n  submitAction: function submitAction(fileList) {\n    if (fileList.length === 0) return;\n    var fileSize = 0;\n    var files = [];\n\n    for (var i = 0, len = fileList.length; i < len; i++) {\n      if (/image/i.test(fileList[i].type)) {\n        files.push(fileList[i]);\n        fileSize += fileList[i].size;\n      }\n    }\n\n    var limitSize = this.options.imageUploadSizeLimit;\n\n    if (limitSize > 0) {\n      var infoSize = 0;\n      var imagesInfo = this.context.image._infoList;\n\n      for (var _i = 0, _len = imagesInfo.length; _i < _len; _i++) {\n        infoSize += imagesInfo[_i].size * 1;\n      }\n\n      if (fileSize + infoSize > limitSize) {\n        this.closeLoading();\n        var err = '[SUNEDITOR.imageUpload.fail] Size of uploadable total images: ' + limitSize / 1000 + 'KB';\n\n        if (typeof this.functions.onImageUploadError !== 'function' || this.functions.onImageUploadError(err, {\n          'limitSize': limitSize,\n          'currentSize': infoSize,\n          'uploadSize': fileSize\n        }, this)) {\n          this.functions.noticeOpen(err);\n        }\n\n        return;\n      }\n    }\n\n    var contextImage = this.context.image;\n    contextImage._uploadFileLength = files.length;\n    var anchor = this.plugins.anchor.createAnchor.call(this, contextImage.anchorCtx, true);\n    var info = {\n      anchor: anchor,\n      inputWidth: contextImage.inputX.value,\n      inputHeight: contextImage.inputY.value,\n      align: contextImage._align,\n      isUpdate: this.context.dialog.updateModal,\n      element: contextImage._element\n    };\n\n    if (typeof this.functions.onImageUploadBefore === 'function') {\n      var result = this.functions.onImageUploadBefore(files, info, this, function (data) {\n        if (data && this._w.Array.isArray(data.result)) {\n          this.plugins.image.register.call(this, info, data);\n        } else {\n          this.plugins.image.upload.call(this, info, data);\n        }\n      }.bind(this));\n      if (typeof result === 'undefined') return;\n\n      if (!result) {\n        this.closeLoading();\n        return;\n      }\n\n      if (this._w.Array.isArray(result) && result.length > 0) files = result;\n    }\n\n    this.plugins.image.upload.call(this, info, files);\n  },\n  error: function error(message, response) {\n    this.closeLoading();\n\n    if (typeof this.functions.onImageUploadError !== 'function' || this.functions.onImageUploadError(message, response, this)) {\n      this.functions.noticeOpen(message);\n      throw Error('[SUNEDITOR.plugin.image.error] response: ' + message);\n    }\n  },\n  upload: function upload(info, files) {\n    if (!files) {\n      this.closeLoading();\n      return;\n    }\n\n    if (typeof files === 'string') {\n      this.plugins.image.error.call(this, files, null);\n      return;\n    }\n\n    var imageUploadUrl = this.options.imageUploadUrl;\n    var filesLen = this.context.dialog.updateModal ? 1 : files.length; // server upload\n\n    if (typeof imageUploadUrl === 'string' && imageUploadUrl.length > 0) {\n      var formData = new FormData();\n\n      for (var i = 0; i < filesLen; i++) {\n        formData.append('file-' + i, files[i]);\n      }\n\n      this.plugins.fileManager.upload.call(this, imageUploadUrl, this.options.imageUploadHeader, formData, this.plugins.image.callBack_imgUpload.bind(this, info), this.functions.onImageUploadError);\n    } else {\n      // base64\n      this.plugins.image.setup_reader.call(this, files, info.anchor, info.inputWidth, info.inputHeight, info.align, filesLen, info.isUpdate);\n    }\n  },\n  callBack_imgUpload: function callBack_imgUpload(info, xmlHttp) {\n    if (typeof this.functions.imageUploadHandler === 'function') {\n      this.functions.imageUploadHandler(xmlHttp, info, this);\n    } else {\n      var response = JSON.parse(xmlHttp.responseText);\n\n      if (response.errorMessage) {\n        this.plugins.image.error.call(this, response.errorMessage, response);\n      } else {\n        this.plugins.image.register.call(this, info, response);\n      }\n    }\n  },\n  register: function register(info, response) {\n    var fileList = response.result;\n\n    for (var i = 0, len = fileList.length, file; i < len; i++) {\n      file = {\n        name: fileList[i].name,\n        size: fileList[i].size\n      };\n\n      if (info.isUpdate) {\n        this.plugins.image.update_src.call(this, fileList[i].url, info.element, file);\n        break;\n      } else {\n        this.plugins.image.create_image.call(this, fileList[i].url, info.anchor, info.inputWidth, info.inputHeight, info.align, file);\n      }\n    }\n\n    this.closeLoading();\n  },\n  setup_reader: function setup_reader(files, anchor, width, height, align, filesLen, isUpdate) {\n    var _this = this;\n\n    try {\n      (function () {\n        _this.context.image.base64RenderIndex = filesLen;\n        var wFileReader = _this._w.FileReader;\n        var filesStack = [filesLen];\n        _this.context.image.inputX.value = width;\n        _this.context.image.inputY.value = height;\n\n        for (var i = 0, reader, file; i < filesLen; i++) {\n          reader = new wFileReader();\n          file = files[i];\n\n          reader.onload = function (reader, update, updateElement, file, index) {\n            filesStack[index] = {\n              result: reader.result,\n              file: file\n            };\n\n            if (--this.context.image.base64RenderIndex === 0) {\n              this.plugins.image.onRender_imgBase64.call(this, update, filesStack, updateElement, anchor, width, height, align);\n              this.closeLoading();\n            }\n          }.bind(_this, reader, isUpdate, _this.context.image._element, file, i);\n\n          reader.readAsDataURL(file);\n        }\n      })();\n    } catch (e) {\n      this.closeLoading();\n      throw Error('[SUNEDITOR.image.setup_reader.fail] cause : \"' + e.message + '\"');\n    }\n  },\n  onRender_imgBase64: function onRender_imgBase64(update, filesStack, updateElement, anchor, width, height, align) {\n    var updateMethod = this.plugins.image.update_src;\n    var createMethod = this.plugins.image.create_image;\n\n    for (var i = 0, len = filesStack.length; i < len; i++) {\n      if (update) {\n        this.context.image._element.setAttribute('data-file-name', filesStack[i].file.name);\n\n        this.context.image._element.setAttribute('data-file-size', filesStack[i].file.size);\n\n        updateMethod.call(this, filesStack[i].result, updateElement, filesStack[i].file);\n      } else {\n        createMethod.call(this, filesStack[i].result, anchor, width, height, align, filesStack[i].file);\n      }\n    }\n  },\n  onRender_imgUrl: function onRender_imgUrl() {\n    var contextImage = this.context.image;\n    if (contextImage._v_src._linkValue.length === 0) return false;\n\n    try {\n      var file = {\n        name: contextImage._v_src._linkValue.split('/').pop(),\n        size: 0\n      };\n      if (this.context.dialog.updateModal) this.plugins.image.update_src.call(this, contextImage._v_src._linkValue, contextImage._element, file);else this.plugins.image.create_image.call(this, contextImage._v_src._linkValue, this.plugins.anchor.createAnchor.call(this, contextImage.anchorCtx, true), contextImage.inputX.value, contextImage.inputY.value, contextImage._align, file);\n    } catch (e) {\n      throw Error('[SUNEDITOR.image.URLRendering.fail] cause : \"' + e.message + '\"');\n    } finally {\n      this.closeLoading();\n    }\n  },\n  onRender_link: function onRender_link(imgTag, anchor) {\n    if (anchor) {\n      anchor.setAttribute('data-image-link', 'image');\n      imgTag.setAttribute('data-image-link', anchor.href);\n      anchor.appendChild(imgTag);\n      return anchor;\n    }\n\n    return imgTag;\n  },\n\n  /**\n   * @Override resizing\n   * @param {String} xy 'x': width, 'y': height\n   * @param {KeyboardEvent} e Event object\n   */\n  setInputSize: function setInputSize(xy, e) {\n    if (e && e.keyCode === 32) {\n      e.preventDefault();\n      return;\n    }\n\n    this.plugins.resizing._module_setInputSize.call(this, this.context.image, xy);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setRatio: function setRatio() {\n    this.plugins.resizing._module_setRatio.call(this, this.context.image);\n  },\n\n  /**\n   * @Override fileManager\n   */\n  checkFileInfo: function checkFileInfo() {\n    var imagePlugin = this.plugins.image;\n    var contextImage = this.context.image;\n\n    var modifyHandler = function (tag) {\n      imagePlugin.onModifyMode.call(this, tag, null);\n      imagePlugin.openModify.call(this, true); // get size\n\n      contextImage.inputX.value = contextImage._origin_w;\n      contextImage.inputY.value = contextImage._origin_h; // get align\n\n      var format = this.util.getFormatElement(tag);\n      if (format) contextImage._align = format.style.textAlign || format.style.float; // link\n\n      var link = this.util.getParentElement(tag, this.util.isAnchor);\n      if (link && !contextImage.anchorCtx.linkValue) contextImage.anchorCtx.linkValue = ' ';\n      imagePlugin.update_image.call(this, true, false, true);\n      imagePlugin.init.call(this);\n    }.bind(this);\n\n    this.plugins.fileManager.checkInfo.call(this, 'image', ['img'], this.functions.onImageUpload, modifyHandler, true);\n  },\n\n  /**\n   * @Override fileManager\n   */\n  resetFileInfo: function resetFileInfo() {\n    this.plugins.fileManager.resetInfo.call(this, 'image', this.functions.onImageUpload);\n  },\n  create_image: function create_image(src, anchor, width, height, align, file) {\n    var imagePlugin = this.plugins.image;\n    var contextImage = this.context.image;\n    this.context.resizing._resize_plugin = 'image';\n    var oImg = this.util.createElement('IMG');\n    oImg.src = src;\n    oImg.alt = contextImage._altText;\n    oImg.setAttribute('data-rotate', '0');\n    anchor = imagePlugin.onRender_link.call(this, oImg, anchor);\n\n    if (contextImage._resizing) {\n      oImg.setAttribute('data-proportion', contextImage._proportionChecked);\n    }\n\n    var cover = this.plugins.component.set_cover.call(this, anchor);\n    var container = this.plugins.component.set_container.call(this, cover, 'se-image-container'); // caption\n\n    if (contextImage._captionChecked) {\n      contextImage._caption = this.plugins.component.create_caption.call(this);\n\n      contextImage._caption.setAttribute('contenteditable', false);\n\n      cover.appendChild(contextImage._caption);\n    }\n\n    contextImage._element = oImg;\n    contextImage._cover = cover;\n    contextImage._container = container; // set size\n\n    imagePlugin.applySize.call(this, width, height); // align\n\n    imagePlugin.setAlign.call(this, align, oImg, cover, container);\n    oImg.onload = imagePlugin._image_create_onload.bind(this, oImg, contextImage.svgDefaultSize, container);\n    if (this.insertComponent(container, true, true, true)) this.plugins.fileManager.setInfo.call(this, 'image', oImg, this.functions.onImageUpload, file, true);\n    this.context.resizing._resize_plugin = '';\n  },\n  _image_create_onload: function _image_create_onload(oImg, svgDefaultSize, container) {\n    // svg exception handling\n    if (oImg.offsetWidth === 0) this.plugins.image.applySize.call(this, svgDefaultSize, '');\n\n    if (this.options.mediaAutoSelect) {\n      this.selectComponent(oImg, 'image');\n    } else {\n      var line = this.appendFormatTag(container, null);\n      if (line) this.setRange(line, 0, line, 0);\n    }\n  },\n  update_image: function update_image(init, openController, notHistoryPush) {\n    var contextImage = this.context.image;\n    var imageEl = contextImage._element;\n    var cover = contextImage._cover;\n    var container = contextImage._container;\n    var isNewContainer = false;\n\n    if (cover === null) {\n      isNewContainer = true;\n      imageEl = contextImage._element.cloneNode(true);\n      cover = this.plugins.component.set_cover.call(this, imageEl);\n    }\n\n    if (container === null) {\n      cover = cover.cloneNode(true);\n      imageEl = cover.querySelector('img');\n      isNewContainer = true;\n      container = this.plugins.component.set_container.call(this, cover, 'se-image-container');\n    } else if (isNewContainer) {\n      container.innerHTML = '';\n      container.appendChild(cover);\n      contextImage._cover = cover;\n      contextImage._element = imageEl;\n      isNewContainer = false;\n    } // check size\n\n\n    var changeSize;\n    var x = this.util.isNumber(contextImage.inputX.value) ? contextImage.inputX.value + contextImage.sizeUnit : contextImage.inputX.value;\n    var y = this.util.isNumber(contextImage.inputY.value) ? contextImage.inputY.value + contextImage.sizeUnit : contextImage.inputY.value;\n\n    if (/%$/.test(imageEl.style.width)) {\n      changeSize = x !== container.style.width || y !== container.style.height;\n    } else {\n      changeSize = x !== imageEl.style.width || y !== imageEl.style.height;\n    } // alt\n\n\n    imageEl.alt = contextImage._altText; // caption\n\n    var modifiedCaption = false;\n\n    if (contextImage._captionChecked) {\n      if (!contextImage._caption) {\n        contextImage._caption = this.plugins.component.create_caption.call(this);\n        cover.appendChild(contextImage._caption);\n        modifiedCaption = true;\n      }\n    } else {\n      if (contextImage._caption) {\n        this.util.removeItem(contextImage._caption);\n        contextImage._caption = null;\n        modifiedCaption = true;\n      }\n    } // link\n\n\n    var anchor = this.plugins.anchor.createAnchor.call(this, contextImage.anchorCtx, true);\n\n    if (anchor) {\n      contextImage._linkElement = contextImage._linkElement === anchor ? anchor.cloneNode(false) : anchor;\n      cover.insertBefore(this.plugins.image.onRender_link.call(this, imageEl, contextImage._linkElement), contextImage._caption);\n    } else if (contextImage._linkElement !== null) {\n      var imageElement = imageEl;\n      imageElement.setAttribute('data-image-link', '');\n\n      if (cover.contains(contextImage._linkElement)) {\n        var newEl = imageElement.cloneNode(true);\n        cover.removeChild(contextImage._linkElement);\n        cover.insertBefore(newEl, contextImage._caption);\n        imageEl = newEl;\n      }\n    }\n\n    if (isNewContainer) {\n      var existElement = this.util.isRangeFormatElement(contextImage._element.parentNode) || this.util.isWysiwygDiv(contextImage._element.parentNode) ? contextImage._element : /^A$/i.test(contextImage._element.parentNode.nodeName) ? contextImage._element.parentNode : this.util.getFormatElement(contextImage._element) || contextImage._element;\n\n      if (this.util.isFormatElement(existElement) && existElement.childNodes.length > 0) {\n        existElement.parentNode.insertBefore(container, existElement);\n        this.util.removeItem(contextImage._element); // clean format tag\n\n        this.util.removeEmptyNode(existElement, null);\n        if (existElement.children.length === 0) existElement.innerHTML = this.util.htmlRemoveWhiteSpace(existElement.innerHTML);\n      } else {\n        if (this.util.isFormatElement(existElement.parentNode)) {\n          var formats = existElement.parentNode;\n          formats.parentNode.insertBefore(container, existElement.previousSibling ? formats.nextElementSibling : formats);\n          this.util.removeItem(existElement);\n        } else {\n          existElement.parentNode.replaceChild(container, existElement);\n        }\n      }\n\n      imageEl = container.querySelector('img');\n      contextImage._element = imageEl;\n      contextImage._cover = cover;\n      contextImage._container = container;\n    } // transform\n\n\n    if (modifiedCaption || !contextImage._onlyPercentage && changeSize) {\n      if (!init && (/\\d+/.test(imageEl.style.height) || this.context.resizing._rotateVertical && contextImage._captionChecked)) {\n        if (/%$/.test(contextImage.inputX.value) || /%$/.test(contextImage.inputY.value)) {\n          this.plugins.resizing.resetTransform.call(this, imageEl);\n        } else {\n          this.plugins.resizing.setTransformSize.call(this, imageEl, this.util.getNumber(contextImage.inputX.value, 0), this.util.getNumber(contextImage.inputY.value, 0));\n        }\n      }\n    } // size\n\n\n    if (contextImage._resizing) {\n      imageEl.setAttribute('data-proportion', contextImage._proportionChecked);\n\n      if (changeSize) {\n        this.plugins.image.applySize.call(this);\n      }\n    } // align\n\n\n    this.plugins.image.setAlign.call(this, null, imageEl, null, null); // set imagesInfo\n\n    if (init) {\n      this.plugins.fileManager.setInfo.call(this, 'image', imageEl, this.functions.onImageUpload, null, true);\n    }\n\n    if (openController) {\n      this.selectComponent(imageEl, 'image');\n    } // history stack\n\n\n    if (!notHistoryPush) this.history.push(false);\n  },\n  update_src: function update_src(src, element, file) {\n    element.src = src;\n\n    this._w.setTimeout(this.plugins.fileManager.setInfo.bind(this, 'image', element, this.functions.onImageUpload, file, true));\n\n    this.selectComponent(element, 'image');\n  },\n\n  /**\n   * @Required @Override fileManager, resizing\n   */\n  onModifyMode: function onModifyMode(element, size) {\n    if (!element) return;\n    var contextImage = this.context.image;\n    contextImage._linkElement = contextImage.anchorCtx.linkAnchor = /^A$/i.test(element.parentNode.nodeName) ? element.parentNode : null;\n    contextImage._element = element;\n    contextImage._cover = this.util.getParentElement(element, 'FIGURE');\n    contextImage._container = this.util.getParentElement(element, this.util.isMediaComponent);\n    contextImage._caption = this.util.getChildElement(contextImage._cover, 'FIGCAPTION');\n    contextImage._align = element.style.float || element.getAttribute('data-align') || 'none';\n    element.style.float = '';\n    this.plugins.anchor.setCtx(contextImage._linkElement, contextImage.anchorCtx);\n\n    if (size) {\n      contextImage._element_w = size.w;\n      contextImage._element_h = size.h;\n      contextImage._element_t = size.t;\n      contextImage._element_l = size.l;\n    }\n\n    var userSize = contextImage._element.getAttribute('data-size') || contextImage._element.getAttribute('data-origin');\n\n    var w, h;\n\n    if (userSize) {\n      userSize = userSize.split(',');\n      w = userSize[0];\n      h = userSize[1];\n    } else if (size) {\n      w = size.w;\n      h = size.h;\n    }\n\n    contextImage._origin_w = w || element.style.width || element.width || '';\n    contextImage._origin_h = h || element.style.height || element.height || '';\n  },\n\n  /**\n   * @Required @Override fileManager, resizing\n   */\n  openModify: function openModify(notOpen) {\n    var contextImage = this.context.image;\n\n    if (contextImage.imgUrlFile) {\n      contextImage._v_src._linkValue = contextImage.previewSrc.textContent = contextImage.imgUrlFile.value = contextImage._element.src;\n    }\n\n    contextImage._altText = contextImage.altText.value = contextImage._element.alt;\n    contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"][value=\"' + contextImage._align + '\"]').checked = true;\n    contextImage._align = contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"]:checked').value;\n    contextImage._captionChecked = contextImage.captionCheckEl.checked = !!contextImage._caption;\n\n    if (contextImage._resizing) {\n      this.plugins.resizing._module_setModifyInputSize.call(this, contextImage, this.plugins.image);\n    }\n\n    if (!notOpen) this.plugins.dialog.open.call(this, 'image', true);\n  },\n\n  /**\n   * @Override fileManager\n   */\n  applySize: function applySize(w, h) {\n    var contextImage = this.context.image;\n    if (!w) w = contextImage.inputX.value || this.options.imageWidth;\n    if (!h) h = contextImage.inputY.value || this.options.imageHeight;\n\n    if (contextImage._onlyPercentage && !!w || /%$/.test(w)) {\n      this.plugins.image.setPercentSize.call(this, w, h);\n      return true;\n    } else if ((!w || w === 'auto') && (!h || h === 'auto')) {\n      this.plugins.image.setAutoSize.call(this);\n    } else {\n      this.plugins.image.setSize.call(this, w, h, false);\n    }\n\n    return false;\n  },\n\n  /**\n   * @Override resizing\n   */\n  sizeRevert: function sizeRevert() {\n    this.plugins.resizing._module_sizeRevert.call(this, this.context.image);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setSize: function setSize(w, h, notResetPercentage, direction) {\n    var contextImage = this.context.image;\n    var onlyW = /^(rw|lw)$/.test(direction);\n    var onlyH = /^(th|bh)$/.test(direction);\n\n    if (!onlyH) {\n      contextImage._element.style.width = this.util.isNumber(w) ? w + contextImage.sizeUnit : w;\n      this.plugins.image.cancelPercentAttr.call(this);\n    }\n\n    if (!onlyW) {\n      contextImage._element.style.height = this.util.isNumber(h) ? h + contextImage.sizeUnit : /%$/.test(h) ? '' : h;\n    }\n\n    if (contextImage._align === 'center') this.plugins.image.setAlign.call(this, null, null, null, null);\n    if (!notResetPercentage) contextImage._element.removeAttribute('data-percentage'); // save current size\n\n    this.plugins.resizing._module_saveCurrentSize.call(this, contextImage);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setAutoSize: function setAutoSize() {\n    var contextImage = this.context.image;\n    this.plugins.resizing.resetTransform.call(this, contextImage._element);\n    this.plugins.image.cancelPercentAttr.call(this);\n    contextImage._element.style.maxWidth = '';\n    contextImage._element.style.width = '';\n    contextImage._element.style.height = '';\n    contextImage._cover.style.width = '';\n    contextImage._cover.style.height = '';\n    this.plugins.image.setAlign.call(this, null, null, null, null);\n\n    contextImage._element.setAttribute('data-percentage', 'auto,auto'); // save current size\n\n\n    this.plugins.resizing._module_saveCurrentSize.call(this, contextImage);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setOriginSize: function setOriginSize() {\n    var contextImage = this.context.image;\n\n    contextImage._element.removeAttribute('data-percentage');\n\n    this.plugins.resizing.resetTransform.call(this, contextImage._element);\n    this.plugins.image.cancelPercentAttr.call(this);\n    var originSize = (contextImage._element.getAttribute('data-origin') || '').split(',');\n    var w = originSize[0];\n    var h = originSize[1];\n\n    if (originSize) {\n      if (contextImage._onlyPercentage || /%$/.test(w) && (/%$/.test(h) || !/\\d/.test(h))) {\n        this.plugins.image.setPercentSize.call(this, w, h);\n      } else {\n        this.plugins.image.setSize.call(this, w, h);\n      } // save current size\n\n\n      this.plugins.resizing._module_saveCurrentSize.call(this, contextImage);\n    }\n  },\n\n  /**\n   * @Override resizing\n   */\n  setPercentSize: function setPercentSize(w, h) {\n    var contextImage = this.context.image;\n    h = !!h && !/%$/.test(h) && !this.util.getNumber(h, 0) ? this.util.isNumber(h) ? h + '%' : h : this.util.isNumber(h) ? h + contextImage.sizeUnit : h || '';\n    var heightPercentage = /%$/.test(h);\n    contextImage._container.style.width = this.util.isNumber(w) ? w + '%' : w;\n    contextImage._container.style.height = '';\n    contextImage._cover.style.width = '100%';\n    contextImage._cover.style.height = !heightPercentage ? '' : h;\n    contextImage._element.style.width = '100%';\n    contextImage._element.style.height = heightPercentage ? '' : h;\n    contextImage._element.style.maxWidth = '';\n    if (contextImage._align === 'center') this.plugins.image.setAlign.call(this, null, null, null, null);\n\n    contextImage._element.setAttribute('data-percentage', w + ',' + h);\n\n    this.plugins.resizing.setCaptionPosition.call(this, contextImage._element); // save current size\n\n    this.plugins.resizing._module_saveCurrentSize.call(this, contextImage);\n  },\n\n  /**\n   * @Override resizing\n   */\n  cancelPercentAttr: function cancelPercentAttr() {\n    var contextImage = this.context.image;\n    contextImage._cover.style.width = '';\n    contextImage._cover.style.height = '';\n    contextImage._container.style.width = '';\n    contextImage._container.style.height = '';\n    this.util.removeClass(contextImage._container, this.context.image._floatClassRegExp);\n    this.util.addClass(contextImage._container, '__se__float-' + contextImage._align);\n    if (contextImage._align === 'center') this.plugins.image.setAlign.call(this, null, null, null, null);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setAlign: function setAlign(align, element, cover, container) {\n    var contextImage = this.context.image;\n    if (!align) align = contextImage._align;\n    if (!element) element = contextImage._element;\n    if (!cover) cover = contextImage._cover;\n    if (!container) container = contextImage._container;\n\n    if (align && align !== 'none') {\n      cover.style.margin = 'auto';\n    } else {\n      cover.style.margin = '0';\n    }\n\n    if (/%$/.test(element.style.width) && align === 'center') {\n      container.style.minWidth = '100%';\n      cover.style.width = container.style.width;\n    } else {\n      container.style.minWidth = '';\n      cover.style.width = this.context.resizing._rotateVertical ? element.style.height || element.offsetHeight : !element.style.width || element.style.width === 'auto' ? '' : element.style.width || '100%';\n    }\n\n    if (!this.util.hasClass(container, '__se__float-' + align)) {\n      this.util.removeClass(container, contextImage._floatClassRegExp);\n      this.util.addClass(container, '__se__float-' + align);\n    }\n\n    element.setAttribute('data-align', align);\n  },\n\n  /**\n   * @Override dialog\n   */\n  init: function init() {\n    var contextImage = this.context.image;\n    if (contextImage.imgInputFile) contextImage.imgInputFile.value = '';\n    if (contextImage.imgUrlFile) contextImage._v_src._linkValue = contextImage.previewSrc.textContent = contextImage.imgUrlFile.value = '';\n\n    if (contextImage.imgInputFile && contextImage.imgUrlFile) {\n      contextImage.imgUrlFile.removeAttribute('disabled');\n      contextImage.previewSrc.style.textDecoration = '';\n    }\n\n    contextImage.altText.value = '';\n    contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"][value=\"none\"]').checked = true;\n    contextImage.captionCheckEl.checked = false;\n    contextImage._element = null;\n    this.plugins.image.openTab.call(this, 'init');\n\n    if (contextImage._resizing) {\n      contextImage.inputX.value = this.options.imageWidth === contextImage._defaultSizeX ? '' : this.options.imageWidth;\n      contextImage.inputY.value = this.options.imageHeight === contextImage._defaultSizeY ? '' : this.options.imageHeight;\n      contextImage.proportion.checked = true;\n      contextImage._ratio = false;\n      contextImage._ratioX = 1;\n      contextImage._ratioY = 1;\n    }\n\n    this.plugins.anchor.init.call(this, contextImage.anchorCtx);\n  }\n};","map":{"version":3,"sources":["/github/workspace/node_modules/suneditor/src/plugins/dialog/image.js"],"names":["dialog","anchor","component","resizing","fileManager","name","display","add","core","addModule","options","context","contextImage","image","_infoList","_infoIndex","_uploadFileLength","focusElement","sizeUnit","_imageSizeUnit","_linkElement","_altText","_align","_floatClassRegExp","_v_src","_linkValue","svgDefaultSize","base64RenderIndex","_element","_cover","_container","inputX","inputY","_element_w","_element_h","_element_l","_element_t","_defaultSizeX","_defaultSizeY","_origin_w","imageWidth","_origin_h","imageHeight","_proportionChecked","_resizing","imageResizing","_resizeDotHide","imageHeightShow","_rotation","imageRotation","_onlyPercentage","imageSizeOnlyPercentage","_ratio","_ratioX","_ratioY","_captionShow","_captionChecked","_caption","captionCheckEl","image_dialog","setDialog","modal","imgInputFile","querySelector","imgUrlFile","altText","previewSrc","addEventListener","openTab","bind","submit","_removeSelectedFiles","_onLinkPreview","linkProtocol","_fileInputChange","imageGalleryButton","_openGallery","proportion","value","setInputSize","setRatio","sizeRevert","appendChild","plugins","initEvent","call","anchorCtx","caller","option","lang","util","createElement","className","style","html","dialogBox","close","icons","cancel","imageBox","title","toolbar","link","imageFileInput","file","imageAccept","imageMultipleFile","controller","remove","imageUrlInput","url","imageGalleryUrl","imageGallery","image_gallery","onlyPercentage","onlyPercentDisplay","heightDisplay","size","width","height","revertButton","revert","caption","forms","innerHTML","basic","left","center","right","submitButton","removeAttribute","textDecoration","setAttribute","urlInput","callPlugin","open","_setUrlInput","target","alt","textContent","src","focus","protocol","e","trim","indexOf","fileTags","select","element","onModifyMode","call_controller_resize","destroy","imageEl","imageContainer","getParentElement","isMediaComponent","dataIndex","getAttribute","focusEl","previousElementSibling","nextElementSibling","emptyDiv","parentNode","removeItem","init","controllersOff","wysiwyg","removeItemAllParents","current","childNodes","length","focusEdge","deleteInfo","functions","onImageUpload","history","push","on","update","currentControllerName","targetElement","test","tagName","tabName","contentClassName","i","tabContent","tabLinks","getElementsByClassName","removeClass","addClass","imagePlugin","preventDefault","stopPropagation","checked","updateModal","update_image","files","showLoading","submitAction","onRender_imgUrl","error","closeLoading","Error","message","fileList","fileSize","len","type","limitSize","imageUploadSizeLimit","infoSize","imagesInfo","err","onImageUploadError","noticeOpen","createAnchor","info","inputWidth","inputHeight","align","isUpdate","onImageUploadBefore","result","data","_w","Array","isArray","register","upload","response","imageUploadUrl","filesLen","formData","FormData","append","imageUploadHeader","callBack_imgUpload","setup_reader","xmlHttp","imageUploadHandler","JSON","parse","responseText","errorMessage","update_src","create_image","wFileReader","FileReader","filesStack","reader","onload","updateElement","index","onRender_imgBase64","readAsDataURL","updateMethod","createMethod","split","pop","onRender_link","imgTag","href","xy","keyCode","_module_setInputSize","_module_setRatio","checkFileInfo","modifyHandler","tag","openModify","format","getFormatElement","textAlign","float","isAnchor","linkValue","checkInfo","resetFileInfo","resetInfo","_resize_plugin","oImg","cover","set_cover","container","set_container","create_caption","applySize","setAlign","_image_create_onload","insertComponent","setInfo","offsetWidth","mediaAutoSelect","selectComponent","line","appendFormatTag","setRange","openController","notHistoryPush","isNewContainer","cloneNode","changeSize","x","isNumber","y","modifiedCaption","insertBefore","imageElement","contains","newEl","removeChild","existElement","isRangeFormatElement","isWysiwygDiv","nodeName","isFormatElement","removeEmptyNode","children","htmlRemoveWhiteSpace","formats","previousSibling","replaceChild","_rotateVertical","resetTransform","setTransformSize","getNumber","setTimeout","linkAnchor","getChildElement","setCtx","w","h","t","l","userSize","notOpen","_module_setModifyInputSize","setPercentSize","setAutoSize","setSize","_module_sizeRevert","notResetPercentage","direction","onlyW","onlyH","cancelPercentAttr","_module_saveCurrentSize","maxWidth","setOriginSize","originSize","heightPercentage","setCaptionPosition","margin","minWidth","offsetHeight","hasClass"],"mappings":"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","sourcesContent":["/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport dialog from '../modules/dialog';\nimport anchor from '../modules/_anchor';\nimport component from '../modules/component';\nimport resizing from '../modules/resizing';\nimport fileManager from '../modules/fileManager';\n\nexport default {\n    name: 'image',\n    display: 'dialog',\n    add: function (core) {\n        core.addModule([dialog, anchor, component, resizing, fileManager]);\n        \n        const options = core.options;\n        const context = core.context;\n        const contextImage = context.image = {\n            _infoList: [], // @Override fileManager\n            _infoIndex: 0, // @Override fileManager\n            _uploadFileLength: 0, // @Override fileManager\n            focusElement: null, // @Override dialog // This element has focus when the dialog is opened.\n            sizeUnit: options._imageSizeUnit,\n            _linkElement: '',\n            _altText: '',\n            _align: 'none',\n            _floatClassRegExp: '__se__float\\\\-[a-z]+',\n            _v_src: {_linkValue: ''},\n            svgDefaultSize: '30%',\n            base64RenderIndex: 0,\n            // @require @Override component\n            _element: null,\n            _cover: null,\n            _container: null,\n            // @Override resizing properties\n            inputX: null,\n            inputY: null,\n            _element_w: 1,\n            _element_h: 1,\n            _element_l: 0,\n            _element_t: 0,\n            _defaultSizeX: 'auto',\n            _defaultSizeY: 'auto',\n            _origin_w: options.imageWidth === 'auto' ? '' : options.imageWidth,\n            _origin_h: options.imageHeight === 'auto' ? '' : options.imageHeight,\n            _proportionChecked: true,\n            _resizing: options.imageResizing,\n            _resizeDotHide: !options.imageHeightShow,\n            _rotation: options.imageRotation,\n            _onlyPercentage: options.imageSizeOnlyPercentage,\n            _ratio: false,\n            _ratioX: 1,\n            _ratioY: 1,\n            _captionShow: true,\n            _captionChecked: false,\n            _caption: null,\n            captionCheckEl: null\n        };\n\n        /** image dialog */\n        let image_dialog = this.setDialog(core);\n        contextImage.modal = image_dialog;\n        contextImage.imgInputFile = image_dialog.querySelector('._se_image_file');\n        contextImage.imgUrlFile = image_dialog.querySelector('._se_image_url');\n        contextImage.focusElement = contextImage.imgInputFile || contextImage.imgUrlFile;\n        contextImage.altText = image_dialog.querySelector('._se_image_alt');\n        contextImage.captionCheckEl = image_dialog.querySelector('._se_image_check_caption');\n        contextImage.previewSrc = image_dialog.querySelector('._se_tab_content_image .se-link-preview');\n\n        /** add event listeners */\n        image_dialog.querySelector('.se-dialog-tabs').addEventListener('click', this.openTab.bind(core));\n        image_dialog.querySelector('form').addEventListener('submit', this.submit.bind(core));\n        if (contextImage.imgInputFile) image_dialog.querySelector('.se-file-remove').addEventListener('click', this._removeSelectedFiles.bind(contextImage.imgInputFile, contextImage.imgUrlFile, contextImage.previewSrc));\n        if (contextImage.imgUrlFile) contextImage.imgUrlFile.addEventListener('input', this._onLinkPreview.bind(contextImage.previewSrc, contextImage._v_src, options.linkProtocol));\n        if (contextImage.imgInputFile && contextImage.imgUrlFile) contextImage.imgInputFile.addEventListener('change', this._fileInputChange.bind(contextImage));\n\n        const imageGalleryButton = image_dialog.querySelector('.__se__gallery');\n        if (imageGalleryButton) imageGalleryButton.addEventListener('click', this._openGallery.bind(core));\n        \n        contextImage.proportion = {};\n        contextImage.inputX = {};\n        contextImage.inputY = {};\n        if (options.imageResizing) {\n            contextImage.proportion = image_dialog.querySelector('._se_image_check_proportion');\n            contextImage.inputX = image_dialog.querySelector('._se_image_size_x');\n            contextImage.inputY = image_dialog.querySelector('._se_image_size_y');\n            contextImage.inputX.value = options.imageWidth;\n            contextImage.inputY.value = options.imageHeight;\n            \n            contextImage.inputX.addEventListener('keyup', this.setInputSize.bind(core, 'x'));\n            contextImage.inputY.addEventListener('keyup', this.setInputSize.bind(core, 'y'));\n\n            contextImage.inputX.addEventListener('change', this.setRatio.bind(core));\n            contextImage.inputY.addEventListener('change', this.setRatio.bind(core));\n            contextImage.proportion.addEventListener('change', this.setRatio.bind(core));\n            \n            image_dialog.querySelector('.se-dialog-btn-revert').addEventListener('click', this.sizeRevert.bind(core));\n        }\n\n        /** append html */\n        context.dialog.modal.appendChild(image_dialog);\n\n        /** link event */\n        core.plugins.anchor.initEvent.call(core, 'image', image_dialog.querySelector('._se_tab_content_url'));\n        contextImage.anchorCtx = core.context.anchor.caller.image;\n\n        /** empty memory */\n        image_dialog = null;\n    },\n\n    /** dialog */\n    setDialog: function (core) {\n        const option = core.options;\n        const lang = core.lang;\n        const dialog = core.util.createElement('DIV');\n\n        dialog.className = 'se-dialog-content se-dialog-image';\n        dialog.style.display = 'none';\n\n        let html = '' +\n            '<div class=\"se-dialog-header\">' +\n                '<button type=\"button\" data-command=\"close\" class=\"se-btn se-dialog-close\" class=\"close\" aria-label=\"Close\" title=\"' + lang.dialogBox.close + '\">' +\n                    core.icons.cancel +\n                '</button>' +\n                '<span class=\"se-modal-title\">' + lang.dialogBox.imageBox.title + '</span>' +\n            '</div>' +\n            '<div class=\"se-dialog-tabs\">' +\n                '<button type=\"button\" class=\"_se_tab_link active\" data-tab-link=\"image\">' + lang.toolbar.image + '</button>' +\n                '<button type=\"button\" class=\"_se_tab_link\" data-tab-link=\"url\">' + lang.toolbar.link + '</button>' +\n            '</div>' +\n            '<form method=\"post\" enctype=\"multipart/form-data\">' +\n                '<div class=\"_se_tab_content _se_tab_content_image\">' +\n                    '<div class=\"se-dialog-body\"><div style=\"border-bottom: 1px dashed #ccc;\">';\n                    \n                    if (option.imageFileInput) {\n                        html += '' +\n                            '<div class=\"se-dialog-form\">' +\n                                '<label>' + lang.dialogBox.imageBox.file + '</label>' +\n                                '<div class=\"se-dialog-form-files\">' +\n                                    '<input class=\"se-input-form _se_image_file\" type=\"file\" accept=\"' + option.imageAccept + '\"' + (option.imageMultipleFile ? ' multiple=\"multiple\"' : '') + '/>' +\n                                    '<button type=\"button\" class=\"se-btn se-dialog-files-edge-button se-file-remove\" title=\"' + lang.controller.remove + '\">' + core.icons.cancel + '</button>' +\n                                '</div>' +\n                            '</div>' ;\n                    }\n        \n                    if (option.imageUrlInput) {\n                        html += '' +\n                            '<div class=\"se-dialog-form\">' +\n                                '<label>' + lang.dialogBox.imageBox.url + '</label>' +\n                                '<div class=\"se-dialog-form-files\">' +\n                                    '<input class=\"se-input-form se-input-url _se_image_url\" type=\"text\" />' +\n                                    ((option.imageGalleryUrl && core.plugins.imageGallery) ? '<button type=\"button\" class=\"se-btn se-dialog-files-edge-button __se__gallery\" title=\"' + lang.toolbar.imageGallery + '\">' + core.icons.image_gallery + '</button>' : '') +\n                                '</div>' +\n                                '<pre class=\"se-link-preview\"></pre>' +\n                            '</div>';\n                    }\n        \n                    html += '</div>' +\n                        '<div class=\"se-dialog-form\">' +\n                            '<label>' + lang.dialogBox.imageBox.altText + '</label><input class=\"se-input-form _se_image_alt\" type=\"text\" />' +\n                        '</div>';\n\n            if (option.imageResizing) {\n                const onlyPercentage = option.imageSizeOnlyPercentage;\n                const onlyPercentDisplay = onlyPercentage ? ' style=\"display: none !important;\"' : '';\n                const heightDisplay = !option.imageHeightShow ? ' style=\"display: none !important;\"' : '';\n                html += '<div class=\"se-dialog-form\">';\n                        if (onlyPercentage || !option.imageHeightShow) {\n                            html += '' +\n                            '<div class=\"se-dialog-size-text\">' +\n                                '<label class=\"size-w\">' + lang.dialogBox.size + '</label>' +\n                            '</div>';\n                        } else {\n                            html += '' +\n                            '<div class=\"se-dialog-size-text\">' +\n                                '<label class=\"size-w\">' + lang.dialogBox.width + '</label>' +\n                                '<label class=\"se-dialog-size-x\">&nbsp;</label>' +\n                                '<label class=\"size-h\">' + lang.dialogBox.height + '</label>' +\n                            '</div>';\n                        }\n                        html += '' +\n                            '<input class=\"se-input-control _se_image_size_x\" placeholder=\"auto\"' + (onlyPercentage ? ' type=\"number\" min=\"1\"' : 'type=\"text\"') + (onlyPercentage ? ' max=\"100\"' : '') + ' />' +\n                            '<label class=\"se-dialog-size-x\"' + heightDisplay + '>' + (onlyPercentage ? '%' : 'x') + '</label>' +\n                            '<input type=\"text\" class=\"se-input-control _se_image_size_y\" placeholder=\"auto\"' + onlyPercentDisplay + (onlyPercentage ? ' max=\"100\"' : '') + heightDisplay + '/>' +\n                            '<label' + onlyPercentDisplay + heightDisplay + '><input type=\"checkbox\" class=\"se-dialog-btn-check _se_image_check_proportion\" checked/>&nbsp;' + lang.dialogBox.proportion + '</label>' +\n                            '<button type=\"button\" title=\"' + lang.dialogBox.revertButton + '\" class=\"se-btn se-dialog-btn-revert\" style=\"float: right;\">' + core.icons.revert + '</button>' +\n                        '</div>' ;\n            }\n\n            html += '' +\n                        '<div class=\"se-dialog-form se-dialog-form-footer\">' +\n                            '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_image_check_caption\" />&nbsp;' + lang.dialogBox.caption + '</label>' +\n                        '</div>' +\n                    '</div>' +\n                '</div>' +\n                '<div class=\"_se_tab_content _se_tab_content_url\" style=\"display: none\">' +\n                    core.context.anchor.forms.innerHTML +\n                '</div>' +\n                '<div class=\"se-dialog-footer\">' +\n                    '<div>' +\n                        '<label><input type=\"radio\" name=\"suneditor_image_radio\" class=\"se-dialog-btn-radio\" value=\"none\" checked>' + lang.dialogBox.basic + '</label>' +\n                        '<label><input type=\"radio\" name=\"suneditor_image_radio\" class=\"se-dialog-btn-radio\" value=\"left\">' + lang.dialogBox.left + '</label>' +\n                        '<label><input type=\"radio\" name=\"suneditor_image_radio\" class=\"se-dialog-btn-radio\" value=\"center\">' + lang.dialogBox.center + '</label>' +\n                        '<label><input type=\"radio\" name=\"suneditor_image_radio\" class=\"se-dialog-btn-radio\" value=\"right\">' + lang.dialogBox.right + '</label>' +\n                    '</div>' +\n                    '<button type=\"submit\" class=\"se-btn-primary\" title=\"' + lang.dialogBox.submitButton + '\"><span>' + lang.dialogBox.submitButton + '</span></button>' +\n                '</div>' +\n            '</form>';\n\n        dialog.innerHTML = html;\n\n        return dialog;\n    },\n\n    _fileInputChange: function () {\n        if (!this.imgInputFile.value) {\n            this.imgUrlFile.removeAttribute('disabled');\n            this.previewSrc.style.textDecoration = '';\n        } else {\n            this.imgUrlFile.setAttribute('disabled', true);\n            this.previewSrc.style.textDecoration = 'line-through';\n        }\n    },\n\n    _removeSelectedFiles: function (urlInput, previewSrc) {\n        this.value = '';\n        if (urlInput) {\n            urlInput.removeAttribute('disabled');\n            previewSrc.style.textDecoration = '';\n        }\n    },\n\n    _openGallery: function () {\n        this.callPlugin('imageGallery', this.plugins.imageGallery.open.bind(this, this.plugins.image._setUrlInput.bind(this.context.image)), null);\n    },\n\n    _setUrlInput: function (target) {\n        this.altText.value = target.alt;\n        this._v_src._linkValue = this.previewSrc.textContent = this.imgUrlFile.value = target.src;\n        this.imgUrlFile.focus();\n    },\n\n    _onLinkPreview: function (context, protocol, e) {\n        const value = e.target.value.trim();\n        context._linkValue = this.textContent = !value ? '' : (protocol && value.indexOf('://') === -1 && value.indexOf('#') !== 0) ? protocol + value : value.indexOf('://') === -1 ? '/' + value : value;\n    },\n\n    /**\n     * @Override @Required fileManager\n     */\n    fileTags: ['img'],\n\n    /**\n     * @Override core, fileManager, resizing\n     * @description It is called from core.selectComponent.\n     * @param {Element} element Target element\n     */\n    select: function (element) {\n        this.plugins.image.onModifyMode.call(this, element, this.plugins.resizing.call_controller_resize.call(this, element, 'image'));\n    },\n\n    /**\n     * @Override fileManager, resizing\n     */\n    destroy: function (element) {\n        const imageEl = element || this.context.image._element;\n        const imageContainer = this.util.getParentElement(imageEl, this.util.isMediaComponent) || imageEl;\n        const dataIndex = imageEl.getAttribute('data-index') * 1;\n        let focusEl = (imageContainer.previousElementSibling || imageContainer.nextElementSibling);\n        \n        const emptyDiv = imageContainer.parentNode;\n        this.util.removeItem(imageContainer);\n        this.plugins.image.init.call(this);\n        this.controllersOff();\n\n        if (emptyDiv !== this.context.element.wysiwyg) this.util.removeItemAllParents(emptyDiv, function (current) { return current.childNodes.length === 0; }, null);\n\n        // focus\n        this.focusEdge(focusEl);\n        \n        // event\n        this.plugins.fileManager.deleteInfo.call(this, 'image', dataIndex, this.functions.onImageUpload);\n\n        // history stack\n        this.history.push(false);\n    },\n\n    /**\n     * @Required @Override dialog\n     */\n    on: function (update) {\n        const contextImage = this.context.image;\n        \n        if (!update) {\n            contextImage.inputX.value = contextImage._origin_w = this.options.imageWidth === contextImage._defaultSizeX ? '' : this.options.imageWidth;\n            contextImage.inputY.value = contextImage._origin_h = this.options.imageHeight === contextImage._defaultSizeY ? '' : this.options.imageHeight;\n            if (contextImage.imgInputFile && this.options.imageMultipleFile) contextImage.imgInputFile.setAttribute('multiple', 'multiple');\n        } else {\n            if (contextImage.imgInputFile && this.options.imageMultipleFile) contextImage.imgInputFile.removeAttribute('multiple');\n        }\n        this.plugins.anchor.on.call(this, contextImage.anchorCtx, update);\n    },\n\n    /**\n     * @Required @Override dialog\n     */\n    open: function () {\n        this.plugins.dialog.open.call(this, 'image', 'image' === this.currentControllerName);\n    },\n\n    openTab: function (e) {\n        const modal = this.context.image.modal;\n        const targetElement = (e === 'init' ? modal.querySelector('._se_tab_link') : e.target);\n\n        if (!/^BUTTON$/i.test(targetElement.tagName)) {\n            return false;\n        }\n\n        // Declare all variables\n        const tabName = targetElement.getAttribute('data-tab-link');\n        const contentClassName = '_se_tab_content';\n        let i, tabContent, tabLinks;\n\n        // Get all elements with class=\"tabcontent\" and hide them\n        tabContent = modal.getElementsByClassName(contentClassName);\n        for (i = 0; i < tabContent.length; i++) {\n            tabContent[i].style.display = 'none';\n        }\n\n        // Get all elements with class=\"tablinks\" and remove the class \"active\"\n        tabLinks = modal.getElementsByClassName('_se_tab_link');\n        for (i = 0; i < tabLinks.length; i++) {\n            this.util.removeClass(tabLinks[i], 'active');\n        }\n\n        // Show the current tab, and add an \"active\" class to the button that opened the tab\n        modal.querySelector('.' + contentClassName + '_' + tabName).style.display = 'block';\n        this.util.addClass(targetElement, 'active');\n\n        // focus\n        if (tabName === 'image' && this.context.image.focusElement) {\n            this.context.image.focusElement.focus();\n        } else if (tabName === 'url') {\n            this.context.anchor.caller.image.urlInput.focus();\n        }\n\n        return false;\n    },\n\n    submit: function (e) {\n        const contextImage = this.context.image;\n        const imagePlugin = this.plugins.image;\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        contextImage._altText = contextImage.altText.value;\n        contextImage._align = contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"]:checked').value;\n        contextImage._captionChecked = contextImage.captionCheckEl.checked;\n        if (contextImage._resizing) contextImage._proportionChecked = contextImage.proportion.checked;\n\n        try {\n            if (this.context.dialog.updateModal) {\n                imagePlugin.update_image.call(this, false, true, false);\n            }\n            \n            if (contextImage.imgInputFile && contextImage.imgInputFile.files.length > 0) {\n                this.showLoading();\n                imagePlugin.submitAction.call(this, this.context.image.imgInputFile.files);\n            } else if (contextImage.imgUrlFile && contextImage._v_src._linkValue.length > 0) {\n                this.showLoading();\n                imagePlugin.onRender_imgUrl.call(this);\n            }\n        } catch (error) {\n            this.closeLoading();\n            throw Error('[SUNEDITOR.image.submit.fail] cause : \"' + error.message + '\"');\n        } finally {\n            this.plugins.dialog.close.call(this);\n        }\n\n        return false;\n    },\n\n    submitAction: function (fileList) {\n        if (fileList.length === 0) return;\n\n        let fileSize = 0;\n        let files = [];\n        for (let i = 0, len = fileList.length; i < len; i++) {\n            if (/image/i.test(fileList[i].type)) {\n                files.push(fileList[i]);\n                fileSize += fileList[i].size;\n            }\n        }\n\n        const limitSize = this.options.imageUploadSizeLimit;\n        if (limitSize > 0) {\n            let infoSize = 0;\n            const imagesInfo = this.context.image._infoList;\n            for (let i = 0, len = imagesInfo.length; i < len; i++) {\n                infoSize += imagesInfo[i].size * 1;\n            }\n\n            if ((fileSize + infoSize) > limitSize) {\n                this.closeLoading();\n                const err = '[SUNEDITOR.imageUpload.fail] Size of uploadable total images: ' + (limitSize/1000) + 'KB';\n                if (typeof this.functions.onImageUploadError !== 'function' || this.functions.onImageUploadError(err, { 'limitSize': limitSize, 'currentSize': infoSize, 'uploadSize': fileSize }, this)) {\n                    this.functions.noticeOpen(err);\n                }\n                return;\n            }\n        }\n\n        const contextImage = this.context.image;\n        contextImage._uploadFileLength = files.length;\n        \n        const anchor = this.plugins.anchor.createAnchor.call(this, contextImage.anchorCtx, true);\n        const info = {\n            anchor: anchor,\n            inputWidth: contextImage.inputX.value,\n            inputHeight: contextImage.inputY.value,\n            align: contextImage._align,\n            isUpdate: this.context.dialog.updateModal,\n            element: contextImage._element\n        };\n\n        if (typeof this.functions.onImageUploadBefore === 'function') {\n            const result = this.functions.onImageUploadBefore(files, info, this, function (data) {\n                if (data && this._w.Array.isArray(data.result)) {\n                    this.plugins.image.register.call(this, info, data);\n                } else {\n                    this.plugins.image.upload.call(this, info, data);\n                }\n            }.bind(this));\n            \n            if (typeof result === 'undefined') return;\n            if (!result) {\n                this.closeLoading();\n                return;\n            }\n            if (this._w.Array.isArray(result) && result.length > 0) files = result;\n        }\n\n        this.plugins.image.upload.call(this, info, files);\n    },\n\n    error: function (message, response) {\n        this.closeLoading();\n        if (typeof this.functions.onImageUploadError !== 'function' || this.functions.onImageUploadError(message, response, this)) {\n            this.functions.noticeOpen(message);\n            throw Error('[SUNEDITOR.plugin.image.error] response: ' + message);\n        }\n    },\n\n    upload: function (info, files) {\n        if (!files) {\n            this.closeLoading();\n            return;\n        }\n        if (typeof files === 'string') {\n            this.plugins.image.error.call(this, files, null);\n            return;\n        }\n\n        const imageUploadUrl = this.options.imageUploadUrl;\n        const filesLen = this.context.dialog.updateModal ? 1 : files.length;\n\n        // server upload\n        if (typeof imageUploadUrl === 'string' && imageUploadUrl.length > 0) {\n            const formData = new FormData();\n            for (let i = 0; i < filesLen; i++) {\n                formData.append('file-' + i, files[i]);\n            }\n            this.plugins.fileManager.upload.call(this, imageUploadUrl, this.options.imageUploadHeader, formData, this.plugins.image.callBack_imgUpload.bind(this, info), this.functions.onImageUploadError);\n        } else { // base64\n            this.plugins.image.setup_reader.call(this, files, info.anchor, info.inputWidth, info.inputHeight, info.align, filesLen, info.isUpdate);\n        }\n    },\n\n    callBack_imgUpload: function (info, xmlHttp) {\n        if (typeof this.functions.imageUploadHandler === 'function') {\n            this.functions.imageUploadHandler(xmlHttp, info, this);\n        } else {\n            const response = JSON.parse(xmlHttp.responseText);\n            if (response.errorMessage) {\n                this.plugins.image.error.call(this, response.errorMessage, response);\n            } else {\n                this.plugins.image.register.call(this, info, response);\n            }\n        }\n    },\n\n    register: function (info, response) {\n        const fileList = response.result;\n\n        for (let i = 0, len = fileList.length, file; i < len; i++) {\n            file = { name: fileList[i].name, size: fileList[i].size };\n            if (info.isUpdate) {\n                this.plugins.image.update_src.call(this, fileList[i].url, info.element, file);\n                break;\n            } else {\n                this.plugins.image.create_image.call(this, fileList[i].url, info.anchor, info.inputWidth, info.inputHeight, info.align, file);\n            }\n        }\n        \n        this.closeLoading();\n    },\n\n    setup_reader: function (files, anchor, width, height, align, filesLen, isUpdate) {\n        try {\n            this.context.image.base64RenderIndex = filesLen;\n            const wFileReader = this._w.FileReader;\n            const filesStack = [filesLen];\n            this.context.image.inputX.value = width;\n            this.context.image.inputY.value = height;\n    \n            for (let i = 0, reader, file; i < filesLen; i++) {\n                reader = new wFileReader();\n                file = files[i];\n    \n                reader.onload = function (reader, update, updateElement, file, index) {\n                    filesStack[index] = { result: reader.result, file: file };\n\n                    if (--this.context.image.base64RenderIndex === 0) {\n                        this.plugins.image.onRender_imgBase64.call(this, update, filesStack, updateElement, anchor, width, height, align);\n                        this.closeLoading();\n                    }\n                }.bind(this, reader, isUpdate, this.context.image._element, file, i);\n\n                reader.readAsDataURL(file);\n            }\n        } catch (e) {\n            this.closeLoading();\n            throw Error('[SUNEDITOR.image.setup_reader.fail] cause : \"' + e.message + '\"');\n        }\n    },\n\n    onRender_imgBase64: function (update, filesStack, updateElement, anchor, width, height, align) {\n        const updateMethod = this.plugins.image.update_src;\n        const createMethod = this.plugins.image.create_image;\n        \n        for (let i = 0, len = filesStack.length; i < len; i++) {\n            if (update) {\n                this.context.image._element.setAttribute('data-file-name', filesStack[i].file.name);\n                this.context.image._element.setAttribute('data-file-size', filesStack[i].file.size);\n                updateMethod.call(this, filesStack[i].result, updateElement, filesStack[i].file);\n            } else {\n                createMethod.call(this, filesStack[i].result, anchor, width, height, align, filesStack[i].file);\n            }\n        }\n    },\n\n    onRender_imgUrl: function () {\n        const contextImage = this.context.image;\n        if (contextImage._v_src._linkValue.length === 0) return false;\n\n        try {\n            const file = {name: contextImage._v_src._linkValue.split('/').pop(), size: 0};\n            if (this.context.dialog.updateModal) this.plugins.image.update_src.call(this, contextImage._v_src._linkValue, contextImage._element, file);\n            else this.plugins.image.create_image.call(this, contextImage._v_src._linkValue, this.plugins.anchor.createAnchor.call(this, contextImage.anchorCtx, true), contextImage.inputX.value, contextImage.inputY.value, contextImage._align, file);\n        } catch (e) {\n            throw Error('[SUNEDITOR.image.URLRendering.fail] cause : \"' + e.message + '\"');\n        } finally {\n            this.closeLoading();\n        }\n    },\n\n    onRender_link: function (imgTag, anchor) {\n        if (anchor) {\n            anchor.setAttribute('data-image-link', 'image');\n            imgTag.setAttribute('data-image-link', anchor.href);\n            anchor.appendChild(imgTag);\n            return anchor;\n        }\n\n        return imgTag;\n    },\n\n    /**\n     * @Override resizing\n     * @param {String} xy 'x': width, 'y': height\n     * @param {KeyboardEvent} e Event object\n     */\n    setInputSize: function (xy, e) {\n        if (e && e.keyCode === 32) {\n            e.preventDefault();\n            return;\n        }\n\n        this.plugins.resizing._module_setInputSize.call(this, this.context.image, xy);\n    },\n\n    /**\n     * @Override resizing\n     */\n    setRatio: function () {\n        this.plugins.resizing._module_setRatio.call(this, this.context.image);\n    },\n\n    /**\n     * @Override fileManager\n     */\n    checkFileInfo: function () {\n        const imagePlugin = this.plugins.image;\n        const contextImage = this.context.image;\n\n        const modifyHandler = function (tag) {\n            imagePlugin.onModifyMode.call(this, tag, null);\n            imagePlugin.openModify.call(this, true);\n            // get size\n            contextImage.inputX.value = contextImage._origin_w;\n            contextImage.inputY.value = contextImage._origin_h;\n            // get align\n            const format = this.util.getFormatElement(tag);\n            if (format) contextImage._align = format.style.textAlign || format.style.float;\n            // link\n            const link = this.util.getParentElement(tag, this.util.isAnchor);\n            if (link && !contextImage.anchorCtx.linkValue) contextImage.anchorCtx.linkValue = ' ';\n            \n            imagePlugin.update_image.call(this, true, false, true);\n            imagePlugin.init.call(this);\n        }.bind(this);\n\n        this.plugins.fileManager.checkInfo.call(this, 'image', ['img'], this.functions.onImageUpload, modifyHandler, true);\n    },\n\n    /**\n     * @Override fileManager\n     */\n    resetFileInfo: function () {\n        this.plugins.fileManager.resetInfo.call(this, 'image', this.functions.onImageUpload);\n    },\n\n    create_image: function (src, anchor, width, height, align, file) {\n        const imagePlugin = this.plugins.image;\n        const contextImage = this.context.image;\n        this.context.resizing._resize_plugin = 'image';\n\n        let oImg = this.util.createElement('IMG');\n        oImg.src = src;\n        oImg.alt = contextImage._altText;\n        oImg.setAttribute('data-rotate', '0');\n        anchor = imagePlugin.onRender_link.call(this, oImg, anchor);\n\n        if (contextImage._resizing) {\n            oImg.setAttribute('data-proportion', contextImage._proportionChecked);\n        }\n\n        const cover = this.plugins.component.set_cover.call(this, anchor);\n        const container = this.plugins.component.set_container.call(this, cover, 'se-image-container');\n\n        // caption\n        if (contextImage._captionChecked) {\n            contextImage._caption = this.plugins.component.create_caption.call(this);\n            contextImage._caption.setAttribute('contenteditable', false);\n            cover.appendChild(contextImage._caption);\n        }\n\n        contextImage._element = oImg;\n        contextImage._cover = cover;\n        contextImage._container = container;\n\n        // set size\n        imagePlugin.applySize.call(this, width, height);\n\n        // align\n        imagePlugin.setAlign.call(this, align, oImg, cover, container);\n\n        oImg.onload = imagePlugin._image_create_onload.bind(this, oImg, contextImage.svgDefaultSize, container);\n        if (this.insertComponent(container, true, true, true)) this.plugins.fileManager.setInfo.call(this, 'image', oImg, this.functions.onImageUpload, file, true);\n        this.context.resizing._resize_plugin = '';\n    },\n\n    _image_create_onload: function (oImg, svgDefaultSize, container) {\n        // svg exception handling\n        if (oImg.offsetWidth === 0) this.plugins.image.applySize.call(this, svgDefaultSize, '');\n        if (this.options.mediaAutoSelect) {\n            this.selectComponent(oImg, 'image');\n        } else {\n            const line = this.appendFormatTag(container, null);\n            if (line) this.setRange(line, 0, line, 0);\n        }\n    },\n\n    update_image: function (init, openController, notHistoryPush) {\n        const contextImage = this.context.image;\n        let imageEl = contextImage._element;\n        let cover = contextImage._cover;\n        let container = contextImage._container;\n        let isNewContainer = false;\n\n        if (cover === null) {\n            isNewContainer = true;\n            imageEl = contextImage._element.cloneNode(true);\n            cover = this.plugins.component.set_cover.call(this, imageEl);\n        }\n\n        if (container === null) {\n            cover = cover.cloneNode(true);\n            imageEl = cover.querySelector('img');\n            isNewContainer = true;\n            container = this.plugins.component.set_container.call(this, cover, 'se-image-container');\n        } else if (isNewContainer) {\n            container.innerHTML = '';\n            container.appendChild(cover);\n            contextImage._cover = cover;\n            contextImage._element = imageEl;\n            isNewContainer = false;\n        }\n\n        // check size\n        let changeSize;\n        const x = this.util.isNumber(contextImage.inputX.value) ? contextImage.inputX.value + contextImage.sizeUnit : contextImage.inputX.value;\n        const y = this.util.isNumber(contextImage.inputY.value) ? contextImage.inputY.value + contextImage.sizeUnit : contextImage.inputY.value;\n        if (/%$/.test(imageEl.style.width)) {\n            changeSize = x !== container.style.width || y !== container.style.height;\n        } else {\n            changeSize = x !== imageEl.style.width || y !== imageEl.style.height;\n        }\n\n        // alt\n        imageEl.alt = contextImage._altText;\n        \n        // caption\n        let modifiedCaption = false;\n        if (contextImage._captionChecked) {\n            if (!contextImage._caption) {\n                contextImage._caption = this.plugins.component.create_caption.call(this);\n                cover.appendChild(contextImage._caption);\n                modifiedCaption = true;\n            }\n        } else {\n            if (contextImage._caption) {\n                this.util.removeItem(contextImage._caption);\n                contextImage._caption = null;\n                modifiedCaption = true;\n            }\n        }\n\n        // link\n        const anchor = this.plugins.anchor.createAnchor.call(this, contextImage.anchorCtx, true);\n        if (anchor) {\n            contextImage._linkElement = contextImage._linkElement === anchor ? anchor.cloneNode(false) : anchor;\n            cover.insertBefore(this.plugins.image.onRender_link.call(this, imageEl, contextImage._linkElement), contextImage._caption);\n        } else if (contextImage._linkElement !== null) {\n            const imageElement = imageEl;\n            imageElement.setAttribute('data-image-link', '');\n            if (cover.contains(contextImage._linkElement)) {\n                const newEl = imageElement.cloneNode(true);\n                cover.removeChild(contextImage._linkElement);\n                cover.insertBefore(newEl, contextImage._caption);\n                imageEl = newEl;\n            }\n        }\n\n        if (isNewContainer) {\n            const existElement = (this.util.isRangeFormatElement(contextImage._element.parentNode) || this.util.isWysiwygDiv(contextImage._element.parentNode)) ? \n                contextImage._element : \n                /^A$/i.test(contextImage._element.parentNode.nodeName) ? contextImage._element.parentNode : this.util.getFormatElement(contextImage._element) || contextImage._element;\n                \n            if (this.util.isFormatElement(existElement) && existElement.childNodes.length > 0) {\n                existElement.parentNode.insertBefore(container, existElement);\n                this.util.removeItem(contextImage._element);\n                // clean format tag\n                this.util.removeEmptyNode(existElement, null);\n                if (existElement.children.length === 0) existElement.innerHTML = this.util.htmlRemoveWhiteSpace(existElement.innerHTML);\n            } else {\n                if (this.util.isFormatElement(existElement.parentNode)) {\n                    const formats = existElement.parentNode;\n                    formats.parentNode.insertBefore(container, existElement.previousSibling ? formats.nextElementSibling : formats);\n                    this.util.removeItem(existElement);\n                } else {\n                    existElement.parentNode.replaceChild(container, existElement);\n                }\n            }\n\n            imageEl = container.querySelector('img');\n\n            contextImage._element = imageEl;\n            contextImage._cover = cover;\n            contextImage._container = container;\n        }\n\n        // transform\n        if (modifiedCaption || (!contextImage._onlyPercentage && changeSize)) {\n            if (!init && (/\\d+/.test(imageEl.style.height) || (this.context.resizing._rotateVertical && contextImage._captionChecked))) {\n                if (/%$/.test(contextImage.inputX.value) || /%$/.test(contextImage.inputY.value)) {\n                    this.plugins.resizing.resetTransform.call(this, imageEl);\n                } else {\n                    this.plugins.resizing.setTransformSize.call(this, imageEl, this.util.getNumber(contextImage.inputX.value, 0), this.util.getNumber(contextImage.inputY.value, 0));\n                }\n            }\n        }\n\n        // size\n        if (contextImage._resizing) {\n            imageEl.setAttribute('data-proportion', contextImage._proportionChecked);\n            if (changeSize) {\n                this.plugins.image.applySize.call(this);\n            }\n        }\n\n        // align\n        this.plugins.image.setAlign.call(this, null, imageEl, null, null);\n\n        // set imagesInfo\n        if (init) {\n            this.plugins.fileManager.setInfo.call(this, 'image', imageEl, this.functions.onImageUpload, null, true);\n        }\n\n        if (openController) {\n            this.selectComponent(imageEl, 'image');\n        }\n\n        // history stack\n        if (!notHistoryPush) this.history.push(false);\n    },\n\n    update_src: function (src, element, file) {\n        element.src = src;\n        this._w.setTimeout(this.plugins.fileManager.setInfo.bind(this, 'image', element, this.functions.onImageUpload, file, true));\n        this.selectComponent(element, 'image');\n    },\n\n    /**\n     * @Required @Override fileManager, resizing\n     */\n    onModifyMode: function (element, size) {\n        if (!element) return;\n        \n        const contextImage = this.context.image;\n        contextImage._linkElement = contextImage.anchorCtx.linkAnchor = /^A$/i.test(element.parentNode.nodeName) ? element.parentNode : null;\n        contextImage._element = element;\n        contextImage._cover = this.util.getParentElement(element, 'FIGURE');\n        contextImage._container = this.util.getParentElement(element, this.util.isMediaComponent);\n        contextImage._caption = this.util.getChildElement(contextImage._cover, 'FIGCAPTION');\n        contextImage._align = element.style.float || element.getAttribute('data-align') || 'none';\n        element.style.float = '';\n        this.plugins.anchor.setCtx(contextImage._linkElement, contextImage.anchorCtx);\n\n        if (size) {\n            contextImage._element_w = size.w;\n            contextImage._element_h = size.h;\n            contextImage._element_t = size.t;\n            contextImage._element_l = size.l;\n        }\n\n        let userSize = contextImage._element.getAttribute('data-size') || contextImage._element.getAttribute('data-origin');\n        let w, h;\n        if (userSize) {\n            userSize = userSize.split(',');\n            w = userSize[0];\n            h = userSize[1];\n        } else if (size) {\n            w = size.w;\n            h = size.h;\n        }\n\n        contextImage._origin_w = w || element.style.width || element.width || '';\n        contextImage._origin_h = h || element.style.height || element.height || '';\n    },\n\n    /**\n     * @Required @Override fileManager, resizing\n     */\n    openModify: function (notOpen) {\n        const contextImage = this.context.image;\n        if (contextImage.imgUrlFile) {\n            contextImage._v_src._linkValue = contextImage.previewSrc.textContent = contextImage.imgUrlFile.value = contextImage._element.src;\n        }\n        contextImage._altText = contextImage.altText.value = contextImage._element.alt;\n        contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"][value=\"' + contextImage._align + '\"]').checked = true;\n        contextImage._align = contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"]:checked').value;\n        contextImage._captionChecked = contextImage.captionCheckEl.checked = !!contextImage._caption;\n        \n        if (contextImage._resizing) {\n            this.plugins.resizing._module_setModifyInputSize.call(this, contextImage, this.plugins.image);\n        }\n\n        if (!notOpen) this.plugins.dialog.open.call(this, 'image', true);\n    },\n\n    /**\n     * @Override fileManager\n     */\n    applySize: function (w, h) {\n        const contextImage = this.context.image;\n\n        if (!w) w = contextImage.inputX.value || this.options.imageWidth;\n        if (!h) h = contextImage.inputY.value || this.options.imageHeight;\n        \n        if ((contextImage._onlyPercentage && !!w) || /%$/.test(w)) {\n            this.plugins.image.setPercentSize.call(this, w, h);\n            return true;\n        } else if ((!w || w === 'auto') && (!h || h === 'auto')) {\n            this.plugins.image.setAutoSize.call(this);\n        } else {\n            this.plugins.image.setSize.call(this, w, h, false);\n        }\n\n        return false;\n    },\n\n    /**\n     * @Override resizing\n     */\n    sizeRevert: function () {\n        this.plugins.resizing._module_sizeRevert.call(this, this.context.image);\n    },\n\n    /**\n     * @Override resizing\n     */\n    setSize: function (w, h, notResetPercentage, direction) {\n        const contextImage = this.context.image;\n        const onlyW = /^(rw|lw)$/.test(direction);\n        const onlyH = /^(th|bh)$/.test(direction);\n\n        if (!onlyH) {\n            contextImage._element.style.width = this.util.isNumber(w) ? w + contextImage.sizeUnit : w;\n            this.plugins.image.cancelPercentAttr.call(this);\n        }\n        if (!onlyW) {\n            contextImage._element.style.height = this.util.isNumber(h) ? h + contextImage.sizeUnit : /%$/.test(h) ? '' : h;\n        }\n\n        if (contextImage._align === 'center') this.plugins.image.setAlign.call(this, null, null, null, null);\n        if (!notResetPercentage) contextImage._element.removeAttribute('data-percentage');\n\n        // save current size\n        this.plugins.resizing._module_saveCurrentSize.call(this, contextImage);\n    },\n\n    /**\n     * @Override resizing\n     */\n    setAutoSize: function () {\n        const contextImage = this.context.image;\n\n        this.plugins.resizing.resetTransform.call(this, contextImage._element);\n        this.plugins.image.cancelPercentAttr.call(this);\n\n        contextImage._element.style.maxWidth = '';\n        contextImage._element.style.width = '';\n        contextImage._element.style.height = '';\n        contextImage._cover.style.width = '';\n        contextImage._cover.style.height = '';\n\n        this.plugins.image.setAlign.call(this, null, null, null, null);\n        contextImage._element.setAttribute('data-percentage', 'auto,auto');\n\n        // save current size\n        this.plugins.resizing._module_saveCurrentSize.call(this, contextImage);\n    },\n    \n    /**\n     * @Override resizing\n     */\n    setOriginSize: function () {\n        const contextImage = this.context.image;\n        contextImage._element.removeAttribute('data-percentage');\n\n        this.plugins.resizing.resetTransform.call(this, contextImage._element);\n        this.plugins.image.cancelPercentAttr.call(this);\n\n        const originSize = (contextImage._element.getAttribute('data-origin') || '').split(',');\n        const w = originSize[0];\n        const h = originSize[1];\n\n        if (originSize) {\n            if (contextImage._onlyPercentage || (/%$/.test(w) && (/%$/.test(h) || !/\\d/.test(h)))) {\n                this.plugins.image.setPercentSize.call(this, w, h);\n            } else {\n                this.plugins.image.setSize.call(this, w, h);\n            }\n\n            // save current size\n            this.plugins.resizing._module_saveCurrentSize.call(this, contextImage);\n        }\n    },\n\n    /**\n     * @Override resizing\n     */\n    setPercentSize: function (w, h) {\n        const contextImage = this.context.image;\n        h = !!h && !/%$/.test(h) && !this.util.getNumber(h, 0) ? this.util.isNumber(h) ? h + '%' : h : this.util.isNumber(h) ? h + contextImage.sizeUnit : (h || '');\n        const heightPercentage = /%$/.test(h);\n\n        contextImage._container.style.width = this.util.isNumber(w) ? w + '%' : w;\n        contextImage._container.style.height = '';\n        contextImage._cover.style.width = '100%';\n        contextImage._cover.style.height = !heightPercentage ? '' : h;\n        contextImage._element.style.width = '100%';\n        contextImage._element.style.height = heightPercentage ? '' : h;\n        contextImage._element.style.maxWidth = '';\n\n        if (contextImage._align === 'center') this.plugins.image.setAlign.call(this, null, null, null, null);\n\n        contextImage._element.setAttribute('data-percentage', w + ',' + h);\n        this.plugins.resizing.setCaptionPosition.call(this, contextImage._element);\n\n        // save current size\n        this.plugins.resizing._module_saveCurrentSize.call(this, contextImage);\n    },\n\n    /**\n     * @Override resizing\n     */\n    cancelPercentAttr: function () {\n        const contextImage = this.context.image;\n        \n        contextImage._cover.style.width = '';\n        contextImage._cover.style.height = '';\n        contextImage._container.style.width = '';\n        contextImage._container.style.height = '';\n\n        this.util.removeClass(contextImage._container, this.context.image._floatClassRegExp);\n        this.util.addClass(contextImage._container, '__se__float-' + contextImage._align);\n\n        if (contextImage._align === 'center') this.plugins.image.setAlign.call(this, null, null, null, null);\n    },\n\n    /**\n     * @Override resizing\n     */\n    setAlign: function (align, element, cover, container) {\n        const contextImage = this.context.image;\n        \n        if (!align) align = contextImage._align;\n        if (!element) element = contextImage._element;\n        if (!cover) cover = contextImage._cover;\n        if (!container) container = contextImage._container;\n\n        if (align && align !== 'none') {\n            cover.style.margin = 'auto';\n        } else {\n            cover.style.margin = '0';\n        }\n\n        if (/%$/.test(element.style.width) && align === 'center') {\n            container.style.minWidth = '100%';\n            cover.style.width = container.style.width;\n        } else {\n            container.style.minWidth = '';\n            cover.style.width = this.context.resizing._rotateVertical ? (element.style.height || element.offsetHeight) : ((!element.style.width || element.style.width === 'auto') ? '' : element.style.width || '100%');\n        }\n\n        if (!this.util.hasClass(container, '__se__float-' + align)) {\n            this.util.removeClass(container, contextImage._floatClassRegExp);\n            this.util.addClass(container, '__se__float-' + align);\n        }\n        \n        element.setAttribute('data-align', align);\n    },\n\n    /**\n     * @Override dialog\n     */\n    init: function () {\n        const contextImage = this.context.image;\n        if (contextImage.imgInputFile) contextImage.imgInputFile.value = '';\n        if (contextImage.imgUrlFile) contextImage._v_src._linkValue = contextImage.previewSrc.textContent = contextImage.imgUrlFile.value = '';\n        if (contextImage.imgInputFile && contextImage.imgUrlFile) {\n            contextImage.imgUrlFile.removeAttribute('disabled');\n            contextImage.previewSrc.style.textDecoration = '';\n        }\n\n        contextImage.altText.value = '';\n        contextImage.modal.querySelector('input[name=\"suneditor_image_radio\"][value=\"none\"]').checked = true;\n        contextImage.captionCheckEl.checked = false;\n        contextImage._element = null;\n        this.plugins.image.openTab.call(this, 'init');\n\n        if (contextImage._resizing) {\n            contextImage.inputX.value = this.options.imageWidth === contextImage._defaultSizeX ? '' : this.options.imageWidth;\n            contextImage.inputY.value = this.options.imageHeight === contextImage._defaultSizeY ? '' : this.options.imageHeight;\n            contextImage.proportion.checked = true;\n            contextImage._ratio = false;\n            contextImage._ratioX = 1;\n            contextImage._ratioY = 1;\n        }\n\n        this.plugins.anchor.init.call(this, contextImage.anchorCtx);\n    }\n};\n"]},"metadata":{},"sourceType":"module"}