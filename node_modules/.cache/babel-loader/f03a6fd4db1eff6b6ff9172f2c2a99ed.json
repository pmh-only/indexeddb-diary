{"ast":null,"code":"/*\r\n * wysiwyg web editor\r\n *\r\n * suneditor.js\r\n * Copyright 2017 JiHong Lee.\r\n * MIT license.\r\n */\n'use strict';\n\nexport default {\n  name: 'table',\n  display: 'submenu',\n  add: function add(core, targetElement) {\n    var context = core.context;\n    var contextTable = context.table = {\n      _element: null,\n      _tdElement: null,\n      _trElement: null,\n      _trElements: null,\n      _tableXY: [],\n      _maxWidth: true,\n      _fixedColumn: false,\n      _rtl: core.options.rtl,\n      cellControllerTop: core.options.tableCellControllerPosition === 'top',\n      resizeText: null,\n      headerButton: null,\n      mergeButton: null,\n      splitButton: null,\n      splitMenu: null,\n      maxText: core.lang.controller.maxSize,\n      minText: core.lang.controller.minSize,\n      _physical_cellCnt: 0,\n      _logical_cellCnt: 0,\n      _rowCnt: 0,\n      _rowIndex: 0,\n      _physical_cellIndex: 0,\n      _logical_cellIndex: 0,\n      _current_colSpan: 0,\n      _current_rowSpan: 0,\n      icons: {\n        expansion: core.icons.expansion,\n        reduction: core.icons.reduction\n      }\n    };\n    /** set submenu */\n\n    var listDiv = this.setSubmenu(core);\n    var tablePicker = listDiv.querySelector('.se-controller-table-picker');\n    contextTable.tableHighlight = listDiv.querySelector('.se-table-size-highlighted');\n    contextTable.tableUnHighlight = listDiv.querySelector('.se-table-size-unhighlighted');\n    contextTable.tableDisplay = listDiv.querySelector('.se-table-size-display');\n    if (core.options.rtl) contextTable.tableHighlight.style.left = 10 * 18 - 13 + 'px';\n    /** set table controller */\n\n    var tableController = this.setController_table(core);\n    contextTable.tableController = tableController;\n    contextTable.resizeButton = tableController.querySelector('._se_table_resize');\n    contextTable.resizeText = tableController.querySelector('._se_table_resize > span > span');\n    contextTable.columnFixedButton = tableController.querySelector('._se_table_fixed_column');\n    contextTable.headerButton = tableController.querySelector('._se_table_header');\n    /** set resizing */\n\n    var resizeDiv = this.setController_tableEditor(core, contextTable.cellControllerTop);\n    contextTable.resizeDiv = resizeDiv;\n    contextTable.splitMenu = resizeDiv.querySelector('.se-btn-group-sub');\n    contextTable.mergeButton = resizeDiv.querySelector('._se_table_merge_button');\n    contextTable.splitButton = resizeDiv.querySelector('._se_table_split_button');\n    contextTable.insertRowAboveButton = resizeDiv.querySelector('._se_table_insert_row_a');\n    contextTable.insertRowBelowButton = resizeDiv.querySelector('._se_table_insert_row_b');\n    /** add event listeners */\n\n    tablePicker.addEventListener('mousemove', this.onMouseMove_tablePicker.bind(core, contextTable));\n    tablePicker.addEventListener('click', this.appendTable.bind(core));\n    resizeDiv.addEventListener('click', this.onClick_tableController.bind(core));\n    tableController.addEventListener('click', this.onClick_tableController.bind(core));\n    /** append target button menu */\n\n    core.initMenuTarget(this.name, targetElement, listDiv);\n    /** append controller */\n\n    context.element.relative.appendChild(resizeDiv);\n    context.element.relative.appendChild(tableController);\n    /** empty memory */\n\n    listDiv = null, tablePicker = null, resizeDiv = null, tableController = null, contextTable = null;\n  },\n  setSubmenu: function setSubmenu(core) {\n    var listDiv = core.util.createElement('DIV');\n    listDiv.className = 'se-submenu se-selector-table';\n    listDiv.innerHTML = '' + '<div class=\"se-table-size\">' + '<div class=\"se-table-size-picker se-controller-table-picker\"></div>' + '<div class=\"se-table-size-highlighted\"></div>' + '<div class=\"se-table-size-unhighlighted\"></div>' + '</div>' + '<div class=\"se-table-size-display\">1 x 1</div>';\n    return listDiv;\n  },\n  setController_table: function setController_table(core) {\n    var lang = core.lang;\n    var icons = core.icons;\n    var tableResize = core.util.createElement('DIV');\n    tableResize.className = 'se-controller se-controller-table';\n    tableResize.innerHTML = '' + '<div>' + '<div class=\"se-btn-group\">' + '<button type=\"button\" data-command=\"resize\" class=\"se-btn se-tooltip _se_table_resize\">' + icons.expansion + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.maxSize + '</span></span>' + '</button>' + '<button type=\"button\" data-command=\"layout\" class=\"se-btn se-tooltip _se_table_fixed_column\">' + icons.fixed_column_width + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.fixedColumnWidth + '</span></span>' + '</button>' + '<button type=\"button\" data-command=\"header\" class=\"se-btn se-tooltip _se_table_header\">' + icons.table_header + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.tableHeader + '</span></span>' + '</button>' + '<button type=\"button\" data-command=\"remove\" class=\"se-btn se-tooltip\">' + icons.delete + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.remove + '</span></span>' + '</button>' + '</div>' + '</div>';\n    return tableResize;\n  },\n  setController_tableEditor: function setController_tableEditor(core, cellControllerTop) {\n    var lang = core.lang;\n    var icons = core.icons;\n    var tableResize = core.util.createElement('DIV');\n    tableResize.className = 'se-controller se-controller-table-cell';\n    tableResize.innerHTML = (cellControllerTop ? '' : '<div class=\"se-arrow se-arrow-up\"></div>') + '<div class=\"se-btn-group\">' + '<button type=\"button\" data-command=\"insert\" data-value=\"row\" data-option=\"up\" class=\"se-btn se-tooltip _se_table_insert_row_a\">' + icons.insert_row_above + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.insertRowAbove + '</span></span>' + '</button>' + '<button type=\"button\" data-command=\"insert\" data-value=\"row\" data-option=\"down\" class=\"se-btn se-tooltip _se_table_insert_row_b\">' + icons.insert_row_below + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.insertRowBelow + '</span></span>' + '</button>' + '<button type=\"button\" data-command=\"delete\" data-value=\"row\" class=\"se-btn se-tooltip\">' + icons.delete_row + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.deleteRow + '</span></span>' + '</button>' + '<button type=\"button\" data-command=\"merge\" class=\"_se_table_merge_button se-btn se-tooltip\" disabled>' + icons.merge_cell + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.mergeCells + '</span></span>' + '</button>' + '</div>' + '<div class=\"se-btn-group\" style=\"padding-top: 0;\">' + '<button type=\"button\" data-command=\"insert\" data-value=\"cell\" data-option=\"left\" class=\"se-btn se-tooltip\">' + icons.insert_column_left + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.insertColumnBefore + '</span></span>' + '</button>' + '<button type=\"button\" data-command=\"insert\" data-value=\"cell\" data-option=\"right\" class=\"se-btn se-tooltip\">' + icons.insert_column_right + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.insertColumnAfter + '</span></span>' + '</button>' + '<button type=\"button\" data-command=\"delete\" data-value=\"cell\" class=\"se-btn se-tooltip\">' + icons.delete_column + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.deleteColumn + '</span></span>' + '</button>' + '<button type=\"button\" data-command=\"onsplit\" class=\"_se_table_split_button se-btn se-tooltip\">' + icons.split_cell + '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.splitCells + '</span></span>' + '</button>' + '<div class=\"se-btn-group-sub sun-editor-common se-list-layer se-table-split\">' + '<div class=\"se-list-inner\">' + '<ul class=\"se-list-basic\">' + '<li class=\"se-btn-list\" data-command=\"split\" data-value=\"vertical\" style=\"line-height:32px;\" title=\"' + lang.controller.VerticalSplit + '\">' + lang.controller.VerticalSplit + '</li>' + '<li class=\"se-btn-list\" data-command=\"split\" data-value=\"horizontal\" style=\"line-height:32px;\" title=\"' + lang.controller.HorizontalSplit + '\">' + lang.controller.HorizontalSplit + '</li>' + '</ul>' + '</div>' + '</div>' + '</div>';\n    return tableResize;\n  },\n  appendTable: function appendTable() {\n    var oTable = this.util.createElement('TABLE');\n    var createCells = this.plugins.table.createCells;\n    var x = this.context.table._tableXY[0];\n    var y = this.context.table._tableXY[1];\n    var tableHTML = '<tbody>';\n\n    while (y > 0) {\n      tableHTML += '<tr>' + createCells.call(this, 'td', x) + '</tr>';\n      --y;\n    }\n\n    tableHTML += '</tbody>';\n    oTable.innerHTML = tableHTML;\n    var changed = this.insertComponent(oTable, false, true, false);\n\n    if (changed) {\n      var firstTd = oTable.querySelector('td div');\n      this.setRange(firstTd, 0, firstTd, 0);\n      this.plugins.table.reset_table_picker.call(this);\n    }\n  },\n  createCells: function createCells(nodeName, cnt, returnElement) {\n    nodeName = nodeName.toLowerCase();\n\n    if (!returnElement) {\n      var cellsHTML = '';\n\n      while (cnt > 0) {\n        cellsHTML += '<' + nodeName + '><div><br></div></' + nodeName + '>';\n        cnt--;\n      }\n\n      return cellsHTML;\n    } else {\n      var cell = this.util.createElement(nodeName);\n      cell.innerHTML = '<div><br></div>';\n      return cell;\n    }\n  },\n  onMouseMove_tablePicker: function onMouseMove_tablePicker(contextTable, e) {\n    e.stopPropagation();\n\n    var x = this._w.Math.ceil(e.offsetX / 18);\n\n    var y = this._w.Math.ceil(e.offsetY / 18);\n\n    x = x < 1 ? 1 : x;\n    y = y < 1 ? 1 : y;\n\n    if (contextTable._rtl) {\n      contextTable.tableHighlight.style.left = x * 18 - 13 + 'px';\n      x = 11 - x;\n    }\n\n    contextTable.tableHighlight.style.width = x + 'em';\n    contextTable.tableHighlight.style.height = y + 'em'; // let x_u = x < 5 ? 5 : (x > 9 ? 10 : x + 1);\n    // let y_u = y < 5 ? 5 : (y > 9 ? 10 : y + 1);\n    // contextTable.tableUnHighlight.style.width = x_u + 'em';\n    // contextTable.tableUnHighlight.style.height = y_u + 'em';\n\n    this.util.changeTxt(contextTable.tableDisplay, x + ' x ' + y);\n    contextTable._tableXY = [x, y];\n  },\n  reset_table_picker: function reset_table_picker() {\n    if (!this.context.table.tableHighlight) return;\n    var highlight = this.context.table.tableHighlight.style;\n    var unHighlight = this.context.table.tableUnHighlight.style;\n    highlight.width = '1em';\n    highlight.height = '1em';\n    unHighlight.width = '10em';\n    unHighlight.height = '10em';\n    this.util.changeTxt(this.context.table.tableDisplay, '1 x 1');\n    this.submenuOff();\n  },\n  init: function init() {\n    var contextTable = this.context.table;\n    var tablePlugin = this.plugins.table;\n\n    tablePlugin._removeEvents.call(this);\n\n    if (tablePlugin._selectedTable) {\n      var selectedCells = tablePlugin._selectedTable.querySelectorAll('.se-table-selected-cell');\n\n      for (var i = 0, len = selectedCells.length; i < len; i++) {\n        this.util.removeClass(selectedCells[i], 'se-table-selected-cell');\n      }\n    }\n\n    tablePlugin._toggleEditor.call(this, true);\n\n    contextTable._element = null;\n    contextTable._tdElement = null;\n    contextTable._trElement = null;\n    contextTable._trElements = null;\n    contextTable._tableXY = [];\n    contextTable._maxWidth = true;\n    contextTable._fixedColumn = false;\n    contextTable._physical_cellCnt = 0;\n    contextTable._logical_cellCnt = 0;\n    contextTable._rowCnt = 0;\n    contextTable._rowIndex = 0;\n    contextTable._physical_cellIndex = 0;\n    contextTable._logical_cellIndex = 0;\n    contextTable._current_colSpan = 0;\n    contextTable._current_rowSpan = 0;\n    tablePlugin._shift = false;\n    tablePlugin._selectedCells = null;\n    tablePlugin._selectedTable = null;\n    tablePlugin._ref = null;\n    tablePlugin._fixedCell = null;\n    tablePlugin._selectedCell = null;\n    tablePlugin._fixedCellName = null;\n  },\n\n  /** table edit controller */\n  call_controller_tableEdit: function call_controller_tableEdit(tdElement) {\n    var tablePlugin = this.plugins.table;\n    var contextTable = this.context.table;\n\n    if (!this.getSelection().isCollapsed && !tablePlugin._selectedCell) {\n      this.controllersOff();\n      this.util.removeClass(tdElement, 'se-table-selected-cell');\n      return;\n    }\n\n    var tableElement = contextTable._element || this.plugins.table._selectedTable || this.util.getParentElement(tdElement, 'TABLE');\n    contextTable._maxWidth = this.util.hasClass(tableElement, 'se-table-size-100') || tableElement.style.width === '100%' || !tableElement.style.width && !this.util.hasClass(tableElement, 'se-table-size-auto');\n    contextTable._fixedColumn = this.util.hasClass(tableElement, 'se-table-layout-fixed') || tableElement.style.tableLayout === 'fixed';\n    tablePlugin.setTableStyle.call(this, contextTable._maxWidth ? 'width|column' : 'width');\n    tablePlugin.setPositionControllerTop.call(this, tableElement);\n    tablePlugin.setPositionControllerDiv.call(this, tdElement, tablePlugin._shift);\n    if (!tablePlugin._shift) this.controllersOn(contextTable.resizeDiv, contextTable.tableController, tablePlugin.init.bind(this), tdElement, 'table');\n  },\n  setPositionControllerTop: function setPositionControllerTop(tableElement) {\n    this.setControllerPosition(this.context.table.tableController, tableElement, 'top', {\n      left: 0,\n      top: 0\n    });\n  },\n  setPositionControllerDiv: function setPositionControllerDiv(tdElement, reset) {\n    var contextTable = this.context.table;\n    var resizeDiv = contextTable.resizeDiv;\n    this.plugins.table.setCellInfo.call(this, tdElement, reset);\n\n    if (contextTable.cellControllerTop) {\n      this.setControllerPosition(resizeDiv, contextTable._element, 'top', {\n        left: contextTable.tableController.offsetWidth,\n        top: 0\n      });\n    } else {\n      this.setControllerPosition(resizeDiv, tdElement, 'bottom', {\n        left: 0,\n        top: 0\n      });\n    }\n  },\n  setCellInfo: function setCellInfo(tdElement, reset) {\n    var contextTable = this.context.table;\n    var table = contextTable._element = this.plugins.table._selectedTable || this.util.getParentElement(tdElement, 'TABLE');\n\n    if (/THEAD/i.test(table.firstElementChild.nodeName)) {\n      this.util.addClass(contextTable.headerButton, 'active');\n    } else {\n      this.util.removeClass(contextTable.headerButton, 'active');\n    }\n\n    if (reset || contextTable._physical_cellCnt === 0) {\n      if (contextTable._tdElement !== tdElement) {\n        contextTable._tdElement = tdElement;\n        contextTable._trElement = tdElement.parentNode;\n      }\n\n      var rows = contextTable._trElements = table.rows;\n      var cellIndex = tdElement.cellIndex;\n      var cellCnt = 0;\n\n      for (var i = 0, cells = rows[0].cells, len = rows[0].cells.length; i < len; i++) {\n        cellCnt += cells[i].colSpan;\n      } // row cnt, row index\n\n\n      var rowIndex = contextTable._rowIndex = contextTable._trElement.rowIndex;\n      contextTable._rowCnt = rows.length; // cell cnt, physical cell index\n\n      contextTable._physical_cellCnt = contextTable._trElement.cells.length;\n      contextTable._logical_cellCnt = cellCnt;\n      contextTable._physical_cellIndex = cellIndex; // span\n\n      contextTable._current_colSpan = contextTable._tdElement.colSpan - 1;\n      contextTable._current_rowSpan - contextTable._trElement.cells[cellIndex].rowSpan - 1; // find logcal cell index\n\n      var rowSpanArr = [];\n      var spanIndex = [];\n\n      for (var _i = 0, _cells, colSpan; _i <= rowIndex; _i++) {\n        _cells = rows[_i].cells;\n        colSpan = 0;\n\n        for (var c = 0, cLen = _cells.length, cell, cs, rs, logcalIndex; c < cLen; c++) {\n          cell = _cells[c];\n          cs = cell.colSpan - 1;\n          rs = cell.rowSpan - 1;\n          logcalIndex = c + colSpan;\n\n          if (spanIndex.length > 0) {\n            for (var r = 0, arr; r < spanIndex.length; r++) {\n              arr = spanIndex[r];\n              if (arr.row > _i) continue;\n\n              if (logcalIndex >= arr.index) {\n                colSpan += arr.cs;\n                logcalIndex += arr.cs;\n                arr.rs -= 1;\n                arr.row = _i + 1;\n\n                if (arr.rs < 1) {\n                  spanIndex.splice(r, 1);\n                  r--;\n                }\n              } else if (c === cLen - 1) {\n                arr.rs -= 1;\n                arr.row = _i + 1;\n\n                if (arr.rs < 1) {\n                  spanIndex.splice(r, 1);\n                  r--;\n                }\n              }\n            }\n          } // logcal cell index\n\n\n          if (_i === rowIndex && c === cellIndex) {\n            contextTable._logical_cellIndex = logcalIndex;\n            break;\n          }\n\n          if (rs > 0) {\n            rowSpanArr.push({\n              index: logcalIndex,\n              cs: cs + 1,\n              rs: rs,\n              row: -1\n            });\n          }\n\n          colSpan += cs;\n        }\n\n        spanIndex = spanIndex.concat(rowSpanArr).sort(function (a, b) {\n          return a.index - b.index;\n        });\n        rowSpanArr = [];\n      }\n\n      rowSpanArr = null;\n      spanIndex = null;\n    }\n  },\n  editTable: function editTable(type, option) {\n    var tablePlugin = this.plugins.table;\n    var contextTable = this.context.table;\n    var table = contextTable._element;\n    var isRow = type === 'row';\n\n    if (isRow) {\n      var tableAttr = contextTable._trElement.parentNode;\n\n      if (/^THEAD$/i.test(tableAttr.nodeName)) {\n        if (option === 'up') {\n          return;\n        } else if (!tableAttr.nextElementSibling || !/^TBODY$/i.test(tableAttr.nextElementSibling.nodeName)) {\n          table.innerHTML += '<tbody><tr>' + tablePlugin.createCells.call(this, 'td', contextTable._logical_cellCnt, false) + '</tr></tbody>';\n          return;\n        }\n      }\n    } // multi\n\n\n    if (tablePlugin._ref) {\n      var positionCell = contextTable._tdElement;\n      var selectedCells = tablePlugin._selectedCells; // multi - row\n\n      if (isRow) {\n        // remove row\n        if (!option) {\n          var row = selectedCells[0].parentNode;\n          var removeCells = [selectedCells[0]];\n\n          for (var i = 1, len = selectedCells.length, cell; i < len; i++) {\n            cell = selectedCells[i];\n\n            if (row !== cell.parentNode) {\n              removeCells.push(cell);\n              row = cell.parentNode;\n            }\n          }\n\n          for (var _i2 = 0, _len = removeCells.length; _i2 < _len; _i2++) {\n            tablePlugin.setCellInfo.call(this, removeCells[_i2], true);\n            tablePlugin.editRow.call(this, option);\n          }\n        } else {\n          // edit row\n          tablePlugin.setCellInfo.call(this, option === 'up' ? selectedCells[0] : selectedCells[selectedCells.length - 1], true);\n          tablePlugin.editRow.call(this, option, positionCell);\n        }\n      } else {\n        // multi - cell\n        var firstRow = selectedCells[0].parentNode; // remove cell\n\n        if (!option) {\n          var _removeCells = [selectedCells[0]];\n\n          for (var _i3 = 1, _len2 = selectedCells.length, _cell; _i3 < _len2; _i3++) {\n            _cell = selectedCells[_i3];\n\n            if (firstRow === _cell.parentNode) {\n              _removeCells.push(_cell);\n            } else {\n              break;\n            }\n          }\n\n          for (var _i4 = 0, _len3 = _removeCells.length; _i4 < _len3; _i4++) {\n            tablePlugin.setCellInfo.call(this, _removeCells[_i4], true);\n            tablePlugin.editCell.call(this, option);\n          }\n        } else {\n          // edit cell\n          var rightCell = null;\n\n          for (var _i5 = 0, _len4 = selectedCells.length - 1; _i5 < _len4; _i5++) {\n            if (firstRow !== selectedCells[_i5 + 1].parentNode) {\n              rightCell = selectedCells[_i5];\n              break;\n            }\n          }\n\n          tablePlugin.setCellInfo.call(this, option === 'left' ? selectedCells[0] : rightCell || selectedCells[0], true);\n          tablePlugin.editCell.call(this, option, positionCell);\n        }\n      }\n\n      if (!option) tablePlugin.init.call(this);\n    } // one\n    else {\n        tablePlugin[isRow ? 'editRow' : 'editCell'].call(this, option);\n      } // after remove\n\n\n    if (!option) {\n      var children = table.children;\n\n      for (var _i6 = 0; _i6 < children.length; _i6++) {\n        if (children[_i6].children.length === 0) {\n          this.util.removeItem(children[_i6]);\n          _i6--;\n        }\n      }\n\n      if (table.children.length === 0) this.util.removeItem(table);\n    }\n  },\n  editRow: function editRow(option, positionResetElement) {\n    var contextTable = this.context.table;\n    var remove = !option;\n    var up = option === 'up';\n    var originRowIndex = contextTable._rowIndex;\n    var rowIndex = remove || up ? originRowIndex : originRowIndex + contextTable._current_rowSpan + 1;\n    var sign = remove ? -1 : 1;\n    var rows = contextTable._trElements;\n    var cellCnt = contextTable._logical_cellCnt;\n\n    for (var i = 0, len = originRowIndex + (remove ? -1 : 0), cell; i <= len; i++) {\n      cell = rows[i].cells;\n      if (cell.length === 0) return;\n\n      for (var c = 0, cLen = cell.length, rs, cs; c < cLen; c++) {\n        rs = cell[c].rowSpan;\n        cs = cell[c].colSpan;\n        if (rs < 2 && cs < 2) continue;\n\n        if (rs + i > rowIndex && rowIndex > i) {\n          cell[c].rowSpan = rs + sign;\n          cellCnt -= cs;\n        }\n      }\n    }\n\n    if (remove) {\n      var next = rows[originRowIndex + 1];\n\n      if (next) {\n        var spanCells = [];\n        var cells = rows[originRowIndex].cells;\n        var colSpan = 0;\n\n        for (var _i7 = 0, _len5 = cells.length, _cell2, logcalIndex; _i7 < _len5; _i7++) {\n          _cell2 = cells[_i7];\n          logcalIndex = _i7 + colSpan;\n          colSpan += _cell2.colSpan - 1;\n\n          if (_cell2.rowSpan > 1) {\n            _cell2.rowSpan -= 1;\n            spanCells.push({\n              cell: _cell2.cloneNode(false),\n              index: logcalIndex\n            });\n          }\n        }\n\n        if (spanCells.length > 0) {\n          var spanCell = spanCells.shift();\n          cells = next.cells;\n          colSpan = 0;\n\n          for (var _i8 = 0, _len6 = cells.length, _cell3, _logcalIndex; _i8 < _len6; _i8++) {\n            _cell3 = cells[_i8];\n            _logcalIndex = _i8 + colSpan;\n            colSpan += _cell3.colSpan - 1;\n\n            if (_logcalIndex >= spanCell.index) {\n              _i8--, colSpan--;\n              colSpan += spanCell.cell.colSpan - 1;\n              next.insertBefore(spanCell.cell, _cell3);\n              spanCell = spanCells.shift();\n              if (!spanCell) break;\n            }\n          }\n\n          if (spanCell) {\n            next.appendChild(spanCell.cell);\n\n            for (var _i9 = 0, _len7 = spanCells.length; _i9 < _len7; _i9++) {\n              next.appendChild(spanCells[_i9].cell);\n            }\n          }\n        }\n      }\n\n      contextTable._element.deleteRow(rowIndex);\n    } else {\n      var newRow = contextTable._element.insertRow(rowIndex);\n\n      newRow.innerHTML = this.plugins.table.createCells.call(this, 'td', cellCnt, false);\n    }\n\n    if (!remove) {\n      this.plugins.table.setPositionControllerDiv.call(this, positionResetElement || contextTable._tdElement, true);\n    } else {\n      this.controllersOff();\n    }\n  },\n  editCell: function editCell(option, positionResetElement) {\n    var contextTable = this.context.table;\n    var util = this.util;\n    var remove = !option;\n    var left = option === 'left';\n    var colSpan = contextTable._current_colSpan;\n    var cellIndex = remove || left ? contextTable._logical_cellIndex : contextTable._logical_cellIndex + colSpan + 1;\n    var rows = contextTable._trElements;\n    var rowSpanArr = [];\n    var spanIndex = [];\n    var passCell = 0;\n    var removeCell = [];\n    var removeSpanArr = [];\n\n    for (var i = 0, len = contextTable._rowCnt, row, insertIndex, cells, newCell, applySpan, cellColSpan; i < len; i++) {\n      row = rows[i];\n      insertIndex = cellIndex;\n      applySpan = false;\n      cells = row.cells;\n      cellColSpan = 0;\n\n      for (var c = 0, cell, cLen = cells.length, rs, cs, removeIndex; c < cLen; c++) {\n        cell = cells[c];\n        if (!cell) break;\n        rs = cell.rowSpan - 1;\n        cs = cell.colSpan - 1;\n\n        if (!remove) {\n          if (c >= insertIndex) break;\n\n          if (cs > 0) {\n            if (passCell < 1 && cs + c >= insertIndex) {\n              cell.colSpan += 1;\n              insertIndex = null;\n              passCell = rs + 1;\n              break;\n            }\n\n            insertIndex -= cs;\n          }\n\n          if (!applySpan) {\n            for (var r = 0, arr; r < spanIndex.length; r++) {\n              arr = spanIndex[r];\n              insertIndex -= arr.cs;\n              arr.rs -= 1;\n\n              if (arr.rs < 1) {\n                spanIndex.splice(r, 1);\n                r--;\n              }\n            }\n\n            applySpan = true;\n          }\n        } else {\n          removeIndex = c + cellColSpan;\n\n          if (spanIndex.length > 0) {\n            var lastCell = !cells[c + 1];\n\n            for (var _r = 0, _arr; _r < spanIndex.length; _r++) {\n              _arr = spanIndex[_r];\n              if (_arr.row > i) continue;\n\n              if (removeIndex >= _arr.index) {\n                cellColSpan += _arr.cs;\n                removeIndex = c + cellColSpan;\n                _arr.rs -= 1;\n                _arr.row = i + 1;\n\n                if (_arr.rs < 1) {\n                  spanIndex.splice(_r, 1);\n                  _r--;\n                }\n              } else if (lastCell) {\n                _arr.rs -= 1;\n                _arr.row = i + 1;\n\n                if (_arr.rs < 1) {\n                  spanIndex.splice(_r, 1);\n                  _r--;\n                }\n              }\n            }\n          }\n\n          if (rs > 0) {\n            rowSpanArr.push({\n              rs: rs,\n              cs: cs + 1,\n              index: removeIndex,\n              row: -1\n            });\n          }\n\n          if (removeIndex >= insertIndex && removeIndex + cs <= insertIndex + colSpan) {\n            removeCell.push(cell);\n          } else if (removeIndex <= insertIndex + colSpan && removeIndex + cs >= insertIndex) {\n            cell.colSpan -= util.getOverlapRangeAtIndex(cellIndex, cellIndex + colSpan, removeIndex, removeIndex + cs);\n          } else if (rs > 0 && (removeIndex < insertIndex || removeIndex + cs > insertIndex + colSpan)) {\n            removeSpanArr.push({\n              cell: cell,\n              i: i,\n              rs: i + rs\n            });\n          }\n\n          cellColSpan += cs;\n        }\n      }\n\n      spanIndex = spanIndex.concat(rowSpanArr).sort(function (a, b) {\n        return a.index - b.index;\n      });\n      rowSpanArr = [];\n\n      if (!remove) {\n        if (passCell > 0) {\n          passCell -= 1;\n          continue;\n        }\n\n        if (insertIndex !== null && cells.length > 0) {\n          newCell = this.plugins.table.createCells.call(this, cells[0].nodeName, 0, true);\n          newCell = row.insertBefore(newCell, cells[insertIndex]);\n        }\n      }\n    }\n\n    if (remove) {\n      var removeFirst, removeEnd;\n\n      for (var _r2 = 0, rLen = removeCell.length, _row; _r2 < rLen; _r2++) {\n        _row = removeCell[_r2].parentNode;\n        util.removeItem(removeCell[_r2]);\n\n        if (_row.cells.length === 0) {\n          if (!removeFirst) removeFirst = util.getArrayIndex(rows, _row);\n          removeEnd = util.getArrayIndex(rows, _row);\n          util.removeItem(_row);\n        }\n      }\n\n      for (var _c = 0, _cLen = removeSpanArr.length, rowSpanCell; _c < _cLen; _c++) {\n        rowSpanCell = removeSpanArr[_c];\n        rowSpanCell.cell.rowSpan = util.getOverlapRangeAtIndex(removeFirst, removeEnd, rowSpanCell.i, rowSpanCell.rs);\n      }\n\n      this.controllersOff();\n    } else {\n      this.plugins.table.setPositionControllerDiv.call(this, positionResetElement || contextTable._tdElement, true);\n    }\n  },\n  _closeSplitMenu: null,\n  openSplitMenu: function openSplitMenu() {\n    this.util.addClass(this.context.table.splitButton, 'on');\n    this.context.table.splitMenu.style.display = 'inline-table';\n\n    this.plugins.table._closeSplitMenu = function () {\n      this.util.removeClass(this.context.table.splitButton, 'on');\n      this.context.table.splitMenu.style.display = 'none';\n      this.removeDocEvent('click', this.plugins.table._closeSplitMenu);\n      this.plugins.table._closeSplitMenu = null;\n    }.bind(this);\n\n    this.addDocEvent('click', this.plugins.table._closeSplitMenu);\n  },\n  splitCells: function splitCells(direction) {\n    var util = this.util;\n    var vertical = direction === 'vertical';\n    var contextTable = this.context.table;\n    var currentCell = contextTable._tdElement;\n    var rows = contextTable._trElements;\n    var currentRow = contextTable._trElement;\n    var index = contextTable._logical_cellIndex;\n    var rowIndex = contextTable._rowIndex;\n    var newCell = this.plugins.table.createCells.call(this, currentCell.nodeName, 0, true); // vertical\n\n    if (vertical) {\n      var currentColSpan = currentCell.colSpan;\n      newCell.rowSpan = currentCell.rowSpan; // colspan > 1\n\n      if (currentColSpan > 1) {\n        newCell.colSpan = this._w.Math.floor(currentColSpan / 2);\n        currentCell.colSpan = currentColSpan - newCell.colSpan;\n        currentRow.insertBefore(newCell, currentCell.nextElementSibling);\n      } else {\n        // colspan - 1\n        var rowSpanArr = [];\n        var spanIndex = [];\n\n        for (var i = 0, len = contextTable._rowCnt, cells, colSpan; i < len; i++) {\n          cells = rows[i].cells;\n          colSpan = 0;\n\n          for (var c = 0, cLen = cells.length, cell, cs, rs, logcalIndex; c < cLen; c++) {\n            cell = cells[c];\n            cs = cell.colSpan - 1;\n            rs = cell.rowSpan - 1;\n            logcalIndex = c + colSpan;\n\n            if (spanIndex.length > 0) {\n              for (var r = 0, arr; r < spanIndex.length; r++) {\n                arr = spanIndex[r];\n                if (arr.row > i) continue;\n\n                if (logcalIndex >= arr.index) {\n                  colSpan += arr.cs;\n                  logcalIndex += arr.cs;\n                  arr.rs -= 1;\n                  arr.row = i + 1;\n\n                  if (arr.rs < 1) {\n                    spanIndex.splice(r, 1);\n                    r--;\n                  }\n                } else if (c === cLen - 1) {\n                  arr.rs -= 1;\n                  arr.row = i + 1;\n\n                  if (arr.rs < 1) {\n                    spanIndex.splice(r, 1);\n                    r--;\n                  }\n                }\n              }\n            }\n\n            if (logcalIndex <= index && rs > 0) {\n              rowSpanArr.push({\n                index: logcalIndex,\n                cs: cs + 1,\n                rs: rs,\n                row: -1\n              });\n            }\n\n            if (cell !== currentCell && logcalIndex <= index && logcalIndex + cs >= index + currentColSpan - 1) {\n              cell.colSpan += 1;\n              break;\n            }\n\n            if (logcalIndex > index) break;\n            colSpan += cs;\n          }\n\n          spanIndex = spanIndex.concat(rowSpanArr).sort(function (a, b) {\n            return a.index - b.index;\n          });\n          rowSpanArr = [];\n        }\n\n        currentRow.insertBefore(newCell, currentCell.nextElementSibling);\n      }\n    } else {\n      // horizontal\n      var currentRowSpan = currentCell.rowSpan;\n      newCell.colSpan = currentCell.colSpan; // rowspan > 1\n\n      if (currentRowSpan > 1) {\n        newCell.rowSpan = this._w.Math.floor(currentRowSpan / 2);\n        var newRowSpan = currentRowSpan - newCell.rowSpan;\n        var _rowSpanArr = [];\n        var nextRowIndex = util.getArrayIndex(rows, currentRow) + newRowSpan;\n\n        for (var _i10 = 0, _cells2, _colSpan; _i10 < nextRowIndex; _i10++) {\n          _cells2 = rows[_i10].cells;\n          _colSpan = 0;\n\n          for (var _c2 = 0, _cLen2 = _cells2.length, _cell4, _cs, _logcalIndex2; _c2 < _cLen2; _c2++) {\n            _logcalIndex2 = _c2 + _colSpan;\n            if (_logcalIndex2 >= index) break;\n            _cell4 = _cells2[_c2];\n            _cs = _cell4.rowSpan - 1;\n\n            if (_cs > 0 && _cs + _i10 >= nextRowIndex && _logcalIndex2 < index) {\n              _rowSpanArr.push({\n                index: _logcalIndex2,\n                cs: _cell4.colSpan\n              });\n            }\n\n            _colSpan += _cell4.colSpan - 1;\n          }\n        }\n\n        var nextRow = rows[nextRowIndex];\n        var nextCells = nextRow.cells;\n\n        var _rs = _rowSpanArr.shift();\n\n        for (var _c3 = 0, _cLen3 = nextCells.length, _colSpan2 = 0, _cell5, _cs2, _logcalIndex3, insertIndex; _c3 < _cLen3; _c3++) {\n          _logcalIndex3 = _c3 + _colSpan2;\n          _cell5 = nextCells[_c3];\n          _cs2 = _cell5.colSpan - 1;\n          insertIndex = _logcalIndex3 + _cs2 + 1;\n\n          if (_rs && insertIndex >= _rs.index) {\n            _colSpan2 += _rs.cs;\n            insertIndex += _rs.cs;\n            _rs = _rowSpanArr.shift();\n          }\n\n          if (insertIndex >= index || _c3 === _cLen3 - 1) {\n            nextRow.insertBefore(newCell, _cell5.nextElementSibling);\n            break;\n          }\n\n          _colSpan2 += _cs2;\n        }\n\n        currentCell.rowSpan = newRowSpan;\n      } else {\n        // rowspan - 1\n        newCell.rowSpan = currentCell.rowSpan;\n        var newRow = util.createElement('TR');\n        newRow.appendChild(newCell);\n\n        for (var _i11 = 0, _cells4; _i11 < rowIndex; _i11++) {\n          _cells4 = rows[_i11].cells;\n          if (_cells4.length === 0) return;\n\n          for (var _c4 = 0, _cLen4 = _cells4.length; _c4 < _cLen4; _c4++) {\n            if (_i11 + _cells4[_c4].rowSpan - 1 >= rowIndex) {\n              _cells4[_c4].rowSpan += 1;\n            }\n          }\n        }\n\n        var physicalIndex = contextTable._physical_cellIndex;\n        var _cells3 = currentRow.cells;\n\n        for (var _c5 = 0, _cLen5 = _cells3.length; _c5 < _cLen5; _c5++) {\n          if (_c5 === physicalIndex) continue;\n          _cells3[_c5].rowSpan += 1;\n        }\n\n        currentRow.parentNode.insertBefore(newRow, currentRow.nextElementSibling);\n      }\n    }\n\n    this.focusEdge(currentCell);\n    this.plugins.table.setPositionControllerDiv.call(this, currentCell, true);\n  },\n  mergeCells: function mergeCells() {\n    var tablePlugin = this.plugins.table;\n    var contextTable = this.context.table;\n    var util = this.util;\n    var ref = tablePlugin._ref;\n    var selectedCells = tablePlugin._selectedCells;\n    var mergeCell = selectedCells[0];\n    var emptyRowFirst = null;\n    var emptyRowLast = null;\n    var cs = ref.ce - ref.cs + 1;\n    var rs = ref.re - ref.rs + 1;\n    var mergeHTML = '';\n    var row = null;\n\n    for (var i = 1, len = selectedCells.length, cell, ch; i < len; i++) {\n      cell = selectedCells[i];\n      if (row !== cell.parentNode) row = cell.parentNode;\n      ch = cell.children;\n\n      for (var c = 0, cLen = ch.length; c < cLen; c++) {\n        if (util.isFormatElement(ch[c]) && util.onlyZeroWidthSpace(ch[c].textContent)) {\n          util.removeItem(ch[c]);\n        }\n      }\n\n      mergeHTML += cell.innerHTML;\n      util.removeItem(cell);\n\n      if (row.cells.length === 0) {\n        if (!emptyRowFirst) emptyRowFirst = row;else emptyRowLast = row;\n        rs -= 1;\n      }\n    }\n\n    if (emptyRowFirst) {\n      var rows = contextTable._trElements;\n      var rowIndexFirst = util.getArrayIndex(rows, emptyRowFirst);\n      var rowIndexLast = util.getArrayIndex(rows, emptyRowLast || emptyRowFirst);\n      var removeRows = [];\n\n      for (var _i12 = 0, cells; _i12 <= rowIndexLast; _i12++) {\n        cells = rows[_i12].cells;\n\n        if (cells.length === 0) {\n          removeRows.push(rows[_i12]);\n          continue;\n        }\n\n        for (var _c6 = 0, _cLen6 = cells.length, _cell6, _rs2; _c6 < _cLen6; _c6++) {\n          _cell6 = cells[_c6];\n          _rs2 = _cell6.rowSpan - 1;\n\n          if (_rs2 > 0 && _i12 + _rs2 >= rowIndexFirst) {\n            _cell6.rowSpan -= util.getOverlapRangeAtIndex(rowIndexFirst, rowIndexLast, _i12, _i12 + _rs2);\n          }\n        }\n      }\n\n      for (var _i13 = 0, _len8 = removeRows.length; _i13 < _len8; _i13++) {\n        util.removeItem(removeRows[_i13]);\n      }\n    }\n\n    mergeCell.innerHTML += mergeHTML;\n    mergeCell.colSpan = cs;\n    mergeCell.rowSpan = rs;\n    this.controllersOff();\n    tablePlugin.setActiveButton.call(this, true, false);\n    tablePlugin.call_controller_tableEdit.call(this, mergeCell);\n    util.addClass(mergeCell, 'se-table-selected-cell');\n    this.focusEdge(mergeCell);\n  },\n  toggleHeader: function toggleHeader() {\n    var util = this.util;\n    var headerButton = this.context.table.headerButton;\n    var active = util.hasClass(headerButton, 'active');\n    var table = this.context.table._element;\n\n    if (!active) {\n      var header = util.createElement('THEAD');\n      header.innerHTML = '<tr>' + this.plugins.table.createCells.call(this, 'th', this.context.table._logical_cellCnt, false) + '</tr>';\n      table.insertBefore(header, table.firstElementChild);\n    } else {\n      util.removeItem(table.querySelector('thead'));\n    }\n\n    util.toggleClass(headerButton, 'active');\n\n    if (/TH/i.test(this.context.table._tdElement.nodeName)) {\n      this.controllersOff();\n    } else {\n      this.plugins.table.setPositionControllerDiv.call(this, this.context.table._tdElement, false);\n    }\n  },\n  setTableStyle: function setTableStyle(styles) {\n    var contextTable = this.context.table;\n    var tableElement = contextTable._element;\n    var icon, span, sizeIcon, text;\n\n    if (styles.indexOf('width') > -1) {\n      icon = contextTable.resizeButton.firstElementChild;\n      span = contextTable.resizeText;\n\n      if (!contextTable._maxWidth) {\n        sizeIcon = contextTable.icons.expansion;\n        text = contextTable.maxText;\n        contextTable.columnFixedButton.style.display = 'none';\n        this.util.removeClass(tableElement, 'se-table-size-100');\n        this.util.addClass(tableElement, 'se-table-size-auto');\n      } else {\n        sizeIcon = contextTable.icons.reduction;\n        text = contextTable.minText;\n        contextTable.columnFixedButton.style.display = 'block';\n        this.util.removeClass(tableElement, 'se-table-size-auto');\n        this.util.addClass(tableElement, 'se-table-size-100');\n      }\n\n      this.util.changeElement(icon, sizeIcon);\n      this.util.changeTxt(span, text);\n    }\n\n    if (styles.indexOf('column') > -1) {\n      if (!contextTable._fixedColumn) {\n        this.util.removeClass(tableElement, 'se-table-layout-fixed');\n        this.util.addClass(tableElement, 'se-table-layout-auto');\n        this.util.removeClass(contextTable.columnFixedButton, 'active');\n      } else {\n        this.util.removeClass(tableElement, 'se-table-layout-auto');\n        this.util.addClass(tableElement, 'se-table-layout-fixed');\n        this.util.addClass(contextTable.columnFixedButton, 'active');\n      }\n    }\n  },\n  setActiveButton: function setActiveButton(fixedCell, selectedCell) {\n    var contextTable = this.context.table;\n\n    if (/^TH$/i.test(fixedCell.nodeName)) {\n      contextTable.insertRowAboveButton.setAttribute('disabled', true);\n      contextTable.insertRowBelowButton.setAttribute('disabled', true);\n    } else {\n      contextTable.insertRowAboveButton.removeAttribute('disabled');\n      contextTable.insertRowBelowButton.removeAttribute('disabled');\n    }\n\n    if (!selectedCell || fixedCell === selectedCell) {\n      contextTable.splitButton.removeAttribute('disabled');\n      contextTable.mergeButton.setAttribute('disabled', true);\n    } else {\n      contextTable.splitButton.setAttribute('disabled', true);\n      contextTable.mergeButton.removeAttribute('disabled');\n    }\n  },\n  // multi selecte\n  _bindOnSelect: null,\n  _bindOffSelect: null,\n  _bindOffShift: null,\n  _selectedCells: null,\n  _shift: false,\n  _fixedCell: null,\n  _fixedCellName: null,\n  _selectedCell: null,\n  _selectedTable: null,\n  _ref: null,\n  _toggleEditor: function _toggleEditor(enabled) {\n    this.context.element.wysiwyg.setAttribute('contenteditable', enabled);\n    if (enabled) this.util.removeClass(this.context.element.wysiwyg, 'se-disabled');else this.util.addClass(this.context.element.wysiwyg, 'se-disabled');\n  },\n  _offCellMultiSelect: function _offCellMultiSelect(e) {\n    e.stopPropagation();\n    var tablePlugin = this.plugins.table;\n\n    if (!tablePlugin._shift) {\n      tablePlugin._removeEvents.call(this);\n\n      tablePlugin._toggleEditor.call(this, true);\n    } else if (tablePlugin._initBind) {\n      this._wd.removeEventListener('touchmove', tablePlugin._initBind);\n\n      tablePlugin._initBind = null;\n    }\n\n    if (!tablePlugin._fixedCell || !tablePlugin._selectedTable) return;\n    tablePlugin.setActiveButton.call(this, tablePlugin._fixedCell, tablePlugin._selectedCell);\n    tablePlugin.call_controller_tableEdit.call(this, tablePlugin._selectedCell || tablePlugin._fixedCell);\n    tablePlugin._selectedCells = tablePlugin._selectedTable.querySelectorAll('.se-table-selected-cell');\n    if (tablePlugin._selectedCell && tablePlugin._fixedCell) this.focusEdge(tablePlugin._selectedCell);\n\n    if (!tablePlugin._shift) {\n      tablePlugin._fixedCell = null;\n      tablePlugin._selectedCell = null;\n      tablePlugin._fixedCellName = null;\n    }\n  },\n  _onCellMultiSelect: function _onCellMultiSelect(e) {\n    this._antiBlur = true;\n    var tablePlugin = this.plugins.table;\n    var target = this.util.getParentElement(e.target, this.util.isCell);\n\n    if (tablePlugin._shift) {\n      if (target === tablePlugin._fixedCell) tablePlugin._toggleEditor.call(this, true);else tablePlugin._toggleEditor.call(this, false);\n    } else if (!tablePlugin._ref) {\n      if (target === tablePlugin._fixedCell) return;else tablePlugin._toggleEditor.call(this, false);\n    }\n\n    if (!target || target === tablePlugin._selectedCell || tablePlugin._fixedCellName !== target.nodeName || tablePlugin._selectedTable !== this.util.getParentElement(target, 'TABLE')) {\n      return;\n    }\n\n    tablePlugin._selectedCell = target;\n\n    tablePlugin._setMultiCells.call(this, tablePlugin._fixedCell, target);\n  },\n  _setMultiCells: function _setMultiCells(startCell, endCell) {\n    var tablePlugin = this.plugins.table;\n    var rows = tablePlugin._selectedTable.rows;\n    var util = this.util;\n\n    var selectedCells = tablePlugin._selectedTable.querySelectorAll('.se-table-selected-cell');\n\n    for (var i = 0, len = selectedCells.length; i < len; i++) {\n      util.removeClass(selectedCells[i], 'se-table-selected-cell');\n    }\n\n    if (startCell === endCell) {\n      util.addClass(startCell, 'se-table-selected-cell');\n      if (!tablePlugin._shift) return;\n    }\n\n    var findSelectedCell = true;\n    var spanIndex = [];\n    var rowSpanArr = [];\n    var ref = tablePlugin._ref = {\n      _i: 0,\n      cs: null,\n      ce: null,\n      rs: null,\n      re: null\n    };\n\n    for (var _i14 = 0, _len9 = rows.length, cells, colSpan; _i14 < _len9; _i14++) {\n      cells = rows[_i14].cells;\n      colSpan = 0;\n\n      for (var c = 0, cLen = cells.length, cell, logcalIndex, cs, rs; c < cLen; c++) {\n        cell = cells[c];\n        cs = cell.colSpan - 1;\n        rs = cell.rowSpan - 1;\n        logcalIndex = c + colSpan;\n\n        if (spanIndex.length > 0) {\n          for (var r = 0, arr; r < spanIndex.length; r++) {\n            arr = spanIndex[r];\n            if (arr.row > _i14) continue;\n\n            if (logcalIndex >= arr.index) {\n              colSpan += arr.cs;\n              logcalIndex += arr.cs;\n              arr.rs -= 1;\n              arr.row = _i14 + 1;\n\n              if (arr.rs < 1) {\n                spanIndex.splice(r, 1);\n                r--;\n              }\n            } else if (c === cLen - 1) {\n              arr.rs -= 1;\n              arr.row = _i14 + 1;\n\n              if (arr.rs < 1) {\n                spanIndex.splice(r, 1);\n                r--;\n              }\n            }\n          }\n        }\n\n        if (findSelectedCell) {\n          if (cell === startCell || cell === endCell) {\n            ref.cs = ref.cs !== null && ref.cs < logcalIndex ? ref.cs : logcalIndex;\n            ref.ce = ref.ce !== null && ref.ce > logcalIndex + cs ? ref.ce : logcalIndex + cs;\n            ref.rs = ref.rs !== null && ref.rs < _i14 ? ref.rs : _i14;\n            ref.re = ref.re !== null && ref.re > _i14 + rs ? ref.re : _i14 + rs;\n            ref._i += 1;\n          }\n\n          if (ref._i === 2) {\n            findSelectedCell = false;\n            spanIndex = [];\n            rowSpanArr = [];\n            _i14 = -1;\n            break;\n          }\n        } else if (util.getOverlapRangeAtIndex(ref.cs, ref.ce, logcalIndex, logcalIndex + cs) && util.getOverlapRangeAtIndex(ref.rs, ref.re, _i14, _i14 + rs)) {\n          var newCs = ref.cs < logcalIndex ? ref.cs : logcalIndex;\n          var newCe = ref.ce > logcalIndex + cs ? ref.ce : logcalIndex + cs;\n          var newRs = ref.rs < _i14 ? ref.rs : _i14;\n          var newRe = ref.re > _i14 + rs ? ref.re : _i14 + rs;\n\n          if (ref.cs !== newCs || ref.ce !== newCe || ref.rs !== newRs || ref.re !== newRe) {\n            ref.cs = newCs;\n            ref.ce = newCe;\n            ref.rs = newRs;\n            ref.re = newRe;\n            _i14 = -1;\n            spanIndex = [];\n            rowSpanArr = [];\n            break;\n          }\n\n          util.addClass(cell, 'se-table-selected-cell');\n        }\n\n        if (rs > 0) {\n          rowSpanArr.push({\n            index: logcalIndex,\n            cs: cs + 1,\n            rs: rs,\n            row: -1\n          });\n        }\n\n        colSpan += cell.colSpan - 1;\n      }\n\n      spanIndex = spanIndex.concat(rowSpanArr).sort(function (a, b) {\n        return a.index - b.index;\n      });\n      rowSpanArr = [];\n    }\n  },\n  _removeEvents: function _removeEvents() {\n    var tablePlugin = this.plugins.table;\n\n    if (tablePlugin._initBind) {\n      this._wd.removeEventListener('touchmove', tablePlugin._initBind);\n\n      tablePlugin._initBind = null;\n    }\n\n    if (tablePlugin._bindOnSelect) {\n      this._wd.removeEventListener('mousedown', tablePlugin._bindOnSelect);\n\n      this._wd.removeEventListener('mousemove', tablePlugin._bindOnSelect);\n\n      tablePlugin._bindOnSelect = null;\n    }\n\n    if (tablePlugin._bindOffSelect) {\n      this._wd.removeEventListener('mouseup', tablePlugin._bindOffSelect);\n\n      tablePlugin._bindOffSelect = null;\n    }\n\n    if (tablePlugin._bindOffShift) {\n      this._wd.removeEventListener('keyup', tablePlugin._bindOffShift);\n\n      tablePlugin._bindOffShift = null;\n    }\n  },\n  _initBind: null,\n  onTableCellMultiSelect: function onTableCellMultiSelect(tdElement, shift) {\n    var tablePlugin = this.plugins.table;\n\n    tablePlugin._removeEvents.call(this);\n\n    this.controllersOff();\n    tablePlugin._shift = shift;\n    tablePlugin._fixedCell = tdElement;\n    tablePlugin._fixedCellName = tdElement.nodeName;\n    tablePlugin._selectedTable = this.util.getParentElement(tdElement, 'TABLE');\n\n    var selectedCells = tablePlugin._selectedTable.querySelectorAll('.se-table-selected-cell');\n\n    for (var i = 0, len = selectedCells.length; i < len; i++) {\n      this.util.removeClass(selectedCells[i], 'se-table-selected-cell');\n    }\n\n    this.util.addClass(tdElement, 'se-table-selected-cell');\n    tablePlugin._bindOnSelect = tablePlugin._onCellMultiSelect.bind(this);\n    tablePlugin._bindOffSelect = tablePlugin._offCellMultiSelect.bind(this);\n\n    if (!shift) {\n      this._wd.addEventListener('mousemove', tablePlugin._bindOnSelect, false);\n    } else {\n      tablePlugin._bindOffShift = function () {\n        this.controllersOn(this.context.table.resizeDiv, this.context.table.tableController, this.plugins.table.init.bind(this), tdElement, 'table');\n        if (!tablePlugin._ref) this.controllersOff();\n      }.bind(this);\n\n      this._wd.addEventListener('keyup', tablePlugin._bindOffShift, false);\n\n      this._wd.addEventListener('mousedown', tablePlugin._bindOnSelect, false);\n    }\n\n    this._wd.addEventListener('mouseup', tablePlugin._bindOffSelect, false);\n\n    tablePlugin._initBind = tablePlugin.init.bind(this);\n\n    this._wd.addEventListener('touchmove', tablePlugin._initBind, false);\n  },\n  onClick_tableController: function onClick_tableController(e) {\n    e.stopPropagation();\n    var target = e.target.getAttribute('data-command') ? e.target : e.target.parentNode;\n    if (target.getAttribute('disabled')) return;\n    var command = target.getAttribute('data-command');\n    var value = target.getAttribute('data-value');\n    var option = target.getAttribute('data-option');\n    var tablePlugin = this.plugins.table;\n\n    if (typeof tablePlugin._closeSplitMenu === 'function') {\n      tablePlugin._closeSplitMenu();\n\n      if (command === 'onsplit') return;\n    }\n\n    if (!command) return;\n    e.preventDefault();\n    var contextTable = this.context.table;\n\n    switch (command) {\n      case 'insert':\n      case 'delete':\n        tablePlugin.editTable.call(this, value, option);\n        break;\n\n      case 'header':\n        tablePlugin.toggleHeader.call(this);\n        break;\n\n      case 'onsplit':\n        tablePlugin.openSplitMenu.call(this);\n        break;\n\n      case 'split':\n        tablePlugin.splitCells.call(this, value);\n        break;\n\n      case 'merge':\n        tablePlugin.mergeCells.call(this);\n        break;\n\n      case 'resize':\n        contextTable._maxWidth = !contextTable._maxWidth;\n        tablePlugin.setTableStyle.call(this, 'width');\n        tablePlugin.setPositionControllerTop.call(this, contextTable._element);\n        tablePlugin.setPositionControllerDiv.call(this, contextTable._tdElement, tablePlugin._shift);\n        break;\n\n      case 'layout':\n        contextTable._fixedColumn = !contextTable._fixedColumn;\n        tablePlugin.setTableStyle.call(this, 'column');\n        tablePlugin.setPositionControllerTop.call(this, contextTable._element);\n        tablePlugin.setPositionControllerDiv.call(this, contextTable._tdElement, tablePlugin._shift);\n        break;\n\n      case 'remove':\n        var emptyDiv = contextTable._element.parentNode;\n        this.util.removeItem(contextTable._element);\n        this.controllersOff();\n        if (emptyDiv !== this.context.element.wysiwyg) this.util.removeItemAllParents(emptyDiv, function (current) {\n          return current.childNodes.length === 0;\n        }, null);\n        this.focus();\n    } // history stack\n\n\n    this.history.push(false);\n  }\n};","map":{"version":3,"sources":["/github/workspace/node_modules/suneditor/src/plugins/submenu/table.js"],"names":["name","display","add","core","targetElement","context","contextTable","table","_element","_tdElement","_trElement","_trElements","_tableXY","_maxWidth","_fixedColumn","_rtl","options","rtl","cellControllerTop","tableCellControllerPosition","resizeText","headerButton","mergeButton","splitButton","splitMenu","maxText","lang","controller","maxSize","minText","minSize","_physical_cellCnt","_logical_cellCnt","_rowCnt","_rowIndex","_physical_cellIndex","_logical_cellIndex","_current_colSpan","_current_rowSpan","icons","expansion","reduction","listDiv","setSubmenu","tablePicker","querySelector","tableHighlight","tableUnHighlight","tableDisplay","style","left","tableController","setController_table","resizeButton","columnFixedButton","resizeDiv","setController_tableEditor","insertRowAboveButton","insertRowBelowButton","addEventListener","onMouseMove_tablePicker","bind","appendTable","onClick_tableController","initMenuTarget","element","relative","appendChild","util","createElement","className","innerHTML","tableResize","fixed_column_width","fixedColumnWidth","table_header","tableHeader","delete","remove","insert_row_above","insertRowAbove","insert_row_below","insertRowBelow","delete_row","deleteRow","merge_cell","mergeCells","insert_column_left","insertColumnBefore","insert_column_right","insertColumnAfter","delete_column","deleteColumn","split_cell","splitCells","VerticalSplit","HorizontalSplit","oTable","createCells","plugins","x","y","tableHTML","call","changed","insertComponent","firstTd","setRange","reset_table_picker","nodeName","cnt","returnElement","toLowerCase","cellsHTML","cell","e","stopPropagation","_w","Math","ceil","offsetX","offsetY","width","height","changeTxt","highlight","unHighlight","submenuOff","init","tablePlugin","_removeEvents","_selectedTable","selectedCells","querySelectorAll","i","len","length","removeClass","_toggleEditor","_shift","_selectedCells","_ref","_fixedCell","_selectedCell","_fixedCellName","call_controller_tableEdit","tdElement","getSelection","isCollapsed","controllersOff","tableElement","getParentElement","hasClass","tableLayout","setTableStyle","setPositionControllerTop","setPositionControllerDiv","controllersOn","setControllerPosition","top","reset","setCellInfo","offsetWidth","test","firstElementChild","addClass","parentNode","rows","cellIndex","cellCnt","cells","colSpan","rowIndex","rowSpan","rowSpanArr","spanIndex","c","cLen","cs","rs","logcalIndex","r","arr","row","index","splice","push","concat","sort","a","b","editTable","type","option","isRow","tableAttr","nextElementSibling","positionCell","removeCells","editRow","firstRow","editCell","rightCell","children","removeItem","positionResetElement","up","originRowIndex","sign","next","spanCells","cloneNode","spanCell","shift","insertBefore","newRow","insertRow","passCell","removeCell","removeSpanArr","insertIndex","newCell","applySpan","cellColSpan","removeIndex","lastCell","getOverlapRangeAtIndex","removeFirst","removeEnd","rLen","getArrayIndex","rowSpanCell","_closeSplitMenu","openSplitMenu","removeDocEvent","addDocEvent","direction","vertical","currentCell","currentRow","currentColSpan","floor","currentRowSpan","newRowSpan","nextRowIndex","nextRow","nextCells","physicalIndex","focusEdge","ref","mergeCell","emptyRowFirst","emptyRowLast","ce","re","mergeHTML","ch","isFormatElement","onlyZeroWidthSpace","textContent","rowIndexFirst","rowIndexLast","removeRows","setActiveButton","toggleHeader","active","header","toggleClass","styles","icon","span","sizeIcon","text","indexOf","changeElement","fixedCell","selectedCell","setAttribute","removeAttribute","_bindOnSelect","_bindOffSelect","_bindOffShift","enabled","wysiwyg","_offCellMultiSelect","_initBind","_wd","removeEventListener","_onCellMultiSelect","_antiBlur","target","isCell","_setMultiCells","startCell","endCell","findSelectedCell","_i","newCs","newCe","newRs","newRe","onTableCellMultiSelect","getAttribute","command","value","preventDefault","emptyDiv","removeItemAllParents","current","childNodes","focus","history"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,eAAe;AACXA,EAAAA,IAAI,EAAE,OADK;AAEXC,EAAAA,OAAO,EAAE,SAFE;AAGXC,EAAAA,GAAG,EAAE,aAAUC,IAAV,EAAgBC,aAAhB,EAA+B;AAChC,QAAMC,OAAO,GAAGF,IAAI,CAACE,OAArB;AACA,QAAIC,YAAY,GAAGD,OAAO,CAACE,KAAR,GAAgB;AAC/BC,MAAAA,QAAQ,EAAE,IADqB;AAE/BC,MAAAA,UAAU,EAAE,IAFmB;AAG/BC,MAAAA,UAAU,EAAE,IAHmB;AAI/BC,MAAAA,WAAW,EAAE,IAJkB;AAK/BC,MAAAA,QAAQ,EAAE,EALqB;AAM/BC,MAAAA,SAAS,EAAE,IANoB;AAO/BC,MAAAA,YAAY,EAAE,KAPiB;AAQ/BC,MAAAA,IAAI,EAAEZ,IAAI,CAACa,OAAL,CAAaC,GARY;AAS/BC,MAAAA,iBAAiB,EAAEf,IAAI,CAACa,OAAL,CAAaG,2BAAb,KAA6C,KATjC;AAU/BC,MAAAA,UAAU,EAAE,IAVmB;AAW/BC,MAAAA,YAAY,EAAE,IAXiB;AAY/BC,MAAAA,WAAW,EAAE,IAZkB;AAa/BC,MAAAA,WAAW,EAAE,IAbkB;AAc/BC,MAAAA,SAAS,EAAE,IAdoB;AAe/BC,MAAAA,OAAO,EAAEtB,IAAI,CAACuB,IAAL,CAAUC,UAAV,CAAqBC,OAfC;AAgB/BC,MAAAA,OAAO,EAAE1B,IAAI,CAACuB,IAAL,CAAUC,UAAV,CAAqBG,OAhBC;AAiB/BC,MAAAA,iBAAiB,EAAE,CAjBY;AAkB/BC,MAAAA,gBAAgB,EAAE,CAlBa;AAmB/BC,MAAAA,OAAO,EAAE,CAnBsB;AAoB/BC,MAAAA,SAAS,EAAE,CApBoB;AAqB/BC,MAAAA,mBAAmB,EAAE,CArBU;AAsB/BC,MAAAA,kBAAkB,EAAE,CAtBW;AAuB/BC,MAAAA,gBAAgB,EAAE,CAvBa;AAwB/BC,MAAAA,gBAAgB,EAAE,CAxBa;AAyB/BC,MAAAA,KAAK,EAAE;AACHC,QAAAA,SAAS,EAAErC,IAAI,CAACoC,KAAL,CAAWC,SADnB;AAEHC,QAAAA,SAAS,EAAEtC,IAAI,CAACoC,KAAL,CAAWE;AAFnB;AAzBwB,KAAnC;AA+BA;;AACA,QAAIC,OAAO,GAAG,KAAKC,UAAL,CAAgBxC,IAAhB,CAAd;AACA,QAAIyC,WAAW,GAAGF,OAAO,CAACG,aAAR,CAAsB,6BAAtB,CAAlB;AAEAvC,IAAAA,YAAY,CAACwC,cAAb,GAA8BJ,OAAO,CAACG,aAAR,CAAsB,4BAAtB,CAA9B;AACAvC,IAAAA,YAAY,CAACyC,gBAAb,GAAgCL,OAAO,CAACG,aAAR,CAAsB,8BAAtB,CAAhC;AACAvC,IAAAA,YAAY,CAAC0C,YAAb,GAA4BN,OAAO,CAACG,aAAR,CAAsB,wBAAtB,CAA5B;AACA,QAAI1C,IAAI,CAACa,OAAL,CAAaC,GAAjB,EAAsBX,YAAY,CAACwC,cAAb,CAA4BG,KAA5B,CAAkCC,IAAlC,GAA0C,KAAK,EAAL,GAAU,EAAX,GAAiB,IAA1D;AAEtB;;AACA,QAAIC,eAAe,GAAG,KAAKC,mBAAL,CAAyBjD,IAAzB,CAAtB;AACAG,IAAAA,YAAY,CAAC6C,eAAb,GAA+BA,eAA/B;AACA7C,IAAAA,YAAY,CAAC+C,YAAb,GAA4BF,eAAe,CAACN,aAAhB,CAA8B,mBAA9B,CAA5B;AACAvC,IAAAA,YAAY,CAACc,UAAb,GAA0B+B,eAAe,CAACN,aAAhB,CAA8B,iCAA9B,CAA1B;AACAvC,IAAAA,YAAY,CAACgD,iBAAb,GAAiCH,eAAe,CAACN,aAAhB,CAA8B,yBAA9B,CAAjC;AACAvC,IAAAA,YAAY,CAACe,YAAb,GAA4B8B,eAAe,CAACN,aAAhB,CAA8B,mBAA9B,CAA5B;AAEA;;AACA,QAAIU,SAAS,GAAG,KAAKC,yBAAL,CAA+BrD,IAA/B,EAAqCG,YAAY,CAACY,iBAAlD,CAAhB;AACAZ,IAAAA,YAAY,CAACiD,SAAb,GAAyBA,SAAzB;AACAjD,IAAAA,YAAY,CAACkB,SAAb,GAAyB+B,SAAS,CAACV,aAAV,CAAwB,mBAAxB,CAAzB;AACAvC,IAAAA,YAAY,CAACgB,WAAb,GAA2BiC,SAAS,CAACV,aAAV,CAAwB,yBAAxB,CAA3B;AACAvC,IAAAA,YAAY,CAACiB,WAAb,GAA2BgC,SAAS,CAACV,aAAV,CAAwB,yBAAxB,CAA3B;AACAvC,IAAAA,YAAY,CAACmD,oBAAb,GAAoCF,SAAS,CAACV,aAAV,CAAwB,yBAAxB,CAApC;AACAvC,IAAAA,YAAY,CAACoD,oBAAb,GAAoCH,SAAS,CAACV,aAAV,CAAwB,yBAAxB,CAApC;AAEA;;AACAD,IAAAA,WAAW,CAACe,gBAAZ,CAA6B,WAA7B,EAA0C,KAAKC,uBAAL,CAA6BC,IAA7B,CAAkC1D,IAAlC,EAAwCG,YAAxC,CAA1C;AACAsC,IAAAA,WAAW,CAACe,gBAAZ,CAA6B,OAA7B,EAAsC,KAAKG,WAAL,CAAiBD,IAAjB,CAAsB1D,IAAtB,CAAtC;AACAoD,IAAAA,SAAS,CAACI,gBAAV,CAA2B,OAA3B,EAAoC,KAAKI,uBAAL,CAA6BF,IAA7B,CAAkC1D,IAAlC,CAApC;AACAgD,IAAAA,eAAe,CAACQ,gBAAhB,CAAiC,OAAjC,EAA0C,KAAKI,uBAAL,CAA6BF,IAA7B,CAAkC1D,IAAlC,CAA1C;AAEA;;AACAA,IAAAA,IAAI,CAAC6D,cAAL,CAAoB,KAAKhE,IAAzB,EAA+BI,aAA/B,EAA8CsC,OAA9C;AAEA;;AACArC,IAAAA,OAAO,CAAC4D,OAAR,CAAgBC,QAAhB,CAAyBC,WAAzB,CAAqCZ,SAArC;AACAlD,IAAAA,OAAO,CAAC4D,OAAR,CAAgBC,QAAhB,CAAyBC,WAAzB,CAAqChB,eAArC;AAEA;;AACAT,IAAAA,OAAO,GAAG,IAAV,EAAgBE,WAAW,GAAG,IAA9B,EAAoCW,SAAS,GAAG,IAAhD,EAAsDJ,eAAe,GAAG,IAAxE,EAA8E7C,YAAY,GAAG,IAA7F;AACH,GA7EU;AA+EXqC,EAAAA,UAAU,EAAE,oBAAUxC,IAAV,EAAgB;AACxB,QAAMuC,OAAO,GAAGvC,IAAI,CAACiE,IAAL,CAAUC,aAAV,CAAwB,KAAxB,CAAhB;AACA3B,IAAAA,OAAO,CAAC4B,SAAR,GAAoB,8BAApB;AACA5B,IAAAA,OAAO,CAAC6B,SAAR,GAAoB,KAChB,6BADgB,GAEZ,qEAFY,GAGZ,+CAHY,GAIZ,iDAJY,GAKhB,QALgB,GAMhB,gDANJ;AAQA,WAAO7B,OAAP;AACH,GA3FU;AA6FXU,EAAAA,mBAAmB,EAAE,6BAAUjD,IAAV,EAAgB;AACjC,QAAMuB,IAAI,GAAGvB,IAAI,CAACuB,IAAlB;AACA,QAAMa,KAAK,GAAGpC,IAAI,CAACoC,KAAnB;AACA,QAAMiC,WAAW,GAAGrE,IAAI,CAACiE,IAAL,CAAUC,aAAV,CAAwB,KAAxB,CAApB;AAEAG,IAAAA,WAAW,CAACF,SAAZ,GAAwB,mCAAxB;AACAE,IAAAA,WAAW,CAACD,SAAZ,GAAwB,KACpB,OADoB,GAEhB,4BAFgB,GAGZ,yFAHY,GAIRhC,KAAK,CAACC,SAJE,GAKR,+DALQ,GAK0Dd,IAAI,CAACC,UAAL,CAAgBC,OAL1E,GAKoF,gBALpF,GAMZ,WANY,GAOZ,+FAPY,GAQRW,KAAK,CAACkC,kBARE,GASR,+DATQ,GAS0D/C,IAAI,CAACC,UAAL,CAAgB+C,gBAT1E,GAS6F,gBAT7F,GAUZ,WAVY,GAWZ,yFAXY,GAYRnC,KAAK,CAACoC,YAZE,GAaR,+DAbQ,GAa0DjD,IAAI,CAACC,UAAL,CAAgBiD,WAb1E,GAawF,gBAbxF,GAcZ,WAdY,GAeZ,wEAfY,GAgBRrC,KAAK,CAACsC,MAhBE,GAiBR,+DAjBQ,GAiB0DnD,IAAI,CAACC,UAAL,CAAgBmD,MAjB1E,GAiBmF,gBAjBnF,GAkBZ,WAlBY,GAmBhB,QAnBgB,GAoBpB,QApBJ;AAsBA,WAAON,WAAP;AACH,GA1HU;AA4HXhB,EAAAA,yBAAyB,EAAE,mCAAUrD,IAAV,EAAgBe,iBAAhB,EAAmC;AAC1D,QAAMQ,IAAI,GAAGvB,IAAI,CAACuB,IAAlB;AACA,QAAMa,KAAK,GAAGpC,IAAI,CAACoC,KAAnB;AACA,QAAMiC,WAAW,GAAGrE,IAAI,CAACiE,IAAL,CAAUC,aAAV,CAAwB,KAAxB,CAApB;AAEAG,IAAAA,WAAW,CAACF,SAAZ,GAAwB,wCAAxB;AACAE,IAAAA,WAAW,CAACD,SAAZ,GAAwB,CAACrD,iBAAiB,GAAG,EAAH,GAAQ,0CAA1B,IACpB,4BADoB,GAEhB,iIAFgB,GAGZqB,KAAK,CAACwC,gBAHM,GAIZ,+DAJY,GAIsDrD,IAAI,CAACC,UAAL,CAAgBqD,cAJtE,GAIuF,gBAJvF,GAKhB,WALgB,GAMhB,mIANgB,GAOZzC,KAAK,CAAC0C,gBAPM,GAQZ,+DARY,GAQsDvD,IAAI,CAACC,UAAL,CAAgBuD,cARtE,GAQuF,gBARvF,GAShB,WATgB,GAUhB,yFAVgB,GAWZ3C,KAAK,CAAC4C,UAXM,GAYZ,+DAZY,GAYsDzD,IAAI,CAACC,UAAL,CAAgByD,SAZtE,GAYkF,gBAZlF,GAahB,WAbgB,GAchB,uGAdgB,GAeZ7C,KAAK,CAAC8C,UAfM,GAgBZ,+DAhBY,GAgBsD3D,IAAI,CAACC,UAAL,CAAgB2D,UAhBtE,GAgBmF,gBAhBnF,GAiBhB,WAjBgB,GAkBpB,QAlBoB,GAmBpB,oDAnBoB,GAoBhB,6GApBgB,GAqBZ/C,KAAK,CAACgD,kBArBM,GAsBZ,+DAtBY,GAsBsD7D,IAAI,CAACC,UAAL,CAAgB6D,kBAtBtE,GAsB2F,gBAtB3F,GAuBhB,WAvBgB,GAwBhB,8GAxBgB,GAyBZjD,KAAK,CAACkD,mBAzBM,GA0BZ,+DA1BY,GA0BsD/D,IAAI,CAACC,UAAL,CAAgB+D,iBA1BtE,GA0B0F,gBA1B1F,GA2BhB,WA3BgB,GA4BhB,0FA5BgB,GA6BZnD,KAAK,CAACoD,aA7BM,GA8BZ,+DA9BY,GA8BsDjE,IAAI,CAACC,UAAL,CAAgBiE,YA9BtE,GA8BqF,gBA9BrF,GA+BhB,WA/BgB,GAgChB,gGAhCgB,GAiCZrD,KAAK,CAACsD,UAjCM,GAkCZ,+DAlCY,GAkCsDnE,IAAI,CAACC,UAAL,CAAgBmE,UAlCtE,GAkCmF,gBAlCnF,GAmChB,WAnCgB,GAoChB,+EApCgB,GAqCZ,6BArCY,GAsCR,4BAtCQ,GAuCJ,sGAvCI,GAuCqGpE,IAAI,CAACC,UAAL,CAAgBoE,aAvCrH,GAuCqI,IAvCrI,GAwCArE,IAAI,CAACC,UAAL,CAAgBoE,aAxChB,GAwCgC,OAxChC,GAyCJ,wGAzCI,GAyCuGrE,IAAI,CAACC,UAAL,CAAgBqE,eAzCvH,GAyCyI,IAzCzI,GA0CAtE,IAAI,CAACC,UAAL,CAAgBqE,eA1ChB,GA0CkC,OA1ClC,GA2CR,OA3CQ,GA4CZ,QA5CY,GA6ChB,QA7CgB,GA8CpB,QA9CJ;AAgDA,WAAOxB,WAAP;AACH,GAnLU;AAqLXV,EAAAA,WAAW,EAAE,uBAAY;AACrB,QAAMmC,MAAM,GAAG,KAAK7B,IAAL,CAAUC,aAAV,CAAwB,OAAxB,CAAf;AACA,QAAM6B,WAAW,GAAG,KAAKC,OAAL,CAAa5F,KAAb,CAAmB2F,WAAvC;AAEA,QAAME,CAAC,GAAG,KAAK/F,OAAL,CAAaE,KAAb,CAAmBK,QAAnB,CAA4B,CAA5B,CAAV;AACA,QAAIyF,CAAC,GAAG,KAAKhG,OAAL,CAAaE,KAAb,CAAmBK,QAAnB,CAA4B,CAA5B,CAAR;AACA,QAAI0F,SAAS,GAAG,SAAhB;;AACA,WAAOD,CAAC,GAAG,CAAX,EAAc;AACVC,MAAAA,SAAS,IAAI,SAASJ,WAAW,CAACK,IAAZ,CAAiB,IAAjB,EAAuB,IAAvB,EAA6BH,CAA7B,CAAT,GAA2C,OAAxD;AACA,QAAEC,CAAF;AACH;;AACDC,IAAAA,SAAS,IAAI,UAAb;AACAL,IAAAA,MAAM,CAAC1B,SAAP,GAAmB+B,SAAnB;AAEA,QAAME,OAAO,GAAG,KAAKC,eAAL,CAAqBR,MAArB,EAA6B,KAA7B,EAAoC,IAApC,EAA0C,KAA1C,CAAhB;;AAEA,QAAIO,OAAJ,EAAa;AACT,UAAME,OAAO,GAAGT,MAAM,CAACpD,aAAP,CAAqB,QAArB,CAAhB;AACA,WAAK8D,QAAL,CAAcD,OAAd,EAAuB,CAAvB,EAA0BA,OAA1B,EAAmC,CAAnC;AACA,WAAKP,OAAL,CAAa5F,KAAb,CAAmBqG,kBAAnB,CAAsCL,IAAtC,CAA2C,IAA3C;AACH;AACJ,GA1MU;AA4MXL,EAAAA,WAAW,EAAE,qBAAUW,QAAV,EAAoBC,GAApB,EAAyBC,aAAzB,EAAwC;AACjDF,IAAAA,QAAQ,GAAGA,QAAQ,CAACG,WAAT,EAAX;;AAEA,QAAI,CAACD,aAAL,EAAoB;AAChB,UAAIE,SAAS,GAAG,EAAhB;;AACA,aAAOH,GAAG,GAAG,CAAb,EAAgB;AACZG,QAAAA,SAAS,IAAI,MAAKJ,QAAL,GAAgB,oBAAhB,GAAuCA,QAAvC,GAAkD,GAA/D;AACAC,QAAAA,GAAG;AACN;;AACD,aAAOG,SAAP;AACH,KAPD,MAOO;AACH,UAAMC,IAAI,GAAG,KAAK9C,IAAL,CAAUC,aAAV,CAAwBwC,QAAxB,CAAb;AACAK,MAAAA,IAAI,CAAC3C,SAAL,GAAiB,iBAAjB;AACA,aAAO2C,IAAP;AACH;AACJ,GA3NU;AA6NXtD,EAAAA,uBAAuB,EAAE,iCAAUtD,YAAV,EAAwB6G,CAAxB,EAA2B;AAChDA,IAAAA,CAAC,CAACC,eAAF;;AAEA,QAAIhB,CAAC,GAAG,KAAKiB,EAAL,CAAQC,IAAR,CAAaC,IAAb,CAAkBJ,CAAC,CAACK,OAAF,GAAY,EAA9B,CAAR;;AACA,QAAInB,CAAC,GAAG,KAAKgB,EAAL,CAAQC,IAAR,CAAaC,IAAb,CAAkBJ,CAAC,CAACM,OAAF,GAAY,EAA9B,CAAR;;AACArB,IAAAA,CAAC,GAAGA,CAAC,GAAG,CAAJ,GAAQ,CAAR,GAAYA,CAAhB;AACAC,IAAAA,CAAC,GAAGA,CAAC,GAAG,CAAJ,GAAQ,CAAR,GAAYA,CAAhB;;AAEA,QAAI/F,YAAY,CAACS,IAAjB,EAAuB;AACnBT,MAAAA,YAAY,CAACwC,cAAb,CAA4BG,KAA5B,CAAkCC,IAAlC,GAA0CkD,CAAC,GAAG,EAAJ,GAAS,EAAV,GAAgB,IAAzD;AACAA,MAAAA,CAAC,GAAG,KAAKA,CAAT;AACH;;AAED9F,IAAAA,YAAY,CAACwC,cAAb,CAA4BG,KAA5B,CAAkCyE,KAAlC,GAA0CtB,CAAC,GAAG,IAA9C;AACA9F,IAAAA,YAAY,CAACwC,cAAb,CAA4BG,KAA5B,CAAkC0E,MAAlC,GAA2CtB,CAAC,GAAG,IAA/C,CAdgD,CAgBhD;AACA;AACA;AACA;;AAEA,SAAKjC,IAAL,CAAUwD,SAAV,CAAoBtH,YAAY,CAAC0C,YAAjC,EAA+CoD,CAAC,GAAG,KAAJ,GAAYC,CAA3D;AACA/F,IAAAA,YAAY,CAACM,QAAb,GAAwB,CAACwF,CAAD,EAAIC,CAAJ,CAAxB;AACH,GApPU;AAsPXO,EAAAA,kBAAkB,EAAE,8BAAY;AAC5B,QAAI,CAAC,KAAKvG,OAAL,CAAaE,KAAb,CAAmBuC,cAAxB,EAAwC;AAExC,QAAM+E,SAAS,GAAG,KAAKxH,OAAL,CAAaE,KAAb,CAAmBuC,cAAnB,CAAkCG,KAApD;AACA,QAAM6E,WAAW,GAAG,KAAKzH,OAAL,CAAaE,KAAb,CAAmBwC,gBAAnB,CAAoCE,KAAxD;AAEA4E,IAAAA,SAAS,CAACH,KAAV,GAAkB,KAAlB;AACAG,IAAAA,SAAS,CAACF,MAAV,GAAmB,KAAnB;AACAG,IAAAA,WAAW,CAACJ,KAAZ,GAAoB,MAApB;AACAI,IAAAA,WAAW,CAACH,MAAZ,GAAqB,MAArB;AAEA,SAAKvD,IAAL,CAAUwD,SAAV,CAAoB,KAAKvH,OAAL,CAAaE,KAAb,CAAmByC,YAAvC,EAAqD,OAArD;AACA,SAAK+E,UAAL;AACH,GAnQU;AAqQXC,EAAAA,IAAI,EAAE,gBAAY;AACd,QAAM1H,YAAY,GAAG,KAAKD,OAAL,CAAaE,KAAlC;AACA,QAAM0H,WAAW,GAAG,KAAK9B,OAAL,CAAa5F,KAAjC;;AAEA0H,IAAAA,WAAW,CAACC,aAAZ,CAA0B3B,IAA1B,CAA+B,IAA/B;;AAEA,QAAI0B,WAAW,CAACE,cAAhB,EAAgC;AAC5B,UAAMC,aAAa,GAAGH,WAAW,CAACE,cAAZ,CAA2BE,gBAA3B,CAA4C,yBAA5C,CAAtB;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,aAAa,CAACI,MAApC,EAA4CF,CAAC,GAAGC,GAAhD,EAAqDD,CAAC,EAAtD,EAA0D;AACtD,aAAKlE,IAAL,CAAUqE,WAAV,CAAsBL,aAAa,CAACE,CAAD,CAAnC,EAAwC,wBAAxC;AACH;AACJ;;AAEDL,IAAAA,WAAW,CAACS,aAAZ,CAA0BnC,IAA1B,CAA+B,IAA/B,EAAqC,IAArC;;AAEAjG,IAAAA,YAAY,CAACE,QAAb,GAAwB,IAAxB;AACAF,IAAAA,YAAY,CAACG,UAAb,GAA0B,IAA1B;AACAH,IAAAA,YAAY,CAACI,UAAb,GAA0B,IAA1B;AACAJ,IAAAA,YAAY,CAACK,WAAb,GAA2B,IAA3B;AACAL,IAAAA,YAAY,CAACM,QAAb,GAAwB,EAAxB;AACAN,IAAAA,YAAY,CAACO,SAAb,GAAyB,IAAzB;AACAP,IAAAA,YAAY,CAACQ,YAAb,GAA4B,KAA5B;AACAR,IAAAA,YAAY,CAACyB,iBAAb,GAAiC,CAAjC;AACAzB,IAAAA,YAAY,CAAC0B,gBAAb,GAAgC,CAAhC;AACA1B,IAAAA,YAAY,CAAC2B,OAAb,GAAuB,CAAvB;AACA3B,IAAAA,YAAY,CAAC4B,SAAb,GAAyB,CAAzB;AACA5B,IAAAA,YAAY,CAAC6B,mBAAb,GAAmC,CAAnC;AACA7B,IAAAA,YAAY,CAAC8B,kBAAb,GAAkC,CAAlC;AACA9B,IAAAA,YAAY,CAAC+B,gBAAb,GAAgC,CAAhC;AACA/B,IAAAA,YAAY,CAACgC,gBAAb,GAAgC,CAAhC;AAEA2F,IAAAA,WAAW,CAACU,MAAZ,GAAqB,KAArB;AACAV,IAAAA,WAAW,CAACW,cAAZ,GAA6B,IAA7B;AACAX,IAAAA,WAAW,CAACE,cAAZ,GAA6B,IAA7B;AACAF,IAAAA,WAAW,CAACY,IAAZ,GAAmB,IAAnB;AAEAZ,IAAAA,WAAW,CAACa,UAAZ,GAAyB,IAAzB;AACAb,IAAAA,WAAW,CAACc,aAAZ,GAA4B,IAA5B;AACAd,IAAAA,WAAW,CAACe,cAAZ,GAA6B,IAA7B;AACH,GA5SU;;AA8SX;AACAC,EAAAA,yBAAyB,EAAE,mCAAUC,SAAV,EAAqB;AAC5C,QAAMjB,WAAW,GAAG,KAAK9B,OAAL,CAAa5F,KAAjC;AACA,QAAMD,YAAY,GAAG,KAAKD,OAAL,CAAaE,KAAlC;;AAEA,QAAI,CAAC,KAAK4I,YAAL,GAAoBC,WAArB,IAAoC,CAACnB,WAAW,CAACc,aAArD,EAAoE;AAChE,WAAKM,cAAL;AACA,WAAKjF,IAAL,CAAUqE,WAAV,CAAsBS,SAAtB,EAAiC,wBAAjC;AACA;AACH;;AAED,QAAMI,YAAY,GAAGhJ,YAAY,CAACE,QAAb,IAAyB,KAAK2F,OAAL,CAAa5F,KAAb,CAAmB4H,cAA5C,IAA8D,KAAK/D,IAAL,CAAUmF,gBAAV,CAA2BL,SAA3B,EAAsC,OAAtC,CAAnF;AACA5I,IAAAA,YAAY,CAACO,SAAb,GAAyB,KAAKuD,IAAL,CAAUoF,QAAV,CAAmBF,YAAnB,EAAiC,mBAAjC,KAAyDA,YAAY,CAACrG,KAAb,CAAmByE,KAAnB,KAA6B,MAAtF,IAAiG,CAAC4B,YAAY,CAACrG,KAAb,CAAmByE,KAApB,IAA6B,CAAC,KAAKtD,IAAL,CAAUoF,QAAV,CAAmBF,YAAnB,EAAiC,oBAAjC,CAAxJ;AACAhJ,IAAAA,YAAY,CAACQ,YAAb,GAA4B,KAAKsD,IAAL,CAAUoF,QAAV,CAAmBF,YAAnB,EAAiC,uBAAjC,KAA6DA,YAAY,CAACrG,KAAb,CAAmBwG,WAAnB,KAAmC,OAA5H;AACAxB,IAAAA,WAAW,CAACyB,aAAZ,CAA0BnD,IAA1B,CAA+B,IAA/B,EAAqCjG,YAAY,CAACO,SAAb,GAAyB,cAAzB,GAA0C,OAA/E;AAEAoH,IAAAA,WAAW,CAAC0B,wBAAZ,CAAqCpD,IAArC,CAA0C,IAA1C,EAAgD+C,YAAhD;AACArB,IAAAA,WAAW,CAAC2B,wBAAZ,CAAqCrD,IAArC,CAA0C,IAA1C,EAAgD2C,SAAhD,EAA2DjB,WAAW,CAACU,MAAvE;AAEA,QAAI,CAACV,WAAW,CAACU,MAAjB,EAAyB,KAAKkB,aAAL,CAAmBvJ,YAAY,CAACiD,SAAhC,EAA2CjD,YAAY,CAAC6C,eAAxD,EAAyE8E,WAAW,CAACD,IAAZ,CAAiBnE,IAAjB,CAAsB,IAAtB,CAAzE,EAAsGqF,SAAtG,EAAiH,OAAjH;AAC5B,GAlUU;AAoUXS,EAAAA,wBAAwB,EAAE,kCAAUL,YAAV,EAAwB;AAC9C,SAAKQ,qBAAL,CAA2B,KAAKzJ,OAAL,CAAaE,KAAb,CAAmB4C,eAA9C,EAA+DmG,YAA/D,EAA6E,KAA7E,EAAoF;AAACpG,MAAAA,IAAI,EAAE,CAAP;AAAU6G,MAAAA,GAAG,EAAE;AAAf,KAApF;AACH,GAtUU;AAwUXH,EAAAA,wBAAwB,EAAE,kCAAUV,SAAV,EAAqBc,KAArB,EAA4B;AAClD,QAAM1J,YAAY,GAAG,KAAKD,OAAL,CAAaE,KAAlC;AACA,QAAMgD,SAAS,GAAGjD,YAAY,CAACiD,SAA/B;AAEA,SAAK4C,OAAL,CAAa5F,KAAb,CAAmB0J,WAAnB,CAA+B1D,IAA/B,CAAoC,IAApC,EAA0C2C,SAA1C,EAAqDc,KAArD;;AAEA,QAAI1J,YAAY,CAACY,iBAAjB,EAAoC;AAChC,WAAK4I,qBAAL,CAA2BvG,SAA3B,EAAsCjD,YAAY,CAACE,QAAnD,EAA6D,KAA7D,EAAoE;AAAC0C,QAAAA,IAAI,EAAE5C,YAAY,CAAC6C,eAAb,CAA6B+G,WAApC;AAAiDH,QAAAA,GAAG,EAAE;AAAtD,OAApE;AACH,KAFD,MAEO;AACH,WAAKD,qBAAL,CAA2BvG,SAA3B,EAAsC2F,SAAtC,EAAiD,QAAjD,EAA2D;AAAChG,QAAAA,IAAI,EAAE,CAAP;AAAU6G,QAAAA,GAAG,EAAE;AAAf,OAA3D;AACH;AACJ,GAnVU;AAqVXE,EAAAA,WAAW,EAAE,qBAAUf,SAAV,EAAqBc,KAArB,EAA4B;AACrC,QAAM1J,YAAY,GAAG,KAAKD,OAAL,CAAaE,KAAlC;AACA,QAAMA,KAAK,GAAGD,YAAY,CAACE,QAAb,GAAwB,KAAK2F,OAAL,CAAa5F,KAAb,CAAmB4H,cAAnB,IAAqC,KAAK/D,IAAL,CAAUmF,gBAAV,CAA2BL,SAA3B,EAAsC,OAAtC,CAA3E;;AAEA,QAAI,SAASiB,IAAT,CAAc5J,KAAK,CAAC6J,iBAAN,CAAwBvD,QAAtC,CAAJ,EAAqD;AACjD,WAAKzC,IAAL,CAAUiG,QAAV,CAAmB/J,YAAY,CAACe,YAAhC,EAA8C,QAA9C;AACH,KAFD,MAEO;AACH,WAAK+C,IAAL,CAAUqE,WAAV,CAAsBnI,YAAY,CAACe,YAAnC,EAAiD,QAAjD;AACH;;AAED,QAAI2I,KAAK,IAAI1J,YAAY,CAACyB,iBAAb,KAAmC,CAAhD,EAAmD;AAC/C,UAAIzB,YAAY,CAACG,UAAb,KAA4ByI,SAAhC,EAA2C;AACvC5I,QAAAA,YAAY,CAACG,UAAb,GAA0ByI,SAA1B;AACA5I,QAAAA,YAAY,CAACI,UAAb,GAA0BwI,SAAS,CAACoB,UAApC;AACH;;AAED,UAAMC,IAAI,GAAGjK,YAAY,CAACK,WAAb,GAA2BJ,KAAK,CAACgK,IAA9C;AACA,UAAMC,SAAS,GAAGtB,SAAS,CAACsB,SAA5B;AAEA,UAAIC,OAAO,GAAG,CAAd;;AACA,WAAK,IAAInC,CAAC,GAAG,CAAR,EAAWoC,KAAK,GAAGH,IAAI,CAAC,CAAD,CAAJ,CAAQG,KAA3B,EAAkCnC,GAAG,GAAGgC,IAAI,CAAC,CAAD,CAAJ,CAAQG,KAAR,CAAclC,MAA3D,EAAmEF,CAAC,GAAGC,GAAvE,EAA4ED,CAAC,EAA7E,EAAiF;AAC7EmC,QAAAA,OAAO,IAAIC,KAAK,CAACpC,CAAD,CAAL,CAASqC,OAApB;AACH,OAZ8C,CAc/C;;;AACA,UAAMC,QAAQ,GAAGtK,YAAY,CAAC4B,SAAb,GAAyB5B,YAAY,CAACI,UAAb,CAAwBkK,QAAlE;AACAtK,MAAAA,YAAY,CAAC2B,OAAb,GAAuBsI,IAAI,CAAC/B,MAA5B,CAhB+C,CAkB/C;;AACAlI,MAAAA,YAAY,CAACyB,iBAAb,GAAiCzB,YAAY,CAACI,UAAb,CAAwBgK,KAAxB,CAA8BlC,MAA/D;AACAlI,MAAAA,YAAY,CAAC0B,gBAAb,GAAgCyI,OAAhC;AACAnK,MAAAA,YAAY,CAAC6B,mBAAb,GAAmCqI,SAAnC,CArB+C,CAuB/C;;AACAlK,MAAAA,YAAY,CAAC+B,gBAAb,GAAgC/B,YAAY,CAACG,UAAb,CAAwBkK,OAAxB,GAAkC,CAAlE;AACArK,MAAAA,YAAY,CAACgC,gBAAb,GAAgChC,YAAY,CAACI,UAAb,CAAwBgK,KAAxB,CAA8BF,SAA9B,EAAyCK,OAAzE,GAAmF,CAAnF,CAzB+C,CA2B/C;;AACA,UAAIC,UAAU,GAAG,EAAjB;AACA,UAAIC,SAAS,GAAG,EAAhB;;AACA,WAAK,IAAIzC,EAAC,GAAG,CAAR,EAAWoC,MAAX,EAAkBC,OAAvB,EAAgCrC,EAAC,IAAIsC,QAArC,EAA+CtC,EAAC,EAAhD,EAAoD;AAChDoC,QAAAA,MAAK,GAAGH,IAAI,CAACjC,EAAD,CAAJ,CAAQoC,KAAhB;AACAC,QAAAA,OAAO,GAAG,CAAV;;AACA,aAAK,IAAIK,CAAC,GAAG,CAAR,EAAWC,IAAI,GAAGP,MAAK,CAAClC,MAAxB,EAAgCtB,IAAhC,EAAsCgE,EAAtC,EAA0CC,EAA1C,EAA8CC,WAAnD,EAAgEJ,CAAC,GAAGC,IAApE,EAA0ED,CAAC,EAA3E,EAA+E;AAC3E9D,UAAAA,IAAI,GAAGwD,MAAK,CAACM,CAAD,CAAZ;AACAE,UAAAA,EAAE,GAAGhE,IAAI,CAACyD,OAAL,GAAe,CAApB;AACAQ,UAAAA,EAAE,GAAGjE,IAAI,CAAC2D,OAAL,GAAe,CAApB;AACAO,UAAAA,WAAW,GAAGJ,CAAC,GAAGL,OAAlB;;AAEA,cAAII,SAAS,CAACvC,MAAV,GAAmB,CAAvB,EAA0B;AACtB,iBAAK,IAAI6C,CAAC,GAAG,CAAR,EAAWC,GAAhB,EAAqBD,CAAC,GAAGN,SAAS,CAACvC,MAAnC,EAA2C6C,CAAC,EAA5C,EAAgD;AAC5CC,cAAAA,GAAG,GAAGP,SAAS,CAACM,CAAD,CAAf;AACA,kBAAIC,GAAG,CAACC,GAAJ,GAAUjD,EAAd,EAAiB;;AACjB,kBAAI8C,WAAW,IAAIE,GAAG,CAACE,KAAvB,EAA8B;AAC1Bb,gBAAAA,OAAO,IAAIW,GAAG,CAACJ,EAAf;AACAE,gBAAAA,WAAW,IAAIE,GAAG,CAACJ,EAAnB;AACAI,gBAAAA,GAAG,CAACH,EAAJ,IAAU,CAAV;AACAG,gBAAAA,GAAG,CAACC,GAAJ,GAAUjD,EAAC,GAAG,CAAd;;AACA,oBAAIgD,GAAG,CAACH,EAAJ,GAAS,CAAb,EAAgB;AACZJ,kBAAAA,SAAS,CAACU,MAAV,CAAiBJ,CAAjB,EAAoB,CAApB;AACAA,kBAAAA,CAAC;AACJ;AACJ,eATD,MASO,IAAIL,CAAC,KAAKC,IAAI,GAAG,CAAjB,EAAoB;AACvBK,gBAAAA,GAAG,CAACH,EAAJ,IAAU,CAAV;AACAG,gBAAAA,GAAG,CAACC,GAAJ,GAAUjD,EAAC,GAAG,CAAd;;AACA,oBAAIgD,GAAG,CAACH,EAAJ,GAAS,CAAb,EAAgB;AACZJ,kBAAAA,SAAS,CAACU,MAAV,CAAiBJ,CAAjB,EAAoB,CAApB;AACAA,kBAAAA,CAAC;AACJ;AACJ;AACJ;AACJ,WA5B0E,CA8B3E;;;AACA,cAAI/C,EAAC,KAAKsC,QAAN,IAAkBI,CAAC,KAAKR,SAA5B,EAAuC;AACnClK,YAAAA,YAAY,CAAC8B,kBAAb,GAAkCgJ,WAAlC;AACA;AACH;;AAED,cAAID,EAAE,GAAG,CAAT,EAAY;AACRL,YAAAA,UAAU,CAACY,IAAX,CAAgB;AACZF,cAAAA,KAAK,EAAEJ,WADK;AAEZF,cAAAA,EAAE,EAAEA,EAAE,GAAG,CAFG;AAGZC,cAAAA,EAAE,EAAEA,EAHQ;AAIZI,cAAAA,GAAG,EAAE,CAAC;AAJM,aAAhB;AAMH;;AAEDZ,UAAAA,OAAO,IAAIO,EAAX;AACH;;AAEDH,QAAAA,SAAS,GAAGA,SAAS,CAACY,MAAV,CAAiBb,UAAjB,EAA6Bc,IAA7B,CAAkC,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAAC,iBAAOD,CAAC,CAACL,KAAF,GAAUM,CAAC,CAACN,KAAnB;AAA0B,SAA7E,CAAZ;AACAV,QAAAA,UAAU,GAAG,EAAb;AACH;;AAEDA,MAAAA,UAAU,GAAG,IAAb;AACAC,MAAAA,SAAS,GAAG,IAAZ;AACH;AACJ,GAvbU;AAybXgB,EAAAA,SAAS,EAAE,mBAAUC,IAAV,EAAgBC,MAAhB,EAAwB;AAC/B,QAAMhE,WAAW,GAAG,KAAK9B,OAAL,CAAa5F,KAAjC;AACA,QAAMD,YAAY,GAAG,KAAKD,OAAL,CAAaE,KAAlC;AACA,QAAMA,KAAK,GAAGD,YAAY,CAACE,QAA3B;AACA,QAAM0L,KAAK,GAAGF,IAAI,KAAK,KAAvB;;AAEA,QAAIE,KAAJ,EAAW;AACP,UAAMC,SAAS,GAAG7L,YAAY,CAACI,UAAb,CAAwB4J,UAA1C;;AACA,UAAI,WAAWH,IAAX,CAAgBgC,SAAS,CAACtF,QAA1B,CAAJ,EAAyC;AACrC,YAAIoF,MAAM,KAAK,IAAf,EAAqB;AACjB;AACH,SAFD,MAEO,IAAI,CAACE,SAAS,CAACC,kBAAX,IAAiC,CAAC,WAAWjC,IAAX,CAAgBgC,SAAS,CAACC,kBAAV,CAA6BvF,QAA7C,CAAtC,EAA8F;AACjGtG,UAAAA,KAAK,CAACgE,SAAN,IAAmB,gBAAgB0D,WAAW,CAAC/B,WAAZ,CAAwBK,IAAxB,CAA6B,IAA7B,EAAmC,IAAnC,EAAyCjG,YAAY,CAAC0B,gBAAtD,EAAwE,KAAxE,CAAhB,GAAiG,eAApH;AACA;AACH;AACJ;AACJ,KAhB8B,CAkB/B;;;AACA,QAAIiG,WAAW,CAACY,IAAhB,EAAsB;AAClB,UAAMwD,YAAY,GAAG/L,YAAY,CAACG,UAAlC;AACA,UAAM2H,aAAa,GAAGH,WAAW,CAACW,cAAlC,CAFkB,CAGlB;;AACA,UAAIsD,KAAJ,EAAW;AACP;AACA,YAAI,CAACD,MAAL,EAAa;AACT,cAAIV,GAAG,GAAGnD,aAAa,CAAC,CAAD,CAAb,CAAiBkC,UAA3B;AACA,cAAMgC,WAAW,GAAG,CAAClE,aAAa,CAAC,CAAD,CAAd,CAApB;;AAEA,eAAK,IAAIE,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,aAAa,CAACI,MAA/B,EAAuCtB,IAA5C,EAAkDoB,CAAC,GAAGC,GAAtD,EAA2DD,CAAC,EAA5D,EAAgE;AAC5DpB,YAAAA,IAAI,GAAGkB,aAAa,CAACE,CAAD,CAApB;;AACA,gBAAIiD,GAAG,KAAKrE,IAAI,CAACoD,UAAjB,EAA6B;AACzBgC,cAAAA,WAAW,CAACZ,IAAZ,CAAiBxE,IAAjB;AACAqE,cAAAA,GAAG,GAAGrE,IAAI,CAACoD,UAAX;AACH;AACJ;;AAED,eAAK,IAAIhC,GAAC,GAAG,CAAR,EAAWC,IAAG,GAAG+D,WAAW,CAAC9D,MAAlC,EAA0CF,GAAC,GAAGC,IAA9C,EAAmDD,GAAC,EAApD,EAAwD;AACpDL,YAAAA,WAAW,CAACgC,WAAZ,CAAwB1D,IAAxB,CAA6B,IAA7B,EAAmC+F,WAAW,CAAChE,GAAD,CAA9C,EAAmD,IAAnD;AACAL,YAAAA,WAAW,CAACsE,OAAZ,CAAoBhG,IAApB,CAAyB,IAAzB,EAA+B0F,MAA/B;AACH;AACJ,SAhBD,MAgBO;AAAE;AACLhE,UAAAA,WAAW,CAACgC,WAAZ,CAAwB1D,IAAxB,CAA6B,IAA7B,EAAmC0F,MAAM,KAAK,IAAX,GAAkB7D,aAAa,CAAC,CAAD,CAA/B,GAAqCA,aAAa,CAACA,aAAa,CAACI,MAAd,GAAuB,CAAxB,CAArF,EAAiH,IAAjH;AACAP,UAAAA,WAAW,CAACsE,OAAZ,CAAoBhG,IAApB,CAAyB,IAAzB,EAA+B0F,MAA/B,EAAuCI,YAAvC;AACH;AACJ,OAtBD,MAsBO;AAAE;AACL,YAAMG,QAAQ,GAAGpE,aAAa,CAAC,CAAD,CAAb,CAAiBkC,UAAlC,CADG,CAEH;;AACA,YAAI,CAAC2B,MAAL,EAAa;AACT,cAAMK,YAAW,GAAG,CAAClE,aAAa,CAAC,CAAD,CAAd,CAApB;;AAEA,eAAK,IAAIE,GAAC,GAAG,CAAR,EAAWC,KAAG,GAAGH,aAAa,CAACI,MAA/B,EAAuCtB,KAA5C,EAAkDoB,GAAC,GAAGC,KAAtD,EAA2DD,GAAC,EAA5D,EAAgE;AAC5DpB,YAAAA,KAAI,GAAGkB,aAAa,CAACE,GAAD,CAApB;;AACA,gBAAIkE,QAAQ,KAAKtF,KAAI,CAACoD,UAAtB,EAAkC;AAC9BgC,cAAAA,YAAW,CAACZ,IAAZ,CAAiBxE,KAAjB;AACH,aAFD,MAEO;AACH;AACH;AACJ;;AAED,eAAK,IAAIoB,GAAC,GAAG,CAAR,EAAWC,KAAG,GAAG+D,YAAW,CAAC9D,MAAlC,EAA0CF,GAAC,GAAGC,KAA9C,EAAmDD,GAAC,EAApD,EAAwD;AACpDL,YAAAA,WAAW,CAACgC,WAAZ,CAAwB1D,IAAxB,CAA6B,IAA7B,EAAmC+F,YAAW,CAAChE,GAAD,CAA9C,EAAmD,IAAnD;AACAL,YAAAA,WAAW,CAACwE,QAAZ,CAAqBlG,IAArB,CAA0B,IAA1B,EAAgC0F,MAAhC;AACH;AACJ,SAhBD,MAgBO;AAAE;AACL,cAAIS,SAAS,GAAG,IAAhB;;AAEA,eAAK,IAAIpE,GAAC,GAAG,CAAR,EAAWC,KAAG,GAAGH,aAAa,CAACI,MAAd,GAAuB,CAA7C,EAAgDF,GAAC,GAAGC,KAApD,EAAyDD,GAAC,EAA1D,EAA8D;AAC1D,gBAAIkE,QAAQ,KAAKpE,aAAa,CAACE,GAAC,GAAG,CAAL,CAAb,CAAqBgC,UAAtC,EAAkD;AAC9CoC,cAAAA,SAAS,GAAGtE,aAAa,CAACE,GAAD,CAAzB;AACA;AACH;AACJ;;AAEDL,UAAAA,WAAW,CAACgC,WAAZ,CAAwB1D,IAAxB,CAA6B,IAA7B,EAAmC0F,MAAM,KAAK,MAAX,GAAoB7D,aAAa,CAAC,CAAD,CAAjC,GAAuCsE,SAAS,IAAItE,aAAa,CAAC,CAAD,CAApG,EAAyG,IAAzG;AACAH,UAAAA,WAAW,CAACwE,QAAZ,CAAqBlG,IAArB,CAA0B,IAA1B,EAAgC0F,MAAhC,EAAwCI,YAAxC;AACH;AACJ;;AAED,UAAI,CAACJ,MAAL,EAAahE,WAAW,CAACD,IAAZ,CAAiBzB,IAAjB,CAAsB,IAAtB;AAChB,KA7DD,CA6DE;AA7DF,SA8DK;AACD0B,QAAAA,WAAW,CAACiE,KAAK,GAAG,SAAH,GAAe,UAArB,CAAX,CAA4C3F,IAA5C,CAAiD,IAAjD,EAAuD0F,MAAvD;AACH,OAnF8B,CAqF/B;;;AACA,QAAI,CAACA,MAAL,EAAa;AACT,UAAMU,QAAQ,GAAGpM,KAAK,CAACoM,QAAvB;;AACA,WAAK,IAAIrE,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGqE,QAAQ,CAACnE,MAA7B,EAAqCF,GAAC,EAAtC,EAA0C;AACtC,YAAIqE,QAAQ,CAACrE,GAAD,CAAR,CAAYqE,QAAZ,CAAqBnE,MAArB,KAAgC,CAApC,EAAuC;AACnC,eAAKpE,IAAL,CAAUwI,UAAV,CAAqBD,QAAQ,CAACrE,GAAD,CAA7B;AACAA,UAAAA,GAAC;AACJ;AACJ;;AAED,UAAI/H,KAAK,CAACoM,QAAN,CAAenE,MAAf,KAA0B,CAA9B,EAAiC,KAAKpE,IAAL,CAAUwI,UAAV,CAAqBrM,KAArB;AACpC;AACJ,GA1hBU;AA4hBXgM,EAAAA,OAAO,EAAE,iBAAUN,MAAV,EAAkBY,oBAAlB,EAAwC;AAC7C,QAAMvM,YAAY,GAAG,KAAKD,OAAL,CAAaE,KAAlC;AACA,QAAMuE,MAAM,GAAG,CAACmH,MAAhB;AAEA,QAAMa,EAAE,GAAGb,MAAM,KAAK,IAAtB;AACA,QAAMc,cAAc,GAAGzM,YAAY,CAAC4B,SAApC;AACA,QAAM0I,QAAQ,GAAG9F,MAAM,IAAIgI,EAAV,GAAeC,cAAf,GAAgCA,cAAc,GAAGzM,YAAY,CAACgC,gBAA9B,GAAiD,CAAlG;AACA,QAAM0K,IAAI,GAAGlI,MAAM,GAAG,CAAC,CAAJ,GAAQ,CAA3B;AAEA,QAAMyF,IAAI,GAAGjK,YAAY,CAACK,WAA1B;AACA,QAAI8J,OAAO,GAAGnK,YAAY,CAAC0B,gBAA3B;;AAEA,SAAK,IAAIsG,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGwE,cAAc,IAAIjI,MAAM,GAAG,CAAC,CAAJ,GAAQ,CAAlB,CAA/B,EAAqDoC,IAA1D,EAAgEoB,CAAC,IAAIC,GAArE,EAA0ED,CAAC,EAA3E,EAA+E;AAC3EpB,MAAAA,IAAI,GAAGqD,IAAI,CAACjC,CAAD,CAAJ,CAAQoC,KAAf;AACA,UAAIxD,IAAI,CAACsB,MAAL,KAAgB,CAApB,EAAuB;;AAEvB,WAAK,IAAIwC,CAAC,GAAG,CAAR,EAAWC,IAAI,GAAG/D,IAAI,CAACsB,MAAvB,EAA+B2C,EAA/B,EAAmCD,EAAxC,EAA4CF,CAAC,GAAGC,IAAhD,EAAsDD,CAAC,EAAvD,EAA2D;AACvDG,QAAAA,EAAE,GAAGjE,IAAI,CAAC8D,CAAD,CAAJ,CAAQH,OAAb;AACAK,QAAAA,EAAE,GAAGhE,IAAI,CAAC8D,CAAD,CAAJ,CAAQL,OAAb;AACA,YAAIQ,EAAE,GAAG,CAAL,IAAUD,EAAE,GAAG,CAAnB,EAAsB;;AAEtB,YAAIC,EAAE,GAAG7C,CAAL,GAASsC,QAAT,IAAqBA,QAAQ,GAAGtC,CAApC,EAAuC;AACnCpB,UAAAA,IAAI,CAAC8D,CAAD,CAAJ,CAAQH,OAAR,GAAkBM,EAAE,GAAG6B,IAAvB;AACAvC,UAAAA,OAAO,IAAIS,EAAX;AACH;AACJ;AACJ;;AAED,QAAIpG,MAAJ,EAAY;AACR,UAAMmI,IAAI,GAAG1C,IAAI,CAACwC,cAAc,GAAG,CAAlB,CAAjB;;AACA,UAAIE,IAAJ,EAAU;AACN,YAAMC,SAAS,GAAG,EAAlB;AACA,YAAIxC,KAAK,GAAGH,IAAI,CAACwC,cAAD,CAAJ,CAAqBrC,KAAjC;AACA,YAAIC,OAAO,GAAG,CAAd;;AAEA,aAAK,IAAIrC,GAAC,GAAG,CAAR,EAAWC,KAAG,GAAGmC,KAAK,CAAClC,MAAvB,EAA+BtB,MAA/B,EAAqCkE,WAA1C,EAAuD9C,GAAC,GAAGC,KAA3D,EAAgED,GAAC,EAAjE,EAAqE;AACjEpB,UAAAA,MAAI,GAAGwD,KAAK,CAACpC,GAAD,CAAZ;AACA8C,UAAAA,WAAW,GAAG9C,GAAC,GAAGqC,OAAlB;AACAA,UAAAA,OAAO,IAAIzD,MAAI,CAACyD,OAAL,GAAe,CAA1B;;AAEA,cAAIzD,MAAI,CAAC2D,OAAL,GAAe,CAAnB,EAAsB;AAClB3D,YAAAA,MAAI,CAAC2D,OAAL,IAAgB,CAAhB;AACAqC,YAAAA,SAAS,CAACxB,IAAV,CAAe;AAACxE,cAAAA,IAAI,EAAEA,MAAI,CAACiG,SAAL,CAAe,KAAf,CAAP;AAA8B3B,cAAAA,KAAK,EAAEJ;AAArC,aAAf;AACH;AACJ;;AAED,YAAI8B,SAAS,CAAC1E,MAAV,GAAmB,CAAvB,EAA0B;AACtB,cAAI4E,QAAQ,GAAGF,SAAS,CAACG,KAAV,EAAf;AACA3C,UAAAA,KAAK,GAAGuC,IAAI,CAACvC,KAAb;AACAC,UAAAA,OAAO,GAAG,CAAV;;AAEA,eAAK,IAAIrC,GAAC,GAAG,CAAR,EAAWC,KAAG,GAAGmC,KAAK,CAAClC,MAAvB,EAA+BtB,MAA/B,EAAqCkE,YAA1C,EAAuD9C,GAAC,GAAGC,KAA3D,EAAgED,GAAC,EAAjE,EAAqE;AACjEpB,YAAAA,MAAI,GAAGwD,KAAK,CAACpC,GAAD,CAAZ;AACA8C,YAAAA,YAAW,GAAG9C,GAAC,GAAGqC,OAAlB;AACAA,YAAAA,OAAO,IAAIzD,MAAI,CAACyD,OAAL,GAAe,CAA1B;;AAEA,gBAAIS,YAAW,IAAIgC,QAAQ,CAAC5B,KAA5B,EAAmC;AAC/BlD,cAAAA,GAAC,IAAIqC,OAAO,EAAZ;AACAA,cAAAA,OAAO,IAAIyC,QAAQ,CAAClG,IAAT,CAAcyD,OAAd,GAAwB,CAAnC;AACAsC,cAAAA,IAAI,CAACK,YAAL,CAAkBF,QAAQ,CAAClG,IAA3B,EAAiCA,MAAjC;AACAkG,cAAAA,QAAQ,GAAGF,SAAS,CAACG,KAAV,EAAX;AACA,kBAAI,CAACD,QAAL,EAAe;AAClB;AACJ;;AAED,cAAIA,QAAJ,EAAc;AACVH,YAAAA,IAAI,CAAC9I,WAAL,CAAiBiJ,QAAQ,CAAClG,IAA1B;;AACA,iBAAK,IAAIoB,GAAC,GAAG,CAAR,EAAWC,KAAG,GAAG2E,SAAS,CAAC1E,MAAhC,EAAwCF,GAAC,GAAGC,KAA5C,EAAiDD,GAAC,EAAlD,EAAsD;AAClD2E,cAAAA,IAAI,CAAC9I,WAAL,CAAiB+I,SAAS,CAAC5E,GAAD,CAAT,CAAapB,IAA9B;AACH;AACJ;AACJ;AACJ;;AAED5G,MAAAA,YAAY,CAACE,QAAb,CAAsB4E,SAAtB,CAAgCwF,QAAhC;AACH,KA/CD,MA+CO;AACH,UAAM2C,MAAM,GAAGjN,YAAY,CAACE,QAAb,CAAsBgN,SAAtB,CAAgC5C,QAAhC,CAAf;;AACA2C,MAAAA,MAAM,CAAChJ,SAAP,GAAmB,KAAK4B,OAAL,CAAa5F,KAAb,CAAmB2F,WAAnB,CAA+BK,IAA/B,CAAoC,IAApC,EAA0C,IAA1C,EAAgDkE,OAAhD,EAAyD,KAAzD,CAAnB;AACH;;AAED,QAAI,CAAC3F,MAAL,EAAa;AACT,WAAKqB,OAAL,CAAa5F,KAAb,CAAmBqJ,wBAAnB,CAA4CrD,IAA5C,CAAiD,IAAjD,EAAuDsG,oBAAoB,IAAIvM,YAAY,CAACG,UAA5F,EAAwG,IAAxG;AACH,KAFD,MAEO;AACH,WAAK4I,cAAL;AACH;AACJ,GAjnBU;AAmnBXoD,EAAAA,QAAQ,EAAE,kBAAUR,MAAV,EAAkBY,oBAAlB,EAAwC;AAC9C,QAAMvM,YAAY,GAAG,KAAKD,OAAL,CAAaE,KAAlC;AACA,QAAM6D,IAAI,GAAG,KAAKA,IAAlB;AACA,QAAMU,MAAM,GAAG,CAACmH,MAAhB;AAEA,QAAM/I,IAAI,GAAG+I,MAAM,KAAK,MAAxB;AACA,QAAMtB,OAAO,GAAGrK,YAAY,CAAC+B,gBAA7B;AACA,QAAMmI,SAAS,GAAG1F,MAAM,IAAI5B,IAAV,GAAiB5C,YAAY,CAAC8B,kBAA9B,GAAmD9B,YAAY,CAAC8B,kBAAb,GAAkCuI,OAAlC,GAA4C,CAAjH;AAEA,QAAMJ,IAAI,GAAGjK,YAAY,CAACK,WAA1B;AACA,QAAImK,UAAU,GAAG,EAAjB;AACA,QAAIC,SAAS,GAAG,EAAhB;AACA,QAAI0C,QAAQ,GAAG,CAAf;AACA,QAAMC,UAAU,GAAG,EAAnB;AACA,QAAMC,aAAa,GAAG,EAAtB;;AAEA,SAAK,IAAIrF,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGjI,YAAY,CAAC2B,OAA9B,EAAuCsJ,GAAvC,EAA4CqC,WAA5C,EAAyDlD,KAAzD,EAAgEmD,OAAhE,EAAyEC,SAAzE,EAAoFC,WAAzF,EAAsGzF,CAAC,GAAGC,GAA1G,EAA+GD,CAAC,EAAhH,EAAoH;AAChHiD,MAAAA,GAAG,GAAGhB,IAAI,CAACjC,CAAD,CAAV;AACAsF,MAAAA,WAAW,GAAGpD,SAAd;AACAsD,MAAAA,SAAS,GAAG,KAAZ;AACApD,MAAAA,KAAK,GAAGa,GAAG,CAACb,KAAZ;AACAqD,MAAAA,WAAW,GAAG,CAAd;;AAEA,WAAK,IAAI/C,CAAC,GAAG,CAAR,EAAW9D,IAAX,EAAiB+D,IAAI,GAAGP,KAAK,CAAClC,MAA9B,EAAsC2C,EAAtC,EAA0CD,EAA1C,EAA8C8C,WAAnD,EAAgEhD,CAAC,GAAGC,IAApE,EAA0ED,CAAC,EAA3E,EAA+E;AAC3E9D,QAAAA,IAAI,GAAGwD,KAAK,CAACM,CAAD,CAAZ;AACA,YAAI,CAAC9D,IAAL,EAAW;AAEXiE,QAAAA,EAAE,GAAGjE,IAAI,CAAC2D,OAAL,GAAe,CAApB;AACAK,QAAAA,EAAE,GAAGhE,IAAI,CAACyD,OAAL,GAAe,CAApB;;AAEA,YAAI,CAAC7F,MAAL,EAAa;AACT,cAAIkG,CAAC,IAAI4C,WAAT,EAAsB;;AACtB,cAAI1C,EAAE,GAAG,CAAT,EAAY;AACR,gBAAIuC,QAAQ,GAAG,CAAX,IAAgBvC,EAAE,GAAGF,CAAL,IAAU4C,WAA9B,EAA2C;AACvC1G,cAAAA,IAAI,CAACyD,OAAL,IAAgB,CAAhB;AACAiD,cAAAA,WAAW,GAAG,IAAd;AACAH,cAAAA,QAAQ,GAAGtC,EAAE,GAAG,CAAhB;AACA;AACH;;AAEDyC,YAAAA,WAAW,IAAI1C,EAAf;AACH;;AAED,cAAI,CAAC4C,SAAL,EAAgB;AACZ,iBAAK,IAAIzC,CAAC,GAAG,CAAR,EAAWC,GAAhB,EAAqBD,CAAC,GAAGN,SAAS,CAACvC,MAAnC,EAA2C6C,CAAC,EAA5C,EAAgD;AAC5CC,cAAAA,GAAG,GAAGP,SAAS,CAACM,CAAD,CAAf;AACAuC,cAAAA,WAAW,IAAItC,GAAG,CAACJ,EAAnB;AACAI,cAAAA,GAAG,CAACH,EAAJ,IAAU,CAAV;;AACA,kBAAIG,GAAG,CAACH,EAAJ,GAAS,CAAb,EAAgB;AACZJ,gBAAAA,SAAS,CAACU,MAAV,CAAiBJ,CAAjB,EAAoB,CAApB;AACAA,gBAAAA,CAAC;AACJ;AACJ;;AACDyC,YAAAA,SAAS,GAAG,IAAZ;AACH;AACJ,SAzBD,MAyBO;AACHE,UAAAA,WAAW,GAAGhD,CAAC,GAAG+C,WAAlB;;AAEA,cAAIhD,SAAS,CAACvC,MAAV,GAAmB,CAAvB,EAA0B;AACtB,gBAAMyF,QAAQ,GAAG,CAACvD,KAAK,CAACM,CAAC,GAAG,CAAL,CAAvB;;AACA,iBAAK,IAAIK,EAAC,GAAG,CAAR,EAAWC,IAAhB,EAAqBD,EAAC,GAAGN,SAAS,CAACvC,MAAnC,EAA2C6C,EAAC,EAA5C,EAAgD;AAC5CC,cAAAA,IAAG,GAAGP,SAAS,CAACM,EAAD,CAAf;AACA,kBAAIC,IAAG,CAACC,GAAJ,GAAUjD,CAAd,EAAiB;;AAEjB,kBAAI0F,WAAW,IAAI1C,IAAG,CAACE,KAAvB,EAA8B;AAC1BuC,gBAAAA,WAAW,IAAIzC,IAAG,CAACJ,EAAnB;AACA8C,gBAAAA,WAAW,GAAGhD,CAAC,GAAG+C,WAAlB;AACAzC,gBAAAA,IAAG,CAACH,EAAJ,IAAU,CAAV;AACAG,gBAAAA,IAAG,CAACC,GAAJ,GAAUjD,CAAC,GAAG,CAAd;;AACA,oBAAIgD,IAAG,CAACH,EAAJ,GAAS,CAAb,EAAgB;AACZJ,kBAAAA,SAAS,CAACU,MAAV,CAAiBJ,EAAjB,EAAoB,CAApB;AACAA,kBAAAA,EAAC;AACJ;AACJ,eATD,MASO,IAAI4C,QAAJ,EAAc;AACjB3C,gBAAAA,IAAG,CAACH,EAAJ,IAAU,CAAV;AACAG,gBAAAA,IAAG,CAACC,GAAJ,GAAUjD,CAAC,GAAG,CAAd;;AACA,oBAAIgD,IAAG,CAACH,EAAJ,GAAS,CAAb,EAAgB;AACZJ,kBAAAA,SAAS,CAACU,MAAV,CAAiBJ,EAAjB,EAAoB,CAApB;AACAA,kBAAAA,EAAC;AACJ;AACJ;AACJ;AACJ;;AAED,cAAIF,EAAE,GAAG,CAAT,EAAY;AACRL,YAAAA,UAAU,CAACY,IAAX,CAAgB;AACZP,cAAAA,EAAE,EAAEA,EADQ;AAEZD,cAAAA,EAAE,EAAEA,EAAE,GAAG,CAFG;AAGZM,cAAAA,KAAK,EAAEwC,WAHK;AAIZzC,cAAAA,GAAG,EAAE,CAAC;AAJM,aAAhB;AAMH;;AAED,cAAIyC,WAAW,IAAIJ,WAAf,IAA8BI,WAAW,GAAG9C,EAAd,IAAoB0C,WAAW,GAAGjD,OAApE,EAA6E;AACzE+C,YAAAA,UAAU,CAAChC,IAAX,CAAgBxE,IAAhB;AACH,WAFD,MAEO,IAAI8G,WAAW,IAAIJ,WAAW,GAAGjD,OAA7B,IAAwCqD,WAAW,GAAG9C,EAAd,IAAoB0C,WAAhE,EAA6E;AAChF1G,YAAAA,IAAI,CAACyD,OAAL,IAAgBvG,IAAI,CAAC8J,sBAAL,CAA4B1D,SAA5B,EAAuCA,SAAS,GAAGG,OAAnD,EAA4DqD,WAA5D,EAAyEA,WAAW,GAAG9C,EAAvF,CAAhB;AACH,WAFM,MAEA,IAAIC,EAAE,GAAG,CAAL,KAAW6C,WAAW,GAAGJ,WAAd,IAA6BI,WAAW,GAAG9C,EAAd,GAAmB0C,WAAW,GAAGjD,OAAzE,CAAJ,EAAuF;AAC1FgD,YAAAA,aAAa,CAACjC,IAAd,CAAmB;AACfxE,cAAAA,IAAI,EAAEA,IADS;AAEfoB,cAAAA,CAAC,EAAEA,CAFY;AAGf6C,cAAAA,EAAE,EAAE7C,CAAC,GAAG6C;AAHO,aAAnB;AAKH;;AAED4C,UAAAA,WAAW,IAAI7C,EAAf;AACH;AACJ;;AAEDH,MAAAA,SAAS,GAAGA,SAAS,CAACY,MAAV,CAAiBb,UAAjB,EAA6Bc,IAA7B,CAAkC,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAAC,eAAOD,CAAC,CAACL,KAAF,GAAUM,CAAC,CAACN,KAAnB;AAA0B,OAA7E,CAAZ;AACAV,MAAAA,UAAU,GAAG,EAAb;;AAEA,UAAI,CAAChG,MAAL,EAAa;AACT,YAAI2I,QAAQ,GAAG,CAAf,EAAkB;AACdA,UAAAA,QAAQ,IAAI,CAAZ;AACA;AACH;;AAED,YAAIG,WAAW,KAAK,IAAhB,IAAwBlD,KAAK,CAAClC,MAAN,GAAe,CAA3C,EAA8C;AAC1CqF,UAAAA,OAAO,GAAG,KAAK1H,OAAL,CAAa5F,KAAb,CAAmB2F,WAAnB,CAA+BK,IAA/B,CAAoC,IAApC,EAA0CmE,KAAK,CAAC,CAAD,CAAL,CAAS7D,QAAnD,EAA6D,CAA7D,EAAgE,IAAhE,CAAV;AACAgH,UAAAA,OAAO,GAAGtC,GAAG,CAAC+B,YAAJ,CAAiBO,OAAjB,EAA0BnD,KAAK,CAACkD,WAAD,CAA/B,CAAV;AACH;AACJ;AACJ;;AAED,QAAI9I,MAAJ,EAAY;AACR,UAAIqJ,WAAJ,EAAiBC,SAAjB;;AACA,WAAK,IAAI/C,GAAC,GAAG,CAAR,EAAWgD,IAAI,GAAGX,UAAU,CAAClF,MAA7B,EAAqC+C,IAA1C,EAA+CF,GAAC,GAAGgD,IAAnD,EAAyDhD,GAAC,EAA1D,EAA8D;AAC1DE,QAAAA,IAAG,GAAGmC,UAAU,CAACrC,GAAD,CAAV,CAAcf,UAApB;AACAlG,QAAAA,IAAI,CAACwI,UAAL,CAAgBc,UAAU,CAACrC,GAAD,CAA1B;;AACA,YAAIE,IAAG,CAACb,KAAJ,CAAUlC,MAAV,KAAqB,CAAzB,EAA4B;AACxB,cAAI,CAAC2F,WAAL,EAAkBA,WAAW,GAAG/J,IAAI,CAACkK,aAAL,CAAmB/D,IAAnB,EAAyBgB,IAAzB,CAAd;AAClB6C,UAAAA,SAAS,GAAGhK,IAAI,CAACkK,aAAL,CAAmB/D,IAAnB,EAAyBgB,IAAzB,CAAZ;AACAnH,UAAAA,IAAI,CAACwI,UAAL,CAAgBrB,IAAhB;AACH;AACJ;;AAED,WAAK,IAAIP,EAAC,GAAG,CAAR,EAAWC,KAAI,GAAG0C,aAAa,CAACnF,MAAhC,EAAwC+F,WAA7C,EAA0DvD,EAAC,GAAGC,KAA9D,EAAoED,EAAC,EAArE,EAAyE;AACrEuD,QAAAA,WAAW,GAAGZ,aAAa,CAAC3C,EAAD,CAA3B;AACAuD,QAAAA,WAAW,CAACrH,IAAZ,CAAiB2D,OAAjB,GAA2BzG,IAAI,CAAC8J,sBAAL,CAA4BC,WAA5B,EAAyCC,SAAzC,EAAoDG,WAAW,CAACjG,CAAhE,EAAmEiG,WAAW,CAACpD,EAA/E,CAA3B;AACH;;AAED,WAAK9B,cAAL;AACH,KAlBD,MAkBO;AACH,WAAKlD,OAAL,CAAa5F,KAAb,CAAmBqJ,wBAAnB,CAA4CrD,IAA5C,CAAiD,IAAjD,EAAuDsG,oBAAoB,IAAIvM,YAAY,CAACG,UAA5F,EAAwG,IAAxG;AACH;AACJ,GArwBU;AAuwBX+N,EAAAA,eAAe,EAAE,IAvwBN;AAwwBXC,EAAAA,aAAa,EAAE,yBAAY;AACvB,SAAKrK,IAAL,CAAUiG,QAAV,CAAmB,KAAKhK,OAAL,CAAaE,KAAb,CAAmBgB,WAAtC,EAAmD,IAAnD;AACA,SAAKlB,OAAL,CAAaE,KAAb,CAAmBiB,SAAnB,CAA6ByB,KAA7B,CAAmChD,OAAnC,GAA6C,cAA7C;;AAEA,SAAKkG,OAAL,CAAa5F,KAAb,CAAmBiO,eAAnB,GAAqC,YAAY;AAC7C,WAAKpK,IAAL,CAAUqE,WAAV,CAAsB,KAAKpI,OAAL,CAAaE,KAAb,CAAmBgB,WAAzC,EAAsD,IAAtD;AACA,WAAKlB,OAAL,CAAaE,KAAb,CAAmBiB,SAAnB,CAA6ByB,KAA7B,CAAmChD,OAAnC,GAA6C,MAA7C;AACA,WAAKyO,cAAL,CAAoB,OAApB,EAA6B,KAAKvI,OAAL,CAAa5F,KAAb,CAAmBiO,eAAhD;AACA,WAAKrI,OAAL,CAAa5F,KAAb,CAAmBiO,eAAnB,GAAqC,IAArC;AACH,KALoC,CAKnC3K,IALmC,CAK9B,IAL8B,CAArC;;AAOA,SAAK8K,WAAL,CAAiB,OAAjB,EAA0B,KAAKxI,OAAL,CAAa5F,KAAb,CAAmBiO,eAA7C;AACH,GApxBU;AAsxBX1I,EAAAA,UAAU,EAAE,oBAAU8I,SAAV,EAAqB;AAC7B,QAAMxK,IAAI,GAAG,KAAKA,IAAlB;AACA,QAAMyK,QAAQ,GAAGD,SAAS,KAAK,UAA/B;AACA,QAAMtO,YAAY,GAAG,KAAKD,OAAL,CAAaE,KAAlC;AACA,QAAMuO,WAAW,GAAGxO,YAAY,CAACG,UAAjC;AACA,QAAM8J,IAAI,GAAGjK,YAAY,CAACK,WAA1B;AACA,QAAMoO,UAAU,GAAGzO,YAAY,CAACI,UAAhC;AACA,QAAM8K,KAAK,GAAGlL,YAAY,CAAC8B,kBAA3B;AACA,QAAMwI,QAAQ,GAAGtK,YAAY,CAAC4B,SAA9B;AACA,QAAM2L,OAAO,GAAG,KAAK1H,OAAL,CAAa5F,KAAb,CAAmB2F,WAAnB,CAA+BK,IAA/B,CAAoC,IAApC,EAA0CuI,WAAW,CAACjI,QAAtD,EAAgE,CAAhE,EAAmE,IAAnE,CAAhB,CAT6B,CAW7B;;AACA,QAAIgI,QAAJ,EAAc;AACV,UAAMG,cAAc,GAAGF,WAAW,CAACnE,OAAnC;AACAkD,MAAAA,OAAO,CAAChD,OAAR,GAAkBiE,WAAW,CAACjE,OAA9B,CAFU,CAIV;;AACA,UAAImE,cAAc,GAAG,CAArB,EAAwB;AACpBnB,QAAAA,OAAO,CAAClD,OAAR,GAAkB,KAAKtD,EAAL,CAAQC,IAAR,CAAa2H,KAAb,CAAmBD,cAAc,GAAC,CAAlC,CAAlB;AACAF,QAAAA,WAAW,CAACnE,OAAZ,GAAsBqE,cAAc,GAAGnB,OAAO,CAAClD,OAA/C;AACAoE,QAAAA,UAAU,CAACzB,YAAX,CAAwBO,OAAxB,EAAiCiB,WAAW,CAAC1C,kBAA7C;AACH,OAJD,MAIO;AAAE;AACL,YAAItB,UAAU,GAAG,EAAjB;AACA,YAAIC,SAAS,GAAG,EAAhB;;AAEA,aAAK,IAAIzC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGjI,YAAY,CAAC2B,OAA9B,EAAuCyI,KAAvC,EAA8CC,OAAnD,EAA4DrC,CAAC,GAAGC,GAAhE,EAAqED,CAAC,EAAtE,EAA0E;AACtEoC,UAAAA,KAAK,GAAGH,IAAI,CAACjC,CAAD,CAAJ,CAAQoC,KAAhB;AACAC,UAAAA,OAAO,GAAG,CAAV;;AACA,eAAK,IAAIK,CAAC,GAAG,CAAR,EAAWC,IAAI,GAAGP,KAAK,CAAClC,MAAxB,EAAgCtB,IAAhC,EAAsCgE,EAAtC,EAA0CC,EAA1C,EAA8CC,WAAnD,EAAgEJ,CAAC,GAAGC,IAApE,EAA0ED,CAAC,EAA3E,EAA+E;AAC3E9D,YAAAA,IAAI,GAAGwD,KAAK,CAACM,CAAD,CAAZ;AACAE,YAAAA,EAAE,GAAGhE,IAAI,CAACyD,OAAL,GAAe,CAApB;AACAQ,YAAAA,EAAE,GAAGjE,IAAI,CAAC2D,OAAL,GAAe,CAApB;AACAO,YAAAA,WAAW,GAAGJ,CAAC,GAAGL,OAAlB;;AAEA,gBAAII,SAAS,CAACvC,MAAV,GAAmB,CAAvB,EAA0B;AACtB,mBAAK,IAAI6C,CAAC,GAAG,CAAR,EAAWC,GAAhB,EAAqBD,CAAC,GAAGN,SAAS,CAACvC,MAAnC,EAA2C6C,CAAC,EAA5C,EAAgD;AAC5CC,gBAAAA,GAAG,GAAGP,SAAS,CAACM,CAAD,CAAf;AACA,oBAAIC,GAAG,CAACC,GAAJ,GAAUjD,CAAd,EAAiB;;AACjB,oBAAI8C,WAAW,IAAIE,GAAG,CAACE,KAAvB,EAA8B;AAC1Bb,kBAAAA,OAAO,IAAIW,GAAG,CAACJ,EAAf;AACAE,kBAAAA,WAAW,IAAIE,GAAG,CAACJ,EAAnB;AACAI,kBAAAA,GAAG,CAACH,EAAJ,IAAU,CAAV;AACAG,kBAAAA,GAAG,CAACC,GAAJ,GAAUjD,CAAC,GAAG,CAAd;;AACA,sBAAIgD,GAAG,CAACH,EAAJ,GAAS,CAAb,EAAgB;AACZJ,oBAAAA,SAAS,CAACU,MAAV,CAAiBJ,CAAjB,EAAoB,CAApB;AACAA,oBAAAA,CAAC;AACJ;AACJ,iBATD,MASO,IAAIL,CAAC,KAAKC,IAAI,GAAG,CAAjB,EAAoB;AACvBK,kBAAAA,GAAG,CAACH,EAAJ,IAAU,CAAV;AACAG,kBAAAA,GAAG,CAACC,GAAJ,GAAUjD,CAAC,GAAG,CAAd;;AACA,sBAAIgD,GAAG,CAACH,EAAJ,GAAS,CAAb,EAAgB;AACZJ,oBAAAA,SAAS,CAACU,MAAV,CAAiBJ,CAAjB,EAAoB,CAApB;AACAA,oBAAAA,CAAC;AACJ;AACJ;AACJ;AACJ;;AAED,gBAAID,WAAW,IAAII,KAAf,IAAwBL,EAAE,GAAG,CAAjC,EAAoC;AAChCL,cAAAA,UAAU,CAACY,IAAX,CAAgB;AACZF,gBAAAA,KAAK,EAAEJ,WADK;AAEZF,gBAAAA,EAAE,EAAEA,EAAE,GAAG,CAFG;AAGZC,gBAAAA,EAAE,EAAEA,EAHQ;AAIZI,gBAAAA,GAAG,EAAE,CAAC;AAJM,eAAhB;AAMH;;AAED,gBAAIrE,IAAI,KAAK4H,WAAT,IAAwB1D,WAAW,IAAII,KAAvC,IAAgDJ,WAAW,GAAGF,EAAd,IAAoBM,KAAK,GAAGwD,cAAR,GAAyB,CAAjG,EAAoG;AAChG9H,cAAAA,IAAI,CAACyD,OAAL,IAAgB,CAAhB;AACA;AACH;;AAED,gBAAIS,WAAW,GAAGI,KAAlB,EAAyB;AAEzBb,YAAAA,OAAO,IAAIO,EAAX;AACH;;AAEDH,UAAAA,SAAS,GAAGA,SAAS,CAACY,MAAV,CAAiBb,UAAjB,EAA6Bc,IAA7B,CAAkC,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAAC,mBAAOD,CAAC,CAACL,KAAF,GAAUM,CAAC,CAACN,KAAnB;AAA0B,WAA7E,CAAZ;AACAV,UAAAA,UAAU,GAAG,EAAb;AACH;;AAEDiE,QAAAA,UAAU,CAACzB,YAAX,CAAwBO,OAAxB,EAAiCiB,WAAW,CAAC1C,kBAA7C;AACH;AACJ,KAvED,MAuEO;AAAE;AACL,UAAM8C,cAAc,GAAGJ,WAAW,CAACjE,OAAnC;AACAgD,MAAAA,OAAO,CAAClD,OAAR,GAAkBmE,WAAW,CAACnE,OAA9B,CAFG,CAIH;;AACA,UAAIuE,cAAc,GAAG,CAArB,EAAwB;AACpBrB,QAAAA,OAAO,CAAChD,OAAR,GAAkB,KAAKxD,EAAL,CAAQC,IAAR,CAAa2H,KAAb,CAAmBC,cAAc,GAAC,CAAlC,CAAlB;AACA,YAAMC,UAAU,GAAGD,cAAc,GAAGrB,OAAO,CAAChD,OAA5C;AAEA,YAAMC,WAAU,GAAG,EAAnB;AACA,YAAMsE,YAAY,GAAGhL,IAAI,CAACkK,aAAL,CAAmB/D,IAAnB,EAAyBwE,UAAzB,IAAuCI,UAA5D;;AAEA,aAAK,IAAI7G,IAAC,GAAG,CAAR,EAAWoC,OAAX,EAAkBC,QAAvB,EAAgCrC,IAAC,GAAG8G,YAApC,EAAkD9G,IAAC,EAAnD,EAAuD;AACnDoC,UAAAA,OAAK,GAAGH,IAAI,CAACjC,IAAD,CAAJ,CAAQoC,KAAhB;AACAC,UAAAA,QAAO,GAAG,CAAV;;AACA,eAAK,IAAIK,GAAC,GAAG,CAAR,EAAWC,MAAI,GAAGP,OAAK,CAAClC,MAAxB,EAAgCtB,MAAhC,EAAsCgE,GAAtC,EAA0CE,aAA/C,EAA4DJ,GAAC,GAAGC,MAAhE,EAAsED,GAAC,EAAvE,EAA2E;AACvEI,YAAAA,aAAW,GAAGJ,GAAC,GAAGL,QAAlB;AACA,gBAAIS,aAAW,IAAII,KAAnB,EAA0B;AAE1BtE,YAAAA,MAAI,GAAGwD,OAAK,CAACM,GAAD,CAAZ;AACAE,YAAAA,GAAE,GAAGhE,MAAI,CAAC2D,OAAL,GAAe,CAApB;;AACA,gBAAIK,GAAE,GAAG,CAAL,IAAUA,GAAE,GAAG5C,IAAL,IAAU8G,YAApB,IAAoChE,aAAW,GAAGI,KAAtD,EAA6D;AACzDV,cAAAA,WAAU,CAACY,IAAX,CAAgB;AACZF,gBAAAA,KAAK,EAAEJ,aADK;AAEZF,gBAAAA,EAAE,EAAEhE,MAAI,CAACyD;AAFG,eAAhB;AAIH;;AACDA,YAAAA,QAAO,IAAIzD,MAAI,CAACyD,OAAL,GAAe,CAA1B;AACH;AACJ;;AAED,YAAM0E,OAAO,GAAG9E,IAAI,CAAC6E,YAAD,CAApB;AACA,YAAME,SAAS,GAAGD,OAAO,CAAC3E,KAA1B;;AACA,YAAIS,GAAE,GAAGL,WAAU,CAACuC,KAAX,EAAT;;AAEA,aAAK,IAAIrC,GAAC,GAAG,CAAR,EAAWC,MAAI,GAAGqE,SAAS,CAAC9G,MAA5B,EAAoCmC,SAAO,GAAG,CAA9C,EAAiDzD,MAAjD,EAAuDgE,IAAvD,EAA2DE,aAA3D,EAAwEwC,WAA7E,EAA0F5C,GAAC,GAAGC,MAA9F,EAAoGD,GAAC,EAArG,EAAyG;AACrGI,UAAAA,aAAW,GAAGJ,GAAC,GAAGL,SAAlB;AACAzD,UAAAA,MAAI,GAAGoI,SAAS,CAACtE,GAAD,CAAhB;AACAE,UAAAA,IAAE,GAAGhE,MAAI,CAACyD,OAAL,GAAe,CAApB;AACAiD,UAAAA,WAAW,GAAGxC,aAAW,GAAGF,IAAd,GAAmB,CAAjC;;AAEA,cAAIC,GAAE,IAAIyC,WAAW,IAAIzC,GAAE,CAACK,KAA5B,EAAmC;AAC/Bb,YAAAA,SAAO,IAAIQ,GAAE,CAACD,EAAd;AACA0C,YAAAA,WAAW,IAAIzC,GAAE,CAACD,EAAlB;AACAC,YAAAA,GAAE,GAAGL,WAAU,CAACuC,KAAX,EAAL;AACH;;AAED,cAAIO,WAAW,IAAIpC,KAAf,IAAwBR,GAAC,KAAKC,MAAI,GAAG,CAAzC,EAA4C;AACxCoE,YAAAA,OAAO,CAAC/B,YAAR,CAAqBO,OAArB,EAA8B3G,MAAI,CAACkF,kBAAnC;AACA;AACH;;AAEDzB,UAAAA,SAAO,IAAIO,IAAX;AACH;;AAED4D,QAAAA,WAAW,CAACjE,OAAZ,GAAsBsE,UAAtB;AACH,OAnDD,MAmDO;AAAE;AACLtB,QAAAA,OAAO,CAAChD,OAAR,GAAkBiE,WAAW,CAACjE,OAA9B;AACA,YAAM0C,MAAM,GAAGnJ,IAAI,CAACC,aAAL,CAAmB,IAAnB,CAAf;AACAkJ,QAAAA,MAAM,CAACpJ,WAAP,CAAmB0J,OAAnB;;AAEA,aAAK,IAAIvF,IAAC,GAAG,CAAR,EAAWoC,OAAhB,EAAuBpC,IAAC,GAAGsC,QAA3B,EAAqCtC,IAAC,EAAtC,EAA0C;AACtCoC,UAAAA,OAAK,GAAGH,IAAI,CAACjC,IAAD,CAAJ,CAAQoC,KAAhB;AACA,cAAIA,OAAK,CAAClC,MAAN,KAAiB,CAArB,EAAwB;;AAExB,eAAK,IAAIwC,GAAC,GAAG,CAAR,EAAWC,MAAI,GAAGP,OAAK,CAAClC,MAA7B,EAAqCwC,GAAC,GAAGC,MAAzC,EAA+CD,GAAC,EAAhD,EAAoD;AAChD,gBAAI1C,IAAC,GAAGoC,OAAK,CAACM,GAAD,CAAL,CAASH,OAAb,GAAuB,CAAvB,IAA4BD,QAAhC,EAA0C;AACtCF,cAAAA,OAAK,CAACM,GAAD,CAAL,CAASH,OAAT,IAAoB,CAApB;AACH;AACJ;AACJ;;AAED,YAAM0E,aAAa,GAAGjP,YAAY,CAAC6B,mBAAnC;AACA,YAAMuI,OAAK,GAAGqE,UAAU,CAACrE,KAAzB;;AAEA,aAAK,IAAIM,GAAC,GAAG,CAAR,EAAWC,MAAI,GAAGP,OAAK,CAAClC,MAA7B,EAAqCwC,GAAC,GAAGC,MAAzC,EAA+CD,GAAC,EAAhD,EAAoD;AAChD,cAAIA,GAAC,KAAKuE,aAAV,EAAyB;AACzB7E,UAAAA,OAAK,CAACM,GAAD,CAAL,CAASH,OAAT,IAAoB,CAApB;AACH;;AAEDkE,QAAAA,UAAU,CAACzE,UAAX,CAAsBgD,YAAtB,CAAmCC,MAAnC,EAA2CwB,UAAU,CAAC3C,kBAAtD;AACH;AACJ;;AAED,SAAKoD,SAAL,CAAeV,WAAf;AACA,SAAK3I,OAAL,CAAa5F,KAAb,CAAmBqJ,wBAAnB,CAA4CrD,IAA5C,CAAiD,IAAjD,EAAuDuI,WAAvD,EAAoE,IAApE;AACH,GA/7BU;AAi8BXxJ,EAAAA,UAAU,EAAE,sBAAY;AACpB,QAAM2C,WAAW,GAAG,KAAK9B,OAAL,CAAa5F,KAAjC;AACA,QAAMD,YAAY,GAAG,KAAKD,OAAL,CAAaE,KAAlC;AACA,QAAM6D,IAAI,GAAG,KAAKA,IAAlB;AAEA,QAAMqL,GAAG,GAAGxH,WAAW,CAACY,IAAxB;AACA,QAAMT,aAAa,GAAGH,WAAW,CAACW,cAAlC;AACA,QAAM8G,SAAS,GAAGtH,aAAa,CAAC,CAAD,CAA/B;AAEA,QAAIuH,aAAa,GAAG,IAApB;AACA,QAAIC,YAAY,GAAG,IAAnB;AACA,QAAI1E,EAAE,GAAIuE,GAAG,CAACI,EAAJ,GAASJ,GAAG,CAACvE,EAAd,GAAoB,CAA7B;AACA,QAAIC,EAAE,GAAIsE,GAAG,CAACK,EAAJ,GAASL,GAAG,CAACtE,EAAd,GAAoB,CAA7B;AACA,QAAI4E,SAAS,GAAG,EAAhB;AACA,QAAIxE,GAAG,GAAG,IAAV;;AAEA,SAAK,IAAIjD,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,aAAa,CAACI,MAA/B,EAAuCtB,IAAvC,EAA6C8I,EAAlD,EAAsD1H,CAAC,GAAGC,GAA1D,EAA+DD,CAAC,EAAhE,EAAoE;AAChEpB,MAAAA,IAAI,GAAGkB,aAAa,CAACE,CAAD,CAApB;AACA,UAAIiD,GAAG,KAAKrE,IAAI,CAACoD,UAAjB,EAA6BiB,GAAG,GAAGrE,IAAI,CAACoD,UAAX;AAE7B0F,MAAAA,EAAE,GAAG9I,IAAI,CAACyF,QAAV;;AACA,WAAK,IAAI3B,CAAC,GAAG,CAAR,EAAWC,IAAI,GAAG+E,EAAE,CAACxH,MAA1B,EAAkCwC,CAAC,GAAGC,IAAtC,EAA4CD,CAAC,EAA7C,EAAiD;AAC7C,YAAI5G,IAAI,CAAC6L,eAAL,CAAqBD,EAAE,CAAChF,CAAD,CAAvB,KAA+B5G,IAAI,CAAC8L,kBAAL,CAAwBF,EAAE,CAAChF,CAAD,CAAF,CAAMmF,WAA9B,CAAnC,EAA+E;AAC3E/L,UAAAA,IAAI,CAACwI,UAAL,CAAgBoD,EAAE,CAAChF,CAAD,CAAlB;AACH;AACJ;;AAED+E,MAAAA,SAAS,IAAI7I,IAAI,CAAC3C,SAAlB;AACAH,MAAAA,IAAI,CAACwI,UAAL,CAAgB1F,IAAhB;;AAEA,UAAIqE,GAAG,CAACb,KAAJ,CAAUlC,MAAV,KAAqB,CAAzB,EAA4B;AACxB,YAAI,CAACmH,aAAL,EAAoBA,aAAa,GAAGpE,GAAhB,CAApB,KACKqE,YAAY,GAAGrE,GAAf;AACLJ,QAAAA,EAAE,IAAI,CAAN;AACH;AACJ;;AAED,QAAIwE,aAAJ,EAAmB;AACf,UAAMpF,IAAI,GAAGjK,YAAY,CAACK,WAA1B;AACA,UAAMyP,aAAa,GAAGhM,IAAI,CAACkK,aAAL,CAAmB/D,IAAnB,EAAyBoF,aAAzB,CAAtB;AACA,UAAMU,YAAY,GAAGjM,IAAI,CAACkK,aAAL,CAAmB/D,IAAnB,EAAyBqF,YAAY,IAAID,aAAzC,CAArB;AACA,UAAMW,UAAU,GAAG,EAAnB;;AAEA,WAAK,IAAIhI,IAAC,GAAG,CAAR,EAAWoC,KAAhB,EAAuBpC,IAAC,IAAI+H,YAA5B,EAA0C/H,IAAC,EAA3C,EAA+C;AAC3CoC,QAAAA,KAAK,GAAGH,IAAI,CAACjC,IAAD,CAAJ,CAAQoC,KAAhB;;AACA,YAAIA,KAAK,CAAClC,MAAN,KAAiB,CAArB,EAAwB;AACpB8H,UAAAA,UAAU,CAAC5E,IAAX,CAAgBnB,IAAI,CAACjC,IAAD,CAApB;AACA;AACH;;AAED,aAAK,IAAI0C,GAAC,GAAG,CAAR,EAAWC,MAAI,GAAGP,KAAK,CAAClC,MAAxB,EAAgCtB,MAAhC,EAAsCiE,IAA3C,EAA+CH,GAAC,GAAGC,MAAnD,EAAyDD,GAAC,EAA1D,EAA8D;AAC1D9D,UAAAA,MAAI,GAAGwD,KAAK,CAACM,GAAD,CAAZ;AACAG,UAAAA,IAAE,GAAGjE,MAAI,CAAC2D,OAAL,GAAe,CAApB;;AACA,cAAIM,IAAE,GAAG,CAAL,IAAU7C,IAAC,GAAG6C,IAAJ,IAAUiF,aAAxB,EAAuC;AACnClJ,YAAAA,MAAI,CAAC2D,OAAL,IAAgBzG,IAAI,CAAC8J,sBAAL,CAA4BkC,aAA5B,EAA2CC,YAA3C,EAAyD/H,IAAzD,EAA4DA,IAAC,GAAG6C,IAAhE,CAAhB;AACH;AACJ;AACJ;;AAED,WAAK,IAAI7C,IAAC,GAAG,CAAR,EAAWC,KAAG,GAAG+H,UAAU,CAAC9H,MAAjC,EAAyCF,IAAC,GAAGC,KAA7C,EAAkDD,IAAC,EAAnD,EAAuD;AACnDlE,QAAAA,IAAI,CAACwI,UAAL,CAAgB0D,UAAU,CAAChI,IAAD,CAA1B;AACH;AACJ;;AAEDoH,IAAAA,SAAS,CAACnL,SAAV,IAAuBwL,SAAvB;AACAL,IAAAA,SAAS,CAAC/E,OAAV,GAAoBO,EAApB;AACAwE,IAAAA,SAAS,CAAC7E,OAAV,GAAoBM,EAApB;AAEA,SAAK9B,cAAL;AACApB,IAAAA,WAAW,CAACsI,eAAZ,CAA4BhK,IAA5B,CAAiC,IAAjC,EAAuC,IAAvC,EAA6C,KAA7C;AACA0B,IAAAA,WAAW,CAACgB,yBAAZ,CAAsC1C,IAAtC,CAA2C,IAA3C,EAAiDmJ,SAAjD;AAEAtL,IAAAA,IAAI,CAACiG,QAAL,CAAcqF,SAAd,EAAyB,wBAAzB;AACA,SAAKF,SAAL,CAAeE,SAAf;AACH,GA3gCU;AA6gCXc,EAAAA,YAAY,EAAE,wBAAY;AACtB,QAAMpM,IAAI,GAAG,KAAKA,IAAlB;AACA,QAAM/C,YAAY,GAAG,KAAKhB,OAAL,CAAaE,KAAb,CAAmBc,YAAxC;AACA,QAAMoP,MAAM,GAAGrM,IAAI,CAACoF,QAAL,CAAcnI,YAAd,EAA4B,QAA5B,CAAf;AACA,QAAMd,KAAK,GAAG,KAAKF,OAAL,CAAaE,KAAb,CAAmBC,QAAjC;;AAEA,QAAI,CAACiQ,MAAL,EAAa;AACT,UAAMC,MAAM,GAAGtM,IAAI,CAACC,aAAL,CAAmB,OAAnB,CAAf;AACAqM,MAAAA,MAAM,CAACnM,SAAP,GAAmB,SAAS,KAAK4B,OAAL,CAAa5F,KAAb,CAAmB2F,WAAnB,CAA+BK,IAA/B,CAAoC,IAApC,EAA0C,IAA1C,EAAgD,KAAKlG,OAAL,CAAaE,KAAb,CAAmByB,gBAAnE,EAAqF,KAArF,CAAT,GAAuG,OAA1H;AACAzB,MAAAA,KAAK,CAAC+M,YAAN,CAAmBoD,MAAnB,EAA2BnQ,KAAK,CAAC6J,iBAAjC;AACH,KAJD,MAIO;AACHhG,MAAAA,IAAI,CAACwI,UAAL,CAAgBrM,KAAK,CAACsC,aAAN,CAAoB,OAApB,CAAhB;AACH;;AAEDuB,IAAAA,IAAI,CAACuM,WAAL,CAAiBtP,YAAjB,EAA+B,QAA/B;;AAEA,QAAI,MAAM8I,IAAN,CAAW,KAAK9J,OAAL,CAAaE,KAAb,CAAmBE,UAAnB,CAA8BoG,QAAzC,CAAJ,EAAwD;AACpD,WAAKwC,cAAL;AACH,KAFD,MAEO;AACH,WAAKlD,OAAL,CAAa5F,KAAb,CAAmBqJ,wBAAnB,CAA4CrD,IAA5C,CAAiD,IAAjD,EAAuD,KAAKlG,OAAL,CAAaE,KAAb,CAAmBE,UAA1E,EAAsF,KAAtF;AACH;AACJ,GAliCU;AAoiCXiJ,EAAAA,aAAa,EAAE,uBAAUkH,MAAV,EAAkB;AAC7B,QAAMtQ,YAAY,GAAG,KAAKD,OAAL,CAAaE,KAAlC;AACA,QAAM+I,YAAY,GAAGhJ,YAAY,CAACE,QAAlC;AACA,QAAIqQ,IAAJ,EAAUC,IAAV,EAAgBC,QAAhB,EAA0BC,IAA1B;;AAEA,QAAIJ,MAAM,CAACK,OAAP,CAAe,OAAf,IAA0B,CAAC,CAA/B,EAAkC;AAC9BJ,MAAAA,IAAI,GAAIvQ,YAAY,CAAC+C,YAAb,CAA0B+G,iBAAlC;AACA0G,MAAAA,IAAI,GAAGxQ,YAAY,CAACc,UAApB;;AAEA,UAAI,CAACd,YAAY,CAACO,SAAlB,EAA6B;AACzBkQ,QAAAA,QAAQ,GAAGzQ,YAAY,CAACiC,KAAb,CAAmBC,SAA9B;AACAwO,QAAAA,IAAI,GAAG1Q,YAAY,CAACmB,OAApB;AACAnB,QAAAA,YAAY,CAACgD,iBAAb,CAA+BL,KAA/B,CAAqChD,OAArC,GAA+C,MAA/C;AACA,aAAKmE,IAAL,CAAUqE,WAAV,CAAsBa,YAAtB,EAAoC,mBAApC;AACA,aAAKlF,IAAL,CAAUiG,QAAV,CAAmBf,YAAnB,EAAiC,oBAAjC;AACH,OAND,MAMO;AACHyH,QAAAA,QAAQ,GAAGzQ,YAAY,CAACiC,KAAb,CAAmBE,SAA9B;AACAuO,QAAAA,IAAI,GAAG1Q,YAAY,CAACuB,OAApB;AACAvB,QAAAA,YAAY,CAACgD,iBAAb,CAA+BL,KAA/B,CAAqChD,OAArC,GAA+C,OAA/C;AACA,aAAKmE,IAAL,CAAUqE,WAAV,CAAsBa,YAAtB,EAAoC,oBAApC;AACA,aAAKlF,IAAL,CAAUiG,QAAV,CAAmBf,YAAnB,EAAiC,mBAAjC;AACH;;AAED,WAAKlF,IAAL,CAAU8M,aAAV,CAAwBL,IAAxB,EAA8BE,QAA9B;AACA,WAAK3M,IAAL,CAAUwD,SAAV,CAAoBkJ,IAApB,EAA0BE,IAA1B;AACH;;AAED,QAAIJ,MAAM,CAACK,OAAP,CAAe,QAAf,IAA2B,CAAC,CAAhC,EAAmC;AAC/B,UAAI,CAAC3Q,YAAY,CAACQ,YAAlB,EAAgC;AAC5B,aAAKsD,IAAL,CAAUqE,WAAV,CAAsBa,YAAtB,EAAoC,uBAApC;AACA,aAAKlF,IAAL,CAAUiG,QAAV,CAAmBf,YAAnB,EAAiC,sBAAjC;AACA,aAAKlF,IAAL,CAAUqE,WAAV,CAAsBnI,YAAY,CAACgD,iBAAnC,EAAsD,QAAtD;AACH,OAJD,MAIO;AACH,aAAKc,IAAL,CAAUqE,WAAV,CAAsBa,YAAtB,EAAoC,sBAApC;AACA,aAAKlF,IAAL,CAAUiG,QAAV,CAAmBf,YAAnB,EAAiC,uBAAjC;AACA,aAAKlF,IAAL,CAAUiG,QAAV,CAAmB/J,YAAY,CAACgD,iBAAhC,EAAmD,QAAnD;AACH;AAEJ;AACJ,GA3kCU;AA6kCXiN,EAAAA,eAAe,EAAE,yBAAUY,SAAV,EAAqBC,YAArB,EAAmC;AAChD,QAAM9Q,YAAY,GAAG,KAAKD,OAAL,CAAaE,KAAlC;;AAEA,QAAI,QAAQ4J,IAAR,CAAagH,SAAS,CAACtK,QAAvB,CAAJ,EAAsC;AAClCvG,MAAAA,YAAY,CAACmD,oBAAb,CAAkC4N,YAAlC,CAA+C,UAA/C,EAA2D,IAA3D;AACA/Q,MAAAA,YAAY,CAACoD,oBAAb,CAAkC2N,YAAlC,CAA+C,UAA/C,EAA2D,IAA3D;AACH,KAHD,MAGO;AACH/Q,MAAAA,YAAY,CAACmD,oBAAb,CAAkC6N,eAAlC,CAAkD,UAAlD;AACAhR,MAAAA,YAAY,CAACoD,oBAAb,CAAkC4N,eAAlC,CAAkD,UAAlD;AACH;;AAED,QAAI,CAACF,YAAD,IAAiBD,SAAS,KAAKC,YAAnC,EAAiD;AAC7C9Q,MAAAA,YAAY,CAACiB,WAAb,CAAyB+P,eAAzB,CAAyC,UAAzC;AACAhR,MAAAA,YAAY,CAACgB,WAAb,CAAyB+P,YAAzB,CAAsC,UAAtC,EAAkD,IAAlD;AACH,KAHD,MAGO;AACH/Q,MAAAA,YAAY,CAACiB,WAAb,CAAyB8P,YAAzB,CAAsC,UAAtC,EAAkD,IAAlD;AACA/Q,MAAAA,YAAY,CAACgB,WAAb,CAAyBgQ,eAAzB,CAAyC,UAAzC;AACH;AACJ,GA/lCU;AAimCX;AACAC,EAAAA,aAAa,EAAE,IAlmCJ;AAmmCXC,EAAAA,cAAc,EAAE,IAnmCL;AAomCXC,EAAAA,aAAa,EAAE,IApmCJ;AAqmCX7I,EAAAA,cAAc,EAAE,IArmCL;AAsmCXD,EAAAA,MAAM,EAAE,KAtmCG;AAumCXG,EAAAA,UAAU,EAAE,IAvmCD;AAwmCXE,EAAAA,cAAc,EAAE,IAxmCL;AAymCXD,EAAAA,aAAa,EAAE,IAzmCJ;AA0mCXZ,EAAAA,cAAc,EAAE,IA1mCL;AA2mCXU,EAAAA,IAAI,EAAE,IA3mCK;AA4mCXH,EAAAA,aAAa,EAAE,uBAAUgJ,OAAV,EAAmB;AAC9B,SAAKrR,OAAL,CAAa4D,OAAb,CAAqB0N,OAArB,CAA6BN,YAA7B,CAA0C,iBAA1C,EAA6DK,OAA7D;AACA,QAAIA,OAAJ,EAAa,KAAKtN,IAAL,CAAUqE,WAAV,CAAsB,KAAKpI,OAAL,CAAa4D,OAAb,CAAqB0N,OAA3C,EAAoD,aAApD,EAAb,KACK,KAAKvN,IAAL,CAAUiG,QAAV,CAAmB,KAAKhK,OAAL,CAAa4D,OAAb,CAAqB0N,OAAxC,EAAiD,aAAjD;AACR,GAhnCU;AAknCXC,EAAAA,mBAAmB,EAAE,6BAAUzK,CAAV,EAAa;AAC9BA,IAAAA,CAAC,CAACC,eAAF;AACA,QAAMa,WAAW,GAAG,KAAK9B,OAAL,CAAa5F,KAAjC;;AAEA,QAAI,CAAC0H,WAAW,CAACU,MAAjB,EAAyB;AACrBV,MAAAA,WAAW,CAACC,aAAZ,CAA0B3B,IAA1B,CAA+B,IAA/B;;AACA0B,MAAAA,WAAW,CAACS,aAAZ,CAA0BnC,IAA1B,CAA+B,IAA/B,EAAqC,IAArC;AACH,KAHD,MAGO,IAAI0B,WAAW,CAAC4J,SAAhB,EAA2B;AAC9B,WAAKC,GAAL,CAASC,mBAAT,CAA6B,WAA7B,EAA0C9J,WAAW,CAAC4J,SAAtD;;AACA5J,MAAAA,WAAW,CAAC4J,SAAZ,GAAwB,IAAxB;AACH;;AAED,QAAI,CAAC5J,WAAW,CAACa,UAAb,IAA2B,CAACb,WAAW,CAACE,cAA5C,EAA4D;AAE5DF,IAAAA,WAAW,CAACsI,eAAZ,CAA4BhK,IAA5B,CAAiC,IAAjC,EAAuC0B,WAAW,CAACa,UAAnD,EAA+Db,WAAW,CAACc,aAA3E;AACAd,IAAAA,WAAW,CAACgB,yBAAZ,CAAsC1C,IAAtC,CAA2C,IAA3C,EAAiD0B,WAAW,CAACc,aAAZ,IAA6Bd,WAAW,CAACa,UAA1F;AAEAb,IAAAA,WAAW,CAACW,cAAZ,GAA6BX,WAAW,CAACE,cAAZ,CAA2BE,gBAA3B,CAA4C,yBAA5C,CAA7B;AACA,QAAIJ,WAAW,CAACc,aAAZ,IAA6Bd,WAAW,CAACa,UAA7C,EAAyD,KAAK0G,SAAL,CAAevH,WAAW,CAACc,aAA3B;;AAEzD,QAAI,CAACd,WAAW,CAACU,MAAjB,EAAyB;AACrBV,MAAAA,WAAW,CAACa,UAAZ,GAAyB,IAAzB;AACAb,MAAAA,WAAW,CAACc,aAAZ,GAA4B,IAA5B;AACAd,MAAAA,WAAW,CAACe,cAAZ,GAA6B,IAA7B;AACH;AACJ,GA3oCU;AA6oCXgJ,EAAAA,kBAAkB,EAAE,4BAAU7K,CAAV,EAAa;AAC7B,SAAK8K,SAAL,GAAiB,IAAjB;AACA,QAAMhK,WAAW,GAAG,KAAK9B,OAAL,CAAa5F,KAAjC;AACA,QAAM2R,MAAM,GAAG,KAAK9N,IAAL,CAAUmF,gBAAV,CAA2BpC,CAAC,CAAC+K,MAA7B,EAAqC,KAAK9N,IAAL,CAAU+N,MAA/C,CAAf;;AAEA,QAAIlK,WAAW,CAACU,MAAhB,EAAwB;AACpB,UAAIuJ,MAAM,KAAKjK,WAAW,CAACa,UAA3B,EAAuCb,WAAW,CAACS,aAAZ,CAA0BnC,IAA1B,CAA+B,IAA/B,EAAqC,IAArC,EAAvC,KACK0B,WAAW,CAACS,aAAZ,CAA0BnC,IAA1B,CAA+B,IAA/B,EAAqC,KAArC;AACR,KAHD,MAGO,IAAI,CAAC0B,WAAW,CAACY,IAAjB,EAAuB;AAC1B,UAAIqJ,MAAM,KAAKjK,WAAW,CAACa,UAA3B,EAAuC,OAAvC,KACKb,WAAW,CAACS,aAAZ,CAA0BnC,IAA1B,CAA+B,IAA/B,EAAqC,KAArC;AACR;;AAED,QAAI,CAAC2L,MAAD,IAAWA,MAAM,KAAKjK,WAAW,CAACc,aAAlC,IAAmDd,WAAW,CAACe,cAAZ,KAA+BkJ,MAAM,CAACrL,QAAzF,IACAoB,WAAW,CAACE,cAAZ,KAA+B,KAAK/D,IAAL,CAAUmF,gBAAV,CAA2B2I,MAA3B,EAAmC,OAAnC,CADnC,EACgF;AAC5E;AACH;;AAEDjK,IAAAA,WAAW,CAACc,aAAZ,GAA4BmJ,MAA5B;;AACAjK,IAAAA,WAAW,CAACmK,cAAZ,CAA2B7L,IAA3B,CAAgC,IAAhC,EAAsC0B,WAAW,CAACa,UAAlD,EAA8DoJ,MAA9D;AACH,GAjqCU;AAmqCXE,EAAAA,cAAc,EAAE,wBAAUC,SAAV,EAAqBC,OAArB,EAA8B;AAC1C,QAAMrK,WAAW,GAAG,KAAK9B,OAAL,CAAa5F,KAAjC;AACA,QAAMgK,IAAI,GAAGtC,WAAW,CAACE,cAAZ,CAA2BoC,IAAxC;AACA,QAAMnG,IAAI,GAAG,KAAKA,IAAlB;;AAEA,QAAMgE,aAAa,GAAGH,WAAW,CAACE,cAAZ,CAA2BE,gBAA3B,CAA4C,yBAA5C,CAAtB;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,aAAa,CAACI,MAApC,EAA4CF,CAAC,GAAGC,GAAhD,EAAqDD,CAAC,EAAtD,EAA0D;AACtDlE,MAAAA,IAAI,CAACqE,WAAL,CAAiBL,aAAa,CAACE,CAAD,CAA9B,EAAmC,wBAAnC;AACH;;AAED,QAAI+J,SAAS,KAAKC,OAAlB,EAA2B;AACvBlO,MAAAA,IAAI,CAACiG,QAAL,CAAcgI,SAAd,EAAyB,wBAAzB;AACA,UAAI,CAACpK,WAAW,CAACU,MAAjB,EAAyB;AAC5B;;AAED,QAAI4J,gBAAgB,GAAG,IAAvB;AACA,QAAIxH,SAAS,GAAG,EAAhB;AACA,QAAID,UAAU,GAAG,EAAjB;AACA,QAAM2E,GAAG,GAAGxH,WAAW,CAACY,IAAZ,GAAmB;AAAC2J,MAAAA,EAAE,EAAE,CAAL;AAAQtH,MAAAA,EAAE,EAAE,IAAZ;AAAkB2E,MAAAA,EAAE,EAAE,IAAtB;AAA4B1E,MAAAA,EAAE,EAAE,IAAhC;AAAsC2E,MAAAA,EAAE,EAAE;AAA1C,KAA/B;;AAEA,SAAK,IAAIxH,IAAC,GAAG,CAAR,EAAWC,KAAG,GAAGgC,IAAI,CAAC/B,MAAtB,EAA8BkC,KAA9B,EAAqCC,OAA1C,EAAmDrC,IAAC,GAAGC,KAAvD,EAA4DD,IAAC,EAA7D,EAAiE;AAC7DoC,MAAAA,KAAK,GAAGH,IAAI,CAACjC,IAAD,CAAJ,CAAQoC,KAAhB;AACAC,MAAAA,OAAO,GAAG,CAAV;;AAEA,WAAK,IAAIK,CAAC,GAAG,CAAR,EAAWC,IAAI,GAAGP,KAAK,CAAClC,MAAxB,EAAgCtB,IAAhC,EAAsCkE,WAAtC,EAAmDF,EAAnD,EAAuDC,EAA5D,EAAgEH,CAAC,GAAGC,IAApE,EAA0ED,CAAC,EAA3E,EAA+E;AAC3E9D,QAAAA,IAAI,GAAGwD,KAAK,CAACM,CAAD,CAAZ;AACAE,QAAAA,EAAE,GAAGhE,IAAI,CAACyD,OAAL,GAAe,CAApB;AACAQ,QAAAA,EAAE,GAAGjE,IAAI,CAAC2D,OAAL,GAAe,CAApB;AACAO,QAAAA,WAAW,GAAGJ,CAAC,GAAGL,OAAlB;;AAEA,YAAII,SAAS,CAACvC,MAAV,GAAmB,CAAvB,EAA0B;AACtB,eAAK,IAAI6C,CAAC,GAAG,CAAR,EAAWC,GAAhB,EAAqBD,CAAC,GAAGN,SAAS,CAACvC,MAAnC,EAA2C6C,CAAC,EAA5C,EAAgD;AAC5CC,YAAAA,GAAG,GAAGP,SAAS,CAACM,CAAD,CAAf;AACA,gBAAIC,GAAG,CAACC,GAAJ,GAAUjD,IAAd,EAAiB;;AACjB,gBAAI8C,WAAW,IAAIE,GAAG,CAACE,KAAvB,EAA8B;AAC1Bb,cAAAA,OAAO,IAAIW,GAAG,CAACJ,EAAf;AACAE,cAAAA,WAAW,IAAIE,GAAG,CAACJ,EAAnB;AACAI,cAAAA,GAAG,CAACH,EAAJ,IAAU,CAAV;AACAG,cAAAA,GAAG,CAACC,GAAJ,GAAUjD,IAAC,GAAG,CAAd;;AACA,kBAAIgD,GAAG,CAACH,EAAJ,GAAS,CAAb,EAAgB;AACZJ,gBAAAA,SAAS,CAACU,MAAV,CAAiBJ,CAAjB,EAAoB,CAApB;AACAA,gBAAAA,CAAC;AACJ;AACJ,aATD,MASO,IAAIL,CAAC,KAAKC,IAAI,GAAG,CAAjB,EAAoB;AACvBK,cAAAA,GAAG,CAACH,EAAJ,IAAU,CAAV;AACAG,cAAAA,GAAG,CAACC,GAAJ,GAAUjD,IAAC,GAAG,CAAd;;AACA,kBAAIgD,GAAG,CAACH,EAAJ,GAAS,CAAb,EAAgB;AACZJ,gBAAAA,SAAS,CAACU,MAAV,CAAiBJ,CAAjB,EAAoB,CAApB;AACAA,gBAAAA,CAAC;AACJ;AACJ;AACJ;AACJ;;AAED,YAAIkH,gBAAJ,EAAsB;AAClB,cAAIrL,IAAI,KAAKmL,SAAT,IAAsBnL,IAAI,KAAKoL,OAAnC,EAA4C;AACxC7C,YAAAA,GAAG,CAACvE,EAAJ,GAASuE,GAAG,CAACvE,EAAJ,KAAW,IAAX,IAAmBuE,GAAG,CAACvE,EAAJ,GAASE,WAA5B,GAA0CqE,GAAG,CAACvE,EAA9C,GAAmDE,WAA5D;AACAqE,YAAAA,GAAG,CAACI,EAAJ,GAASJ,GAAG,CAACI,EAAJ,KAAW,IAAX,IAAmBJ,GAAG,CAACI,EAAJ,GAASzE,WAAW,GAAGF,EAA1C,GAA+CuE,GAAG,CAACI,EAAnD,GAAwDzE,WAAW,GAAGF,EAA/E;AACAuE,YAAAA,GAAG,CAACtE,EAAJ,GAASsE,GAAG,CAACtE,EAAJ,KAAW,IAAX,IAAmBsE,GAAG,CAACtE,EAAJ,GAAS7C,IAA5B,GAAgCmH,GAAG,CAACtE,EAApC,GAAyC7C,IAAlD;AACAmH,YAAAA,GAAG,CAACK,EAAJ,GAASL,GAAG,CAACK,EAAJ,KAAW,IAAX,IAAmBL,GAAG,CAACK,EAAJ,GAASxH,IAAC,GAAG6C,EAAhC,GAAqCsE,GAAG,CAACK,EAAzC,GAA8CxH,IAAC,GAAG6C,EAA3D;AACAsE,YAAAA,GAAG,CAAC+C,EAAJ,IAAU,CAAV;AACH;;AAED,cAAI/C,GAAG,CAAC+C,EAAJ,KAAW,CAAf,EAAkB;AACdD,YAAAA,gBAAgB,GAAG,KAAnB;AACAxH,YAAAA,SAAS,GAAG,EAAZ;AACAD,YAAAA,UAAU,GAAG,EAAb;AACAxC,YAAAA,IAAC,GAAG,CAAC,CAAL;AACA;AACH;AACJ,SAhBD,MAgBO,IAAIlE,IAAI,CAAC8J,sBAAL,CAA4BuB,GAAG,CAACvE,EAAhC,EAAoCuE,GAAG,CAACI,EAAxC,EAA4CzE,WAA5C,EAAyDA,WAAW,GAAGF,EAAvE,KAA8E9G,IAAI,CAAC8J,sBAAL,CAA4BuB,GAAG,CAACtE,EAAhC,EAAoCsE,GAAG,CAACK,EAAxC,EAA4CxH,IAA5C,EAA+CA,IAAC,GAAG6C,EAAnD,CAAlF,EAA0I;AAC7I,cAAMsH,KAAK,GAAGhD,GAAG,CAACvE,EAAJ,GAASE,WAAT,GAAuBqE,GAAG,CAACvE,EAA3B,GAAgCE,WAA9C;AACA,cAAMsH,KAAK,GAAGjD,GAAG,CAACI,EAAJ,GAASzE,WAAW,GAAGF,EAAvB,GAA4BuE,GAAG,CAACI,EAAhC,GAAqCzE,WAAW,GAAGF,EAAjE;AACA,cAAMyH,KAAK,GAAGlD,GAAG,CAACtE,EAAJ,GAAS7C,IAAT,GAAamH,GAAG,CAACtE,EAAjB,GAAsB7C,IAApC;AACA,cAAMsK,KAAK,GAAGnD,GAAG,CAACK,EAAJ,GAASxH,IAAC,GAAG6C,EAAb,GAAkBsE,GAAG,CAACK,EAAtB,GAA2BxH,IAAC,GAAG6C,EAA7C;;AAEA,cAAIsE,GAAG,CAACvE,EAAJ,KAAWuH,KAAX,IAAoBhD,GAAG,CAACI,EAAJ,KAAW6C,KAA/B,IAAwCjD,GAAG,CAACtE,EAAJ,KAAWwH,KAAnD,IAA4DlD,GAAG,CAACK,EAAJ,KAAW8C,KAA3E,EAAkF;AAC9EnD,YAAAA,GAAG,CAACvE,EAAJ,GAASuH,KAAT;AACAhD,YAAAA,GAAG,CAACI,EAAJ,GAAS6C,KAAT;AACAjD,YAAAA,GAAG,CAACtE,EAAJ,GAASwH,KAAT;AACAlD,YAAAA,GAAG,CAACK,EAAJ,GAAS8C,KAAT;AACAtK,YAAAA,IAAC,GAAG,CAAC,CAAL;AAEAyC,YAAAA,SAAS,GAAG,EAAZ;AACAD,YAAAA,UAAU,GAAG,EAAb;AACA;AACH;;AAED1G,UAAAA,IAAI,CAACiG,QAAL,CAAcnD,IAAd,EAAoB,wBAApB;AACH;;AAED,YAAIiE,EAAE,GAAG,CAAT,EAAY;AACRL,UAAAA,UAAU,CAACY,IAAX,CAAgB;AACZF,YAAAA,KAAK,EAAEJ,WADK;AAEZF,YAAAA,EAAE,EAAEA,EAAE,GAAG,CAFG;AAGZC,YAAAA,EAAE,EAAEA,EAHQ;AAIZI,YAAAA,GAAG,EAAE,CAAC;AAJM,WAAhB;AAMH;;AAEDZ,QAAAA,OAAO,IAAIzD,IAAI,CAACyD,OAAL,GAAe,CAA1B;AACH;;AAEDI,MAAAA,SAAS,GAAGA,SAAS,CAACY,MAAV,CAAiBb,UAAjB,EAA6Bc,IAA7B,CAAkC,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAAC,eAAOD,CAAC,CAACL,KAAF,GAAUM,CAAC,CAACN,KAAnB;AAA0B,OAA7E,CAAZ;AACAV,MAAAA,UAAU,GAAG,EAAb;AACH;AACJ,GA7wCU;AA+wCX5C,EAAAA,aAAa,EAAE,yBAAY;AACvB,QAAMD,WAAW,GAAG,KAAK9B,OAAL,CAAa5F,KAAjC;;AAEA,QAAI0H,WAAW,CAAC4J,SAAhB,EAA2B;AACvB,WAAKC,GAAL,CAASC,mBAAT,CAA6B,WAA7B,EAA0C9J,WAAW,CAAC4J,SAAtD;;AACA5J,MAAAA,WAAW,CAAC4J,SAAZ,GAAwB,IAAxB;AACH;;AAED,QAAI5J,WAAW,CAACsJ,aAAhB,EAA+B;AAC3B,WAAKO,GAAL,CAASC,mBAAT,CAA6B,WAA7B,EAA0C9J,WAAW,CAACsJ,aAAtD;;AACA,WAAKO,GAAL,CAASC,mBAAT,CAA6B,WAA7B,EAA0C9J,WAAW,CAACsJ,aAAtD;;AACAtJ,MAAAA,WAAW,CAACsJ,aAAZ,GAA4B,IAA5B;AACH;;AAED,QAAItJ,WAAW,CAACuJ,cAAhB,EAAgC;AAC5B,WAAKM,GAAL,CAASC,mBAAT,CAA6B,SAA7B,EAAwC9J,WAAW,CAACuJ,cAApD;;AACAvJ,MAAAA,WAAW,CAACuJ,cAAZ,GAA6B,IAA7B;AACH;;AAED,QAAIvJ,WAAW,CAACwJ,aAAhB,EAA+B;AAC3B,WAAKK,GAAL,CAASC,mBAAT,CAA6B,OAA7B,EAAsC9J,WAAW,CAACwJ,aAAlD;;AACAxJ,MAAAA,WAAW,CAACwJ,aAAZ,GAA4B,IAA5B;AACH;AACJ,GAtyCU;AAwyCXI,EAAAA,SAAS,EAAE,IAxyCA;AAyyCXgB,EAAAA,sBAAsB,EAAE,gCAAU3J,SAAV,EAAqBmE,KAArB,EAA4B;AAChD,QAAMpF,WAAW,GAAG,KAAK9B,OAAL,CAAa5F,KAAjC;;AAEA0H,IAAAA,WAAW,CAACC,aAAZ,CAA0B3B,IAA1B,CAA+B,IAA/B;;AACA,SAAK8C,cAAL;AAEApB,IAAAA,WAAW,CAACU,MAAZ,GAAqB0E,KAArB;AACApF,IAAAA,WAAW,CAACa,UAAZ,GAAyBI,SAAzB;AACAjB,IAAAA,WAAW,CAACe,cAAZ,GAA6BE,SAAS,CAACrC,QAAvC;AACAoB,IAAAA,WAAW,CAACE,cAAZ,GAA6B,KAAK/D,IAAL,CAAUmF,gBAAV,CAA2BL,SAA3B,EAAsC,OAAtC,CAA7B;;AAEA,QAAMd,aAAa,GAAGH,WAAW,CAACE,cAAZ,CAA2BE,gBAA3B,CAA4C,yBAA5C,CAAtB;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,aAAa,CAACI,MAApC,EAA4CF,CAAC,GAAGC,GAAhD,EAAqDD,CAAC,EAAtD,EAA0D;AACtD,WAAKlE,IAAL,CAAUqE,WAAV,CAAsBL,aAAa,CAACE,CAAD,CAAnC,EAAwC,wBAAxC;AACH;;AAED,SAAKlE,IAAL,CAAUiG,QAAV,CAAmBnB,SAAnB,EAA8B,wBAA9B;AAEAjB,IAAAA,WAAW,CAACsJ,aAAZ,GAA4BtJ,WAAW,CAAC+J,kBAAZ,CAA+BnO,IAA/B,CAAoC,IAApC,CAA5B;AACAoE,IAAAA,WAAW,CAACuJ,cAAZ,GAA6BvJ,WAAW,CAAC2J,mBAAZ,CAAgC/N,IAAhC,CAAqC,IAArC,CAA7B;;AAEA,QAAI,CAACwJ,KAAL,EAAY;AACR,WAAKyE,GAAL,CAASnO,gBAAT,CAA0B,WAA1B,EAAuCsE,WAAW,CAACsJ,aAAnD,EAAkE,KAAlE;AACH,KAFD,MAEO;AACHtJ,MAAAA,WAAW,CAACwJ,aAAZ,GAA4B,YAAY;AACpC,aAAK5H,aAAL,CAAmB,KAAKxJ,OAAL,CAAaE,KAAb,CAAmBgD,SAAtC,EAAiD,KAAKlD,OAAL,CAAaE,KAAb,CAAmB4C,eAApE,EAAqF,KAAKgD,OAAL,CAAa5F,KAAb,CAAmByH,IAAnB,CAAwBnE,IAAxB,CAA6B,IAA7B,CAArF,EAAyHqF,SAAzH,EAAoI,OAApI;AACA,YAAI,CAACjB,WAAW,CAACY,IAAjB,EAAuB,KAAKQ,cAAL;AAC1B,OAH2B,CAG1BxF,IAH0B,CAGrB,IAHqB,CAA5B;;AAKA,WAAKiO,GAAL,CAASnO,gBAAT,CAA0B,OAA1B,EAAmCsE,WAAW,CAACwJ,aAA/C,EAA8D,KAA9D;;AACA,WAAKK,GAAL,CAASnO,gBAAT,CAA0B,WAA1B,EAAuCsE,WAAW,CAACsJ,aAAnD,EAAkE,KAAlE;AACH;;AAED,SAAKO,GAAL,CAASnO,gBAAT,CAA0B,SAA1B,EAAqCsE,WAAW,CAACuJ,cAAjD,EAAiE,KAAjE;;AACAvJ,IAAAA,WAAW,CAAC4J,SAAZ,GAAwB5J,WAAW,CAACD,IAAZ,CAAiBnE,IAAjB,CAAsB,IAAtB,CAAxB;;AACA,SAAKiO,GAAL,CAASnO,gBAAT,CAA0B,WAA1B,EAAuCsE,WAAW,CAAC4J,SAAnD,EAA8D,KAA9D;AACH,GA70CU;AA+0CX9N,EAAAA,uBAAuB,EAAE,iCAAUoD,CAAV,EAAa;AAClCA,IAAAA,CAAC,CAACC,eAAF;AACA,QAAM8K,MAAM,GAAG/K,CAAC,CAAC+K,MAAF,CAASY,YAAT,CAAsB,cAAtB,IAAwC3L,CAAC,CAAC+K,MAA1C,GAAmD/K,CAAC,CAAC+K,MAAF,CAAS5H,UAA3E;AAEA,QAAI4H,MAAM,CAACY,YAAP,CAAoB,UAApB,CAAJ,EAAqC;AAErC,QAAMC,OAAO,GAAGb,MAAM,CAACY,YAAP,CAAoB,cAApB,CAAhB;AACA,QAAME,KAAK,GAAGd,MAAM,CAACY,YAAP,CAAoB,YAApB,CAAd;AACA,QAAM7G,MAAM,GAAGiG,MAAM,CAACY,YAAP,CAAoB,aAApB,CAAf;AACA,QAAM7K,WAAW,GAAG,KAAK9B,OAAL,CAAa5F,KAAjC;;AAEA,QAAI,OAAO0H,WAAW,CAACuG,eAAnB,KAAuC,UAA3C,EAAuD;AACnDvG,MAAAA,WAAW,CAACuG,eAAZ;;AACA,UAAIuE,OAAO,KAAK,SAAhB,EAA2B;AAC9B;;AAED,QAAI,CAACA,OAAL,EAAc;AAEd5L,IAAAA,CAAC,CAAC8L,cAAF;AACA,QAAM3S,YAAY,GAAG,KAAKD,OAAL,CAAaE,KAAlC;;AAEA,YAAQwS,OAAR;AACI,WAAK,QAAL;AACA,WAAK,QAAL;AACI9K,QAAAA,WAAW,CAAC8D,SAAZ,CAAsBxF,IAAtB,CAA2B,IAA3B,EAAiCyM,KAAjC,EAAwC/G,MAAxC;AACA;;AACJ,WAAK,QAAL;AACIhE,QAAAA,WAAW,CAACuI,YAAZ,CAAyBjK,IAAzB,CAA8B,IAA9B;AACA;;AACJ,WAAK,SAAL;AACI0B,QAAAA,WAAW,CAACwG,aAAZ,CAA0BlI,IAA1B,CAA+B,IAA/B;AACA;;AACJ,WAAK,OAAL;AACI0B,QAAAA,WAAW,CAACnC,UAAZ,CAAuBS,IAAvB,CAA4B,IAA5B,EAAkCyM,KAAlC;AACA;;AACJ,WAAK,OAAL;AACI/K,QAAAA,WAAW,CAAC3C,UAAZ,CAAuBiB,IAAvB,CAA4B,IAA5B;AACA;;AACJ,WAAK,QAAL;AACIjG,QAAAA,YAAY,CAACO,SAAb,GAAyB,CAACP,YAAY,CAACO,SAAvC;AACAoH,QAAAA,WAAW,CAACyB,aAAZ,CAA0BnD,IAA1B,CAA+B,IAA/B,EAAqC,OAArC;AACA0B,QAAAA,WAAW,CAAC0B,wBAAZ,CAAqCpD,IAArC,CAA0C,IAA1C,EAAgDjG,YAAY,CAACE,QAA7D;AACAyH,QAAAA,WAAW,CAAC2B,wBAAZ,CAAqCrD,IAArC,CAA0C,IAA1C,EAAgDjG,YAAY,CAACG,UAA7D,EAAyEwH,WAAW,CAACU,MAArF;AACA;;AACJ,WAAK,QAAL;AACIrI,QAAAA,YAAY,CAACQ,YAAb,GAA4B,CAACR,YAAY,CAACQ,YAA1C;AACAmH,QAAAA,WAAW,CAACyB,aAAZ,CAA0BnD,IAA1B,CAA+B,IAA/B,EAAqC,QAArC;AACA0B,QAAAA,WAAW,CAAC0B,wBAAZ,CAAqCpD,IAArC,CAA0C,IAA1C,EAAgDjG,YAAY,CAACE,QAA7D;AACAyH,QAAAA,WAAW,CAAC2B,wBAAZ,CAAqCrD,IAArC,CAA0C,IAA1C,EAAgDjG,YAAY,CAACG,UAA7D,EAAyEwH,WAAW,CAACU,MAArF;AACA;;AACJ,WAAK,QAAL;AACI,YAAMuK,QAAQ,GAAG5S,YAAY,CAACE,QAAb,CAAsB8J,UAAvC;AACA,aAAKlG,IAAL,CAAUwI,UAAV,CAAqBtM,YAAY,CAACE,QAAlC;AACA,aAAK6I,cAAL;AAEA,YAAI6J,QAAQ,KAAK,KAAK7S,OAAL,CAAa4D,OAAb,CAAqB0N,OAAtC,EAA+C,KAAKvN,IAAL,CAAU+O,oBAAV,CAA+BD,QAA/B,EAAyC,UAAUE,OAAV,EAAmB;AAAE,iBAAOA,OAAO,CAACC,UAAR,CAAmB7K,MAAnB,KAA8B,CAArC;AAAyC,SAAvG,EAAyG,IAAzG;AAC/C,aAAK8K,KAAL;AAnCR,KArBkC,CA2DlC;;;AACA,SAAKC,OAAL,CAAa7H,IAAb,CAAkB,KAAlB;AACH;AA54CU,CAAf","sourcesContent":["/*\r\n * wysiwyg web editor\r\n *\r\n * suneditor.js\r\n * Copyright 2017 JiHong Lee.\r\n * MIT license.\r\n */\r\n'use strict';\r\n\r\nexport default {\r\n    name: 'table',\r\n    display: 'submenu',\r\n    add: function (core, targetElement) {\r\n        const context = core.context;\r\n        let contextTable = context.table = {\r\n            _element: null,\r\n            _tdElement: null,\r\n            _trElement: null,\r\n            _trElements: null,\r\n            _tableXY: [],\r\n            _maxWidth: true,\r\n            _fixedColumn: false,\r\n            _rtl: core.options.rtl,\r\n            cellControllerTop: core.options.tableCellControllerPosition === 'top',\r\n            resizeText: null,\r\n            headerButton: null,\r\n            mergeButton: null,\r\n            splitButton: null,\r\n            splitMenu: null,\r\n            maxText: core.lang.controller.maxSize,\r\n            minText: core.lang.controller.minSize,\r\n            _physical_cellCnt: 0,\r\n            _logical_cellCnt: 0,\r\n            _rowCnt: 0,\r\n            _rowIndex: 0,\r\n            _physical_cellIndex: 0,\r\n            _logical_cellIndex: 0,\r\n            _current_colSpan: 0,\r\n            _current_rowSpan: 0,\r\n            icons: {\r\n                expansion: core.icons.expansion,\r\n                reduction: core.icons.reduction\r\n            }\r\n        };\r\n\r\n        /** set submenu */\r\n        let listDiv = this.setSubmenu(core);\r\n        let tablePicker = listDiv.querySelector('.se-controller-table-picker');\r\n\r\n        contextTable.tableHighlight = listDiv.querySelector('.se-table-size-highlighted');\r\n        contextTable.tableUnHighlight = listDiv.querySelector('.se-table-size-unhighlighted');\r\n        contextTable.tableDisplay = listDiv.querySelector('.se-table-size-display');\r\n        if (core.options.rtl) contextTable.tableHighlight.style.left = (10 * 18 - 13) + 'px';\r\n\r\n        /** set table controller */\r\n        let tableController = this.setController_table(core);\r\n        contextTable.tableController = tableController;\r\n        contextTable.resizeButton = tableController.querySelector('._se_table_resize');\r\n        contextTable.resizeText = tableController.querySelector('._se_table_resize > span > span');\r\n        contextTable.columnFixedButton = tableController.querySelector('._se_table_fixed_column');\r\n        contextTable.headerButton = tableController.querySelector('._se_table_header');\r\n\r\n        /** set resizing */\r\n        let resizeDiv = this.setController_tableEditor(core, contextTable.cellControllerTop);\r\n        contextTable.resizeDiv = resizeDiv;\r\n        contextTable.splitMenu = resizeDiv.querySelector('.se-btn-group-sub');\r\n        contextTable.mergeButton = resizeDiv.querySelector('._se_table_merge_button');\r\n        contextTable.splitButton = resizeDiv.querySelector('._se_table_split_button');\r\n        contextTable.insertRowAboveButton = resizeDiv.querySelector('._se_table_insert_row_a');\r\n        contextTable.insertRowBelowButton = resizeDiv.querySelector('._se_table_insert_row_b');\r\n        \r\n        /** add event listeners */\r\n        tablePicker.addEventListener('mousemove', this.onMouseMove_tablePicker.bind(core, contextTable));\r\n        tablePicker.addEventListener('click', this.appendTable.bind(core));\r\n        resizeDiv.addEventListener('click', this.onClick_tableController.bind(core));\r\n        tableController.addEventListener('click', this.onClick_tableController.bind(core));\r\n\r\n        /** append target button menu */\r\n        core.initMenuTarget(this.name, targetElement, listDiv);\r\n\r\n        /** append controller */\r\n        context.element.relative.appendChild(resizeDiv);\r\n        context.element.relative.appendChild(tableController);\r\n\r\n        /** empty memory */\r\n        listDiv = null, tablePicker = null, resizeDiv = null, tableController = null, contextTable = null;\r\n    },\r\n\r\n    setSubmenu: function (core) {\r\n        const listDiv = core.util.createElement('DIV');\r\n        listDiv.className = 'se-submenu se-selector-table';\r\n        listDiv.innerHTML = '' +\r\n            '<div class=\"se-table-size\">' +\r\n                '<div class=\"se-table-size-picker se-controller-table-picker\"></div>' +\r\n                '<div class=\"se-table-size-highlighted\"></div>' +\r\n                '<div class=\"se-table-size-unhighlighted\"></div>' +\r\n            '</div>' +\r\n            '<div class=\"se-table-size-display\">1 x 1</div>';\r\n\r\n        return listDiv;\r\n    },\r\n\r\n    setController_table: function (core) {\r\n        const lang = core.lang;\r\n        const icons = core.icons;\r\n        const tableResize = core.util.createElement('DIV');\r\n\r\n        tableResize.className = 'se-controller se-controller-table';\r\n        tableResize.innerHTML = '' +\r\n            '<div>' +\r\n                '<div class=\"se-btn-group\">' +\r\n                    '<button type=\"button\" data-command=\"resize\" class=\"se-btn se-tooltip _se_table_resize\">' +\r\n                        icons.expansion +\r\n                        '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.maxSize + '</span></span>' +\r\n                    '</button>' +\r\n                    '<button type=\"button\" data-command=\"layout\" class=\"se-btn se-tooltip _se_table_fixed_column\">' +\r\n                        icons.fixed_column_width +\r\n                        '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.fixedColumnWidth + '</span></span>' +\r\n                    '</button>' +\r\n                    '<button type=\"button\" data-command=\"header\" class=\"se-btn se-tooltip _se_table_header\">' +\r\n                        icons.table_header +\r\n                        '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.tableHeader + '</span></span>' +\r\n                    '</button>' +\r\n                    '<button type=\"button\" data-command=\"remove\" class=\"se-btn se-tooltip\">' +\r\n                        icons.delete +\r\n                        '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.remove + '</span></span>' +\r\n                    '</button>' +\r\n                '</div>' +\r\n            '</div>';\r\n\r\n        return tableResize;\r\n    },\r\n\r\n    setController_tableEditor: function (core, cellControllerTop) {\r\n        const lang = core.lang;\r\n        const icons = core.icons;\r\n        const tableResize = core.util.createElement('DIV');\r\n\r\n        tableResize.className = 'se-controller se-controller-table-cell';\r\n        tableResize.innerHTML = (cellControllerTop ? '' : '<div class=\"se-arrow se-arrow-up\"></div>') +\r\n            '<div class=\"se-btn-group\">' +\r\n                '<button type=\"button\" data-command=\"insert\" data-value=\"row\" data-option=\"up\" class=\"se-btn se-tooltip _se_table_insert_row_a\">' +\r\n                    icons.insert_row_above +\r\n                    '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.insertRowAbove + '</span></span>' +\r\n                '</button>' +\r\n                '<button type=\"button\" data-command=\"insert\" data-value=\"row\" data-option=\"down\" class=\"se-btn se-tooltip _se_table_insert_row_b\">' +\r\n                    icons.insert_row_below +\r\n                    '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.insertRowBelow + '</span></span>' +\r\n                '</button>' +\r\n                '<button type=\"button\" data-command=\"delete\" data-value=\"row\" class=\"se-btn se-tooltip\">' +\r\n                    icons.delete_row +\r\n                    '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.deleteRow + '</span></span>' +\r\n                '</button>' +\r\n                '<button type=\"button\" data-command=\"merge\" class=\"_se_table_merge_button se-btn se-tooltip\" disabled>' +\r\n                    icons.merge_cell +\r\n                    '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.mergeCells + '</span></span>' +\r\n                '</button>' +\r\n            '</div>' +\r\n            '<div class=\"se-btn-group\" style=\"padding-top: 0;\">' +\r\n                '<button type=\"button\" data-command=\"insert\" data-value=\"cell\" data-option=\"left\" class=\"se-btn se-tooltip\">' +\r\n                    icons.insert_column_left +\r\n                    '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.insertColumnBefore + '</span></span>' +\r\n                '</button>' +\r\n                '<button type=\"button\" data-command=\"insert\" data-value=\"cell\" data-option=\"right\" class=\"se-btn se-tooltip\">' +\r\n                    icons.insert_column_right +\r\n                    '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.insertColumnAfter + '</span></span>' +\r\n                '</button>' +\r\n                '<button type=\"button\" data-command=\"delete\" data-value=\"cell\" class=\"se-btn se-tooltip\">' +\r\n                    icons.delete_column +\r\n                    '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.deleteColumn + '</span></span>' +\r\n                '</button>' +\r\n                '<button type=\"button\" data-command=\"onsplit\" class=\"_se_table_split_button se-btn se-tooltip\">' +\r\n                    icons.split_cell +\r\n                    '<span class=\"se-tooltip-inner\"><span class=\"se-tooltip-text\">' + lang.controller.splitCells + '</span></span>' +\r\n                '</button>' +\r\n                '<div class=\"se-btn-group-sub sun-editor-common se-list-layer se-table-split\">' +\r\n                    '<div class=\"se-list-inner\">' +\r\n                        '<ul class=\"se-list-basic\">' +\r\n                            '<li class=\"se-btn-list\" data-command=\"split\" data-value=\"vertical\" style=\"line-height:32px;\" title=\"' + lang.controller.VerticalSplit + '\">' + \r\n                                lang.controller.VerticalSplit + '</li>' +\r\n                            '<li class=\"se-btn-list\" data-command=\"split\" data-value=\"horizontal\" style=\"line-height:32px;\" title=\"' + lang.controller.HorizontalSplit + '\">' + \r\n                                lang.controller.HorizontalSplit + '</li>' +\r\n                        '</ul>' +\r\n                    '</div>' +\r\n                '</div>' +\r\n            '</div>';\r\n\r\n        return tableResize;\r\n    },\r\n\r\n    appendTable: function () {\r\n        const oTable = this.util.createElement('TABLE');\r\n        const createCells = this.plugins.table.createCells;\r\n\r\n        const x = this.context.table._tableXY[0];\r\n        let y = this.context.table._tableXY[1];\r\n        let tableHTML = '<tbody>';\r\n        while (y > 0) {\r\n            tableHTML += '<tr>' + createCells.call(this, 'td', x) + '</tr>';\r\n            --y;\r\n        }\r\n        tableHTML += '</tbody>';\r\n        oTable.innerHTML = tableHTML;\r\n\r\n        const changed = this.insertComponent(oTable, false, true, false);\r\n        \r\n        if (changed) {\r\n            const firstTd = oTable.querySelector('td div');\r\n            this.setRange(firstTd, 0, firstTd, 0);\r\n            this.plugins.table.reset_table_picker.call(this);\r\n        }\r\n    },\r\n\r\n    createCells: function (nodeName, cnt, returnElement) {\r\n        nodeName = nodeName.toLowerCase();\r\n\r\n        if (!returnElement) {\r\n            let cellsHTML = '';\r\n            while (cnt > 0) {\r\n                cellsHTML += '<' +nodeName + '><div><br></div></' + nodeName + '>';\r\n                cnt--;\r\n            }\r\n            return cellsHTML;\r\n        } else {\r\n            const cell = this.util.createElement(nodeName);\r\n            cell.innerHTML = '<div><br></div>';\r\n            return cell;\r\n        }\r\n    },\r\n\r\n    onMouseMove_tablePicker: function (contextTable, e) {\r\n        e.stopPropagation();\r\n\r\n        let x = this._w.Math.ceil(e.offsetX / 18);\r\n        let y = this._w.Math.ceil(e.offsetY / 18);\r\n        x = x < 1 ? 1 : x;\r\n        y = y < 1 ? 1 : y;\r\n        \r\n        if (contextTable._rtl) {\r\n            contextTable.tableHighlight.style.left = (x * 18 - 13) + 'px';\r\n            x = 11 - x;\r\n        }\r\n        \r\n        contextTable.tableHighlight.style.width = x + 'em';\r\n        contextTable.tableHighlight.style.height = y + 'em';\r\n\r\n        // let x_u = x < 5 ? 5 : (x > 9 ? 10 : x + 1);\r\n        // let y_u = y < 5 ? 5 : (y > 9 ? 10 : y + 1);\r\n        // contextTable.tableUnHighlight.style.width = x_u + 'em';\r\n        // contextTable.tableUnHighlight.style.height = y_u + 'em';\r\n\r\n        this.util.changeTxt(contextTable.tableDisplay, x + ' x ' + y);\r\n        contextTable._tableXY = [x, y];\r\n    },\r\n\r\n    reset_table_picker: function () {\r\n        if (!this.context.table.tableHighlight) return;\r\n\r\n        const highlight = this.context.table.tableHighlight.style;\r\n        const unHighlight = this.context.table.tableUnHighlight.style;\r\n\r\n        highlight.width = '1em';\r\n        highlight.height = '1em';\r\n        unHighlight.width = '10em';\r\n        unHighlight.height = '10em';\r\n\r\n        this.util.changeTxt(this.context.table.tableDisplay, '1 x 1');\r\n        this.submenuOff();\r\n    },\r\n\r\n    init: function () {\r\n        const contextTable = this.context.table;\r\n        const tablePlugin = this.plugins.table;\r\n\r\n        tablePlugin._removeEvents.call(this);\r\n\r\n        if (tablePlugin._selectedTable) {\r\n            const selectedCells = tablePlugin._selectedTable.querySelectorAll('.se-table-selected-cell');\r\n            for (let i = 0, len = selectedCells.length; i < len; i++) {\r\n                this.util.removeClass(selectedCells[i], 'se-table-selected-cell');\r\n            }\r\n        }\r\n\r\n        tablePlugin._toggleEditor.call(this, true);\r\n\r\n        contextTable._element = null;\r\n        contextTable._tdElement = null;\r\n        contextTable._trElement = null;\r\n        contextTable._trElements = null;\r\n        contextTable._tableXY = [];\r\n        contextTable._maxWidth = true;\r\n        contextTable._fixedColumn = false;\r\n        contextTable._physical_cellCnt = 0;\r\n        contextTable._logical_cellCnt = 0;\r\n        contextTable._rowCnt = 0;\r\n        contextTable._rowIndex = 0;\r\n        contextTable._physical_cellIndex = 0;\r\n        contextTable._logical_cellIndex = 0;\r\n        contextTable._current_colSpan = 0;\r\n        contextTable._current_rowSpan = 0;\r\n\r\n        tablePlugin._shift = false;\r\n        tablePlugin._selectedCells = null;\r\n        tablePlugin._selectedTable = null;\r\n        tablePlugin._ref = null;\r\n\r\n        tablePlugin._fixedCell = null;\r\n        tablePlugin._selectedCell = null;\r\n        tablePlugin._fixedCellName = null;\r\n    },\r\n\r\n    /** table edit controller */\r\n    call_controller_tableEdit: function (tdElement) {\r\n        const tablePlugin = this.plugins.table;\r\n        const contextTable = this.context.table;\r\n\r\n        if (!this.getSelection().isCollapsed && !tablePlugin._selectedCell) {\r\n            this.controllersOff();\r\n            this.util.removeClass(tdElement, 'se-table-selected-cell');\r\n            return;\r\n        }\r\n\r\n        const tableElement = contextTable._element || this.plugins.table._selectedTable || this.util.getParentElement(tdElement, 'TABLE');\r\n        contextTable._maxWidth = this.util.hasClass(tableElement, 'se-table-size-100') || tableElement.style.width === '100%' || (!tableElement.style.width && !this.util.hasClass(tableElement, 'se-table-size-auto'));\r\n        contextTable._fixedColumn = this.util.hasClass(tableElement, 'se-table-layout-fixed') || tableElement.style.tableLayout === 'fixed';\r\n        tablePlugin.setTableStyle.call(this, contextTable._maxWidth ? 'width|column' : 'width');\r\n        \r\n        tablePlugin.setPositionControllerTop.call(this, tableElement);\r\n        tablePlugin.setPositionControllerDiv.call(this, tdElement, tablePlugin._shift);\r\n        \r\n        if (!tablePlugin._shift) this.controllersOn(contextTable.resizeDiv, contextTable.tableController, tablePlugin.init.bind(this), tdElement, 'table');\r\n    },\r\n\r\n    setPositionControllerTop: function (tableElement) {\r\n        this.setControllerPosition(this.context.table.tableController, tableElement, 'top', {left: 0, top: 0});\r\n    },\r\n\r\n    setPositionControllerDiv: function (tdElement, reset) {\r\n        const contextTable = this.context.table;\r\n        const resizeDiv = contextTable.resizeDiv;\r\n        \r\n        this.plugins.table.setCellInfo.call(this, tdElement, reset);\r\n        \r\n        if (contextTable.cellControllerTop) {\r\n            this.setControllerPosition(resizeDiv, contextTable._element, 'top', {left: contextTable.tableController.offsetWidth, top: 0});\r\n        } else {\r\n            this.setControllerPosition(resizeDiv, tdElement, 'bottom', {left: 0, top: 0});\r\n        }\r\n    },\r\n\r\n    setCellInfo: function (tdElement, reset) {\r\n        const contextTable = this.context.table;\r\n        const table = contextTable._element = this.plugins.table._selectedTable || this.util.getParentElement(tdElement, 'TABLE');\r\n\r\n        if (/THEAD/i.test(table.firstElementChild.nodeName)) {\r\n            this.util.addClass(contextTable.headerButton, 'active');\r\n        } else {\r\n            this.util.removeClass(contextTable.headerButton, 'active');\r\n        }\r\n\r\n        if (reset || contextTable._physical_cellCnt === 0) {\r\n            if (contextTable._tdElement !== tdElement) {\r\n                contextTable._tdElement = tdElement;\r\n                contextTable._trElement = tdElement.parentNode;\r\n            }\r\n\r\n            const rows = contextTable._trElements = table.rows;\r\n            const cellIndex = tdElement.cellIndex;\r\n\r\n            let cellCnt = 0;\r\n            for (let i = 0, cells = rows[0].cells, len = rows[0].cells.length; i < len; i++) {\r\n                cellCnt += cells[i].colSpan;\r\n            }\r\n\r\n            // row cnt, row index\r\n            const rowIndex = contextTable._rowIndex = contextTable._trElement.rowIndex;\r\n            contextTable._rowCnt = rows.length;\r\n\r\n            // cell cnt, physical cell index\r\n            contextTable._physical_cellCnt = contextTable._trElement.cells.length;\r\n            contextTable._logical_cellCnt = cellCnt;\r\n            contextTable._physical_cellIndex = cellIndex;\r\n\r\n            // span\r\n            contextTable._current_colSpan = contextTable._tdElement.colSpan - 1;\r\n            contextTable._current_rowSpan - contextTable._trElement.cells[cellIndex].rowSpan - 1;\r\n\r\n            // find logcal cell index\r\n            let rowSpanArr = [];\r\n            let spanIndex = [];\r\n            for (let i = 0, cells, colSpan; i <= rowIndex; i++) {\r\n                cells = rows[i].cells;\r\n                colSpan = 0;\r\n                for (let c = 0, cLen = cells.length, cell, cs, rs, logcalIndex; c < cLen; c++) {\r\n                    cell = cells[c];\r\n                    cs = cell.colSpan - 1;\r\n                    rs = cell.rowSpan - 1;\r\n                    logcalIndex = c + colSpan;\r\n\r\n                    if (spanIndex.length > 0) {\r\n                        for (let r = 0, arr; r < spanIndex.length; r++) {\r\n                            arr = spanIndex[r];\r\n                            if (arr.row > i) continue;\r\n                            if (logcalIndex >= arr.index) {\r\n                                colSpan += arr.cs;\r\n                                logcalIndex += arr.cs;\r\n                                arr.rs -= 1;\r\n                                arr.row = i + 1;\r\n                                if (arr.rs < 1) {\r\n                                    spanIndex.splice(r, 1);\r\n                                    r--;\r\n                                }  \r\n                            } else if (c === cLen - 1) {\r\n                                arr.rs -= 1;\r\n                                arr.row = i + 1;\r\n                                if (arr.rs < 1) {\r\n                                    spanIndex.splice(r, 1);\r\n                                    r--;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // logcal cell index\r\n                    if (i === rowIndex && c === cellIndex) {\r\n                        contextTable._logical_cellIndex = logcalIndex;\r\n                        break;\r\n                    }\r\n\r\n                    if (rs > 0) {\r\n                        rowSpanArr.push({\r\n                            index: logcalIndex,\r\n                            cs: cs + 1,\r\n                            rs: rs,\r\n                            row: -1\r\n                        });\r\n                    }\r\n                    \r\n                    colSpan += cs;\r\n                }\r\n\r\n                spanIndex = spanIndex.concat(rowSpanArr).sort(function (a, b) {return a.index - b.index;});\r\n                rowSpanArr = [];\r\n            }\r\n\r\n            rowSpanArr = null;\r\n            spanIndex = null;\r\n        }\r\n    },\r\n\r\n    editTable: function (type, option) {\r\n        const tablePlugin = this.plugins.table;\r\n        const contextTable = this.context.table;\r\n        const table = contextTable._element;\r\n        const isRow = type === 'row';\r\n\r\n        if (isRow) {\r\n            const tableAttr = contextTable._trElement.parentNode;\r\n            if (/^THEAD$/i.test(tableAttr.nodeName)) {\r\n                if (option === 'up') {\r\n                    return;\r\n                } else if (!tableAttr.nextElementSibling || !/^TBODY$/i.test(tableAttr.nextElementSibling.nodeName)) {\r\n                    table.innerHTML += '<tbody><tr>' + tablePlugin.createCells.call(this, 'td', contextTable._logical_cellCnt, false) + '</tr></tbody>';\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n\r\n        // multi\r\n        if (tablePlugin._ref) {\r\n            const positionCell = contextTable._tdElement;\r\n            const selectedCells = tablePlugin._selectedCells;\r\n            // multi - row\r\n            if (isRow) {\r\n                // remove row\r\n                if (!option) {\r\n                    let row = selectedCells[0].parentNode;\r\n                    const removeCells = [selectedCells[0]];\r\n\r\n                    for (let i = 1, len = selectedCells.length, cell; i < len; i++) {\r\n                        cell = selectedCells[i];\r\n                        if (row !== cell.parentNode) {\r\n                            removeCells.push(cell);\r\n                            row = cell.parentNode;\r\n                        }\r\n                    }\r\n\r\n                    for (let i = 0, len = removeCells.length; i < len; i++) {\r\n                        tablePlugin.setCellInfo.call(this, removeCells[i], true);\r\n                        tablePlugin.editRow.call(this, option);\r\n                    }\r\n                } else { // edit row\r\n                    tablePlugin.setCellInfo.call(this, option === 'up' ? selectedCells[0] : selectedCells[selectedCells.length - 1], true);\r\n                    tablePlugin.editRow.call(this, option, positionCell);\r\n                }\r\n            } else { // multi - cell\r\n                const firstRow = selectedCells[0].parentNode;\r\n                // remove cell\r\n                if (!option) {\r\n                    const removeCells = [selectedCells[0]];\r\n                    \r\n                    for (let i = 1, len = selectedCells.length, cell; i < len; i++) {\r\n                        cell = selectedCells[i];\r\n                        if (firstRow === cell.parentNode) {\r\n                            removeCells.push(cell);\r\n                        } else {\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    for (let i = 0, len = removeCells.length; i < len; i++) {\r\n                        tablePlugin.setCellInfo.call(this, removeCells[i], true);\r\n                        tablePlugin.editCell.call(this, option);\r\n                    }\r\n                } else { // edit cell\r\n                    let rightCell = null;\r\n\r\n                    for (let i = 0, len = selectedCells.length - 1; i < len; i++) {\r\n                        if (firstRow !== selectedCells[i + 1].parentNode) {\r\n                            rightCell = selectedCells[i];\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    tablePlugin.setCellInfo.call(this, option === 'left' ? selectedCells[0] : rightCell || selectedCells[0], true);\r\n                    tablePlugin.editCell.call(this, option, positionCell);\r\n                }\r\n            }\r\n\r\n            if (!option) tablePlugin.init.call(this);\r\n        } // one\r\n        else {\r\n            tablePlugin[isRow ? 'editRow' : 'editCell'].call(this, option);\r\n        }\r\n\r\n        // after remove\r\n        if (!option) {\r\n            const children = table.children;\r\n            for (let i = 0; i < children.length; i++) {\r\n                if (children[i].children.length === 0) {\r\n                    this.util.removeItem(children[i]);\r\n                    i--;\r\n                }\r\n            }\r\n\r\n            if (table.children.length === 0) this.util.removeItem(table);\r\n        }\r\n    },\r\n\r\n    editRow: function (option, positionResetElement) {\r\n        const contextTable = this.context.table;\r\n        const remove = !option;\r\n\r\n        const up = option === 'up';\r\n        const originRowIndex = contextTable._rowIndex;\r\n        const rowIndex = remove || up ? originRowIndex : originRowIndex + contextTable._current_rowSpan + 1;\r\n        const sign = remove ? -1 : 1;\r\n        \r\n        const rows = contextTable._trElements;\r\n        let cellCnt = contextTable._logical_cellCnt;\r\n\r\n        for (let i = 0, len = originRowIndex + (remove ? -1 : 0), cell; i <= len; i++) {\r\n            cell = rows[i].cells;\r\n            if (cell.length === 0) return;\r\n            \r\n            for (let c = 0, cLen = cell.length, rs, cs; c < cLen; c++) {\r\n                rs = cell[c].rowSpan;\r\n                cs = cell[c].colSpan;\r\n                if (rs < 2 && cs < 2) continue;\r\n\r\n                if (rs + i > rowIndex && rowIndex > i) {\r\n                    cell[c].rowSpan = rs + sign;\r\n                    cellCnt -= cs;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (remove) {\r\n            const next = rows[originRowIndex + 1];\r\n            if (next) {\r\n                const spanCells = [];\r\n                let cells = rows[originRowIndex].cells;\r\n                let colSpan = 0;\r\n\r\n                for (let i = 0, len = cells.length, cell, logcalIndex; i < len; i++) {\r\n                    cell = cells[i];\r\n                    logcalIndex = i + colSpan;\r\n                    colSpan += cell.colSpan - 1;\r\n\r\n                    if (cell.rowSpan > 1) {\r\n                        cell.rowSpan -= 1;\r\n                        spanCells.push({cell: cell.cloneNode(false), index: logcalIndex});\r\n                    }\r\n                }\r\n\r\n                if (spanCells.length > 0) {\r\n                    let spanCell = spanCells.shift();\r\n                    cells = next.cells;\r\n                    colSpan = 0;\r\n\r\n                    for (let i = 0, len = cells.length, cell, logcalIndex; i < len; i++) {\r\n                        cell = cells[i];\r\n                        logcalIndex = i + colSpan;\r\n                        colSpan += cell.colSpan - 1;\r\n    \r\n                        if (logcalIndex >= spanCell.index) {\r\n                            i--, colSpan--;\r\n                            colSpan += spanCell.cell.colSpan - 1;\r\n                            next.insertBefore(spanCell.cell, cell);\r\n                            spanCell = spanCells.shift();\r\n                            if (!spanCell) break;\r\n                        }\r\n                    }\r\n\r\n                    if (spanCell) {\r\n                        next.appendChild(spanCell.cell);\r\n                        for (let i = 0, len = spanCells.length; i < len; i++) {\r\n                            next.appendChild(spanCells[i].cell);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            contextTable._element.deleteRow(rowIndex);\r\n        } else {\r\n            const newRow = contextTable._element.insertRow(rowIndex);\r\n            newRow.innerHTML = this.plugins.table.createCells.call(this, 'td', cellCnt, false);\r\n        }\r\n\r\n        if (!remove) {\r\n            this.plugins.table.setPositionControllerDiv.call(this, positionResetElement || contextTable._tdElement, true);\r\n        } else {\r\n            this.controllersOff();\r\n        }\r\n    },\r\n\r\n    editCell: function (option, positionResetElement) {\r\n        const contextTable = this.context.table;\r\n        const util = this.util;\r\n        const remove = !option;\r\n\r\n        const left = option === 'left';\r\n        const colSpan = contextTable._current_colSpan;\r\n        const cellIndex = remove || left ? contextTable._logical_cellIndex : contextTable._logical_cellIndex + colSpan + 1;\r\n\r\n        const rows = contextTable._trElements;\r\n        let rowSpanArr = [];\r\n        let spanIndex = [];\r\n        let passCell = 0;\r\n        const removeCell = [];\r\n        const removeSpanArr = [];\r\n\r\n        for (let i = 0, len = contextTable._rowCnt, row, insertIndex, cells, newCell, applySpan, cellColSpan; i < len; i++) {\r\n            row = rows[i];\r\n            insertIndex = cellIndex;\r\n            applySpan = false;\r\n            cells = row.cells;\r\n            cellColSpan = 0;\r\n\r\n            for (let c = 0, cell, cLen = cells.length, rs, cs, removeIndex; c < cLen; c++) {\r\n                cell = cells[c];\r\n                if (!cell) break;\r\n\r\n                rs = cell.rowSpan - 1;\r\n                cs = cell.colSpan - 1;\r\n\r\n                if (!remove) {\r\n                    if (c >= insertIndex) break;\r\n                    if (cs > 0) {\r\n                        if (passCell < 1 && cs + c >= insertIndex) {\r\n                            cell.colSpan += 1;\r\n                            insertIndex = null;\r\n                            passCell = rs + 1;\r\n                            break;\r\n                        }\r\n\r\n                        insertIndex -= cs;\r\n                    }\r\n\r\n                    if (!applySpan) {\r\n                        for (let r = 0, arr; r < spanIndex.length; r++) {\r\n                            arr = spanIndex[r];\r\n                            insertIndex -= arr.cs;\r\n                            arr.rs -= 1;\r\n                            if (arr.rs < 1) {\r\n                                spanIndex.splice(r, 1);\r\n                                r--;\r\n                            }  \r\n                        }\r\n                        applySpan = true;\r\n                    }\r\n                } else {\r\n                    removeIndex = c + cellColSpan;\r\n\r\n                    if (spanIndex.length > 0) {\r\n                        const lastCell = !cells[c + 1];\r\n                        for (let r = 0, arr; r < spanIndex.length; r++) {\r\n                            arr = spanIndex[r];\r\n                            if (arr.row > i) continue;\r\n\r\n                            if (removeIndex >= arr.index) {\r\n                                cellColSpan += arr.cs;\r\n                                removeIndex = c + cellColSpan;\r\n                                arr.rs -= 1;\r\n                                arr.row = i + 1;\r\n                                if (arr.rs < 1) {\r\n                                    spanIndex.splice(r, 1);\r\n                                    r--;\r\n                                }  \r\n                            } else if (lastCell) {\r\n                                arr.rs -= 1;\r\n                                arr.row = i + 1;\r\n                                if (arr.rs < 1) {\r\n                                    spanIndex.splice(r, 1);\r\n                                    r--;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (rs > 0) {\r\n                        rowSpanArr.push({\r\n                            rs: rs,\r\n                            cs: cs + 1,\r\n                            index: removeIndex,\r\n                            row: -1\r\n                        });\r\n                    }\r\n\r\n                    if (removeIndex >= insertIndex && removeIndex + cs <= insertIndex + colSpan) {\r\n                        removeCell.push(cell);\r\n                    } else if (removeIndex <= insertIndex + colSpan && removeIndex + cs >= insertIndex) {\r\n                        cell.colSpan -= util.getOverlapRangeAtIndex(cellIndex, cellIndex + colSpan, removeIndex, removeIndex + cs); \r\n                    } else if (rs > 0 && (removeIndex < insertIndex || removeIndex + cs > insertIndex + colSpan)) {\r\n                        removeSpanArr.push({\r\n                            cell: cell,\r\n                            i: i,\r\n                            rs: i + rs\r\n                        });\r\n                    }\r\n\r\n                    cellColSpan += cs;\r\n                }\r\n            }\r\n\r\n            spanIndex = spanIndex.concat(rowSpanArr).sort(function (a, b) {return a.index - b.index;});\r\n            rowSpanArr = [];\r\n\r\n            if (!remove) {\r\n                if (passCell > 0) {\r\n                    passCell -= 1;\r\n                    continue;\r\n                }\r\n\r\n                if (insertIndex !== null && cells.length > 0) {\r\n                    newCell = this.plugins.table.createCells.call(this, cells[0].nodeName, 0, true);\r\n                    newCell = row.insertBefore(newCell, cells[insertIndex]);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (remove) {\r\n            let removeFirst, removeEnd;\r\n            for (let r = 0, rLen = removeCell.length, row; r < rLen; r++) {\r\n                row = removeCell[r].parentNode;\r\n                util.removeItem(removeCell[r]);\r\n                if (row.cells.length === 0) {\r\n                    if (!removeFirst) removeFirst = util.getArrayIndex(rows, row);\r\n                    removeEnd = util.getArrayIndex(rows, row);\r\n                    util.removeItem(row);\r\n                }\r\n            }\r\n\r\n            for (let c = 0, cLen = removeSpanArr.length, rowSpanCell; c < cLen; c++) {\r\n                rowSpanCell = removeSpanArr[c];\r\n                rowSpanCell.cell.rowSpan = util.getOverlapRangeAtIndex(removeFirst, removeEnd, rowSpanCell.i, rowSpanCell.rs);\r\n            }\r\n\r\n            this.controllersOff();\r\n        } else {\r\n            this.plugins.table.setPositionControllerDiv.call(this, positionResetElement || contextTable._tdElement, true);\r\n        }\r\n    },\r\n\r\n    _closeSplitMenu: null,\r\n    openSplitMenu: function () {\r\n        this.util.addClass(this.context.table.splitButton, 'on');\r\n        this.context.table.splitMenu.style.display = 'inline-table';\r\n\r\n        this.plugins.table._closeSplitMenu = function () {\r\n            this.util.removeClass(this.context.table.splitButton, 'on');\r\n            this.context.table.splitMenu.style.display = 'none';\r\n            this.removeDocEvent('click', this.plugins.table._closeSplitMenu);\r\n            this.plugins.table._closeSplitMenu = null;\r\n        }.bind(this);\r\n\r\n        this.addDocEvent('click', this.plugins.table._closeSplitMenu);\r\n    },\r\n\r\n    splitCells: function (direction) {\r\n        const util = this.util;\r\n        const vertical = direction === 'vertical';\r\n        const contextTable = this.context.table;\r\n        const currentCell = contextTable._tdElement;\r\n        const rows = contextTable._trElements;\r\n        const currentRow = contextTable._trElement;\r\n        const index = contextTable._logical_cellIndex;\r\n        const rowIndex = contextTable._rowIndex;\r\n        const newCell = this.plugins.table.createCells.call(this, currentCell.nodeName, 0, true);\r\n\r\n        // vertical\r\n        if (vertical) {\r\n            const currentColSpan = currentCell.colSpan;\r\n            newCell.rowSpan = currentCell.rowSpan;\r\n\r\n            // colspan > 1\r\n            if (currentColSpan > 1) {\r\n                newCell.colSpan = this._w.Math.floor(currentColSpan/2);\r\n                currentCell.colSpan = currentColSpan - newCell.colSpan;\r\n                currentRow.insertBefore(newCell, currentCell.nextElementSibling);\r\n            } else { // colspan - 1\r\n                let rowSpanArr = [];\r\n                let spanIndex = [];\r\n\r\n                for (let i = 0, len = contextTable._rowCnt, cells, colSpan; i < len; i++) {\r\n                    cells = rows[i].cells;\r\n                    colSpan = 0;\r\n                    for (let c = 0, cLen = cells.length, cell, cs, rs, logcalIndex; c < cLen; c++) {\r\n                        cell = cells[c];\r\n                        cs = cell.colSpan - 1;\r\n                        rs = cell.rowSpan - 1;\r\n                        logcalIndex = c + colSpan;\r\n\r\n                        if (spanIndex.length > 0) {\r\n                            for (let r = 0, arr; r < spanIndex.length; r++) {\r\n                                arr = spanIndex[r];\r\n                                if (arr.row > i) continue;\r\n                                if (logcalIndex >= arr.index) {\r\n                                    colSpan += arr.cs;\r\n                                    logcalIndex += arr.cs;\r\n                                    arr.rs -= 1;\r\n                                    arr.row = i + 1;\r\n                                    if (arr.rs < 1) {\r\n                                        spanIndex.splice(r, 1);\r\n                                        r--;\r\n                                    }  \r\n                                } else if (c === cLen - 1) {\r\n                                    arr.rs -= 1;\r\n                                    arr.row = i + 1;\r\n                                    if (arr.rs < 1) {\r\n                                        spanIndex.splice(r, 1);\r\n                                        r--;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        if (logcalIndex <= index && rs > 0) {\r\n                            rowSpanArr.push({\r\n                                index: logcalIndex,\r\n                                cs: cs + 1,\r\n                                rs: rs,\r\n                                row: -1\r\n                            });\r\n                        }\r\n\r\n                        if (cell !== currentCell && logcalIndex <= index && logcalIndex + cs >= index + currentColSpan - 1) {\r\n                            cell.colSpan += 1;\r\n                            break;\r\n                        }\r\n\r\n                        if (logcalIndex > index) break;\r\n                        \r\n                        colSpan += cs;\r\n                    }\r\n\r\n                    spanIndex = spanIndex.concat(rowSpanArr).sort(function (a, b) {return a.index - b.index;});\r\n                    rowSpanArr = [];\r\n                }\r\n\r\n                currentRow.insertBefore(newCell, currentCell.nextElementSibling);\r\n            }\r\n        } else { // horizontal\r\n            const currentRowSpan = currentCell.rowSpan;\r\n            newCell.colSpan = currentCell.colSpan;\r\n\r\n            // rowspan > 1\r\n            if (currentRowSpan > 1) {\r\n                newCell.rowSpan = this._w.Math.floor(currentRowSpan/2);\r\n                const newRowSpan = currentRowSpan - newCell.rowSpan;\r\n\r\n                const rowSpanArr = [];\r\n                const nextRowIndex = util.getArrayIndex(rows, currentRow) + newRowSpan;\r\n\r\n                for (let i = 0, cells, colSpan; i < nextRowIndex; i++) {\r\n                    cells = rows[i].cells;\r\n                    colSpan = 0;\r\n                    for (let c = 0, cLen = cells.length, cell, cs, logcalIndex; c < cLen; c++) {\r\n                        logcalIndex = c + colSpan;\r\n                        if (logcalIndex >= index) break;\r\n\r\n                        cell = cells[c];\r\n                        cs = cell.rowSpan - 1;\r\n                        if (cs > 0 && cs + i >= nextRowIndex && logcalIndex < index) {\r\n                            rowSpanArr.push({\r\n                                index: logcalIndex,\r\n                                cs: cell.colSpan\r\n                            });\r\n                        }\r\n                        colSpan += cell.colSpan - 1;\r\n                    }\r\n                }\r\n\r\n                const nextRow = rows[nextRowIndex];\r\n                const nextCells = nextRow.cells;\r\n                let rs = rowSpanArr.shift();\r\n\r\n                for (let c = 0, cLen = nextCells.length, colSpan = 0, cell, cs, logcalIndex, insertIndex; c < cLen; c++) {\r\n                    logcalIndex = c + colSpan;\r\n                    cell = nextCells[c];\r\n                    cs = cell.colSpan - 1;\r\n                    insertIndex = logcalIndex + cs + 1;\r\n\r\n                    if (rs && insertIndex >= rs.index) {\r\n                        colSpan += rs.cs;\r\n                        insertIndex += rs.cs;\r\n                        rs = rowSpanArr.shift();\r\n                    }\r\n                    \r\n                    if (insertIndex >= index || c === cLen - 1) {\r\n                        nextRow.insertBefore(newCell, cell.nextElementSibling);\r\n                        break;\r\n                    }\r\n\r\n                    colSpan += cs;\r\n                }\r\n\r\n                currentCell.rowSpan = newRowSpan;\r\n            } else { // rowspan - 1\r\n                newCell.rowSpan = currentCell.rowSpan;\r\n                const newRow = util.createElement('TR');\r\n                newRow.appendChild(newCell);\r\n\r\n                for (let i = 0, cells; i < rowIndex; i++) {\r\n                    cells = rows[i].cells;\r\n                    if (cells.length === 0) return;\r\n\r\n                    for (let c = 0, cLen = cells.length; c < cLen; c++) {\r\n                        if (i + cells[c].rowSpan - 1 >= rowIndex) {\r\n                            cells[c].rowSpan += 1;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                const physicalIndex = contextTable._physical_cellIndex;\r\n                const cells = currentRow.cells;\r\n\r\n                for (let c = 0, cLen = cells.length; c < cLen; c++) {\r\n                    if (c === physicalIndex) continue;       \r\n                    cells[c].rowSpan += 1;                    \r\n                }\r\n\r\n                currentRow.parentNode.insertBefore(newRow, currentRow.nextElementSibling);\r\n            }\r\n        }\r\n\r\n        this.focusEdge(currentCell);\r\n        this.plugins.table.setPositionControllerDiv.call(this, currentCell, true);\r\n    },\r\n\r\n    mergeCells: function () {\r\n        const tablePlugin = this.plugins.table;\r\n        const contextTable = this.context.table;\r\n        const util = this.util;\r\n\r\n        const ref = tablePlugin._ref;\r\n        const selectedCells = tablePlugin._selectedCells;\r\n        const mergeCell = selectedCells[0];\r\n        \r\n        let emptyRowFirst = null;\r\n        let emptyRowLast = null;\r\n        let cs = (ref.ce - ref.cs) + 1;\r\n        let rs = (ref.re - ref.rs) + 1;\r\n        let mergeHTML = '';\r\n        let row = null;\r\n\r\n        for (let i = 1, len = selectedCells.length, cell, ch; i < len; i++) {\r\n            cell = selectedCells[i];\r\n            if (row !== cell.parentNode) row = cell.parentNode;\r\n\r\n            ch = cell.children;\r\n            for (let c = 0, cLen = ch.length; c < cLen; c++) {\r\n                if (util.isFormatElement(ch[c]) && util.onlyZeroWidthSpace(ch[c].textContent)) {\r\n                    util.removeItem(ch[c]);\r\n                }  \r\n            }\r\n\r\n            mergeHTML += cell.innerHTML;\r\n            util.removeItem(cell);\r\n\r\n            if (row.cells.length === 0) {\r\n                if (!emptyRowFirst) emptyRowFirst = row;\r\n                else emptyRowLast = row;\r\n                rs -= 1;\r\n            }\r\n        }\r\n\r\n        if (emptyRowFirst) {\r\n            const rows = contextTable._trElements;\r\n            const rowIndexFirst = util.getArrayIndex(rows, emptyRowFirst);\r\n            const rowIndexLast = util.getArrayIndex(rows, emptyRowLast || emptyRowFirst);\r\n            const removeRows = [];\r\n    \r\n            for (let i = 0, cells; i <= rowIndexLast; i++) {\r\n                cells = rows[i].cells;\r\n                if (cells.length === 0) {\r\n                    removeRows.push(rows[i]);\r\n                    continue;\r\n                }\r\n    \r\n                for (let c = 0, cLen = cells.length, cell, rs; c < cLen; c++) {\r\n                    cell = cells[c];\r\n                    rs = cell.rowSpan - 1;\r\n                    if (rs > 0 && i + rs >= rowIndexFirst) {\r\n                        cell.rowSpan -= util.getOverlapRangeAtIndex(rowIndexFirst, rowIndexLast, i, i + rs);\r\n                    }\r\n                }\r\n            }\r\n\r\n            for (let i = 0, len = removeRows.length; i < len; i++) {\r\n                util.removeItem(removeRows[i]);\r\n            }\r\n        }\r\n\r\n        mergeCell.innerHTML += mergeHTML;\r\n        mergeCell.colSpan = cs;\r\n        mergeCell.rowSpan = rs;\r\n\r\n        this.controllersOff();\r\n        tablePlugin.setActiveButton.call(this, true, false);\r\n        tablePlugin.call_controller_tableEdit.call(this, mergeCell);\r\n\r\n        util.addClass(mergeCell, 'se-table-selected-cell');\r\n        this.focusEdge(mergeCell);\r\n    },\r\n\r\n    toggleHeader: function () {\r\n        const util = this.util;\r\n        const headerButton = this.context.table.headerButton;\r\n        const active = util.hasClass(headerButton, 'active');\r\n        const table = this.context.table._element;\r\n\r\n        if (!active) {\r\n            const header = util.createElement('THEAD');\r\n            header.innerHTML = '<tr>' + this.plugins.table.createCells.call(this, 'th', this.context.table._logical_cellCnt, false) + '</tr>';\r\n            table.insertBefore(header, table.firstElementChild);\r\n        } else {\r\n            util.removeItem(table.querySelector('thead'));\r\n        }\r\n\r\n        util.toggleClass(headerButton, 'active');\r\n\r\n        if (/TH/i.test(this.context.table._tdElement.nodeName)) {\r\n            this.controllersOff();\r\n        } else {\r\n            this.plugins.table.setPositionControllerDiv.call(this, this.context.table._tdElement, false);\r\n        }\r\n    },\r\n\r\n    setTableStyle: function (styles) {\r\n        const contextTable = this.context.table;\r\n        const tableElement = contextTable._element;\r\n        let icon, span, sizeIcon, text;\r\n\r\n        if (styles.indexOf('width') > -1) {\r\n            icon =  contextTable.resizeButton.firstElementChild;\r\n            span = contextTable.resizeText;\r\n\r\n            if (!contextTable._maxWidth) {\r\n                sizeIcon = contextTable.icons.expansion;\r\n                text = contextTable.maxText;\r\n                contextTable.columnFixedButton.style.display = 'none';\r\n                this.util.removeClass(tableElement, 'se-table-size-100');\r\n                this.util.addClass(tableElement, 'se-table-size-auto');\r\n            } else {\r\n                sizeIcon = contextTable.icons.reduction;\r\n                text = contextTable.minText;\r\n                contextTable.columnFixedButton.style.display = 'block';\r\n                this.util.removeClass(tableElement, 'se-table-size-auto');\r\n                this.util.addClass(tableElement, 'se-table-size-100');\r\n            }\r\n            \r\n            this.util.changeElement(icon, sizeIcon);\r\n            this.util.changeTxt(span, text);\r\n        }\r\n\r\n        if (styles.indexOf('column') > -1) {\r\n            if (!contextTable._fixedColumn) {\r\n                this.util.removeClass(tableElement, 'se-table-layout-fixed');\r\n                this.util.addClass(tableElement, 'se-table-layout-auto');\r\n                this.util.removeClass(contextTable.columnFixedButton, 'active');\r\n            } else {\r\n                this.util.removeClass(tableElement, 'se-table-layout-auto');\r\n                this.util.addClass(tableElement, 'se-table-layout-fixed');\r\n                this.util.addClass(contextTable.columnFixedButton, 'active');\r\n            }\r\n            \r\n        }\r\n    },\r\n\r\n    setActiveButton: function (fixedCell, selectedCell) {\r\n        const contextTable = this.context.table;\r\n\r\n        if (/^TH$/i.test(fixedCell.nodeName)) {\r\n            contextTable.insertRowAboveButton.setAttribute('disabled', true);\r\n            contextTable.insertRowBelowButton.setAttribute('disabled', true);\r\n        } else {\r\n            contextTable.insertRowAboveButton.removeAttribute('disabled');\r\n            contextTable.insertRowBelowButton.removeAttribute('disabled');\r\n        }\r\n\r\n        if (!selectedCell || fixedCell === selectedCell) {\r\n            contextTable.splitButton.removeAttribute('disabled');\r\n            contextTable.mergeButton.setAttribute('disabled', true);\r\n        } else {\r\n            contextTable.splitButton.setAttribute('disabled', true);\r\n            contextTable.mergeButton.removeAttribute('disabled');\r\n        }\r\n    },\r\n\r\n    // multi selecte\r\n    _bindOnSelect: null,\r\n    _bindOffSelect: null,\r\n    _bindOffShift: null,\r\n    _selectedCells: null,\r\n    _shift: false,\r\n    _fixedCell: null,\r\n    _fixedCellName: null,\r\n    _selectedCell: null,\r\n    _selectedTable: null,\r\n    _ref: null,\r\n    _toggleEditor: function (enabled) {\r\n        this.context.element.wysiwyg.setAttribute('contenteditable', enabled);\r\n        if (enabled) this.util.removeClass(this.context.element.wysiwyg, 'se-disabled');\r\n        else this.util.addClass(this.context.element.wysiwyg, 'se-disabled');\r\n    },\r\n\r\n    _offCellMultiSelect: function (e) {\r\n        e.stopPropagation();\r\n        const tablePlugin = this.plugins.table;\r\n\r\n        if (!tablePlugin._shift) {\r\n            tablePlugin._removeEvents.call(this);\r\n            tablePlugin._toggleEditor.call(this, true);\r\n        } else if (tablePlugin._initBind) {\r\n            this._wd.removeEventListener('touchmove', tablePlugin._initBind);\r\n            tablePlugin._initBind = null;\r\n        }\r\n\r\n        if (!tablePlugin._fixedCell || !tablePlugin._selectedTable) return;\r\n        \r\n        tablePlugin.setActiveButton.call(this, tablePlugin._fixedCell, tablePlugin._selectedCell);\r\n        tablePlugin.call_controller_tableEdit.call(this, tablePlugin._selectedCell || tablePlugin._fixedCell);\r\n\r\n        tablePlugin._selectedCells = tablePlugin._selectedTable.querySelectorAll('.se-table-selected-cell');\r\n        if (tablePlugin._selectedCell && tablePlugin._fixedCell) this.focusEdge(tablePlugin._selectedCell);\r\n\r\n        if (!tablePlugin._shift) {\r\n            tablePlugin._fixedCell = null;\r\n            tablePlugin._selectedCell = null;\r\n            tablePlugin._fixedCellName = null;\r\n        }\r\n    },\r\n\r\n    _onCellMultiSelect: function (e) {\r\n        this._antiBlur = true;\r\n        const tablePlugin = this.plugins.table;\r\n        const target = this.util.getParentElement(e.target, this.util.isCell);\r\n\r\n        if (tablePlugin._shift) {\r\n            if (target === tablePlugin._fixedCell) tablePlugin._toggleEditor.call(this, true);\r\n            else tablePlugin._toggleEditor.call(this, false);\r\n        } else if (!tablePlugin._ref) {\r\n            if (target === tablePlugin._fixedCell) return;\r\n            else tablePlugin._toggleEditor.call(this, false);\r\n        }\r\n\r\n        if (!target || target === tablePlugin._selectedCell || tablePlugin._fixedCellName !== target.nodeName || \r\n            tablePlugin._selectedTable !== this.util.getParentElement(target, 'TABLE')) {\r\n            return;\r\n        }\r\n\r\n        tablePlugin._selectedCell = target;\r\n        tablePlugin._setMultiCells.call(this, tablePlugin._fixedCell, target);\r\n    },\r\n\r\n    _setMultiCells: function (startCell, endCell) {\r\n        const tablePlugin = this.plugins.table;\r\n        const rows = tablePlugin._selectedTable.rows;\r\n        const util = this.util;\r\n\r\n        const selectedCells = tablePlugin._selectedTable.querySelectorAll('.se-table-selected-cell');\r\n        for (let i = 0, len = selectedCells.length; i < len; i++) {\r\n            util.removeClass(selectedCells[i], 'se-table-selected-cell');\r\n        }\r\n\r\n        if (startCell === endCell) {\r\n            util.addClass(startCell, 'se-table-selected-cell');\r\n            if (!tablePlugin._shift) return;\r\n        }\r\n\r\n        let findSelectedCell = true;\r\n        let spanIndex = [];\r\n        let rowSpanArr = [];\r\n        const ref = tablePlugin._ref = {_i: 0, cs: null, ce: null, rs: null, re: null};\r\n\r\n        for (let i = 0, len = rows.length, cells, colSpan; i < len; i++) {\r\n            cells = rows[i].cells;\r\n            colSpan = 0;\r\n\r\n            for (let c = 0, cLen = cells.length, cell, logcalIndex, cs, rs; c < cLen; c++) {\r\n                cell = cells[c];\r\n                cs = cell.colSpan - 1;\r\n                rs = cell.rowSpan - 1;\r\n                logcalIndex = c + colSpan;\r\n\r\n                if (spanIndex.length > 0) {\r\n                    for (let r = 0, arr; r < spanIndex.length; r++) {\r\n                        arr = spanIndex[r];\r\n                        if (arr.row > i) continue;\r\n                        if (logcalIndex >= arr.index) {\r\n                            colSpan += arr.cs;\r\n                            logcalIndex += arr.cs;\r\n                            arr.rs -= 1;\r\n                            arr.row = i + 1;\r\n                            if (arr.rs < 1) {\r\n                                spanIndex.splice(r, 1);\r\n                                r--;\r\n                            }\r\n                        } else if (c === cLen - 1) {\r\n                            arr.rs -= 1;\r\n                            arr.row = i + 1;\r\n                            if (arr.rs < 1) {\r\n                                spanIndex.splice(r, 1);\r\n                                r--;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (findSelectedCell) {\r\n                    if (cell === startCell || cell === endCell) {\r\n                        ref.cs = ref.cs !== null && ref.cs < logcalIndex ? ref.cs : logcalIndex;\r\n                        ref.ce = ref.ce !== null && ref.ce > logcalIndex + cs ? ref.ce : logcalIndex + cs;\r\n                        ref.rs = ref.rs !== null && ref.rs < i ? ref.rs : i;\r\n                        ref.re = ref.re !== null && ref.re > i + rs ? ref.re : i + rs;\r\n                        ref._i += 1;\r\n                    }\r\n                    \r\n                    if (ref._i === 2) {\r\n                        findSelectedCell = false;\r\n                        spanIndex = [];\r\n                        rowSpanArr = [];\r\n                        i = -1;\r\n                        break;\r\n                    }\r\n                } else if (util.getOverlapRangeAtIndex(ref.cs, ref.ce, logcalIndex, logcalIndex + cs) && util.getOverlapRangeAtIndex(ref.rs, ref.re, i, i + rs)) {\r\n                    const newCs = ref.cs < logcalIndex ? ref.cs : logcalIndex;\r\n                    const newCe = ref.ce > logcalIndex + cs ? ref.ce : logcalIndex + cs;\r\n                    const newRs = ref.rs < i ? ref.rs : i;\r\n                    const newRe = ref.re > i + rs ? ref.re : i + rs;\r\n\r\n                    if (ref.cs !== newCs || ref.ce !== newCe || ref.rs !== newRs || ref.re !== newRe) {\r\n                        ref.cs = newCs;\r\n                        ref.ce = newCe;\r\n                        ref.rs = newRs;\r\n                        ref.re = newRe;\r\n                        i = -1;\r\n\r\n                        spanIndex = [];\r\n                        rowSpanArr = [];\r\n                        break;\r\n                    }\r\n\r\n                    util.addClass(cell, 'se-table-selected-cell');\r\n                }\r\n\r\n                if (rs > 0) {\r\n                    rowSpanArr.push({\r\n                        index: logcalIndex,\r\n                        cs: cs + 1,\r\n                        rs: rs,\r\n                        row: -1\r\n                    });\r\n                }\r\n\r\n                colSpan += cell.colSpan - 1;\r\n            }\r\n\r\n            spanIndex = spanIndex.concat(rowSpanArr).sort(function (a, b) {return a.index - b.index;});\r\n            rowSpanArr = [];\r\n        }\r\n    },\r\n\r\n    _removeEvents: function () {\r\n        const tablePlugin = this.plugins.table;\r\n\r\n        if (tablePlugin._initBind) {\r\n            this._wd.removeEventListener('touchmove', tablePlugin._initBind);\r\n            tablePlugin._initBind = null;\r\n        }\r\n\r\n        if (tablePlugin._bindOnSelect) {\r\n            this._wd.removeEventListener('mousedown', tablePlugin._bindOnSelect);\r\n            this._wd.removeEventListener('mousemove', tablePlugin._bindOnSelect);\r\n            tablePlugin._bindOnSelect = null;\r\n        }\r\n\r\n        if (tablePlugin._bindOffSelect) {\r\n            this._wd.removeEventListener('mouseup', tablePlugin._bindOffSelect);\r\n            tablePlugin._bindOffSelect = null;\r\n        }\r\n\r\n        if (tablePlugin._bindOffShift) {\r\n            this._wd.removeEventListener('keyup', tablePlugin._bindOffShift);\r\n            tablePlugin._bindOffShift = null;\r\n        }\r\n    },\r\n\r\n    _initBind: null,\r\n    onTableCellMultiSelect: function (tdElement, shift) {\r\n        const tablePlugin = this.plugins.table;\r\n\r\n        tablePlugin._removeEvents.call(this);\r\n        this.controllersOff();\r\n\r\n        tablePlugin._shift = shift;\r\n        tablePlugin._fixedCell = tdElement;\r\n        tablePlugin._fixedCellName = tdElement.nodeName;\r\n        tablePlugin._selectedTable = this.util.getParentElement(tdElement, 'TABLE');\r\n\r\n        const selectedCells = tablePlugin._selectedTable.querySelectorAll('.se-table-selected-cell');\r\n        for (let i = 0, len = selectedCells.length; i < len; i++) {\r\n            this.util.removeClass(selectedCells[i], 'se-table-selected-cell');\r\n        }\r\n\r\n        this.util.addClass(tdElement, 'se-table-selected-cell');\r\n        \r\n        tablePlugin._bindOnSelect = tablePlugin._onCellMultiSelect.bind(this);\r\n        tablePlugin._bindOffSelect = tablePlugin._offCellMultiSelect.bind(this);\r\n\r\n        if (!shift) {\r\n            this._wd.addEventListener('mousemove', tablePlugin._bindOnSelect, false);\r\n        } else {\r\n            tablePlugin._bindOffShift = function () {\r\n                this.controllersOn(this.context.table.resizeDiv, this.context.table.tableController, this.plugins.table.init.bind(this), tdElement, 'table');\r\n                if (!tablePlugin._ref) this.controllersOff();\r\n            }.bind(this);\r\n\r\n            this._wd.addEventListener('keyup', tablePlugin._bindOffShift, false);\r\n            this._wd.addEventListener('mousedown', tablePlugin._bindOnSelect, false);\r\n        }\r\n\r\n        this._wd.addEventListener('mouseup', tablePlugin._bindOffSelect, false);\r\n        tablePlugin._initBind = tablePlugin.init.bind(this);\r\n        this._wd.addEventListener('touchmove', tablePlugin._initBind, false);\r\n    },\r\n\r\n    onClick_tableController: function (e) {\r\n        e.stopPropagation();\r\n        const target = e.target.getAttribute('data-command') ? e.target : e.target.parentNode;\r\n\r\n        if (target.getAttribute('disabled')) return;\r\n\r\n        const command = target.getAttribute('data-command');\r\n        const value = target.getAttribute('data-value');\r\n        const option = target.getAttribute('data-option');\r\n        const tablePlugin = this.plugins.table;\r\n        \r\n        if (typeof tablePlugin._closeSplitMenu === 'function') {\r\n            tablePlugin._closeSplitMenu();\r\n            if (command === 'onsplit') return;\r\n        }\r\n\r\n        if (!command) return;\r\n\r\n        e.preventDefault();\r\n        const contextTable = this.context.table;\r\n\r\n        switch (command) {\r\n            case 'insert':\r\n            case 'delete':\r\n                tablePlugin.editTable.call(this, value, option);\r\n                break;\r\n            case 'header':\r\n                tablePlugin.toggleHeader.call(this);\r\n                break;\r\n            case 'onsplit':\r\n                tablePlugin.openSplitMenu.call(this);\r\n                break;\r\n            case 'split':\r\n                tablePlugin.splitCells.call(this, value);\r\n                break;\r\n            case 'merge':\r\n                tablePlugin.mergeCells.call(this);\r\n                break;\r\n            case 'resize':\r\n                contextTable._maxWidth = !contextTable._maxWidth;\r\n                tablePlugin.setTableStyle.call(this, 'width');\r\n                tablePlugin.setPositionControllerTop.call(this, contextTable._element);\r\n                tablePlugin.setPositionControllerDiv.call(this, contextTable._tdElement, tablePlugin._shift);\r\n                break;\r\n            case 'layout':\r\n                contextTable._fixedColumn = !contextTable._fixedColumn;\r\n                tablePlugin.setTableStyle.call(this, 'column');\r\n                tablePlugin.setPositionControllerTop.call(this, contextTable._element);\r\n                tablePlugin.setPositionControllerDiv.call(this, contextTable._tdElement, tablePlugin._shift);\r\n                break;\r\n            case 'remove':\r\n                const emptyDiv = contextTable._element.parentNode;\r\n                this.util.removeItem(contextTable._element);\r\n                this.controllersOff();\r\n\r\n                if (emptyDiv !== this.context.element.wysiwyg) this.util.removeItemAllParents(emptyDiv, function (current) { return current.childNodes.length === 0; }, null);\r\n                this.focus();\r\n        }\r\n\r\n        // history stack\r\n        this.history.push(false);\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}