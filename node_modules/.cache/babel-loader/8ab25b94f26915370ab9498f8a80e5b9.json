{"ast":null,"code":"/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport dialog from '../modules/dialog';\nimport component from '../modules/component';\nimport resizing from '../modules/resizing';\nimport fileManager from '../modules/fileManager';\nexport default {\n  name: 'video',\n  display: 'dialog',\n  add: function add(core) {\n    core.addModule([dialog, component, resizing, fileManager]);\n    var options = core.options;\n    var context = core.context;\n    var contextVideo = context.video = {\n      _infoList: [],\n      // @Override fileManager\n      _infoIndex: 0,\n      // @Override fileManager\n      _uploadFileLength: 0,\n      // @Override fileManager\n      focusElement: null,\n      // @Override dialog // This element has focus when the dialog is opened.\n      sizeUnit: options._videoSizeUnit,\n      _align: 'none',\n      _floatClassRegExp: '__se__float\\\\-[a-z]+',\n      _youtubeQuery: options.youtubeQuery,\n      _videoRatio: options.videoRatio * 100 + '%',\n      _defaultRatio: options.videoRatio * 100 + '%',\n      _linkValue: '',\n      // @require @Override component\n      _element: null,\n      _cover: null,\n      _container: null,\n      // @Override resizing properties\n      inputX: null,\n      inputY: null,\n      _element_w: 1,\n      _element_h: 1,\n      _element_l: 0,\n      _element_t: 0,\n      _defaultSizeX: '100%',\n      _defaultSizeY: options.videoRatio * 100 + '%',\n      _origin_w: options.videoWidth === '100%' ? '' : options.videoWidth,\n      _origin_h: options.videoHeight === '56.25%' ? '' : options.videoHeight,\n      _proportionChecked: true,\n      _resizing: options.videoResizing,\n      _resizeDotHide: !options.videoHeightShow,\n      _rotation: options.videoRotation,\n      _onlyPercentage: options.videoSizeOnlyPercentage,\n      _ratio: false,\n      _ratioX: 1,\n      _ratioY: 1,\n      _captionShow: false\n    };\n    /** video dialog */\n\n    var video_dialog = this.setDialog(core);\n    contextVideo.modal = video_dialog;\n    contextVideo.videoInputFile = video_dialog.querySelector('._se_video_file');\n    contextVideo.videoUrlFile = video_dialog.querySelector('.se-input-url');\n    contextVideo.focusElement = contextVideo.videoUrlFile || contextVideo.videoInputFile;\n    contextVideo.preview = video_dialog.querySelector('.se-link-preview');\n    /** add event listeners */\n\n    video_dialog.querySelector('form').addEventListener('submit', this.submit.bind(core));\n    if (contextVideo.videoInputFile) video_dialog.querySelector('.se-dialog-files-edge-button').addEventListener('click', this._removeSelectedFiles.bind(contextVideo.videoInputFile, contextVideo.videoUrlFile, contextVideo.preview));\n    if (contextVideo.videoInputFile && contextVideo.videoUrlFile) contextVideo.videoInputFile.addEventListener('change', this._fileInputChange.bind(contextVideo));\n    if (contextVideo.videoUrlFile) contextVideo.videoUrlFile.addEventListener('input', this._onLinkPreview.bind(contextVideo.preview, contextVideo, options.linkProtocol));\n    contextVideo.proportion = {};\n    contextVideo.videoRatioOption = {};\n    contextVideo.inputX = {};\n    contextVideo.inputY = {};\n\n    if (options.videoResizing) {\n      contextVideo.proportion = video_dialog.querySelector('._se_video_check_proportion');\n      contextVideo.videoRatioOption = video_dialog.querySelector('.se-video-ratio');\n      contextVideo.inputX = video_dialog.querySelector('._se_video_size_x');\n      contextVideo.inputY = video_dialog.querySelector('._se_video_size_y');\n      contextVideo.inputX.value = options.videoWidth;\n      contextVideo.inputY.value = options.videoHeight;\n      contextVideo.inputX.addEventListener('keyup', this.setInputSize.bind(core, 'x'));\n      contextVideo.inputY.addEventListener('keyup', this.setInputSize.bind(core, 'y'));\n      contextVideo.inputX.addEventListener('change', this.setRatio.bind(core));\n      contextVideo.inputY.addEventListener('change', this.setRatio.bind(core));\n      contextVideo.proportion.addEventListener('change', this.setRatio.bind(core));\n      contextVideo.videoRatioOption.addEventListener('change', this.setVideoRatio.bind(core));\n      video_dialog.querySelector('.se-dialog-btn-revert').addEventListener('click', this.sizeRevert.bind(core));\n    }\n    /** append html */\n\n\n    context.dialog.modal.appendChild(video_dialog);\n    /** empty memory */\n\n    video_dialog = null;\n  },\n\n  /** dialog */\n  setDialog: function setDialog(core) {\n    var option = core.options;\n    var lang = core.lang;\n    var dialog = core.util.createElement('DIV');\n    dialog.className = 'se-dialog-content';\n    dialog.style.display = 'none';\n    var html = '' + '<form method=\"post\" enctype=\"multipart/form-data\">' + '<div class=\"se-dialog-header\">' + '<button type=\"button\" data-command=\"close\" class=\"se-btn se-dialog-close\" aria-label=\"Close\" title=\"' + lang.dialogBox.close + '\">' + core.icons.cancel + '</button>' + '<span class=\"se-modal-title\">' + lang.dialogBox.videoBox.title + '</span>' + '</div>' + '<div class=\"se-dialog-body\">';\n\n    if (option.videoFileInput) {\n      html += '' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.videoBox.file + '</label>' + '<div class=\"se-dialog-form-files\">' + '<input class=\"se-input-form _se_video_file\" type=\"file\" accept=\"' + option.videoAccept + '\"' + (option.videoMultipleFile ? ' multiple=\"multiple\"' : '') + '/>' + '<button type=\"button\" data-command=\"filesRemove\" class=\"se-btn se-dialog-files-edge-button se-file-remove\" title=\"' + lang.controller.remove + '\">' + core.icons.cancel + '</button>' + '</div>' + '</div>';\n    }\n\n    if (option.videoUrlInput) {\n      html += '' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.videoBox.url + '</label>' + '<input class=\"se-input-form se-input-url\" type=\"text\" />' + '<pre class=\"se-link-preview\"></pre>' + '</div>';\n    }\n\n    if (option.videoResizing) {\n      var ratioList = option.videoRatioList || [{\n        name: '16:9',\n        value: 0.5625\n      }, {\n        name: '4:3',\n        value: 0.75\n      }, {\n        name: '21:9',\n        value: 0.4285\n      }];\n      var ratio = option.videoRatio;\n      var onlyPercentage = option.videoSizeOnlyPercentage;\n      var onlyPercentDisplay = onlyPercentage ? ' style=\"display: none !important;\"' : '';\n      var heightDisplay = !option.videoHeightShow ? ' style=\"display: none !important;\"' : '';\n      var ratioDisplay = !option.videoRatioShow ? ' style=\"display: none !important;\"' : '';\n      var onlyWidthDisplay = !onlyPercentage && !option.videoHeightShow && !option.videoRatioShow ? ' style=\"display: none !important;\"' : '';\n      html += '' + '<div class=\"se-dialog-form\">' + '<div class=\"se-dialog-size-text\">' + '<label class=\"size-w\">' + lang.dialogBox.width + '</label>' + '<label class=\"se-dialog-size-x\">&nbsp;</label>' + '<label class=\"size-h\"' + heightDisplay + '>' + lang.dialogBox.height + '</label>' + '<label class=\"size-h\"' + ratioDisplay + '>(' + lang.dialogBox.ratio + ')</label>' + '</div>' + '<input class=\"se-input-control _se_video_size_x\" placeholder=\"100%\"' + (onlyPercentage ? ' type=\"number\" min=\"1\"' : 'type=\"text\"') + (onlyPercentage ? ' max=\"100\"' : '') + '/>' + '<label class=\"se-dialog-size-x\"' + onlyWidthDisplay + '>' + (onlyPercentage ? '%' : 'x') + '</label>' + '<input class=\"se-input-control _se_video_size_y\" placeholder=\"' + option.videoRatio * 100 + '%\"' + (onlyPercentage ? ' type=\"number\" min=\"1\"' : 'type=\"text\"') + (onlyPercentage ? ' max=\"100\"' : '') + heightDisplay + '/>' + '<select class=\"se-input-select se-video-ratio\" title=\"' + lang.dialogBox.ratio + '\"' + ratioDisplay + '>';\n      if (!heightDisplay) html += '<option value=\"\"> - </option>';\n\n      for (var i = 0, len = ratioList.length; i < len; i++) {\n        html += '<option value=\"' + ratioList[i].value + '\"' + (ratio.toString() === ratioList[i].value.toString() ? ' selected' : '') + '>' + ratioList[i].name + '</option>';\n      }\n\n      html += '</select>' + '<button type=\"button\" title=\"' + lang.dialogBox.revertButton + '\" class=\"se-btn se-dialog-btn-revert\" style=\"float: right;\">' + core.icons.revert + '</button>' + '</div>' + '<div class=\"se-dialog-form se-dialog-form-footer\"' + onlyPercentDisplay + onlyWidthDisplay + '>' + '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_video_check_proportion\" checked/>&nbsp;' + lang.dialogBox.proportion + '</label>' + '</div>';\n    }\n\n    html += '' + '</div>' + '<div class=\"se-dialog-footer\">' + '<div>' + '<label><input type=\"radio\" name=\"suneditor_video_radio\" class=\"se-dialog-btn-radio\" value=\"none\" checked>' + lang.dialogBox.basic + '</label>' + '<label><input type=\"radio\" name=\"suneditor_video_radio\" class=\"se-dialog-btn-radio\" value=\"left\">' + lang.dialogBox.left + '</label>' + '<label><input type=\"radio\" name=\"suneditor_video_radio\" class=\"se-dialog-btn-radio\" value=\"center\">' + lang.dialogBox.center + '</label>' + '<label><input type=\"radio\" name=\"suneditor_video_radio\" class=\"se-dialog-btn-radio\" value=\"right\">' + lang.dialogBox.right + '</label>' + '</div>' + '<button type=\"submit\" class=\"se-btn-primary\" title=\"' + lang.dialogBox.submitButton + '\"><span>' + lang.dialogBox.submitButton + '</span></button>' + '</div>' + '</form>';\n    dialog.innerHTML = html;\n    return dialog;\n  },\n  _fileInputChange: function _fileInputChange() {\n    if (!this.videoInputFile.value) {\n      this.videoUrlFile.removeAttribute('disabled');\n      this.preview.style.textDecoration = '';\n    } else {\n      this.videoUrlFile.setAttribute('disabled', true);\n      this.preview.style.textDecoration = 'line-through';\n    }\n  },\n  _removeSelectedFiles: function _removeSelectedFiles(urlInput, preview) {\n    this.value = '';\n\n    if (urlInput) {\n      urlInput.removeAttribute('disabled');\n      preview.style.textDecoration = '';\n    }\n  },\n  _onLinkPreview: function _onLinkPreview(context, protocol, e) {\n    var value = e.target.value.trim();\n\n    if (/^<iframe.*\\/iframe>$/.test(value)) {\n      context._linkValue = value;\n      this.textContent = '<IFrame :src=\"..\"></IFrame>';\n    } else {\n      context._linkValue = this.textContent = !value ? '' : protocol && value.indexOf('://') === -1 && value.indexOf('#') !== 0 ? protocol + value : value.indexOf('://') === -1 ? '/' + value : value;\n    }\n  },\n  _setTagAttrs: function _setTagAttrs(element) {\n    element.setAttribute('controls', true);\n    var attrs = this.options.videoTagAttrs;\n    if (!attrs) return;\n\n    for (var key in attrs) {\n      if (!this.util.hasOwn(attrs, key)) continue;\n      element.setAttribute(key, attrs[key]);\n    }\n  },\n  createVideoTag: function createVideoTag() {\n    var videoTag = this.util.createElement('VIDEO');\n\n    this.plugins.video._setTagAttrs.call(this, videoTag);\n\n    return videoTag;\n  },\n  _setIframeAttrs: function _setIframeAttrs(element) {\n    element.frameBorder = '0';\n    element.allowFullscreen = true;\n    var attrs = this.options.videoIframeAttrs;\n    if (!attrs) return;\n\n    for (var key in attrs) {\n      if (!this.util.hasOwn(attrs, key)) continue;\n      element.setAttribute(key, attrs[key]);\n    }\n  },\n  createIframeTag: function createIframeTag() {\n    var iframeTag = this.util.createElement('IFRAME');\n\n    this.plugins.video._setIframeAttrs.call(this, iframeTag);\n\n    return iframeTag;\n  },\n\n  /**\n   * @Override @Required fileManager\n   */\n  fileTags: ['iframe', 'video'],\n\n  /**\n   * @Override core, resizing, fileManager\n   * @description It is called from core.selectComponent.\n   * @param {Element} element Target element\n   */\n  select: function select(element) {\n    this.plugins.video.onModifyMode.call(this, element, this.plugins.resizing.call_controller_resize.call(this, element, 'video'));\n  },\n\n  /**\n   * @Override fileManager, resizing\n   */\n  destroy: function destroy(element) {\n    var frame = element || this.context.video._element;\n    var container = this.context.video._container;\n    var dataIndex = frame.getAttribute('data-index') * 1;\n    var focusEl = container.previousElementSibling || container.nextElementSibling;\n    var emptyDiv = container.parentNode;\n    this.util.removeItem(container);\n    this.plugins.video.init.call(this);\n    this.controllersOff();\n    if (emptyDiv !== this.context.element.wysiwyg) this.util.removeItemAllParents(emptyDiv, function (current) {\n      return current.childNodes.length === 0;\n    }, null); // focus\n\n    this.focusEdge(focusEl); // event\n\n    this.plugins.fileManager.deleteInfo.call(this, 'video', dataIndex, this.functions.onVideoUpload); // history stack\n\n    this.history.push(false);\n  },\n\n  /**\n   * @Required @Override dialog\n   */\n  on: function on(update) {\n    var contextVideo = this.context.video;\n\n    if (!update) {\n      contextVideo.inputX.value = contextVideo._origin_w = this.options.videoWidth === contextVideo._defaultSizeX ? '' : this.options.videoWidth;\n      contextVideo.inputY.value = contextVideo._origin_h = this.options.videoHeight === contextVideo._defaultSizeY ? '' : this.options.videoHeight;\n      contextVideo.proportion.disabled = true;\n      if (contextVideo.videoInputFile && this.options.videoMultipleFile) contextVideo.videoInputFile.setAttribute('multiple', 'multiple');\n    } else {\n      if (contextVideo.videoInputFile && this.options.videoMultipleFile) contextVideo.videoInputFile.removeAttribute('multiple');\n    }\n\n    if (contextVideo._resizing) {\n      this.plugins.video.setVideoRatioSelect.call(this, contextVideo._origin_h || contextVideo._defaultRatio);\n    }\n  },\n\n  /**\n   * @Required @Override dialog\n   */\n  open: function open() {\n    this.plugins.dialog.open.call(this, 'video', 'video' === this.currentControllerName);\n  },\n  setVideoRatio: function setVideoRatio(e) {\n    var contextVideo = this.context.video;\n    var value = e.target.options[e.target.selectedIndex].value;\n    contextVideo._defaultSizeY = contextVideo._videoRatio = !value ? contextVideo._defaultSizeY : value * 100 + '%';\n    contextVideo.inputY.placeholder = !value ? '' : value * 100 + '%';\n    contextVideo.inputY.value = '';\n  },\n\n  /**\n   * @Override resizing\n   * @param {String} xy 'x': width, 'y': height\n   * @param {KeyboardEvent} e Event object\n   */\n  setInputSize: function setInputSize(xy, e) {\n    if (e && e.keyCode === 32) {\n      e.preventDefault();\n      return;\n    }\n\n    var contextVideo = this.context.video;\n\n    this.plugins.resizing._module_setInputSize.call(this, contextVideo, xy);\n\n    if (xy === 'y') {\n      this.plugins.video.setVideoRatioSelect.call(this, e.target.value || contextVideo._defaultRatio);\n    }\n  },\n\n  /**\n   * @Override resizing\n   */\n  setRatio: function setRatio() {\n    this.plugins.resizing._module_setRatio.call(this, this.context.video);\n  },\n  submit: function submit(e) {\n    var contextVideo = this.context.video;\n    var videoPlugin = this.plugins.video;\n    e.preventDefault();\n    e.stopPropagation();\n    contextVideo._align = contextVideo.modal.querySelector('input[name=\"suneditor_video_radio\"]:checked').value;\n\n    try {\n      if (contextVideo.videoInputFile && contextVideo.videoInputFile.files.length > 0) {\n        this.showLoading();\n        videoPlugin.submitAction.call(this, this.context.video.videoInputFile.files);\n      } else if (contextVideo.videoUrlFile && contextVideo._linkValue.length > 0) {\n        this.showLoading();\n        videoPlugin.setup_url.call(this);\n      }\n    } catch (error) {\n      this.closeLoading();\n      throw Error('[SUNEDITOR.video.submit.fail] cause : \"' + error.message + '\"');\n    } finally {\n      this.plugins.dialog.close.call(this);\n    }\n\n    return false;\n  },\n  submitAction: function submitAction(fileList) {\n    if (fileList.length === 0) return;\n    var fileSize = 0;\n    var files = [];\n\n    for (var i = 0, len = fileList.length; i < len; i++) {\n      if (/video/i.test(fileList[i].type)) {\n        files.push(fileList[i]);\n        fileSize += fileList[i].size;\n      }\n    }\n\n    var limitSize = this.options.videoUploadSizeLimit;\n\n    if (limitSize > 0) {\n      var infoSize = 0;\n      var videosInfo = this.context.video._infoList;\n\n      for (var _i = 0, _len = videosInfo.length; _i < _len; _i++) {\n        infoSize += videosInfo[_i].size * 1;\n      }\n\n      if (fileSize + infoSize > limitSize) {\n        this.closeLoading();\n        var err = '[SUNEDITOR.videoUpload.fail] Size of uploadable total videos: ' + limitSize / 1000 + 'KB';\n\n        if (typeof this.functions.onVideoUploadError !== 'function' || this.functions.onVideoUploadError(err, {\n          'limitSize': limitSize,\n          'currentSize': infoSize,\n          'uploadSize': fileSize\n        }, this)) {\n          this.functions.noticeOpen(err);\n        }\n\n        return;\n      }\n    }\n\n    var contextVideo = this.context.video;\n    contextVideo._uploadFileLength = files.length;\n    var info = {\n      inputWidth: contextVideo.inputX.value,\n      inputHeight: contextVideo.inputY.value,\n      align: contextVideo._align,\n      isUpdate: this.context.dialog.updateModal,\n      element: contextVideo._element\n    };\n\n    if (typeof this.functions.onVideoUploadBefore === 'function') {\n      var result = this.functions.onVideoUploadBefore(files, info, this, function (data) {\n        if (data && this._w.Array.isArray(data.result)) {\n          this.plugins.video.register.call(this, info, data);\n        } else {\n          this.plugins.video.upload.call(this, info, data);\n        }\n      }.bind(this));\n      if (typeof result === 'undefined') return;\n\n      if (!result) {\n        this.closeLoading();\n        return;\n      }\n\n      if (typeof result === 'object' && result.length > 0) files = result;\n    }\n\n    this.plugins.video.upload.call(this, info, files);\n  },\n  error: function error(message, response) {\n    this.closeLoading();\n\n    if (typeof this.functions.onVideoUploadError !== 'function' || this.functions.onVideoUploadError(message, response, this)) {\n      this.functions.noticeOpen(message);\n      throw Error('[SUNEDITOR.plugin.video.error] response: ' + message);\n    }\n  },\n  upload: function upload(info, files) {\n    if (!files) {\n      this.closeLoading();\n      return;\n    }\n\n    if (typeof files === 'string') {\n      this.plugins.video.error.call(this, files, null);\n      return;\n    }\n\n    var videoUploadUrl = this.options.videoUploadUrl;\n    var filesLen = this.context.dialog.updateModal ? 1 : files.length; // server upload\n\n    if (typeof videoUploadUrl === 'string' && videoUploadUrl.length > 0) {\n      var formData = new FormData();\n\n      for (var i = 0; i < filesLen; i++) {\n        formData.append('file-' + i, files[i]);\n      }\n\n      this.plugins.fileManager.upload.call(this, videoUploadUrl, this.options.videoUploadHeader, formData, this.plugins.video.callBack_videoUpload.bind(this, info), this.functions.onVideoUploadError);\n    } else {\n      throw Error('[SUNEDITOR.videoUpload.fail] cause : There is no \"videoUploadUrl\" option.');\n    }\n  },\n  callBack_videoUpload: function callBack_videoUpload(info, xmlHttp) {\n    if (typeof this.functions.videoUploadHandler === 'function') {\n      this.functions.videoUploadHandler(xmlHttp, info, this);\n    } else {\n      var response = JSON.parse(xmlHttp.responseText);\n\n      if (response.errorMessage) {\n        this.plugins.video.error.call(this, response.errorMessage, response);\n      } else {\n        this.plugins.video.register.call(this, info, response);\n      }\n    }\n  },\n  register: function register(info, response) {\n    var fileList = response.result;\n    var videoTag = this.plugins.video.createVideoTag.call(this);\n\n    for (var i = 0, len = fileList.length, file; i < len; i++) {\n      file = {\n        name: fileList[i].name,\n        size: fileList[i].size\n      };\n      this.plugins.video.create_video.call(this, info.isUpdate ? info.element : videoTag.cloneNode(false), fileList[i].url, info.inputWidth, info.inputHeight, info.align, file, info.isUpdate);\n    }\n\n    this.closeLoading();\n  },\n  setup_url: function setup_url() {\n    try {\n      var contextVideo = this.context.video;\n      var url = contextVideo._linkValue;\n      if (url.length === 0) return false;\n      /** iframe source */\n\n      if (/^<iframe.*\\/iframe>$/.test(url)) {\n        var oIframe = new this._w.DOMParser().parseFromString(url, 'text/html').querySelector('iframe');\n        url = oIframe.src;\n        if (url.length === 0) return false;\n      }\n      /** youtube */\n\n\n      if (/youtu\\.?be/.test(url)) {\n        if (!/^http/.test(url)) url = 'https://' + url;\n        url = url.replace('watch?v=', '');\n\n        if (!/^\\/\\/.+\\/embed\\//.test(url)) {\n          url = url.replace(url.match(/\\/\\/.+\\//)[0], '//www.youtube.com/embed/').replace('&', '?&');\n        }\n\n        if (contextVideo._youtubeQuery.length > 0) {\n          if (/\\?/.test(url)) {\n            var splitUrl = url.split('?');\n            url = splitUrl[0] + '?' + contextVideo._youtubeQuery + '&' + splitUrl[1];\n          } else {\n            url += '?' + contextVideo._youtubeQuery;\n          }\n        }\n      } else if (/vimeo\\.com/.test(url)) {\n        if (url.endsWith('/')) {\n          url = url.slice(0, -1);\n        }\n\n        url = 'https://player.vimeo.com/video/' + url.slice(url.lastIndexOf('/') + 1);\n      }\n\n      this.plugins.video.create_video.call(this, this.plugins.video.createIframeTag.call(this), url, contextVideo.inputX.value, contextVideo.inputY.value, contextVideo._align, null, this.context.dialog.updateModal);\n    } catch (error) {\n      throw Error('[SUNEDITOR.video.upload.fail] cause : \"' + error.message + '\"');\n    } finally {\n      this.closeLoading();\n    }\n  },\n  create_video: function create_video(oFrame, src, width, height, align, file, isUpdate) {\n    this.context.resizing._resize_plugin = 'video';\n    var contextVideo = this.context.video;\n    var cover = null;\n    var container = null;\n    var init = false;\n    /** update */\n\n    if (isUpdate) {\n      oFrame = contextVideo._element;\n\n      if (oFrame.src !== src) {\n        init = true;\n        var isYoutube = /youtu\\.?be/.test(src);\n        var isVimeo = /vimeo\\.com/.test(src);\n\n        if ((isYoutube || isVimeo) && !/^iframe$/i.test(oFrame.nodeName)) {\n          var newTag = this.plugins.video.createIframeTag.call(this);\n          newTag.src = src;\n          oFrame.parentNode.replaceChild(newTag, oFrame);\n          contextVideo._element = oFrame = newTag;\n        } else if (!isYoutube && !isVimeo && !/^videoo$/i.test(oFrame.nodeName)) {\n          var _newTag = this.plugins.video.createVideoTag.call(this);\n\n          _newTag.src = src;\n          oFrame.parentNode.replaceChild(_newTag, oFrame);\n          contextVideo._element = oFrame = _newTag;\n        } else {\n          oFrame.src = src;\n        }\n      }\n\n      container = contextVideo._container;\n      cover = this.util.getParentElement(oFrame, 'FIGURE');\n    }\n    /** create */\n    else {\n        init = true;\n        oFrame.src = src;\n        contextVideo._element = oFrame;\n        cover = this.plugins.component.set_cover.call(this, oFrame);\n        container = this.plugins.component.set_container.call(this, cover, 'se-video-container');\n      }\n    /** rendering */\n\n\n    contextVideo._cover = cover;\n    contextVideo._container = container;\n\n    var inputUpdate = this.plugins.resizing._module_getSizeX.call(this, contextVideo) !== (width || contextVideo._defaultSizeX) || this.plugins.resizing._module_getSizeY.call(this, contextVideo) !== (height || contextVideo._videoRatio);\n\n    var changeSize = !isUpdate || inputUpdate;\n\n    if (contextVideo._resizing) {\n      this.context.video._proportionChecked = contextVideo.proportion.checked;\n      oFrame.setAttribute('data-proportion', contextVideo._proportionChecked);\n    } // size\n\n\n    var isPercent = false;\n\n    if (changeSize) {\n      isPercent = this.plugins.video.applySize.call(this);\n    } // align\n\n\n    if (!(isPercent && align === 'center')) {\n      this.plugins.video.setAlign.call(this, null, oFrame, cover, container);\n    }\n\n    var changed = true;\n\n    if (!isUpdate) {\n      changed = this.insertComponent(container, false, true, !this.options.mediaAutoSelect);\n\n      if (!this.options.mediaAutoSelect) {\n        var line = this.appendFormatTag(container, null);\n        if (line) this.setRange(line, 0, line, 0);\n      }\n    } else if (contextVideo._resizing && this.context.resizing._rotateVertical && changeSize) {\n      this.plugins.resizing.setTransformSize.call(this, oFrame, null, null);\n    }\n\n    if (changed) {\n      if (init) {\n        this.plugins.fileManager.setInfo.call(this, 'video', oFrame, this.functions.onVideoUpload, file, true);\n      }\n\n      if (isUpdate) {\n        this.selectComponent(oFrame, 'video'); // history stack\n\n        this.history.push(false);\n      }\n    }\n\n    this.context.resizing._resize_plugin = '';\n  },\n  _update_videoCover: function _update_videoCover(oFrame) {\n    if (!oFrame) return;\n    var contextVideo = this.context.video;\n    if (/^video$/i.test(oFrame.nodeName)) this.plugins.video._setTagAttrs.call(this, oFrame);else this.plugins.video._setIframeAttrs.call(this, oFrame);\n    var existElement = this.util.getParentElement(oFrame, this.util.isMediaComponent) || this.util.getParentElement(oFrame, function (current) {\n      return this.isWysiwygDiv(current.parentNode);\n    }.bind(this.util));\n    var prevFrame = oFrame;\n    contextVideo._element = oFrame = oFrame.cloneNode(true);\n    var cover = contextVideo._cover = this.plugins.component.set_cover.call(this, oFrame);\n    var container = contextVideo._container = this.plugins.component.set_container.call(this, cover, 'se-video-container');\n\n    try {\n      var figcaption = existElement.querySelector('figcaption');\n      var caption = null;\n\n      if (!!figcaption) {\n        caption = this.util.createElement('DIV');\n        caption.innerHTML = figcaption.innerHTML;\n        this.util.removeItem(figcaption);\n      } // size\n\n\n      var size = (oFrame.getAttribute('data-size') || oFrame.getAttribute('data-origin') || '').split(',');\n      this.plugins.video.applySize.call(this, size[0] || prevFrame.style.width || prevFrame.width || '', size[1] || prevFrame.style.height || prevFrame.height || ''); // align\n\n      var format = this.util.getFormatElement(prevFrame);\n      if (format) contextVideo._align = format.style.textAlign || format.style.float;\n      this.plugins.video.setAlign.call(this, null, oFrame, cover, container);\n\n      if (this.util.isFormatElement(existElement) && existElement.childNodes.length > 0) {\n        existElement.parentNode.insertBefore(container, existElement);\n        this.util.removeItem(prevFrame); // clean format tag\n\n        this.util.removeEmptyNode(existElement, null);\n        if (existElement.children.length === 0) existElement.innerHTML = this.util.htmlRemoveWhiteSpace(existElement.innerHTML);\n      } else {\n        existElement.parentNode.replaceChild(container, existElement);\n      }\n\n      if (!!caption) existElement.parentNode.insertBefore(caption, container.nextElementSibling);\n    } catch (error) {\n      console.warn('[SUNEDITOR.video.error] Maybe the video tag is nested.', error);\n    }\n\n    this.plugins.fileManager.setInfo.call(this, 'video', oFrame, this.functions.onVideoUpload, null, true);\n    this.plugins.video.init.call(this);\n  },\n\n  /**\n   * @Required @Override fileManager, resizing\n   */\n  onModifyMode: function onModifyMode(element, size) {\n    var contextVideo = this.context.video;\n    contextVideo._element = element;\n    contextVideo._cover = this.util.getParentElement(element, 'FIGURE');\n    contextVideo._container = this.util.getParentElement(element, this.util.isMediaComponent);\n    contextVideo._align = element.style.float || element.getAttribute('data-align') || 'none';\n    element.style.float = '';\n\n    if (size) {\n      contextVideo._element_w = size.w;\n      contextVideo._element_h = size.h;\n      contextVideo._element_t = size.t;\n      contextVideo._element_l = size.l;\n    }\n\n    var origin = contextVideo._element.getAttribute('data-size') || contextVideo._element.getAttribute('data-origin');\n\n    var w, h;\n\n    if (origin) {\n      origin = origin.split(',');\n      w = origin[0];\n      h = origin[1];\n    } else if (size) {\n      w = size.w;\n      h = size.h;\n    }\n\n    contextVideo._origin_w = w || element.style.width || element.width || '';\n    contextVideo._origin_h = h || element.style.height || element.height || '';\n  },\n\n  /**\n   * @Required @Override fileManager, resizing\n   */\n  openModify: function openModify(notOpen) {\n    var contextVideo = this.context.video;\n    if (contextVideo.videoUrlFile) contextVideo._linkValue = contextVideo.preview.textContent = contextVideo.videoUrlFile.value = contextVideo._element.src || (contextVideo._element.querySelector('source') || '').src || '';\n    contextVideo.modal.querySelector('input[name=\"suneditor_video_radio\"][value=\"' + contextVideo._align + '\"]').checked = true;\n\n    if (contextVideo._resizing) {\n      this.plugins.resizing._module_setModifyInputSize.call(this, contextVideo, this.plugins.video);\n\n      var y = contextVideo._videoRatio = this.plugins.resizing._module_getSizeY.call(this, contextVideo);\n\n      var ratioSelected = this.plugins.video.setVideoRatioSelect.call(this, y);\n      if (!ratioSelected) contextVideo.inputY.value = contextVideo._onlyPercentage ? this.util.getNumber(y, 2) : y;\n    }\n\n    if (!notOpen) this.plugins.dialog.open.call(this, 'video', true);\n  },\n  setVideoRatioSelect: function setVideoRatioSelect(value) {\n    var ratioSelected = false;\n    var contextVideo = this.context.video;\n    var ratioOptions = contextVideo.videoRatioOption.options;\n    if (/%$/.test(value) || contextVideo._onlyPercentage) value = this.util.getNumber(value, 2) / 100 + '';else if (!this.util.isNumber(value) || value * 1 >= 1) value = '';\n    contextVideo.inputY.placeholder = '';\n\n    for (var i = 0, len = ratioOptions.length; i < len; i++) {\n      if (ratioOptions[i].value === value) {\n        ratioSelected = ratioOptions[i].selected = true;\n        contextVideo.inputY.placeholder = !value ? '' : value * 100 + '%';\n      } else ratioOptions[i].selected = false;\n    }\n\n    return ratioSelected;\n  },\n\n  /**\n   * @Override fileManager\n   */\n  checkFileInfo: function checkFileInfo() {\n    this.plugins.fileManager.checkInfo.call(this, 'video', ['iframe', 'video'], this.functions.onVideoUpload, this.plugins.video._update_videoCover.bind(this), true);\n  },\n\n  /**\n   * @Override fileManager\n   */\n  resetFileInfo: function resetFileInfo() {\n    this.plugins.fileManager.resetInfo.call(this, 'video', this.functions.onVideoUpload);\n  },\n\n  /**\n   * @Override fileManager\n   */\n  applySize: function applySize(w, h) {\n    var contextVideo = this.context.video;\n    if (!w) w = contextVideo.inputX.value || this.options.videoWidth;\n    if (!h) h = contextVideo.inputY.value || this.options.videoHeight;\n\n    if (contextVideo._onlyPercentage || /%$/.test(w) || !w) {\n      this.plugins.video.setPercentSize.call(this, w || '100%', h || (/%$/.test(contextVideo._videoRatio) ? contextVideo._videoRatio : contextVideo._defaultRatio));\n      return true;\n    } else if ((!w || w === 'auto') && (!h || h === 'auto')) {\n      this.plugins.video.setAutoSize.call(this);\n    } else {\n      this.plugins.video.setSize.call(this, w, h || contextVideo._videoRatio || contextVideo._defaultRatio, false);\n    }\n\n    return false;\n  },\n\n  /**\n   * @Override resizing\n   */\n  sizeRevert: function sizeRevert() {\n    this.plugins.resizing._module_sizeRevert.call(this, this.context.video);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setSize: function setSize(w, h, notResetPercentage, direction) {\n    var contextVideo = this.context.video;\n    var onlyW = /^(rw|lw)$/.test(direction);\n    var onlyH = /^(th|bh)$/.test(direction);\n    if (!onlyH) w = this.util.getNumber(w, 0);\n    if (!onlyW) h = this.util.isNumber(h) ? h + contextVideo.sizeUnit : !h ? '' : h;\n    if (!onlyH) contextVideo._element.style.width = w ? w + contextVideo.sizeUnit : '';\n    if (!onlyW) contextVideo._cover.style.paddingBottom = contextVideo._cover.style.height = h;\n\n    if (!onlyH && !/%$/.test(w)) {\n      contextVideo._cover.style.width = '';\n      contextVideo._container.style.width = '';\n    }\n\n    if (!onlyW && !/%$/.test(h)) {\n      contextVideo._element.style.height = h;\n    } else {\n      contextVideo._element.style.height = '';\n    }\n\n    if (!notResetPercentage) contextVideo._element.removeAttribute('data-percentage'); // save current size\n\n    this.plugins.resizing._module_saveCurrentSize.call(this, contextVideo);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setAutoSize: function setAutoSize() {\n    this.plugins.video.setPercentSize.call(this, 100, this.context.video._defaultRatio);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setOriginSize: function setOriginSize(dataSize) {\n    var contextVideo = this.context.video;\n\n    contextVideo._element.removeAttribute('data-percentage');\n\n    this.plugins.resizing.resetTransform.call(this, contextVideo._element);\n    this.plugins.video.cancelPercentAttr.call(this);\n    var originSize = ((dataSize ? contextVideo._element.getAttribute('data-size') : '') || contextVideo._element.getAttribute('data-origin') || '').split(',');\n\n    if (originSize) {\n      var w = originSize[0];\n      var h = originSize[1];\n\n      if (contextVideo._onlyPercentage || /%$/.test(w) && (/%$/.test(h) || !/\\d/.test(h))) {\n        this.plugins.video.setPercentSize.call(this, w, h);\n      } else {\n        this.plugins.video.setSize.call(this, w, h);\n      } // save current size\n\n\n      this.plugins.resizing._module_saveCurrentSize.call(this, contextVideo);\n    }\n  },\n\n  /**\n   * @Override resizing\n   */\n  setPercentSize: function setPercentSize(w, h) {\n    var contextVideo = this.context.video;\n    h = !!h && !/%$/.test(h) && !this.util.getNumber(h, 0) ? this.util.isNumber(h) ? h + '%' : h : this.util.isNumber(h) ? h + contextVideo.sizeUnit : h || contextVideo._defaultRatio;\n    contextVideo._container.style.width = this.util.isNumber(w) ? w + '%' : w;\n    contextVideo._container.style.height = '';\n    contextVideo._cover.style.width = '100%';\n    contextVideo._cover.style.height = h;\n    contextVideo._cover.style.paddingBottom = h;\n    contextVideo._element.style.width = '100%';\n    contextVideo._element.style.height = '100%';\n    contextVideo._element.style.maxWidth = '';\n    if (contextVideo._align === 'center') this.plugins.video.setAlign.call(this, null, null, null, null);\n\n    contextVideo._element.setAttribute('data-percentage', w + ',' + h); // save current size\n\n\n    this.plugins.resizing._module_saveCurrentSize.call(this, contextVideo);\n  },\n\n  /**\n   * @Override resizing\n   */\n  cancelPercentAttr: function cancelPercentAttr() {\n    var contextVideo = this.context.video;\n    contextVideo._cover.style.width = '';\n    contextVideo._cover.style.height = '';\n    contextVideo._cover.style.paddingBottom = '';\n    contextVideo._container.style.width = '';\n    contextVideo._container.style.height = '';\n    this.util.removeClass(contextVideo._container, this.context.video._floatClassRegExp);\n    this.util.addClass(contextVideo._container, '__se__float-' + contextVideo._align);\n    if (contextVideo._align === 'center') this.plugins.video.setAlign.call(this, null, null, null, null);\n  },\n\n  /**\n   * @Override resizing\n   */\n  setAlign: function setAlign(align, element, cover, container) {\n    var contextVideo = this.context.video;\n    if (!align) align = contextVideo._align;\n    if (!element) element = contextVideo._element;\n    if (!cover) cover = contextVideo._cover;\n    if (!container) container = contextVideo._container;\n\n    if (align && align !== 'none') {\n      cover.style.margin = 'auto';\n    } else {\n      cover.style.margin = '0';\n    }\n\n    if (/%$/.test(element.style.width) && align === 'center') {\n      container.style.minWidth = '100%';\n      cover.style.width = container.style.width;\n      cover.style.height = cover.style.height;\n      cover.style.paddingBottom = !/%$/.test(cover.style.height) ? cover.style.height : this.util.getNumber(this.util.getNumber(cover.style.height, 2) / 100 * this.util.getNumber(cover.style.width, 2), 2) + '%';\n    } else {\n      container.style.minWidth = '';\n      cover.style.width = this.context.resizing._rotateVertical ? element.style.height || element.offsetHeight : element.style.width || '100%';\n      cover.style.paddingBottom = cover.style.height;\n    }\n\n    if (!this.util.hasClass(container, '__se__float-' + align)) {\n      this.util.removeClass(container, contextVideo._floatClassRegExp);\n      this.util.addClass(container, '__se__float-' + align);\n    }\n\n    element.setAttribute('data-align', align);\n  },\n\n  /**\n   * @Override dialog\n   */\n  init: function init() {\n    var contextVideo = this.context.video;\n    if (contextVideo.videoInputFile) contextVideo.videoInputFile.value = '';\n    if (contextVideo.videoUrlFile) contextVideo._linkValue = contextVideo.preview.textContent = contextVideo.videoUrlFile.value = '';\n\n    if (contextVideo.videoInputFile && contextVideo.videoUrlFile) {\n      contextVideo.videoUrlFile.removeAttribute('disabled');\n      contextVideo.preview.style.textDecoration = '';\n    }\n\n    contextVideo._origin_w = this.options.videoWidth;\n    contextVideo._origin_h = this.options.videoHeight;\n    contextVideo.modal.querySelector('input[name=\"suneditor_video_radio\"][value=\"none\"]').checked = true;\n\n    if (contextVideo._resizing) {\n      contextVideo.inputX.value = this.options.videoWidth === contextVideo._defaultSizeX ? '' : this.options.videoWidth;\n      contextVideo.inputY.value = this.options.videoHeight === contextVideo._defaultSizeY ? '' : this.options.videoHeight;\n      contextVideo.proportion.checked = true;\n      contextVideo.proportion.disabled = true;\n      this.plugins.video.setVideoRatioSelect.call(this, contextVideo._defaultRatio);\n    }\n  }\n};","map":{"version":3,"sources":["/github/workspace/node_modules/suneditor/src/plugins/dialog/video.js"],"names":["dialog","component","resizing","fileManager","name","display","add","core","addModule","options","context","contextVideo","video","_infoList","_infoIndex","_uploadFileLength","focusElement","sizeUnit","_videoSizeUnit","_align","_floatClassRegExp","_youtubeQuery","youtubeQuery","_videoRatio","videoRatio","_defaultRatio","_linkValue","_element","_cover","_container","inputX","inputY","_element_w","_element_h","_element_l","_element_t","_defaultSizeX","_defaultSizeY","_origin_w","videoWidth","_origin_h","videoHeight","_proportionChecked","_resizing","videoResizing","_resizeDotHide","videoHeightShow","_rotation","videoRotation","_onlyPercentage","videoSizeOnlyPercentage","_ratio","_ratioX","_ratioY","_captionShow","video_dialog","setDialog","modal","videoInputFile","querySelector","videoUrlFile","preview","addEventListener","submit","bind","_removeSelectedFiles","_fileInputChange","_onLinkPreview","linkProtocol","proportion","videoRatioOption","value","setInputSize","setRatio","setVideoRatio","sizeRevert","appendChild","option","lang","util","createElement","className","style","html","dialogBox","close","icons","cancel","videoBox","title","videoFileInput","file","videoAccept","videoMultipleFile","controller","remove","videoUrlInput","url","ratioList","videoRatioList","ratio","onlyPercentage","onlyPercentDisplay","heightDisplay","ratioDisplay","videoRatioShow","onlyWidthDisplay","width","height","i","len","length","toString","revertButton","revert","basic","left","center","right","submitButton","innerHTML","removeAttribute","textDecoration","setAttribute","urlInput","protocol","e","target","trim","test","textContent","indexOf","_setTagAttrs","element","attrs","videoTagAttrs","key","hasOwn","createVideoTag","videoTag","plugins","call","_setIframeAttrs","frameBorder","allowFullscreen","videoIframeAttrs","createIframeTag","iframeTag","fileTags","select","onModifyMode","call_controller_resize","destroy","frame","container","dataIndex","getAttribute","focusEl","previousElementSibling","nextElementSibling","emptyDiv","parentNode","removeItem","init","controllersOff","wysiwyg","removeItemAllParents","current","childNodes","focusEdge","deleteInfo","functions","onVideoUpload","history","push","on","update","disabled","setVideoRatioSelect","open","currentControllerName","selectedIndex","placeholder","xy","keyCode","preventDefault","_module_setInputSize","_module_setRatio","videoPlugin","stopPropagation","files","showLoading","submitAction","setup_url","error","closeLoading","Error","message","fileList","fileSize","type","size","limitSize","videoUploadSizeLimit","infoSize","videosInfo","err","onVideoUploadError","noticeOpen","info","inputWidth","inputHeight","align","isUpdate","updateModal","onVideoUploadBefore","result","data","_w","Array","isArray","register","upload","response","videoUploadUrl","filesLen","formData","FormData","append","videoUploadHeader","callBack_videoUpload","xmlHttp","videoUploadHandler","JSON","parse","responseText","errorMessage","create_video","cloneNode","oIframe","DOMParser","parseFromString","src","replace","match","splitUrl","split","endsWith","slice","lastIndexOf","oFrame","_resize_plugin","cover","isYoutube","isVimeo","nodeName","newTag","replaceChild","getParentElement","set_cover","set_container","inputUpdate","_module_getSizeX","_module_getSizeY","changeSize","checked","isPercent","applySize","setAlign","changed","insertComponent","mediaAutoSelect","line","appendFormatTag","setRange","_rotateVertical","setTransformSize","setInfo","selectComponent","_update_videoCover","existElement","isMediaComponent","isWysiwygDiv","prevFrame","figcaption","caption","format","getFormatElement","textAlign","float","isFormatElement","insertBefore","removeEmptyNode","children","htmlRemoveWhiteSpace","console","warn","w","h","t","l","origin","openModify","notOpen","_module_setModifyInputSize","y","ratioSelected","getNumber","ratioOptions","isNumber","selected","checkFileInfo","checkInfo","resetFileInfo","resetInfo","setPercentSize","setAutoSize","setSize","_module_sizeRevert","notResetPercentage","direction","onlyW","onlyH","paddingBottom","_module_saveCurrentSize","setOriginSize","dataSize","resetTransform","cancelPercentAttr","originSize","maxWidth","removeClass","addClass","margin","minWidth","offsetHeight","hasClass"],"mappings":"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","sourcesContent":["/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport dialog from '../modules/dialog';\nimport component from '../modules/component';\nimport resizing from '../modules/resizing';\nimport fileManager from '../modules/fileManager';\n\nexport default {\n    name: 'video',\n    display: 'dialog',\n    add: function (core) {\n        core.addModule([dialog, component, resizing, fileManager]);\n\n        const options = core.options;\n        const context = core.context;\n        const contextVideo = context.video = {\n            _infoList: [], // @Override fileManager\n            _infoIndex: 0, // @Override fileManager\n            _uploadFileLength: 0, // @Override fileManager\n            focusElement: null, // @Override dialog // This element has focus when the dialog is opened.\n            sizeUnit: options._videoSizeUnit,\n            _align: 'none',\n            _floatClassRegExp: '__se__float\\\\-[a-z]+',\n            _youtubeQuery: options.youtubeQuery,\n            _videoRatio: (options.videoRatio * 100) + '%',\n            _defaultRatio: (options.videoRatio * 100) + '%',\n            _linkValue: '',\n            // @require @Override component\n            _element: null,\n            _cover: null,\n            _container: null,\n            // @Override resizing properties\n            inputX: null,\n            inputY: null,\n            _element_w: 1,\n            _element_h: 1,\n            _element_l: 0,\n            _element_t: 0,\n            _defaultSizeX: '100%',\n            _defaultSizeY: (options.videoRatio * 100) + '%',\n            _origin_w: options.videoWidth === '100%' ? '' : options.videoWidth,\n            _origin_h: options.videoHeight === '56.25%' ? '' : options.videoHeight,\n            _proportionChecked: true,\n            _resizing: options.videoResizing,\n            _resizeDotHide: !options.videoHeightShow,\n            _rotation: options.videoRotation,\n            _onlyPercentage: options.videoSizeOnlyPercentage,\n            _ratio: false,\n            _ratioX: 1,\n            _ratioY: 1,\n            _captionShow: false\n        };\n\n        /** video dialog */\n        let video_dialog = this.setDialog(core);\n        contextVideo.modal = video_dialog;\n        contextVideo.videoInputFile = video_dialog.querySelector('._se_video_file');\n        contextVideo.videoUrlFile = video_dialog.querySelector('.se-input-url');\n        contextVideo.focusElement = contextVideo.videoUrlFile || contextVideo.videoInputFile;\n        contextVideo.preview = video_dialog.querySelector('.se-link-preview');\n\n        /** add event listeners */\n        video_dialog.querySelector('form').addEventListener('submit', this.submit.bind(core));\n        if (contextVideo.videoInputFile) video_dialog.querySelector('.se-dialog-files-edge-button').addEventListener('click', this._removeSelectedFiles.bind(contextVideo.videoInputFile, contextVideo.videoUrlFile, contextVideo.preview));\n        if (contextVideo.videoInputFile && contextVideo.videoUrlFile) contextVideo.videoInputFile.addEventListener('change', this._fileInputChange.bind(contextVideo));\n        if (contextVideo.videoUrlFile) contextVideo.videoUrlFile.addEventListener('input', this._onLinkPreview.bind(contextVideo.preview, contextVideo, options.linkProtocol));\n\n        contextVideo.proportion = {};\n        contextVideo.videoRatioOption = {};\n        contextVideo.inputX = {};\n        contextVideo.inputY = {};\n        if (options.videoResizing) {\n            contextVideo.proportion = video_dialog.querySelector('._se_video_check_proportion');\n            contextVideo.videoRatioOption = video_dialog.querySelector('.se-video-ratio');\n            contextVideo.inputX = video_dialog.querySelector('._se_video_size_x');\n            contextVideo.inputY = video_dialog.querySelector('._se_video_size_y');\n            contextVideo.inputX.value = options.videoWidth;\n            contextVideo.inputY.value = options.videoHeight;\n\n            contextVideo.inputX.addEventListener('keyup', this.setInputSize.bind(core, 'x'));\n            contextVideo.inputY.addEventListener('keyup', this.setInputSize.bind(core, 'y'));\n\n            contextVideo.inputX.addEventListener('change', this.setRatio.bind(core));\n            contextVideo.inputY.addEventListener('change', this.setRatio.bind(core));\n            contextVideo.proportion.addEventListener('change', this.setRatio.bind(core));\n            contextVideo.videoRatioOption.addEventListener('change', this.setVideoRatio.bind(core));\n\n            video_dialog.querySelector('.se-dialog-btn-revert').addEventListener('click', this.sizeRevert.bind(core));\n        }\n\n        /** append html */\n        context.dialog.modal.appendChild(video_dialog);\n\n        /** empty memory */\n        video_dialog = null;\n    },\n\n    /** dialog */\n    setDialog: function (core) {\n        const option = core.options;\n        const lang = core.lang;\n        const dialog = core.util.createElement('DIV');\n\n        dialog.className = 'se-dialog-content';\n        dialog.style.display = 'none';\n        let html = '' +\n            '<form method=\"post\" enctype=\"multipart/form-data\">' +\n                '<div class=\"se-dialog-header\">' +\n                    '<button type=\"button\" data-command=\"close\" class=\"se-btn se-dialog-close\" aria-label=\"Close\" title=\"' + lang.dialogBox.close + '\">' +\n                        core.icons.cancel +\n                    '</button>' +\n                    '<span class=\"se-modal-title\">' + lang.dialogBox.videoBox.title + '</span>' +\n                '</div>' +\n                '<div class=\"se-dialog-body\">';\n\n                if (option.videoFileInput) {\n                    html += '' +\n                        '<div class=\"se-dialog-form\">' +\n                            '<label>' + lang.dialogBox.videoBox.file + '</label>' +\n                            '<div class=\"se-dialog-form-files\">' +\n                                '<input class=\"se-input-form _se_video_file\" type=\"file\" accept=\"' + option.videoAccept + '\"' + (option.videoMultipleFile ? ' multiple=\"multiple\"' : '') + '/>' +\n                                '<button type=\"button\" data-command=\"filesRemove\" class=\"se-btn se-dialog-files-edge-button se-file-remove\" title=\"' + lang.controller.remove + '\">' + core.icons.cancel + '</button>' +\n                            '</div>' +\n                        '</div>' ;\n                }\n    \n                if (option.videoUrlInput) {\n                    html += '' +\n                        '<div class=\"se-dialog-form\">' +\n                            '<label>' + lang.dialogBox.videoBox.url + '</label>' +\n                            '<input class=\"se-input-form se-input-url\" type=\"text\" />' +\n                            '<pre class=\"se-link-preview\"></pre>' +\n                        '</div>';\n                }\n\n            if (option.videoResizing) {\n                const ratioList = option.videoRatioList || [{name: '16:9', value: 0.5625}, {name: '4:3', value: 0.75}, {name: '21:9', value: 0.4285}];\n                const ratio = option.videoRatio;\n                const onlyPercentage = option.videoSizeOnlyPercentage;\n                const onlyPercentDisplay = onlyPercentage ? ' style=\"display: none !important;\"' : '';\n                const heightDisplay = !option.videoHeightShow ? ' style=\"display: none !important;\"' : '';\n                const ratioDisplay = !option.videoRatioShow ? ' style=\"display: none !important;\"' : '';\n                const onlyWidthDisplay = !onlyPercentage && !option.videoHeightShow && !option.videoRatioShow ? ' style=\"display: none !important;\"' : '';\n                html += '' +\n                    '<div class=\"se-dialog-form\">' +\n                        '<div class=\"se-dialog-size-text\">' +\n                            '<label class=\"size-w\">' + lang.dialogBox.width + '</label>' +\n                            '<label class=\"se-dialog-size-x\">&nbsp;</label>' +\n                            '<label class=\"size-h\"' + heightDisplay + '>' + lang.dialogBox.height + '</label>' +\n                            '<label class=\"size-h\"' + ratioDisplay + '>(' + lang.dialogBox.ratio + ')</label>' +\n                        '</div>' +\n                        '<input class=\"se-input-control _se_video_size_x\" placeholder=\"100%\"' + (onlyPercentage ? ' type=\"number\" min=\"1\"' : 'type=\"text\"') + (onlyPercentage ? ' max=\"100\"' : '') + '/>' +\n                        '<label class=\"se-dialog-size-x\"' + onlyWidthDisplay + '>' + (onlyPercentage ? '%' : 'x') + '</label>' +\n                        '<input class=\"se-input-control _se_video_size_y\" placeholder=\"' + (option.videoRatio * 100) + '%\"' + (onlyPercentage ? ' type=\"number\" min=\"1\"' : 'type=\"text\"') + (onlyPercentage ? ' max=\"100\"' : '') + heightDisplay + '/>' +\n                        '<select class=\"se-input-select se-video-ratio\" title=\"' + lang.dialogBox.ratio + '\"' + ratioDisplay + '>';\n                            if (!heightDisplay) html += '<option value=\"\"> - </option>';\n                            for (let i = 0, len = ratioList.length; i < len; i++) {\n                                html += '<option value=\"' + ratioList[i].value + '\"' + (ratio.toString() === ratioList[i].value.toString() ? ' selected' : '') + '>' + ratioList[i].name + '</option>';\n                            }\n                        html += '</select>' +\n                        '<button type=\"button\" title=\"' + lang.dialogBox.revertButton + '\" class=\"se-btn se-dialog-btn-revert\" style=\"float: right;\">' + core.icons.revert + '</button>' +\n                    '</div>' +\n                    '<div class=\"se-dialog-form se-dialog-form-footer\"' + onlyPercentDisplay + onlyWidthDisplay + '>' +\n                        '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_video_check_proportion\" checked/>&nbsp;' + lang.dialogBox.proportion + '</label>' +\n                    '</div>';\n            }\n\n            html += '' +\n                '</div>' +\n                '<div class=\"se-dialog-footer\">' +\n                    '<div>' +\n                        '<label><input type=\"radio\" name=\"suneditor_video_radio\" class=\"se-dialog-btn-radio\" value=\"none\" checked>' + lang.dialogBox.basic + '</label>' +\n                        '<label><input type=\"radio\" name=\"suneditor_video_radio\" class=\"se-dialog-btn-radio\" value=\"left\">' + lang.dialogBox.left + '</label>' +\n                        '<label><input type=\"radio\" name=\"suneditor_video_radio\" class=\"se-dialog-btn-radio\" value=\"center\">' + lang.dialogBox.center + '</label>' +\n                        '<label><input type=\"radio\" name=\"suneditor_video_radio\" class=\"se-dialog-btn-radio\" value=\"right\">' + lang.dialogBox.right + '</label>' +\n                    '</div>' +\n                    '<button type=\"submit\" class=\"se-btn-primary\" title=\"' + lang.dialogBox.submitButton + '\"><span>' + lang.dialogBox.submitButton + '</span></button>' +\n                '</div>' +\n            '</form>';\n\n        dialog.innerHTML = html;\n\n        return dialog;\n    },\n\n    _fileInputChange: function () {\n        if (!this.videoInputFile.value) {\n            this.videoUrlFile.removeAttribute('disabled');\n            this.preview.style.textDecoration = '';\n        } else {\n            this.videoUrlFile.setAttribute('disabled', true);\n            this.preview.style.textDecoration = 'line-through';\n        }\n    },\n\n    _removeSelectedFiles: function (urlInput, preview) {\n        this.value = '';\n        if (urlInput) {\n            urlInput.removeAttribute('disabled');\n            preview.style.textDecoration = '';\n        }\n    },\n\n    _onLinkPreview: function (context, protocol, e) {\n        const value = e.target.value.trim();\n        if (/^<iframe.*\\/iframe>$/.test(value)) {\n            context._linkValue = value;\n            this.textContent = '<IFrame :src=\"..\"></IFrame>';\n        } else {\n            context._linkValue = this.textContent = !value ? '' : (protocol && value.indexOf('://') === -1 && value.indexOf('#') !== 0) ? protocol + value : value.indexOf('://') === -1 ? '/' + value : value;\n        }\n    },\n\n    _setTagAttrs: function (element) {\n        element.setAttribute('controls', true);\n\n        const attrs = this.options.videoTagAttrs;\n        if (!attrs) return;\n\n        for (let key in attrs) {\n            if (!this.util.hasOwn(attrs, key)) continue;\n            element.setAttribute(key, attrs[key]);\n        }\n    },\n\n    createVideoTag: function () {\n        const videoTag = this.util.createElement('VIDEO');\n        this.plugins.video._setTagAttrs.call(this, videoTag);\n        return videoTag;\n    },\n\n    _setIframeAttrs: function (element) {\n        element.frameBorder = '0';\n        element.allowFullscreen = true;\n\n        const attrs = this.options.videoIframeAttrs;\n        if (!attrs) return;\n\n        for (let key in attrs) {\n            if (!this.util.hasOwn(attrs, key)) continue;\n            element.setAttribute(key, attrs[key]);\n        }\n    },\n\n    createIframeTag: function () {\n        const iframeTag = this.util.createElement('IFRAME');\n        this.plugins.video._setIframeAttrs.call(this, iframeTag);\n        return iframeTag;\n    },\n\n    /**\n     * @Override @Required fileManager\n     */\n    fileTags: ['iframe', 'video'],\n\n    /**\n     * @Override core, resizing, fileManager\n     * @description It is called from core.selectComponent.\n     * @param {Element} element Target element\n     */\n    select: function (element) {\n        this.plugins.video.onModifyMode.call(this, element, this.plugins.resizing.call_controller_resize.call(this, element, 'video'));\n    },\n\n    /**\n     * @Override fileManager, resizing\n     */\n    destroy: function (element) {\n        const frame = element || this.context.video._element;\n        const container = this.context.video._container;\n        const dataIndex = frame.getAttribute('data-index') * 1;\n        let focusEl = (container.previousElementSibling || container.nextElementSibling);\n\n        const emptyDiv = container.parentNode;\n        this.util.removeItem(container);\n        this.plugins.video.init.call(this);\n        this.controllersOff();\n\n        if (emptyDiv !== this.context.element.wysiwyg) this.util.removeItemAllParents(emptyDiv, function (current) { return current.childNodes.length === 0; }, null);\n\n        // focus\n        this.focusEdge(focusEl);\n\n        // event\n        this.plugins.fileManager.deleteInfo.call(this, 'video', dataIndex, this.functions.onVideoUpload);\n\n        // history stack\n        this.history.push(false);\n    },\n\n    /**\n     * @Required @Override dialog\n     */\n    on: function (update) {\n        const contextVideo = this.context.video;\n\n        if (!update) {\n            contextVideo.inputX.value = contextVideo._origin_w = this.options.videoWidth === contextVideo._defaultSizeX ? '' : this.options.videoWidth;\n            contextVideo.inputY.value = contextVideo._origin_h = this.options.videoHeight === contextVideo._defaultSizeY ? '' : this.options.videoHeight;\n            contextVideo.proportion.disabled = true;\n            if (contextVideo.videoInputFile && this.options.videoMultipleFile) contextVideo.videoInputFile.setAttribute('multiple', 'multiple');\n        } else {\n            if (contextVideo.videoInputFile && this.options.videoMultipleFile) contextVideo.videoInputFile.removeAttribute('multiple');\n        }\n\n        if (contextVideo._resizing) {\n            this.plugins.video.setVideoRatioSelect.call(this, contextVideo._origin_h || contextVideo._defaultRatio);\n        }\n    },\n\n    /**\n     * @Required @Override dialog\n     */\n    open: function () {\n        this.plugins.dialog.open.call(this, 'video', 'video' === this.currentControllerName);\n    },\n    \n    setVideoRatio: function (e) {\n        const contextVideo = this.context.video;\n        const value = e.target.options[e.target.selectedIndex].value;\n\n        contextVideo._defaultSizeY = contextVideo._videoRatio = !value ? contextVideo._defaultSizeY : (value * 100) + '%';\n        contextVideo.inputY.placeholder = !value ? '' : (value * 100) + '%';\n        contextVideo.inputY.value = '';\n    },\n\n    /**\n     * @Override resizing\n     * @param {String} xy 'x': width, 'y': height\n     * @param {KeyboardEvent} e Event object\n     */\n    setInputSize: function (xy, e) {\n        if (e && e.keyCode === 32) {\n            e.preventDefault();\n            return;\n        }\n\n        const contextVideo = this.context.video;\n        this.plugins.resizing._module_setInputSize.call(this, contextVideo, xy);\n\n        if (xy === 'y') {\n            this.plugins.video.setVideoRatioSelect.call(this, e.target.value || contextVideo._defaultRatio);\n        }\n    },\n\n    /**\n     * @Override resizing\n     */\n    setRatio: function () {\n        this.plugins.resizing._module_setRatio.call(this, this.context.video);\n    },\n\n    submit: function (e) {\n        const contextVideo = this.context.video;\n        const videoPlugin = this.plugins.video;\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        contextVideo._align = contextVideo.modal.querySelector('input[name=\"suneditor_video_radio\"]:checked').value;\n\n        try {\n            if (contextVideo.videoInputFile && contextVideo.videoInputFile.files.length > 0) {\n                this.showLoading();\n                videoPlugin.submitAction.call(this, this.context.video.videoInputFile.files);\n            } else if (contextVideo.videoUrlFile && contextVideo._linkValue.length > 0) {\n                this.showLoading();\n                videoPlugin.setup_url.call(this);\n            }\n        } catch (error) {\n            this.closeLoading();\n            throw Error('[SUNEDITOR.video.submit.fail] cause : \"' + error.message + '\"');\n        } finally {\n            this.plugins.dialog.close.call(this);\n        }\n\n        return false;\n    },\n\n    submitAction: function (fileList) {\n        if (fileList.length === 0) return;\n\n        let fileSize = 0;\n        let files = [];\n        for (let i = 0, len = fileList.length; i < len; i++) {\n            if (/video/i.test(fileList[i].type)) {\n                files.push(fileList[i]);\n                fileSize += fileList[i].size;\n            }\n        }\n\n        const limitSize = this.options.videoUploadSizeLimit;\n        if (limitSize > 0) {\n            let infoSize = 0;\n            const videosInfo = this.context.video._infoList;\n            for (let i = 0, len = videosInfo.length; i < len; i++) {\n                infoSize += videosInfo[i].size * 1;\n            }\n\n            if ((fileSize + infoSize) > limitSize) {\n                this.closeLoading();\n                const err = '[SUNEDITOR.videoUpload.fail] Size of uploadable total videos: ' + (limitSize/1000) + 'KB';\n                if (typeof this.functions.onVideoUploadError !== 'function' || this.functions.onVideoUploadError(err, { 'limitSize': limitSize, 'currentSize': infoSize, 'uploadSize': fileSize }, this)) {\n                    this.functions.noticeOpen(err);\n                }\n                return;\n            }\n        }\n\n        const contextVideo = this.context.video;\n        contextVideo._uploadFileLength = files.length;\n\n        const info = {\n            inputWidth: contextVideo.inputX.value,\n            inputHeight: contextVideo.inputY.value,\n            align: contextVideo._align,\n            isUpdate: this.context.dialog.updateModal,\n            element: contextVideo._element\n        };\n\n        if (typeof this.functions.onVideoUploadBefore === 'function') {\n            const result = this.functions.onVideoUploadBefore(files, info, this, function (data) {\n                if (data && this._w.Array.isArray(data.result)) {\n                    this.plugins.video.register.call(this, info, data);\n                } else {\n                    this.plugins.video.upload.call(this, info, data);\n                }\n            }.bind(this));\n\n            if (typeof result === 'undefined') return;\n            if (!result) {\n                this.closeLoading();\n                return;\n            }\n            if (typeof result === 'object' && result.length > 0) files = result;\n        }\n\n        this.plugins.video.upload.call(this, info, files);\n    },\n\n    error: function (message, response) {\n        this.closeLoading();\n        if (typeof this.functions.onVideoUploadError !== 'function' || this.functions.onVideoUploadError(message, response, this)) {\n            this.functions.noticeOpen(message);\n            throw Error('[SUNEDITOR.plugin.video.error] response: ' + message);\n        }\n    },\n\n    upload: function (info, files) {\n        if (!files) {\n            this.closeLoading();\n            return;\n        }\n        if (typeof files === 'string') {\n            this.plugins.video.error.call(this, files, null);\n            return;\n        }\n\n        const videoUploadUrl = this.options.videoUploadUrl;\n        const filesLen = this.context.dialog.updateModal ? 1 : files.length;\n\n        // server upload\n        if (typeof videoUploadUrl === 'string' && videoUploadUrl.length > 0) {\n            const formData = new FormData();\n            for (let i = 0; i < filesLen; i++) {\n                formData.append('file-' + i, files[i]);\n            }\n            this.plugins.fileManager.upload.call(this, videoUploadUrl, this.options.videoUploadHeader, formData, this.plugins.video.callBack_videoUpload.bind(this, info), this.functions.onVideoUploadError);\n        } else {\n            throw Error('[SUNEDITOR.videoUpload.fail] cause : There is no \"videoUploadUrl\" option.');\n        }\n    },\n\n    callBack_videoUpload: function (info, xmlHttp) {\n        if (typeof this.functions.videoUploadHandler === 'function') {\n            this.functions.videoUploadHandler(xmlHttp, info, this);\n        } else {\n            const response = JSON.parse(xmlHttp.responseText);\n            if (response.errorMessage) {\n                this.plugins.video.error.call(this, response.errorMessage, response);\n            } else {\n                this.plugins.video.register.call(this, info, response);\n            }\n        }\n    },\n\n    register: function (info, response) {\n        const fileList = response.result;\n        const videoTag = this.plugins.video.createVideoTag.call(this);\n\n        for (let i = 0, len = fileList.length, file; i < len; i++) {\n            file = { name: fileList[i].name, size: fileList[i].size };\n            this.plugins.video.create_video.call(this, (info.isUpdate ? info.element : videoTag.cloneNode(false)), fileList[i].url, info.inputWidth, info.inputHeight, info.align, file, info.isUpdate);\n        }\n\n        this.closeLoading();\n    },\n\n    setup_url: function () {\n        try {\n            const contextVideo = this.context.video;\n            let url = contextVideo._linkValue;\n\n            if (url.length === 0) return false;\n\n            /** iframe source */\n            if (/^<iframe.*\\/iframe>$/.test(url)) {\n                const oIframe = (new this._w.DOMParser()).parseFromString(url, 'text/html').querySelector('iframe');\n                url = oIframe.src;\n                if (url.length === 0) return false;\n            }\n            \n            /** youtube */\n            if (/youtu\\.?be/.test(url)) {\n                if (!/^http/.test(url)) url = 'https://' + url;\n                url = url.replace('watch?v=', '');\n                if (!/^\\/\\/.+\\/embed\\//.test(url)) {\n                    url = url.replace(url.match(/\\/\\/.+\\//)[0], '//www.youtube.com/embed/').replace('&', '?&');\n                }\n\n                if (contextVideo._youtubeQuery.length > 0) {\n                    if (/\\?/.test(url)) {\n                        const splitUrl = url.split('?');\n                        url = splitUrl[0] + '?' + contextVideo._youtubeQuery + '&' + splitUrl[1];\n                    } else {\n                        url += '?' + contextVideo._youtubeQuery;\n                    }\n                }\n            } else if (/vimeo\\.com/.test(url)) {\n                if (url.endsWith('/')) {\n                    url = url.slice(0, -1);\n                }\n                url = 'https://player.vimeo.com/video/' + url.slice(url.lastIndexOf('/') + 1);\n            }\n\n            this.plugins.video.create_video.call(this, this.plugins.video.createIframeTag.call(this), url, contextVideo.inputX.value, contextVideo.inputY.value, contextVideo._align, null, this.context.dialog.updateModal);\n        } catch (error) {\n            throw Error('[SUNEDITOR.video.upload.fail] cause : \"' + error.message + '\"');\n        } finally {\n            this.closeLoading();\n        }\n    },\n\n    create_video: function (oFrame, src, width, height, align, file, isUpdate) {\n        this.context.resizing._resize_plugin = 'video';\n        const contextVideo = this.context.video;\n        \n        let cover = null;\n        let container = null;\n        let init = false;\n\n        /** update */\n        if (isUpdate) {\n            oFrame = contextVideo._element;\n            if (oFrame.src !== src) {\n                init = true;\n                const isYoutube = /youtu\\.?be/.test(src);\n                const isVimeo = /vimeo\\.com/.test(src);\n                if ((isYoutube || isVimeo) && !/^iframe$/i.test(oFrame.nodeName)) {\n                    const newTag = this.plugins.video.createIframeTag.call(this);\n                    newTag.src = src;\n                    oFrame.parentNode.replaceChild(newTag, oFrame);\n                    contextVideo._element = oFrame = newTag;\n                } else if (!isYoutube && !isVimeo && !/^videoo$/i.test(oFrame.nodeName)) {\n                    const newTag = this.plugins.video.createVideoTag.call(this);\n                    newTag.src = src;\n                    oFrame.parentNode.replaceChild(newTag, oFrame);\n                    contextVideo._element = oFrame = newTag;\n                } else {\n                    oFrame.src = src;\n                }\n            }\n            container = contextVideo._container;\n            cover = this.util.getParentElement(oFrame, 'FIGURE');\n        }\n        /** create */\n        else {\n            init = true;\n            oFrame.src = src;\n            contextVideo._element = oFrame;\n            cover = this.plugins.component.set_cover.call(this, oFrame);\n            container = this.plugins.component.set_container.call(this, cover, 'se-video-container');\n        }\n\n        /** rendering */\n        contextVideo._cover = cover;\n        contextVideo._container = container;\n\n        const inputUpdate = (this.plugins.resizing._module_getSizeX.call(this, contextVideo) !== (width || contextVideo._defaultSizeX)) || (this.plugins.resizing._module_getSizeY.call(this, contextVideo) !== (height || contextVideo._videoRatio));\n        const changeSize = !isUpdate || inputUpdate;\n\n        if (contextVideo._resizing) {\n            this.context.video._proportionChecked = contextVideo.proportion.checked;\n            oFrame.setAttribute('data-proportion', contextVideo._proportionChecked);\n        }\n\n        // size\n        let isPercent = false;\n        if (changeSize) {\n            isPercent = this.plugins.video.applySize.call(this);\n        }\n\n        // align\n        if (!(isPercent && align === 'center')) {\n            this.plugins.video.setAlign.call(this, null, oFrame, cover, container);\n        }\n\n        let changed = true;\n        if (!isUpdate) {\n            changed = this.insertComponent(container, false, true, !this.options.mediaAutoSelect);\n            if (!this.options.mediaAutoSelect) {\n                const line = this.appendFormatTag(container, null);\n                if (line) this.setRange(line, 0, line, 0);\n            }\n        } else if (contextVideo._resizing && this.context.resizing._rotateVertical && changeSize) {\n            this.plugins.resizing.setTransformSize.call(this, oFrame, null, null);\n        }\n\n        if (changed) {\n            if (init) {\n                this.plugins.fileManager.setInfo.call(this, 'video', oFrame, this.functions.onVideoUpload, file, true);\n            }\n            if (isUpdate) {\n                this.selectComponent(oFrame, 'video');\n                // history stack\n                this.history.push(false);\n            }\n        }\n\n        this.context.resizing._resize_plugin = '';\n    },\n\n    _update_videoCover: function (oFrame) {\n        if (!oFrame) return;\n\n        const contextVideo = this.context.video;\n        \n        if (/^video$/i.test(oFrame.nodeName)) this.plugins.video._setTagAttrs.call(this, oFrame);\n        else this.plugins.video._setIframeAttrs.call(this, oFrame);\n        \n        const existElement = this.util.getParentElement(oFrame, this.util.isMediaComponent) || \n            this.util.getParentElement(oFrame, function (current) {\n                return this.isWysiwygDiv(current.parentNode);\n            }.bind(this.util));\n\n        const prevFrame = oFrame;\n        contextVideo._element = oFrame = oFrame.cloneNode(true);\n        const cover = contextVideo._cover = this.plugins.component.set_cover.call(this, oFrame);\n        const container = contextVideo._container = this.plugins.component.set_container.call(this, cover, 'se-video-container');\n\n        try {\n            const figcaption = existElement.querySelector('figcaption');\n            let caption = null;\n            if (!!figcaption) {\n                caption = this.util.createElement('DIV');\n                caption.innerHTML = figcaption.innerHTML;\n                this.util.removeItem(figcaption);\n            }\n\n            // size\n            const size = (oFrame.getAttribute('data-size') || oFrame.getAttribute('data-origin') || '').split(',');\n            this.plugins.video.applySize.call(this, (size[0] || prevFrame.style.width || prevFrame.width || ''), (size[1] || prevFrame.style.height || prevFrame.height || ''));\n\n            // align\n            const format = this.util.getFormatElement(prevFrame);\n            if (format) contextVideo._align = format.style.textAlign || format.style.float;\n            this.plugins.video.setAlign.call(this, null, oFrame, cover, container);\n\n            if (this.util.isFormatElement(existElement) && existElement.childNodes.length > 0) {\n                existElement.parentNode.insertBefore(container, existElement);\n                this.util.removeItem(prevFrame);\n                // clean format tag\n                this.util.removeEmptyNode(existElement, null);\n                if (existElement.children.length === 0) existElement.innerHTML = this.util.htmlRemoveWhiteSpace(existElement.innerHTML);\n            } else {\n                existElement.parentNode.replaceChild(container, existElement);\n            }\n\n            if (!!caption) existElement.parentNode.insertBefore(caption, container.nextElementSibling);\n        } catch (error) {\n            console.warn('[SUNEDITOR.video.error] Maybe the video tag is nested.', error);\n        }\n\n        this.plugins.fileManager.setInfo.call(this, 'video', oFrame, this.functions.onVideoUpload, null, true);\n        this.plugins.video.init.call(this);\n    },\n\n    /**\n     * @Required @Override fileManager, resizing\n     */\n    onModifyMode: function (element, size) {\n        const contextVideo = this.context.video;\n        contextVideo._element = element;\n        contextVideo._cover = this.util.getParentElement(element, 'FIGURE');\n        contextVideo._container = this.util.getParentElement(element, this.util.isMediaComponent);\n        contextVideo._align = element.style.float || element.getAttribute('data-align') || 'none';\n        element.style.float = '';\n\n        if (size) {\n            contextVideo._element_w = size.w;\n            contextVideo._element_h = size.h;\n            contextVideo._element_t = size.t;\n            contextVideo._element_l = size.l;\n        }\n\n        let origin = contextVideo._element.getAttribute('data-size') || contextVideo._element.getAttribute('data-origin');\n        let w, h;\n        if (origin) {\n            origin = origin.split(',');\n            w = origin[0];\n            h = origin[1];\n        } else if (size) {\n            w = size.w;\n            h = size.h;\n        }\n\n        contextVideo._origin_w = w || element.style.width || element.width || '';\n        contextVideo._origin_h = h || element.style.height || element.height || '';\n    },\n\n    /**\n     * @Required @Override fileManager, resizing\n     */\n    openModify: function (notOpen) {\n        const contextVideo = this.context.video;\n\n        if (contextVideo.videoUrlFile) contextVideo._linkValue = contextVideo.preview.textContent = contextVideo.videoUrlFile.value = (contextVideo._element.src || (contextVideo._element.querySelector('source') || '').src || '');\n        contextVideo.modal.querySelector('input[name=\"suneditor_video_radio\"][value=\"' + contextVideo._align + '\"]').checked = true;\n\n        if (contextVideo._resizing) {\n            this.plugins.resizing._module_setModifyInputSize.call(this, contextVideo, this.plugins.video);\n            \n            const y = contextVideo._videoRatio = this.plugins.resizing._module_getSizeY.call(this, contextVideo);\n            const ratioSelected = this.plugins.video.setVideoRatioSelect.call(this, y);\n            if (!ratioSelected) contextVideo.inputY.value = contextVideo._onlyPercentage ? this.util.getNumber(y, 2) : y;\n        }\n\n        if (!notOpen) this.plugins.dialog.open.call(this, 'video', true);\n    },\n    \n    setVideoRatioSelect: function (value) {\n        let ratioSelected = false;\n        const contextVideo = this.context.video;\n        const ratioOptions = contextVideo.videoRatioOption.options;\n\n        if (/%$/.test(value) || contextVideo._onlyPercentage) value = (this.util.getNumber(value, 2) / 100) + '';\n        else if (!this.util.isNumber(value) || (value * 1) >= 1) value = '';\n\n        contextVideo.inputY.placeholder = '';\n        for (let i = 0, len = ratioOptions.length; i < len; i++) {\n            if (ratioOptions[i].value === value) {\n                ratioSelected = ratioOptions[i].selected = true;\n                contextVideo.inputY.placeholder = !value ? '' : (value * 100) + '%';\n            }\n            else ratioOptions[i].selected = false;\n        }\n\n        return ratioSelected;\n    },\n\n    /**\n     * @Override fileManager\n     */\n    checkFileInfo: function () {\n        this.plugins.fileManager.checkInfo.call(this, 'video', ['iframe', 'video'], this.functions.onVideoUpload, this.plugins.video._update_videoCover.bind(this), true);\n    },\n\n    /**\n     * @Override fileManager\n     */\n    resetFileInfo: function () {\n        this.plugins.fileManager.resetInfo.call(this, 'video', this.functions.onVideoUpload);\n    },\n\n    /**\n     * @Override fileManager\n     */\n    applySize: function (w, h) {\n        const contextVideo = this.context.video;\n\n        if (!w) w = contextVideo.inputX.value || this.options.videoWidth;\n        if (!h) h = contextVideo.inputY.value || this.options.videoHeight;\n        \n        if (contextVideo._onlyPercentage || /%$/.test(w) || !w) {\n            this.plugins.video.setPercentSize.call(this, (w || '100%'), (h || (/%$/.test(contextVideo._videoRatio) ? contextVideo._videoRatio : contextVideo._defaultRatio)));\n            return true;\n        } else if ((!w || w === 'auto') && (!h || h === 'auto')) {\n            this.plugins.video.setAutoSize.call(this);\n        } else {\n            this.plugins.video.setSize.call(this, w, (h || contextVideo._videoRatio || contextVideo._defaultRatio), false);\n        }\n\n        return false;\n    },\n\n    /**\n     * @Override resizing\n     */\n    sizeRevert: function () {\n        this.plugins.resizing._module_sizeRevert.call(this, this.context.video);\n    },\n\n    /**\n     * @Override resizing\n     */\n    setSize: function (w, h, notResetPercentage, direction) {\n        const contextVideo = this.context.video;\n        const onlyW = /^(rw|lw)$/.test(direction);\n        const onlyH = /^(th|bh)$/.test(direction);\n\n        if (!onlyH) w = this.util.getNumber(w, 0);\n        if (!onlyW) h = this.util.isNumber(h) ? h + contextVideo.sizeUnit : !h ? '' : h;\n\n        if (!onlyH) contextVideo._element.style.width = w ? w + contextVideo.sizeUnit : '';\n        if (!onlyW) contextVideo._cover.style.paddingBottom = contextVideo._cover.style.height = h;\n\n        if (!onlyH && !/%$/.test(w)) {\n            contextVideo._cover.style.width = '';\n            contextVideo._container.style.width = '';\n        }\n\n        if (!onlyW && !/%$/.test(h)) {\n            contextVideo._element.style.height = h;\n        } else {\n            contextVideo._element.style.height = '';\n        }\n\n        if (!notResetPercentage) contextVideo._element.removeAttribute('data-percentage');\n\n        // save current size\n        this.plugins.resizing._module_saveCurrentSize.call(this, contextVideo);\n    },\n\n    /**\n     * @Override resizing\n     */\n    setAutoSize: function () {\n        this.plugins.video.setPercentSize.call(this, 100, this.context.video._defaultRatio);\n    },\n\n    /**\n     * @Override resizing\n     */\n    setOriginSize: function (dataSize) {\n        const contextVideo = this.context.video;\n        contextVideo._element.removeAttribute('data-percentage');\n\n        this.plugins.resizing.resetTransform.call(this, contextVideo._element);\n        this.plugins.video.cancelPercentAttr.call(this);\n\n        const originSize = ((dataSize ? contextVideo._element.getAttribute('data-size') : '') || contextVideo._element.getAttribute('data-origin') || '').split(',');\n        \n        if (originSize) {\n            const w = originSize[0];\n            const h = originSize[1];\n\n            if (contextVideo._onlyPercentage || (/%$/.test(w) && (/%$/.test(h) || !/\\d/.test(h)))) {\n                this.plugins.video.setPercentSize.call(this, w, h);\n            } else {\n                this.plugins.video.setSize.call(this, w, h);\n            }\n\n            // save current size\n            this.plugins.resizing._module_saveCurrentSize.call(this, contextVideo);\n        }\n    },\n\n    /**\n     * @Override resizing\n     */\n    setPercentSize: function (w, h) {\n        const contextVideo = this.context.video;\n        h = !!h && !/%$/.test(h) && !this.util.getNumber(h, 0) ? this.util.isNumber(h) ? h + '%' : h : this.util.isNumber(h) ? h + contextVideo.sizeUnit : (h || contextVideo._defaultRatio);\n\n        contextVideo._container.style.width = this.util.isNumber(w) ? w + '%' : w;\n        contextVideo._container.style.height = '';\n        contextVideo._cover.style.width = '100%';\n        contextVideo._cover.style.height = h;\n        contextVideo._cover.style.paddingBottom = h;\n        contextVideo._element.style.width = '100%';\n        contextVideo._element.style.height = '100%';\n        contextVideo._element.style.maxWidth = '';\n\n        if (contextVideo._align === 'center') this.plugins.video.setAlign.call(this, null, null, null, null);\n        contextVideo._element.setAttribute('data-percentage', w + ',' + h);\n\n        // save current size\n        this.plugins.resizing._module_saveCurrentSize.call(this, contextVideo);\n    },\n\n    /**\n     * @Override resizing\n     */\n    cancelPercentAttr: function () {\n        const contextVideo = this.context.video;\n        \n        contextVideo._cover.style.width = '';\n        contextVideo._cover.style.height = '';\n        contextVideo._cover.style.paddingBottom = '';\n        contextVideo._container.style.width = '';\n        contextVideo._container.style.height = '';\n\n        this.util.removeClass(contextVideo._container, this.context.video._floatClassRegExp);\n        this.util.addClass(contextVideo._container, '__se__float-' + contextVideo._align);\n\n        if (contextVideo._align === 'center') this.plugins.video.setAlign.call(this, null, null, null, null);\n    },\n\n    /**\n     * @Override resizing\n     */\n    setAlign: function (align, element, cover, container) {\n        const contextVideo = this.context.video;\n        \n        if (!align) align = contextVideo._align;\n        if (!element) element = contextVideo._element;\n        if (!cover) cover = contextVideo._cover;\n        if (!container) container = contextVideo._container;\n\n        if (align && align !== 'none') {\n            cover.style.margin = 'auto';\n        } else {\n            cover.style.margin = '0';\n        }\n\n        if (/%$/.test(element.style.width) && align === 'center') {\n            container.style.minWidth = '100%';\n            cover.style.width = container.style.width;\n            cover.style.height = cover.style.height;\n            cover.style.paddingBottom = !/%$/.test(cover.style.height) ? cover.style.height : this.util.getNumber((this.util.getNumber(cover.style.height, 2) / 100) * this.util.getNumber(cover.style.width, 2), 2) + '%';\n        } else {\n            container.style.minWidth = '';\n            cover.style.width = this.context.resizing._rotateVertical ? (element.style.height || element.offsetHeight) : (element.style.width || '100%');\n            cover.style.paddingBottom = cover.style.height;\n        }\n\n        if (!this.util.hasClass(container, '__se__float-' + align)) {\n            this.util.removeClass(container, contextVideo._floatClassRegExp);\n            this.util.addClass(container, '__se__float-' + align);\n        }\n        \n        element.setAttribute('data-align', align);\n    },\n\n    /**\n     * @Override dialog\n     */\n    init: function () {\n        const contextVideo = this.context.video;\n        if (contextVideo.videoInputFile) contextVideo.videoInputFile.value = '';\n        if (contextVideo.videoUrlFile) contextVideo._linkValue = contextVideo.preview.textContent = contextVideo.videoUrlFile.value = '';\n        if (contextVideo.videoInputFile && contextVideo.videoUrlFile) {\n            contextVideo.videoUrlFile.removeAttribute('disabled');\n            contextVideo.preview.style.textDecoration = '';\n        }\n\n        contextVideo._origin_w = this.options.videoWidth;\n        contextVideo._origin_h = this.options.videoHeight;\n        contextVideo.modal.querySelector('input[name=\"suneditor_video_radio\"][value=\"none\"]').checked = true;\n        \n        if (contextVideo._resizing) {\n            contextVideo.inputX.value = this.options.videoWidth === contextVideo._defaultSizeX ? '' : this.options.videoWidth;\n            contextVideo.inputY.value = this.options.videoHeight === contextVideo._defaultSizeY ? '' : this.options.videoHeight;\n            contextVideo.proportion.checked = true;\n            contextVideo.proportion.disabled = true;\n            this.plugins.video.setVideoRatioSelect.call(this, contextVideo._defaultRatio);\n        }\n    }\n};\n"]},"metadata":{},"sourceType":"module"}